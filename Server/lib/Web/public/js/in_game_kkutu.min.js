(function(){function e(e){32==e.keyCode&&(Ba.chatBtn.trigger("click"),e.preventDefault())}function t(){var e=Ua._list.slice(Ua.chain),a=Ua.room.opts.proverb?1:5,t="",s=e[0].length;20<=s&&(t="18px"),50<=s&&(t="15px"),Ba.game.display.css("font-size",t),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",Ba.game.display.html(e.slice(0,a).join(" ")),Ba.game.chain.show().html(Ua.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(a,2*a).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function s(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),0<e&&_(s,1e3,e-1)}function l(e){for(var a in e)$("#game-user-"+a+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[a]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function n(e,a){var t=e.toString();return"000000000000000".slice(0,Math.max(0,a-t.length))+t}function m(t,a,s){var l,n={type:t},e=s?Za:h||Za;for(l in a)n[l]=a[l];if("test"!=t&&10<Ya++){if(3<=++Qa)return e.close();Ya=5}e.send(JSON.stringify(n))}function p(e){e?$("#Intro").is(":visible")?(Ba.loading.hide(),$("#intro-text").html(e)):Ba.loading.show().html(e):Ba.loading.hide()}function u(e,a){var t=[$(window).width(),$(window).height()];return!a&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(t[0]-e.width()),top:.5*(t[1]-e.height())}),!0)}function g(e){Ua.opts=e,Ua.muteBGM=Ua.opts.mb,Ua.muteEff=Ua.opts.me,$("#mute-bgm").attr("checked",Ua.muteBGM),$("#mute-effect").attr("checked",Ua.muteEff),$("#deny-invite").attr("checked",Ua.opts.di),$("#deny-whisper").attr("checked",Ua.opts.dw),$("#deny-friend").attr("checked",Ua.opts.df),$("#auto-ready").attr("checked",Ua.opts.ar),$("#sort-user").attr("checked",Ua.opts.su),$("#only-waiting").attr("checked",Ua.opts.ow),$("#only-unlock").attr("checked",Ua.opts.ou),Ua.bgm&&(Ua.muteBGM?(Ua.bgm.volume=0,Ua.bgm.stop()):(Ua.bgm.volume=$("#bgmvol").val(),Ua.bgm=ra("lobby",!0)))}function k(t,a,s,l,d,e,n){var m=Ja(t,a,s,l,d,e,n);return Ua._timers.push(m),m}function _(t,a,s,l,d,e,n){var m=$a(t,a,s,l,d,e,n);return Ua._timers.push(m),m}function y(){}function v(t,a,s,l,d,e){if(Ua.room){var n=za[ja[Ua.room.mode]];if(!n)return null;Ha[n.rule][t].call(this,a,s,l,d,e)}}function C(e,a){var t=Ua.URL.replace(/:(\d+)/,function(a,t){return":"+(+t+416+ +e-1)})+"&"+e+"&"+a;h||(h=new Va(t),p(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){p(),h&&h.close()}),h.onopen=function(){console.log("room-conn",e,a)},h.onmessage=_onMessage,h.onclose=function(){console.log("room-disc",e,a),h=void 0},h.onerror=function(e){console.warn(L.error,e)})}function w(){if(!confirm(L.checkAgeAsk))return m("caj",{answer:"no"},!0);for(;;){for(var e,t=[],a=1;3>=a;)if(e=prompt(L["checkAgeInput"+a]),e&&!isNaN(e=+e))1==a&&(1e3>e||2999<e)?alert(e+"\n"+L.checkAgeNo):2==a&&(1>e||12<e)?alert(e+"\n"+L.checkAgeNo):3==a&&(1>e||31<e)?alert(e+"\n"+L.checkAgeNo):t[a++-1]=e;else if(1>--a)break;if(4==a){if(confirm(L.checkAgeSure+"\n"+t[0]+L.YEAR+" "+t[1]+L.MONTH+" "+t[2]+L.DATE))return m("caj",{answer:"yes",input:[t[1],t[2],t[0]]},!0);}else if(confirm(L.checkAgeCancel))return m("caj",{answer:"no"},!0)}}function A(t){function a(e){T(()=>(alert("\uBE44\uC815\uC0C1\uC801\uC778 \uC544\uC774\uD53C\uB85C \uD310\uB2E8\uB418\uC5B4 \uC811\uADFC\uC774 \uCC28\uB2E8\uB410\uC2B5\uB2C8\uB2E4."),Za.close())),Za.send(JSON.stringify({type:"recaptcha",token:e}))}var s,l;switch(t.type){case"recaptcha":var n=$("#intro-text");T(()=>(alert("\uBE44\uC815\uC0C1\uC801\uC778 \uC544\uC774\uD53C\uB85C \uD310\uB2E8\uB418\uC5B4 \uC811\uADFC\uC774 \uCC28\uB2E8\uB410\uC2B5\uB2C8\uB2E4."),Za.close())),n.empty(),n.text("\uC811\uC18D\uD558\uAE30 \uC804\uC5D0, \uBA3C\uC800 \uCEA1\uCC60 \uC778\uC99D\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.<br/>(\uC790\uB3D9\uD654 \uBD07\uC744 \uBC29\uC9C0\uD558\uAE30 \uC704\uD568\uC785\uB2C8\uB2E4)<br/><br/>"),n.append($("<div class=\"g-recaptcha\" id=\"recaptcha\" style=\"display: table; margin: 0 auto;\"></div>")),grecaptcha.render("recaptcha",{sitekey:t.siteKey,callback:a});break;case"welcome":if(t.guest)return alert("\uBE44\uD68C\uC6D0(\uAC8C\uC2A4\uD2B8)\uC740 \uAC8C\uC784\uC744 \uC774\uC6A9\uD558\uC2E4 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.\n\uC6B0\uCE21 \uC0C1\uB2E8\uC758 \uB85C\uADF8\uC778 \uB2E8\uCD94\uB97C \uB20C\uB7EC \uB85C\uADF8\uC778\uD574 \uBCF4\uC138\uC694!"),Za.close();Ua.id=t.id,Ua.guest=t.guest,Ua.admin=t.admin,Ua.users=t.users,Ua.robots={},Ua.rooms=t.rooms,Ua.place=0,Ua.friends=t.friends,Ua._friends={},Ua._playTime=t.playTime,Ua._okg=t.okg,Ua._gaming=!1,Ua.box=t.box,t.test&&alert(L.welcomeTestServer),location.hash[1]&&da(location.hash.slice(1)),B(void 0,!0),x(),t.caj&&w(),de();break;case"conn":Ua.setUser(t.user.id,t.user),N();break;case"disconn":Ua.setUser(t.id,null),N();break;case"connRoom":Ua._preQuick&&(ia("success"),Ba.dialog.quick.hide(),Ua.admin?null:delete Ua._preQuick),Ba.dialog.quick.hide(),Ua.setUser(t.user.id,t.user),l=Ua.usersR[t.user.id]=t.user,l.id==Ua.id?p():ha((l.profile.title||l.profile.name)+L.hasJoined),N();break;case"disconnRoom":l=Ua.usersR[t.id],l&&(Ua.admin?null:delete Ua.usersR[t.id],ha((l.profile.title||l.profile.name)+L.hasLeft),N());break;case"yell":if("debug"==t.value){var e=$("#bgmselect").val().substr(0,1);prompt(e)}else Da(t.value),ha(t.value,L.yell);break;case"info":ha(t.value,L.info);break;case"dying":Da(L.dying),ha(L.dying,L.yell);break;case"tail":ha(t.a+"|"+t.rid+"@"+t.id+": "+(t.msg instanceof String?t.msg:JSON.stringify(t.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":t.notice?ha(L["error_"+t.code]):ua(t.profile||{title:L.robot},t.value,t.from,t.timestamp);break;case"drawCanvas":Ba.game.canvas&&ga(t);break;case"roomStuck":h.close();break;case"preRoom":C(t.channel,t.id);break;case"room":P(t),E(t.modify&&t.myRoom),B(t.myRoom),t.modify&&Ua.room&&t.myRoom&&(Ua._rTitle!=Ua.room.title&&O(".room-head-title"),Ua._rMode!=Xe(Ua.room.mode,Ua.room.opts,!0)&&O(".room-head-mode"),Ua._rLimit!=Ua.room.limit&&O(".room-head-limit"),Ua._rRound!=Ua.room.round&&O(".room-head-round"),Ua._rTime!=Ua.room.time&&O(".room-head-time"));break;case"user":Ua.setUser(t.id,t),Ua.room&&B(Ua.room.id==t.place);break;case"friends":for(s in Ua._friends={},t.list)t.list[s].forEach(function(e){Ua._friends[e]={server:s}});de();break;case"friend":Ua._friends[t.id]={server:"on"==t.stat&&t.s},Ua._friends[t.id]&&Ua.friends[t.id]&&ha(("on"==t.stat?"&lt;<b>"+L["server_"+Ua._friends[t.id].server]+"</b>&gt; ":"")+L.friend+" "+Ua.friends[t.id]+L["fstat_"+t.stat]),de();break;case"friendAdd":l=Ua.users[t.from].profile,s=(l.title||l.name)+"(#"+t.from.substr(0,5)+")",m("friendAddRes",{from:t.from,res:!Ua.opts.df&&confirm(s+L.attemptFriendAdd)},!0);break;case"friendAddRes":l=Ua.users[t.target].profile,s=(l.title||l.name)+"(#"+t.target.substr(0,5)+")",ha(s+L["friendAddRes_"+(t.res?"ok":"no")]),t.res&&(Ua.friends[t.target]=l.title||l.name,Ua._friends[t.target]={server:Ua.server},de());break;case"friendEdit":Ua.friends=t.friends,de();break;case"starting":p(L.gameLoading);break;case"roundReady":v("roundReady",t);break;case"turnStart":v("turnStart",t);break;case"turnError":De(t.code,t.value);break;case"turnHint":v("turnHint",t);break;case"turnEnd":t.score=+t.score,t.bonus=+t.bonus,Ua.room&&(Ua._tid=t.target||Ua.room.game.seq[Ua.room.game.turn],Ua._tid&&(Ua._tid.robot&&(Ua._tid=Ua._tid.id),ze(Ua._tid,t)),t.baby&&ia("success"));break;case"roundEnd":for(s in t.users)Ua.setUser(s,t.users[s]);Ua._resultRank=t.ranks,Pe(t.result,t.data);break;case"kickVote":Ua._kickTarget=Ua.users[t.target],Ua.id!=t.target&&Ua.id!=Ua.room.master&&Be(t.target),ha((Ua._kickTarget.profile.title||Ua._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":ha(S(Ua._kickTarget.profile,t));break;case"invited":m("inviteRes",{from:t.from,res:!Ua.opts.di&&confirm(t.from+L.invited)});break;case"inviteNo":l=Ua.users[t.target],ha((l.profile.title||l.profile.name)+L.inviteDenied);break;case"okg":Ua._playTime>t.time?ha(L.okgExpired):Ua._okg!=t.count&&ha(L.okgNotice+" ("+L.okgCurrent+t.count+")"),Ua._playTime=t.time,Ua._okg=t.count;break;case"obtain":Ca(t);break;case"expired":for(s in t.list)ha(ka(t.list[s])+L.hasExpired);break;case"blocked":ha(L.blocked);break;case"test":(Ua._test=!Ua._test)?(Ua._testt=k(function(){Ba.talk.val()!=Ua._ttv&&(m("test",{ev:"c",v:Ba.talk.val()},!0),Ua._ttv=Ba.talk.val())},100),document.onkeydown=function(e){m("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){m("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(Ua._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(s=t.message||"",401==t.code);else if(403==t.code)p();else if(406==t.code){if(Ba.dialog.quick.is(":visible")){Ua._preQuick=!1;break}}else if(409==t.code)s=L["server_"+s];else{if(416==t.code)return void(confirm(L["error_"+t.code])&&(ta(),Ua._spectate=!0,Ua._gaming=!0,m("enter",{id:t.target,password:Ua._pw,spectate:!0},!0)));if(413==t.code)Ba.dialog.room.hide(),Ba.menu.setRoom.trigger("click");else if(429==t.code)ra("lobby");else if(430==t.code){if(Ua.setRoom(t.message,null),Ba.dialog.quick.is(":visible")){Ua._preQuick=!1;break}}else if(431==t.code||432==t.code||433==t.code)Ba.dialog.room.show();else if(444==t.code){if(s=t.message,-1!=s.indexOf("\uC0DD\uB144\uC6D4\uC77C")){alert("\uC0DD\uB144\uC6D4\uC77C\uC774 \uC62C\uBC14\uB974\uAC8C \uC785\uB825\uB418\uC9C0 \uC54A\uC544 \uAC8C\uC784 \uC774\uC6A9\uC774 \uC81C\uD55C\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574 \uC8FC\uC138\uC694.");break}}else if(447===t.code){alert("\uC790\uB3D9\uD654 \uBD07 \uBC29\uC9C0\uB97C \uC704\uD55C \uCEA1\uCC60 \uC778\uC99D\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4. \uBA54\uC778 \uD654\uBA74\uC5D0\uC11C \uB2E4\uC2DC \uC2DC\uB3C4\uD574 \uC8FC\uC138\uC694.");break}}alert("[#"+t.code+"] "+L["error_"+t.code]+s);}Ua._record&&Ae(t)}function T(e){$.getJSON("https://ipinfo.io/",a=>{if(!!Ua.admin)console.log(`접속 아이피: ${a.ip}`),console.log(`접속 지역: ${a.country}`);else if(-1==ao.indexOf(a.country))return e(a)})}function x(){var e=window.$Request;Ua.admin||delete window.$Request,ra("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),_(function(){$("#Intro").hide()},2e3),Ua.admin&&console.log("Administrator Mode\n(\uAD00\uB9AC\uC790 \uBAA8\uB4DC)"),e("devtools",()=>(alert("\uAC1C\uBC1C\uC790 \uB3C4\uAD6C(F12)\uB294 \uBCF4\uC548\uC0C1\uC758 \uC774\uC720\uB85C \uC0AC\uC6A9\uD558\uC2E4 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."),Za.close()),Ua,Ba),e("macro",()=>(alert("\uC6B4\uC601\uC815\uCC45 \uC704\uBC18\uC73C\uB85C \uC11C\uBC84\uC640\uC758 \uC5F0\uACB0\uC774 \uB04A\uC5B4\uC84C\uC2B5\uB2C8\uB2E4."),Za.close()),Ua,Ba),T(()=>(alert("\uBE44\uC815\uC0C1\uC801\uC778 \uC544\uC774\uD53C\uB85C \uD310\uB2E8\uB418\uC5B4 \uC811\uADFC\uC774 \uCC28\uB2E8\uB410\uC2B5\uB2C8\uB2E4."),Za.close())),Ua.admin&&$("#badwordfilter").prepend(`<option value="NO">필터링 안함</option>`)}function S(e,a){var t=L.agree+" "+a.Y+", "+L.disagree+" "+a.N+L.kickCon;return t+=a.Y>=a.N?(e.title||e.name)+L.kicked:(e.title||e.name)+L.kickDenied,t}function D(e){var a,t,s={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/\u3131":case"/r":Ua.room&&(Ua.room.master==Ua.id?Ba.menu.start.trigger("click"):Ba.menu.ready.trigger("click"));break;case"/\uCCAD\uC18C":case"/cls":la();break;case"/\u3139":case"/f":u(Ba.dialog.chatLog),Ba.chatLog.scrollTop(999999999);break;case"/\uADD3":case"/\u3137":case"/e":j(e[1],e.slice(2).join(" "));break;case"/\uB2F5":case"/\u3137\u3137":case"/ee":Ua._recentFrom?j(Ua._recentFrom,e.slice(1).join(" ")):ha(L.error_425);break;case"/\uBB34\uC2DC":case"/wb":q(e[1]);break;case"/\uCC28\uB2E8":case"/shut":R(e.slice(1).join(" "));break;case"/\uC544\uC774\uB514":case"/id":if(e[1]){for(a in t=0,e[1]=e.slice(1).join(" "),Ua.users)(Ua.users[a].profile.title||Ua.users[a].profile.name)==e[1]&&ha("["+ ++t+"] "+a);t||ha(L.error_405)}else ha(L.myId+Ua.id);break;default:for(a in s)ha(s[a],a);}}function j(e,a){a.length&&(Ua._whisper=e,m("talk",{whisper:e,value:a},!0),ua({title:"\u2192"+e},a,!0))}function q(e){Ua._wblock.hasOwnProperty(e)?(Ua.admin?null:delete Ua._wblock[e],ha(e+L.wnblocked)):(Ua._wblock[e]=!0,ha(e+L.wblocked))}function R(e){Ua._shut.hasOwnProperty(e)?(Ua.admin?null:delete Ua._shut[e],ha(e+L.userNShut)):(Ua._shut[e]=!0,ha(e+L.userShut))}function z(e,t){var e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,""),s=e.match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";return 1>e.length?t({error:404}):void $.get("/dict/"+e+"?lang="+s,t)}function P(t){var a,s,l,n;if(t.myRoom=Ua.place==t.room.id||t.target==Ua.id,t.myRoom){if($target=Ua.users[t.target],t.kickVote&&(ha(S($target.profile,t.kickVote)),$target.id==t.id&&alert(L.hasKicked)),-1==t.room.players.indexOf(Ua.id))Ua.room&&Ua.room.gaming&&(sa(),Ua.practicing=!1,Ua._gaming=!1,Ba.box.room.height(360),ra("lobby")),Ua.users[Ua.id].game.ready=!1,Ua.users[Ua.id].game.team=0,Ua.users[Ua.id].game.form="J",Ba.menu.spectate.removeClass("toggled"),Ba.menu.ready.removeClass("toggled"),Ua.room=null,Ua.resulting=!1,Ua._players=null,Ua._master=null,Ua.place=0,t.room.practice&&(Ua.admin?null:delete Ua.users[0],Ua.room=Ua._room,Ua.place=Ua._place,Ua.master=Ua.__master,Ua._players=Ua.__players,Ua.admin?null:delete Ua._room);else if(t.room.practice&&!Ua.practicing&&(Ua.practicing=!0,Ua._room=Ua.room,Ua._place=Ua.place,Ua.__master=Ua.master,Ua.__players=Ua._players),Ua.room&&(Ua._players=Ua.room.players.toString(),Ua._master=Ua.room.master,Ua._rTitle=Ua.room.title,Ua._rMode=Xe(Ua.room.mode,Ua.room.opts,!0),Ua._rLimit=Ua.room.limit,Ua._rRound=Ua.room.round,Ua._rTime=Ua.room.time),Ua.room=t.room,Ua.place=Ua.room.id,Ua.master=Ua.room.master==Ua.id,t.spec&&t.target==Ua.id){if(Ua._spectate||(Ua._spectate=!0,Te(),xe()),t.boards){for(a in Ua.selectedRound=1,t.prisoners)for(s in l=a.split(","),t.boards[l[0]])if(n=t.boards[l[0]][s],n[0]==l[1]&&n[1]==l[2]&&n[2]==l[3]){n[4]=t.prisoners[a];break}Ha.Crossword.roundReady(t,!0),Ha.Crossword.turnStart(t,!0)}for(a in t.spec)Ua.users[a].game.score=t.spec[a]}t.modify||t.target!=Ua.id||na()}if(t.target&&Ua.users[t.target]&&(-1==t.room.players.indexOf(t.target)?Ua.users[t.target].place=0:Ua.users[t.target].place=t.room.id),!t.room.practice)if(t.room.players.length)for(a in Ua.setRoom(t.room.id,t.room),t.room.readies)Ua.users[a]&&(Ua.users[a].game.ready=t.room.readies[a].r,Ua.users[a].game.team=t.room.readies[a].t);else Ua.setRoom(t.room.id,null)}function Z(){return Ua.place?Ua.room.gaming||Ua.resulting?"for-gaming":Ua.master?"for-master":"for-normal":"for-lobby"}function B(e,a){var t,s=Z();if(Ua._replay){if(void 0!==e&&!e)return;ve()}if(!Ua._replay&&("for-gaming"!=s||e)){for(t in Ua.practicing&&(s="for-gaming"),$(".kkutu-menu button").hide(),Ba.box)Ba.box[t].hide();Ba.box.me.show(),Ba.box.chat.show().width(790).height(190),Ba.chat.height(120),"for-lobby"==s?(Ua._ar_first=!0,Ba.box.userList.show(),Ua._shop?(Ba.box.roomList.hide(),Ba.box.shop.show()):(Ba.box.roomList.show(),Ba.box.shop.hide()),N(a||s!=Ua._only),I(a||s!=Ua._only),F(),Ua._jamsu&&(clearTimeout(Ua._jamsu),Ua.admin?null:delete Ua._jamsu)):"for-master"==s||"for-normal"==s?($(".team-chosen").removeClass("team-chosen"),Ua.users[Ua.id].game.ready||"S"==Ua.users[Ua.id].game.form?(Ba.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(Ba.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+Ua.users[Ua.id].game.team).addClass("team-chosen"),Ua.opts.ar&&Ua._ar_first&&(Ba.menu.ready.addClass("toggled"),Ba.menu.ready.trigger("click"),Ua._ar_first=!1)),Ua._shop=!1,Ba.box.room.show().height(360),"for-master"==s&&Ba.dialog.inviteList.is(":visible")&&N(),J(!1),F()):"for-gaming"==s&&(Ua._gAnim&&(Ba.box.room.show(),Ua._gAnim=!1),Ua._shop=!1,Ua._ar_first=!0,Ba.box.me.hide(),Ba.box.game.show(),$(".ChatBox").width(1e3).height(140),Ba.chat.height(70),J(!0)),Ua._only=s,xa(Ua.place),$(".kkutu-menu ."+s).show()}}function O(e){$(e).addClass("room-head-modified"),_(function(){$(e).removeClass("room-head-modified")},3e3)}function E(t){if(Ua._players&&Ua.room){var a,s,d=Ua._players.split(","),e=d.length,l=Ua.room.players.length;for(a in d)d[a]=="[object Object]"&&e--;for(a in Ua.room.players)Ua.room.players[a].robot&&l--;if(t){for(a in d)d[a]!="[object Object]"&&(Ua.users[d[a]].game.ready=!1);ha(L.hasModified)}Ua._gaming!=Ua.room.gaming&&(Ua.room.gaming?(ue(),Ua._replay=!1,Ce(Ua.room.game.title)):(Ua._spectate?(Ba.dialog.resultSave.hide(),Ua._spectate=!1,ra("lobby")):(Ba.dialog.resultSave.show(),Ua.resulting=!0),clearInterval(Ua._tTime))),Ua._master!=Ua.room.master&&(s=Ua.users[Ua.room.master],ha((s.profile.title||s.profile.name)+L.hasMaster)),Ua._players=Ua.room.players.toString(),Ua._master=Ua.room.master,Ua._gaming=Ua.room.gaming}}function F(){var t,s,l=Ua.users[Ua.id],n=0,m=$e(l.data.score),d=Na[m-2]||0,e=Na[m-1];for(t in 50>l.data.rankPoint?s="UNRANKED":50<=l.data.rankPoint&&500>l.data.rankPoint?s="BRONZE":500<=l.data.rankPoint&&1500>l.data.rankPoint?s="SILVER":1500<=l.data.rankPoint&&2500>l.data.rankPoint?s="GOLD":2500<=l.data.rankPoint&&3500>l.data.rankPoint?s="PLATINUM":3500<=l.data.rankPoint&&5e3>l.data.rankPoint?s="DIAMOND":5e3<=l.data.rankPoint&&(s="MASTER"),l.data.record)n+=l.data.record[t][1];Aa(".my-image",l.equip),$(".my-stat-level").replaceWith(Qe(l.data.score).addClass("my-stat-level")),$(".my-stat-name").html(l.profile.title||l.profile.name),$(".my-stat-record").html(L.globalWin+" "+n+L.W),$(".my-stat-ping").html(Ta(l.money)+L.ping),$(".my-rankPoint").html(l.data.rankPoint+L.LP),$(".my-rank").html(L[s]),$(".my-okg .graph-bar").width(Ua._playTime%6e5/6e3+"%"),$(".my-okg-text").html(G(Ua._playTime)),$(".my-level").html(L.LEVEL+" "+m),$(".my-gauge .graph-bar").width(190*((l.data.score-d)/(e-d))),$(".my-gauge-text").html(Ta(l.data.score)+" / "+Ta(e))}function G(t){var a=Math.floor(t/6e4)%60,s=Math.floor(.001*t)%60,l=Math.floor(t/36e5),d=[];return l&&d.push(l+L.HOURS),a&&d.push(a+L.MINUTE),l||d.push(s+L.SECOND),d.join(" ")}function N(t){var s,l,n,m=0;if(Ua.opts.su){for(s in n=[],Ua.users)m++,n.push(Ua.users[s]);n.sort(function(e,a){return a.data.score-e.data.score}),t=!0}else for(s in n=Ua.users,Ua.users)m++;if(Ba.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+Ua.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+m+L.MN+"]"),t)for(s in Ba.lobby.userList.empty(),Ba.dialog.inviteList.empty(),n)l=n[s],l.robot||(Ba.lobby.userList.append(M(l)),0==l.place&&Ba.dialog.inviteList.append(M(l,!0)))}function M(e,a){var t;return t=a?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Qe(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.profile.title||e.profile.name)).on("click",function(e){me($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Qe(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.profile.title||e.profile.name)).on("click",function(e){ne($(e.currentTarget).attr("id").slice(11))}),K(t,e),t}function K(e,a){a.equip.NIK&&e.addClass("x-"+a.equip.NIK),"b9_bf"==a.equip.BDG&&e.addClass("x-bf"),"b5_yt"==a.equip.BDG&&e.addClass("x-yt"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"b6_word"==a.equip.BDG&&e.addClass("x-word"),"b6_design"==a.equip.BDG&&e.addClass("x-design"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"1yearbadge"==a.equip.BDG&&e.addClass("x-1yearbadge"),"b6_usermanage"==a.equip.BDG&&e.addClass("x-uman"),"b6_develop"==a.equip.BDG&&e.addClass("x-develop"),"b6_money"==a.equip.BDG&&e.addClass("x-money"),"b1_master"==a.equip.BDG&&e.addClass("x-master")}function I(e){function a(){Ba.menu.newRoom.trigger("click")}var t,s=0;if(e)for(t in Ba.lobby.roomList.empty(),Ua.rooms)Ba.lobby.roomList.append(U(Ua.rooms[t])),s++;else for(t in $(".rooms-create").remove(),Ua.rooms)s++;Ba.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+s+L.GAE+"]"),s?($(".rooms-gaming").css("display",Ua.opts.ow?"none":""),$(".rooms-locked").css("display",Ua.opts.ou?"none":"")):Ba.lobby.roomList.append(Ba.lobby.createBanner.clone().on("click",a))}function U(e){var a,t,s=Xe(e.mode,e.opts);return a=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(t=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(){le(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(ma(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(s.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=t.get(0)&&da($(e.currentTarget).attr("id").slice(5))}),e.gaming&&a.addClass("rooms-gaming"),e.admin&&a.addClass("rooms-admin"+(o.gaming?"-gaming":"")),e.testing&&a.addClass("rooms-testing"+(o.gaming?"-gaming":"")),e.password&&a.addClass("rooms-locked"),a}function H(t){var a,s,l,n=$("<div>").attr("id","game-user-"+t.id).addClass("game-user").append(a=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(Qe(t.data.score).addClass("game-user-level")).append(l=$("<div>").addClass("game-user-name ellipse").html(t.profile.title||t.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+$e(t.data.score)))).append(s=$("<div>").addClass("game-user-score"));return Aa(a,t.equip),global.expl(n),K(l,t),t.game.team&&s.addClass("team-"+t.game.team),n}function W(e){var a,t,s=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(Qe(e.data.score).addClass("game-user-level")).append(t=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(a=$("<div>").addClass("game-user-score"));return e.id==Ua.id&&t.addClass("game-user-my-name"),K(t,e),e.game.team&&a.addClass("team-"+e.game.team),s}function V(e){return{title:L["aiLevel"+e]+" "+L.robot,image:"/img/kkutu/robot.png"}}function J(t){var a,s,p,u,y,v,C,w,A=za[ja[Ua.room.mode]],T=Ea||A.big?W:H,k=!1,x=!0;if(ea($(".RoomBox .product-title"),Ua.room),ea($(".GameBox .product-title"),Ua.room),t){for(a in p=$(".GameBox .game-body").empty(),Ua.room.game.seq)s=Ua._replay?Oa.users[Ua.room.game.seq[a]]||Ua.room.game.seq[a]:Ua.users[Ua.room.game.seq[a]]||Ua.robots[Ua.room.game.seq[a].id]||Ua.room.game.seq[a],s.robot&&!s.profile&&(s.profile=V(s.level),Ua.robots[s.id]=s),p.append(T(s)),Y(s.id,s.game.score||0);clearTimeout(Ua._jamsu),Ua.admin?null:delete Ua._jamsu}else{for(a in p=$(".room-users").empty(),w="S"==Ua.users[Ua.id].game.form,Ua.room.players)if(s=Ua.users[Ua.room.players[a]]||Ua.room.players[a],s.game){var S=s.game.practice?"/"+L.stat_practice:"",w="S"==s.game.form&&"/"+L.stat_spectate;s.robot&&(s.profile=V(s.level),Ua.robots[s.id]=s),p.append($("<div>").attr("id","room-user-"+s.id).addClass("room-user").append(v=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(u=$("<div>").addClass("room-user-ready")).append(y=$("<div>").addClass("room-user-team team-"+s.game.team).html($("#team-"+s.game.team).html()))).append($("<div>").addClass("room-user-title").append(Qe(s.data.score).addClass("room-user-level")).append(C=$("<div>").addClass("room-user-name").html(s.profile.title||s.profile.name))).on("click",function(e){ne($(e.currentTarget).attr("id").slice(10))})),Aa(v,s.equip),w&&y.hide(),s.id==Ua.room.master?u.addClass("room-user-master").html(L.master+S+(w||"")):w?u.addClass("room-user-spectate").html(L.stat_spectate+S):s.game.ready||s.robot?(u.addClass("room-user-readied").html(L.stat_ready),s.robot||(k=!0)):s.game.practice?(u.addClass("room-user-practice").html(L.stat_practice),x=!1):(u.html(L.stat_noready),x=!1),K(C,s)}k&&Ua.room.master==Ua.id&&x?Ua._jamsu||(Ua._jamsu=_(Q,5e3)):(clearTimeout(Ua._jamsu),Ua.admin?null:delete Ua._jamsu)}Ba.dialog.profile.is(":visible")&&ne(Ua._profiled)}function Q(){ha(L.subJamsu),Ua._jamsu=_(function(){m("leave"),alert(L.masterJamsu)},3e4)}function Y(e,a){var t;return(t=Ua["_s"+e])?(clearTimeout(t.timer),t.$obj=$("#game-user-"+e+" .game-user-score"),t.goal=a):t=Ua["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:a,now:0},X(t),$("#game-user-"+e)}function X(e){var a=(e.goal-e.now)*Math.min(1,.01*Ga);.1>a?a=e.goal-e.now:e.timer=_(X,Ga,e),e.now+=a,ee(e.$obj,Math.round(e.now))}function ee(e,a){var t,s=99999<a?n(Math.round(.001*a),4)+"k":n(a,5);for(e.empty(),t=0;t<s.length;t++)e.append($("<div>").addClass("game-user-score-char").html(s[t]))}function ae(e){var a=$("#dress-view"),t=Ua.users[Ua.id];Aa(a,t.equip),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-exordial").val(t.exordial),$("#dress-nickname").val(t.nickname),re(e||!0)}function oe(t,a,s,n,m){var e,c,p,u,_,y,v=[];for(y in t.empty(),n||(n={}),n)Ua.box.hasOwnProperty(n[y])||(Ua.box[n[y]]={value:0});for(y in Ua.box)v.push({key:y,obj:fa(y),value:Ua.box[y]});for(y in v.sort(function(e,a){return e.obj.name<a.obj.name?-1:1}),v)c=v[y].obj,p=v[y].value,u=c.group,"BDG"==u.substr(0,3)&&(u="BDG"),_="Mhand"==u?n.Mlhand==v[y].key||n.Mrhand==v[y].key:n[u]==v[y].key,"number"==typeof p&&(p={value:p}),(p.hasOwnProperty("value")||_)&&(!0===s||-1!=s.indexOf(c.group))&&(t.append(e=$("<div>").addClass("dress-item").append(Ye(c.image).addClass("dress-item-image").html("x"+p.value)).append(Fe(c,_,p.expire))),e.attr("id",a+"-"+c._id).on("click",m),_&&e.addClass("dress-equipped"));global.expl(t)}function re(e){var a,t=Ua.users[Ua.id].equip||{};Ua._avGroup=e,a=!!(!0===e)||(e||"").split(","),oe($("#dress-goods"),"dress",a,t,function(t){var a,s=$(t.currentTarget),l=s.attr("id").slice(6),d=fa(l);if(t.ctrlKey){if(s.hasClass("dress-equipped"))return Sa(426);if(!confirm(L.surePayback+Ta(Math.round(.2*(d.cost||0)))+L.ping))return;$.post("/payback/"+l,function(e){return e.error?Sa(e.error):void(alert(L.painback),Ua.box=e.box,Ua.users[Ua.id].money=e.money,ae(Ua._avGroup),B(!1))})}else if(-1!=Ra.indexOf(d.group))"Mhand"==d.group&&(a=confirm(L.dressWhichHand)),te(l,a);else if("CNS"==d.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+l,function(e){e.exp&&ha(L.obtainExp+": "+Ta(e.exp)),e.money&&ha(L.obtainMoney+": "+Ta(e.money)),e.gain.forEach(function(e){Ca(e)}),Ua.box=e.box,Ua.users[Ua.id].data=e.data,m("refresh"),ae(Ua._avGroup),F()})}})}function te(t,a){var s=Ua.users[Ua.id],l=Ua.shop[t].group;"Mhand"==l&&(l=a?"Mlhand":"Mrhand"),"BDG"==l.substr(0,3)&&(l="BDG");var n=s.equip[l]==t;confirm(L[n?"sureUnequip":"sureEquip"]+": "+L[t][0])&&$.post("/equip/"+t,{isLeft:a},function(e){return e.error?Sa(e.error):void(Ua.box=e.box,s.equip=e.equip,ae(Ua._avGroup),m("refresh"),B(!1))})}function ie(){function t(){d.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function s(){var s,p={WPC:1,WPB:2,WPA:3},u="",g=0;d.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),Ua._tray.forEach(function(e){s=fa(e),u+=e.slice(4),g+=p[e.slice(1,4)],d.append($("<div>").addClass("jt-image").css("background-image","url("+s.image+")").attr("id","cf-tray-"+e).on("click",n)),$("#cf-\\"+e).addClass("cf-tray-selected")}),e.html(L.searching),m.empty(),Ba.dialog.cfCompose.removeClass("cf-composable"),c.html(""),z(u,function(t){var a=!1;if(t.error){if(3!=u.length)return e.html(L["wpFail_"+t.error]);a=!0,e.html(L.cfBlend)}l(u,g,a),Ba.dialog.cfCompose.addClass("cf-composable"),t.error||e.html(We(t.word,t.mean,t.theme,t.type.split(",")))}),""==u&&t()}function l(e,a,t){$.get("/cf/"+e+"?l="+a+"&b="+(t?"1":""),function(e){return e.error?Sa(e.error):void(m.empty(),e.data.forEach(function(e){var a=fa(e.key),t=1<=e.rate?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";m.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+a.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(a.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(t)))}),c.html(L.cfCost+": "+e.cost+L.ping))})}function n(e){var a=$(e.currentTarget).attr("id").slice(8),t=Ua._tray.indexOf(a);-1!=t&&(Ua._tray.splice(t,1),s())}var d=$("#cf-tray"),e=$("#cf-dict"),m=$("#cf-reward"),a=$("#cf-goods"),c=$("#cf-cost");Ua._tray=[],e.empty(),m.empty(),c.html(""),Ba.dialog.cfCompose.removeClass("cf-composable"),oe(a,"cf",["PIX","PIY","PIZ"],null,function(t){var a,l=$(t.currentTarget),d=l.attr("id").slice(3),e=Ua.box[d],n=0;if(100<=Ua._tray.length)return Sa(435);for(a in Ua._tray)Ua._tray[a]==d&&n++;0<e-n?(Ua._tray.push(d),s()):Sa(434)}),t()}function se(e){var t=Ba.dialog.lbTable.empty(),a=e.data[0]?e.data[0].rank:0,s=(e.page||Math.floor(a/20))+1;e.data.forEach(function(e){var a=Ua.users[e.id];a=a?a.profile.title||a.profile.name:L.hidden,e.score=+e.score,t.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(Qe(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html($e(e.score)))).append($("<td>").html(a)).append($("<td>").html(Ta(e.score))))}),$("#ranking-"+Ua.id).addClass("ranking-me"),Ba.dialog.lbPage.html(L.page+" "+s),Ba.dialog.lbPrev.attr("disabled",1>=s),Ba.dialog.lbNext.attr("disabled",15>e.data.length),Ba.dialog.lbMe.attr("disabled",!!Ua.guest),Ua._lbpage=s-1}function de(){function t(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),t=Ua.friends[a],s=prompt(L.friendEditMemo,t);s&&m("friendEdit",{id:a,memo:s},!0)}function a(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),t=Ua.friends[a];return Ua._friends[a].server?Sa(455):void(confirm(t+"(#"+a.substr(0,5)+")\n"+L.friendSureRemove)&&m("friendRemove",{id:a},!0))}var s,l,n,p,u=0;for(s in Ba.dialog.commFriends.empty(),Ua.friends)u++,p=Ua.friends[s],l=Ua._friends[s]||{},n=(Ua.users[s]||{}).profile,Ba.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+s).append($("<div>").addClass("cfi-status cfi-stat-"+(l.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(l.server?L["server_"+l.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(n?n.title||n.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(p)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",t)).append($("<i>").addClass("fa fa-remove").on("click",a))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+u+" / 100)")}function le(e){var t=Ua.rooms[e],s=$("#ri-players").empty();Ua._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((t.password?"<i class='fa fa-lock'></i>&nbsp;":"")+t.title),$("#ri-mode").html(L["mode"+ja[t.mode]]),$("#ri-round").html(t.round+", "+t.time+L.SECOND),$("#ri-limit").html(t.players.length+" / "+t.limit),t.players.forEach(function(l,n){var d,m,c=t.readies[l]||{};l=Ua.users[l]||Fa,t.players[n].robot?(l.profile={title:L.robot},l.equip={robot:!0}):c.t=c.t||0,s.append($("<div>").addClass("ri-player").append(m=$("<div>").addClass("moremi rip-moremi")).append(d=$("<div>").addClass("ellipse rip-title").html(l.profile.title||l.profile.name)).append($("<div>").addClass("rip-team team-"+c.t).html($("#team-"+c.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+c.f]))),l.id==t.master&&d.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),d.prepend(Qe(l.data.score).addClass("profile-level rip-level")),Aa(m,l.equip)}),u(Ba.dialog.roomInfo),Ba.dialog.roomInfo.show()}function ne(t){var a,s,l,n,m=Ua.users[t]||Ua.robots[t],e=$("#profile-record").empty(),p=Ua.users[t];if(!m)return void ha(L.error_405);if($("#ProfileDiag .dialog-title").html((m.profile.title||m.profile.name)+L.sProfile),$(".profile-head").empty().append(a=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(Ye(m.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").html(m.profile.title||m.profile.name).append($("<label>").addClass("profile-tag").html(" #"+m.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(Qe(m.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(l=$e(m.data.score)))).append($("<div>").addClass("profile-score-text").html(Ta(m.data.score)+" / "+Ta(Na[l-1])+L.PTS))).append(s=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(ma(m.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(m.exordial))),m.robot)Ba.dialog.profileLevel.show(),Ba.dialog.profileLevel.prop("disabled",Ua.id!=Ua.room.master),$("#rank").html(L.UNRANKED),$("#rankpoint").html(L["0LP"]),$("#profile-place").html(Ua.room.id+L.roomNumber);else{for(l in n=50>p.data.rankPoint?"UNRANKED":50<=p.data.rankPoint&&500>p.data.rankPoint?"BRONZE":500<=p.data.rankPoint&&1500>p.data.rankPoint?"SILVER":1500<=p.data.rankPoint&&2500>p.data.rankPoint?"GOLD":2500<=p.data.rankPoint&&3500>p.data.rankPoint?"PLATINUM":3500<=p.data.rankPoint&&5e3>p.data.rankPoint?"DIAMOND":5e3<=p.data.rankPoint?"MASTER":"UNDEFINED",Ba.dialog.profileLevel.hide(),$("#rank").html(L[n]),$("#rankpoint").html(p.data.rankPoint+L.LP),$("#profile-place").html(m.place?m.place+L.roomNumber:L.lobby),m.data.record){var h=m.data.record[l];e.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+l])).append($("<div>").addClass("profile-field-record").html(h[0]+L.P+" "+h[1]+L.W)).append($("<div>").addClass("profile-field-score").html(Ta(h[2])+L.PTS)))}Aa(a,m.equip)}Ua._profiled=t,Ba.dialog.profileKick.hide(),Ba.dialog.profileShut.hide(),Ba.dialog.profileDress.hide(),Ba.dialog.profileWhisper.hide(),Ba.dialog.profileHandover.hide(),Ua.id==t?Ba.dialog.profileDress.show():m.robot||(Ba.dialog.profileShut.show(),Ba.dialog.profileWhisper.show()),Ua.room&&Ua.id!=t&&Ua.id==Ua.room.master&&(Ba.dialog.profileKick.show(),Ba.dialog.profileHandover.show()),u(Ba.dialog.profile),Ba.dialog.profile.show(),global.expl(s)}function me(e){var a;("AI"==e||(a=Ua.users[e].profile.title||Ua.users[e].profile.name,confirm(a+L.sureInvite)))&&m("invite",{target:e})}function ce(e){Ua._replay||Ua.lastFail!=Ua.id||Ua.id!=e?Ua.failCombo=0:(Ua.failCombo++,1==Ua.failCombo&&ha(L.trollWarning),1<Ua.failCombo&&(m("leave"),Sa(437))),Ua.lastFail=e}function pe(){Ua._spaced&&Ha.Typing.spaceOff(),clearInterval(Ua._tTime),Ua._relay=!1}function ue(){var e,t;for(e in Ua.room.players)t=Ua._replay?Oa.users[Ua.room.players[e]]||Ua.room.players[e]:Ua.users[Ua.room.players[e]]||Ua.robots[Ua.room.players[e].id],t.game.score=0,Ua.admin?null:delete Ua["_s"+Ua.room.players[e]];Ua.admin?null:delete Ua.lastFail,Ua.failCombo=0,Ua._spectate=-1==Ua.room.game.seq.indexOf(Ua.id),Ua._gAnim=!0,Ba.box.room.show().height(360).animate({height:1},500),Ba.box.game.height(1).animate({height:410},500),ta(),Ba.dialog.resultSave.attr("disabled",!1),Te(),Ba.game.display.html(L.soon),ia("game_start"),na(),_(function(){Ba.box.room.height(360).hide(),Ba.chat.scrollTop(999999999)},500)}function ge(){for(var t in Ua.room.game.seq)Ua.room.game.seq[t].robot&&(Ua.room.game.seq[t].game.score=0);for(t in Oa.users={},Oa.players){var s=Oa.players[t].id,l=Oa.readies[s]||{},n=Ua.users[s]||Ua.robots[s],m=s;Oa.players[t].robot?(n=Oa.users[s]={robot:!0},m=Oa.players[t],m.game={}):n=Oa.users[s]={},Ua.room.players.push(m),n.id=m,n.profile=Oa.players[t],n.data=n.profile.data,n.equip=n.profile.equip,n.game={score:0,team:l.t}}Ua._rf=0}function he(){for(var e in ve(),Ua._replay=!0,Ua.room={title:Oa.title,players:[],events:[],time:Oa.roundTime,round:Oa.round,mode:Oa.mode,limit:Oa.limit,game:Oa.game,opts:Oa.opts,readies:Oa.readies},ge(),Oa.events)Ua.room.events.push(Oa.events[e]);Ba.box.userList.hide(),Ba.box.roomList.hide(),Ba.box.game.show(),Ba.dialog.replay.hide(),ue(),J(!0),Ua.$gp=$(".GameBox .product-title").empty().append(Ua.$gpt=$("<div>").addClass("game-replay-title")).append(Ua.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",ke)).append($("<button>").html(L.replayPause).on("click",fe)).append($("<button>").html(L.replayPrev).on("click",be))),Ua._gpp=L.replay+" - "+new Date(Oa.time).toLocaleString(),Ua._gtt=Ua.room.events[Ua.room.events.length-1].time,Ua._eventTime=0,Ua._rt=_(ye,2e3),Ua._rprev=0,Ua._rpause=!1,_e()}function be(){var e,a,t=Ua.room.events[--Ua._rf];if(t){e=t.time;do if(!(t=Ua.room.events[--Ua._rf]))break;while(1e3>e-t.time);for(a=Ua._rf-1,ge(),e=Ua.muteEff,Ua.muteEff=!0,i=0;i<a;i++)ye();$(".deltaScore").remove(),Ua.muteEff=e,ye()}}function fe(e){var a=Ua._rpause=!Ua._rpause;$(e.target).html(a?L.replayResume:L.replayPause)}function ke(){clearTimeout(Ua._rt),ye()}function _e(){Ua.$gpt.html(Ua._gpp+" ("+(.001*Ua._eventTime).toFixed(1)+L.SECOND+" / "+(.001*Ua._gtt).toFixed(1)+L.SECOND+")")}function ye(e){var a,t=Ua.room.events[Ua._rf];return clearTimeout(Ua._rt),e||Ua._rf++,t?Ua._rpause?(Ua._rf--,Ua._rt=_(ye,100)):(a=t.data,a.hint&&(a.hint={_id:a.hint}),"chat"==a.type&&(a.timestamp=Oa.time+t.time),A(a),Ua._eventTime=t.time,_e(),void(Ua.room.events.length>Ua._rf?Ua._rt=_(ye,Ua.room.events[Ua._rf].time-t.time):ve())):void ve()}function ve(){Ua.admin?null:delete Ua.room,Ua._replay=!1,Ba.box.room.height(360),clearTimeout(Ua._rt),B(),ra("lobby")}function Ce(){var e,a;for(e in Oa={version:Ua.version,me:Ua.id,players:[],events:[],title:Ua.room.title,roundTime:Ua.room.time,round:Ua.room.round,mode:Ua.room.mode,limit:Ua.room.limit,game:Ua.room.game,opts:Ua.room.opts,readies:Ua.room.readies,time:new Date().getTime()},Ua.room.players){var t;a=Ua.users[Ua.room.players[e]]||Ua.room.players[e],t={id:a.id,score:0},a.robot?(t.id=a.id,t.robot=!0,t.data={score:0},a={profile:V(a.level)}):(t.data=a.data,t.equip=a.equip),t.title="#"+a.id,Oa.players.push(t)}Ua._record=!0}function we(){Ua._record=!1}function Ae(e){if(!Ua._replay&&Oa){var t,s=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(t in e={},s)e[t]=s[t];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),Oa.events.push({data:e,time:new Date().getTime()-Oa.time})}}}function Te(){Ua._relay=!1,p(),Ba.game.here.hide(),Ba.dialog.result.hide(),Ba.dialog.dress.hide(),Ba.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),$(".jjoriping,.rounds").removeClass("dg"),$(".rounds").removeClass("painter"),Ba.game.display.empty(),Ba.game.chain.hide(),Ba.game.hints.empty().hide(),Ba.game.tools.hide(),Ba.game.cwcmd.hide(),Ba.game.bb.hide(),Ba.game.round.empty(),Ba.game.history.empty(),Ba.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function xe(e){var a;for(Ba.game.round.empty(),a=0;a<Ua.room.round;a++)Ba.game.round.append($l=$("<label>").html(Ua.room.game.title[a])),a+1==e&&$l.addClass("rounds-current")}function Se(){v("turnGoing")}function De(e,a){Ba.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+a)),ia("fail"),clearTimeout(Ua._fail),Ua._fail=_(function(){Ba.game.display.html(Ua._char)},1800)}function je(e){return Ua._replay?Oa.users[e].game.score:(Ua.users[e]||Ua.robots[e]).game.score}function qe(e,a){Ua._replay?Oa.users[e].game.score+=a:(Ua.users[e]||Ua.robots[e]).game.score+=a}function Re(e,a){return e.append(a),_(function(){a.remove()},2e3),e}function ze(e,a){v("turnEnd",e,a)}function Pe(t,a){function s(){var a,t,d;Ua._result.goal=Na[Ua._result.level-1],Ua._result.before=Na[Ua._result.level-2]||0,0<Ua._result.reward.score&&(a=Ua._result.reward.score*Ua._coef,.05>a&&Ua._coef&&(a=Ua._result.reward.score),Ua._result.reward.score-=a,Ua._result.exp+=a,t=$e(Ua._result.exp),Ua._result.level!=t&&(Ua._result._boing-=Ua._result.goal-Ua._result._exp,Ua._result._exp=Ua._result.goal,ia("lvup")),Ua._result.level=t,_(s,50)),d=Ua._result.exp-Ua._result._exp,c("before",Ua._result._exp,Ua._result.before,Ua._result.goal),c("current",Math.min(d,Ua._result._boing),0,Ua._result.goal-Ua._result.before),c("bonus",Math.max(0,d-Ua._result._boing),0,Ua._result.goal-Ua._result.before),$(".result-me-level-body").html(Ua._result.level),$(".result-me-score-text").html(Ta(Math.round(Ua._result.exp))+" / "+Ta(Ua._result.goal))}function c(e,a,t,s){$(".result-me-"+e+"-bar").width(100*((a-t)/(s-t))+"%")}a||(a={});var d,p,y,v,C,w,A,T,x,S=$(".result-board").empty();for(d in $(".result-me-expl").empty(),Ba.game.display.html(L.roundEnd),Ua._resultPage=1,Ua._result=null,Ua._relay=!1,t)y=t[d],p=Ua._replay?Oa.users[y.id]:Ua.users[y.id],p||(p=Fa),p.data&&y.reward&&(y.reward.score=Ua._replay?0:Math.round(y.reward.score),w=$e(A=p.data.score)>$e(p.data.score-y.reward.score),S.append(v=$("<div>").addClass("result-board-item").append(C=$("<div>").addClass("result-board-rank").html(y.rank+1)).append(Qe(A).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(p.profile.title||p.profile.name)).append($("<div>").addClass("result-board-score").html(a.scores?L.avg+" "+Ta(a.scores[y.id])+L.kpm:Ta(y.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(y.reward.score?"+"+Ta(y.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",w?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),p.game.team&&C.addClass("team-"+p.game.team),y.id==Ua.id&&(y.exp=p.data.score-y.reward.score,y.level=$e(y.exp),Ua._result=y,v.addClass("result-board-me"),$(".result-me-expl").append(function(t,a,s){function n(e,a,t){e.append($("<h5>").addClass("result-me-blog-head").html(a)).append($("<h5>").addClass("result-me-blog-body").html(t))}var d,p,l=$("<div>").append($("<h4>").html(L.scoreGain)).append(d=$("<div>")).append($("<h4>").html(L.moneyGain)).append(p=$("<div>"));return n(d,L.scoreOrigin,t),n(p,L.moneyOrigin,a),s.forEach(function(e){var s,c,u,f=e.charAt(0),_=e.charAt(1),k=e.slice(2,5),l=+e.slice(5);"EXP"==k?(s=d,u=t):"MNY"==k&&(s=p,u=a),"g"==_?c="+"+(u*l).toFixed(1):"h"==_&&(c="+"+Math.floor(l)),n(s,L["bonusFrom_"+f],c)}),l}(y.reward._score,y.reward._money,y.reward._blog))));$(".result-me").css("opacity",0),Ua._coef=0,Ua._result&&(T=Ua._result.reward.score-Ua._result.reward._score,x=Ua._result.reward.money-Ua._result.reward._money,Ua._result._exp=Ua._result.exp,Ua._result._score=Ua._result.reward.score,Ua._result._bonus=T,Ua._result._boing=Ua._result.reward._score,Ua._result._addit=T,Ua._result._addp=x,T=0<T?"<label class='result-me-bonus'>(+"+Ta(T)+")</label>":"",x=0<x?"<label class='result-me-bonus'>(+"+Ta(x)+")</label>":"",ha(L.scoreGain+": "+Ta(Ua._result.reward.score)+", "+L.moneyGain+": "+Ta(Ua._result.reward.money)+", "+L.rankPointGain+": "+Ta(Ua._result.reward.rankPoint)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+Ta(Ua._result.reward.score)+T),$(".result-me-money").html(L.moneyGain+" +"+Ta(Ua._result.reward.money)+x)),_(function(){u(Ba.dialog.result),Ua._result&&s(!0),Ba.dialog.result.css("opacity",0).animate({opacity:1},500),_(function(){Ua._coef=.05},500)},2e3),we()}function Ze(t){var a,s,l,n=$(".result-board").empty();if(Ua._resultPage=2,!t)return Ba.dialog.resultOK.trigger("click");for(i in t.list)r=t.list[i],o=Ua.users[r.id]||{profile:{title:L.hidden}},l=r.id==Ua.id,n.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(Qe(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(Ta(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(s=$("<div>").addClass("result-board-lvup").css("display",l?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(t.prev-r.rank)))),l&&(0>=t.prev-r.rank&&s.hide(),a.addClass("result-board-me"))}function Be(e){var a=Ua.users[e].profile;$("#kick-vote-text").html((a.title||a.name)+L.kickVoteText),Ua.kickTime=10,Ua._kickTime=10,Ua._kickTimer=_(Oe,1e3),u(Ba.dialog.kickVote)}function Oe(){$(".kick-vote-time .graph-bar").width(300*(Ua.kickTime/Ua._kickTime)),0<--Ua.kickTime?Ua._kickTimer=_(Oe,1e3):Ba.dialog.kickVoteY.trigger("click")}function Ee(){var t=$("#shop-shelf");t.html(L.LOADING),Ge(function(e){return(t.empty(),Ua.guest&&(e.error=423),e.error)?(Ba.menu.shop.trigger("click"),Sa(e.error)):void(e.goods.sort(function(e,a){return a.updatedAt-e.updatedAt}).forEach(function(a){if(!(0>a.cost)){var s=ya(!1,a);t.append($("<div>").attr("id","goods_"+a._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+s+")")).append($("<div>").addClass("goods-title").html(ka(a._id))).append($("<div>").addClass("goods-cost").html(Ta(a.cost)+L.ping)).append(Fe(a,!1)).on("click",Ne))}}),global.expl(t))}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}function Le(t){var s,l,n,m=!0===t;for(n in m||(t=t.split(",")),Ua.shop)l=Ua.shop[n],0>l.cost||(s=$("#goods_"+n).show(),m||-1==t.indexOf(l.group)&&s.hide())}function Fe(t,a,s){var l,n,m=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(ka(t._id)+(a?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+t.group])).append($("<div>").addClass("dress-item-expl").html(_a(t._id))),c=$("<div>").addClass("dress-item-opts");for(l in t.term&&m.append($("<div>").addClass("dress-item-term").html(Math.floor(t.term/86400)+L.DATE+" "+L.ITEM_TERM)),s&&m.append($("<div>").addClass("dress-item-term").html(new Date(1e3*s).toLocaleString()+L.ITEM_TERMED)),t.options)if("gif"!=l){var p=l.charAt(0);n=t.options[l],"g"==p?n="+"+(100*n).toFixed(1)+"%p":"h"==p&&(n="+"+n),c.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+l])).append($("<label>").addClass("item-opts-body").html(n)).append($("<br>"))}return n&&m.append(c),m}function Ge(e){var a;$.get("/shop",function(t){for(a in Ua.shop={},t.goods)Ua.shop[t.goods[a]._id]=t.goods[a];e&&e(t)})}function Ne(t){var a,s,l=$(t.currentTarget).attr("id").slice(6),d=Ua.shop[l],e=Ua.users[Ua.id],n=e.money,m=n-d.cost,p=L.surePurchase,g={};for(s in Ua.box&&Ua.box[l]&&(p=L.alreadyGot+" "+p),u(Ba.dialog.purchase,!0),$("#purchase-ping-before").html(Ta(n)+L.ping),$("#purchase-ping-cost").html(Ta(d.cost)+L.ping),$("#purchase-item-name").html(L[l][0]),a=$("#purchase-ping-after").html(Ta(m)+L.ping),$("#purchase-item-desc").html(0>m?L.notEnoughMoney:p),e.equip)g[s]=e.equip[s];g["Mhand"==d.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:d.group]=l,Aa("#moremi-after",g),Ua._sgood=l,Ba.dialog.purchaseOK.attr("disabled",0>m),0>m?a.addClass("purchase-not-enough"):a.removeClass("purchase-not-enough")}function Me(e){1>e||($("#Middle").css("padding-top",e),_(function(){$("#Middle").css("padding-top",0),_(Me,50,.7*e)},50))}function Ke(t,a,s,c){var d,u,y,v,C,w=ja[Ua.room.mode],A="KKT"==w,k="KAP"==w,l=La[d=t.length],T=0,x=Ua.turnTime/96,S=Ua.turnTime/12;if(Ba.game.display.empty(),l?(u="As"+Ua._speed,l=l.split("")):"en"==za[w].lang&&10>d?u="As"+Ua._speed:(u="Al",Me(d)),y="K"+Ua._speed,l){for(v in l)"0"!=l[v]&&(Ba.game.display.append(C=$("<div>").addClass("display-text").css({float:k?"right":"left","margin-top":-6,"font-size":36}).hide().html(k?t.charAt(d-T-1):t.charAt(T))),T++,_(function(e,a){var t={"margin-top":0};ia(a),e.html()==Ua.mission?(ia("mission"),e.css({color:"#66FF66"}),t["font-size"]=24):t["font-size"]=20,e.show().animate(t,100)},+v*x,C,u));v=Ba.game.display.children("div").get(0),$(v).css(k?"margin-right":"margin-left",.5*(Ba.game.display.width()-20*d))}else if(T="",k)for(v=0;v<d;v++)_(function(e){ia(u),e==Ua.mission?(ia("mission"),T="<label style='color: #66FF66;'>"+e+"</label>"+T):T=e+T,Ba.game.display.html(T)},+v*S/d,t[d-v-1]);else for(v=0;v<d;v++)_(function(e){ia(u),e==Ua.mission?(ia("mission"),T+="<label style='color: #66FF66;'>"+e+"</label>"):T+=e,Ba.game.display.html(T)},+v*S/d,t[v]);_(function(){for(v=0;3>v;v++)_(function(e){if(A){if(1==e)return;ia("kung")}(l?Ba.game.display.children(".display-text"):Ba.game.display).css("font-size",21).animate({"font-size":20},x)},2*(v*x),v);_(Ue,4*x,t,a,s,c),A||ia(y)},S)}function Ie(e){var a,t=We("",e);Ba.game.hints.append(a=$("<div>").addClass("hint-item").append($("<label>").html(t)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(t.html()))),Ea||a.width(0).animate({width:215}),global.expl(a)}function Ue(t,a,s,l){var d,n,m,c=l?l.split(","):[],p={};Ba.game.history.prepend(d=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(t)),n=Ba.game.history.children(),6<n.length&&n.last().remove(),m=We(t,a,s,c),c.forEach(function(e){p[e]||L["class_"+e]&&(p[e]=!0,d.append($("<label>").addClass("history-class").html(L["class_"+e])))}),d.append(n=$("<div>").addClass("history-mean ellipse").append(m)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+m.html()+"</h5>")),global.expl(d)}function He(e,a){return $("<label>").addClass("word").html(a)}function We(t,a,s,l){function n(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"\u2265")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}if(!a||-1==a.indexOf("\uFF02"))return He(t,a);var e=$("<label>").addClass("word"),d=a.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("\uFF3B")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),m=(l&&l.map(function(e){return L["class_"+e]}),s?s.split(",").map(function(e){return L["theme_"+e]}):[]),p=1<d.length;return d.forEach(function(t,a){var s=$("<label>").addClass("word-m1"),l=1<t.length;p&&s.append($("<label>").addClass("word-head word-m1-head").html(a+1)),t.forEach(function(e,a){var t=$("<label>").addClass("word-m2"),p=e.length,u=m.splice(0,p);l&&t.append($("<label>").addClass("word-head word-m2-head").html(a+1)),e.forEach(function(e,a){var s=$("<label>").addClass("word-m3"),l=u.shift();1<p&&s.append($("<label>").addClass("word-head word-m3-head").html(a+1)),l&&s.append($("<label>").addClass("word-theme").html(l)),s.append($("<label>").addClass("word-m3-body").html(n(e))),t.append(s)}),s.append(t)}),e.append(s)}),e}function Ve(e,a,t){var s=e+(a?"("+a+")":"");return t&&(s+="<label class='jjo-display-word-length'>("+t+")</label>"),s}function Je(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function $e(e){var a,t=Na.length;for(a=0;a<t&&!(e<Na[a]);a++);return a+1}function Qe(e){this;if("-1">=e)var a="admin";else var a=$e(e)-1;var t=-100*(a%25),s=-100*Math.floor(.04*a);return"admin"==a?$("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/lvGM.png')","background-position":t+"% "+s+"%","background-size":"100%"}):$("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/newlv.png')","background-position":t+"% "+s+"%","background-size":"2560%"})}function Ye(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function Xe(t,a,s){var l,n,m=[L["mode"+ja[t]]];for(l in Pa)n=Pa[l].name.toLowerCase(),a[n]&&m.push(L["opt"+Pa[l].name]);return s&&m.push(a.injpick.join("|")),s?m.toString():m}function ea(t,a){var s,l=Xe(a.mode,a.opts),d=za[ja[a.mode]];t.empty().append($("<h5>").addClass("room-head-number").html("["+(a.practice?L.practice:a.id)+"]")).append($("<h5>").addClass("room-head-title").text(ma(a.title))).append(s=$("<h5>").addClass("room-head-mode").html(l.join(" / "))).append($("<h5>").addClass("room-head-limit").html((Ea?"":L.players+" ")+a.players.length+" / "+a.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+a.round)).append($("<h5>").addClass("room-head-time").html(a.time+L.SECOND)),-1!=d.opts.indexOf("ijp")&&(s.append($("<div>").addClass("expl").html("<h5>"+a.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(t))}function aa(e,t){Ua._lsRemain=e.length,e.forEach(function(e){oa(e.key,e.value,t)})}function oa(t,a,s){function l(){Ka[t]=new e(a),d()}function d(){0==--Ua._lsRemain?s&&s():p(L.loadRemain+Ua._lsRemain)}function e(e){var a=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){a.audio.play()},this.stop=function(){a.audio.currentTime=0,a.audio.pause()}}var n=new XMLHttpRequest;n.open("GET",a),n.responseType="arraybuffer",n.onload=function(e){Wa?Wa.decodeAudioData(e.target.response,function(e){Ka[t]=e,d()},l):l()},n.send()}function ra(e){if("lobby"==e){e=$("#bgmselect").val().substr(0,1)}return Ua.bgm&&Ua.bgm.stop(),Ua.bgm=ia(e,!0,$("#bgmvol").val())}function ta(){Ua.bgm&&(Ua.bgm.stop(),Ua.admin?null:delete Ua.bgm)}function ia(t,a){var s,l,n=a&&Ua.muteBGM||!a&&Ua.muteEff;return l=Ka[t]||Ka.missing,window.hasOwnProperty("AudioBuffer")&&l instanceof AudioBuffer?(s=Wa.createBufferSource(),s.startedAt=Wa.currentTime,s.loop=a,s.buffer=n?Wa.createBuffer(2,l.length,Wa.sampleRate):l,s.connect(Wa.destination)):(l.readyState&&(l.audio.currentTime=0),l.audio.loop=a||!1,l.audio.volume=n?0:1,s=l),Ia[t]&&Ia[t].stop(),Ia[t]=s,s.key=t,s.start(),s}function sa(){for(var e in Ia)Ia[e].stop()}function da(e){var a;Ua.rooms[e]&&(Ua.rooms[e].password&&!(a=prompt(L.putPassword))||(Ua._pw=a,m("enter",{id:e,password:a})))}function la(){$("#Chat").empty()}function na(){var e=$("#Chat,#chat-log-board"),a=e.children(".chat-item").last().get(0);a&&"HR"==a.tagName||(e.append($("<hr>").addClass("chat-item")),Ba.chat.scrollTop(999999999))}function ma(e){if(Ma.test(e)){var a=$("#badwordfilter").val().substr(0,2);return"NO"==a?Ua.admin?e.toString():e.replace(Ma,"**"):"**"==a?e.replace(Ma,a):"\u2665\u2665"==a?e.replace(Ma,a):"\u2605\u2605"==a?e.replace(Ma,a):(++Xa,e.replace(Ma,"**"))}return e}function ca(t,a,s){$("#cb-"+a).remove();var l,n,m=(2&s?$("#game-user-"+a):$("#room-user-"+a)).offset(),c=2==s?"chat-balloon-bot":"chat-balloon-tip",p=$("<div>").addClass("chat-balloon").attr("id","cb-"+a).append($("<div>").addClass("jt-image "+c))[2==s?"prepend":"append"]($("<h4>").text(t));m&&(Ba.balloons.append(p),1==s?(l=0,n=220):2==s?(l=35-p.height(),n=-2):3==s?(l=5,n=210):(l=40,n=110),p.css({top:m.top+l,left:m.left+n}),_(function(){p.animate({opacity:0},500,function(){p.remove()})},2500))}function pa(e){"NONE"==eo&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">확인된 욕설이 없습니다.(횟수: ${Xa.toString()})</div>`),"LIT"==eo&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 낮음(사용횟수: ${Xa.toString()})</div>`),"LOW"==eo&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">낮음(사용횟수: ${Xa.toString()})</div>`),"MID"==eo&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">조금 높음(사용횟수: ${Xa.toString()})</div>`),"HIGH"==eo&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">높음(사용횟수: ${Xa.toString()})</div>`),"WARN"==eo&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 높음(사용횟수: ${Xa.toString()})</div>`)}function ua(t,s,a,l){var d,n,m,c,p=l?new Date(l):new Date,u=Ua.users[t.id]?Ua.users[t.id].equip:{};if(!Ua._shut[t.title||t.name]){if(a){if(Ua.opts.dw)return;if(Ua._wblock[a])return}s=ma(s,Ua.users[t.id]),ia("k"),ba(),!Ea&&Ua.room&&(d=(Ua.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),ca(s,t.id,d)),Ba.chat.append(m=$("<div>").addClass("chat-item").append(d=$("<div>").addClass("chat-head ellipse").text(t.title||t.name)).append(n=$("<div>").addClass("chat-body").text(s)).append($("<div>").addClass("chat-stamp").text(p.toLocaleTimeString()))),l&&d.prepend($("<i>").addClass("fa fa-video-camera")),d.on("click",function(){ne(t.id)}),Ba.chatLog.append(m=m.clone()),m.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(t.id||"").substr(0,5))),(c=s.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(s=n.html(),c.forEach(function(e){s=s.replace(e,"<a href='#' style='color: #2222FF;' onclick='if(confirm(\""+L.linkWarning+"\")) window.open(\""+e+"\");'>"+e+"</a>")}),n.html(s)),a&&(!0!==a&&(Ua._recentFrom=a),n.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+n.html())),K(d,{equip:u}),Ba.chat.scrollTop(999999999)}}function ga(e){v("drawCanvas",e)}function ha(e,a){var t=new Date;ia("k"),ba(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(a||L.notice)).append($("<div>").addClass("chat-body").text(e)).append($("<div>").addClass("chat-stamp").text(t.toLocaleTimeString()))),Ba.chat.scrollTop(999999999),"tail"==a&&console.warn(t.toLocaleString(),e)}function ba(){var e=$("#Chat .chat-item"),a=$("#chat-log-board .chat-item");99<e.length&&e.first().remove(),199<a.length&&a.first().remove()}function fa(e){var a;return a="$"==e.charAt()?Ua.shop[e.slice(0,4)]:Ua.shop[e],{_id:e,group:a.group,term:a.term,name:ka(e),cost:a.cost,image:ya(e,a),desc:_a(e),options:a.options}}function ka(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function _a(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function ya(e,a){var t,s;if(!e)"string"==typeof a&&(a={_id:"def",group:a,options:{}});else if("$"==e.charAt())return va(e.slice(1,4),e.slice(4));return t=Ua.shop[e]||a,s=t.options.hasOwnProperty("gif")?".gif":".png","BDG"==t.group.slice(0,3)?"/img/kkutu/moremi/badge/"+t._id+s:"M"==t.group.charAt(0)?"/img/kkutu/moremi/"+t.group.slice(1)+"/"+t._id+s:"/img/kkutu/shop/"+t._id+".png"}function va(t,a){var s,l=document.createElement("canvas"),d=l.getContext("2d");switch(l.width=l.height=50,d.font="24px NBGothic",d.textAlign="center",d.textBaseline="middle",t){case"WPC":case"WPB":case"WPA":s=["WPC","WPB","WPA"].indexOf(t),d.beginPath(),d.arc(25,25,25,0,2*Math.PI),d.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][s],d.fill(),d.fillStyle=["#000000","#4465C3","#E69D12"][s],d.fillText(a,25,25);}return l.toDataURL()}function Ca(e){Ba.dialog.obtain.is(":visible")?Ua._obtain.push(e):(wa(e),u(Ba.dialog.obtain,!0))}function wa(e){ia("success"),$("#obtain-image").css("background-image","url("+ya(e.key)+")"),$("#obtain-name").html(ka(e.key))}function Aa(t,a){var s,l,n=$(t).empty(),e={Mlhand:"Mhand",Mrhand:"Mhand"};for(s in a||(a={}),qa)l="M"+qa[s],n.append($("<img>").addClass("moremies moremi-"+l.slice(1)).attr("src",ya(a[l],e[l]||l)).css({width:"100%",height:"100%"}));(l=a.BDG)&&n.append($("<img>").addClass("moremies moremi-badge").attr("src",ya(l)).css({width:"100%",height:"100%"})),n.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",a.robot?"/img/kkutu/moremi/robot.png":"/img/kkutu/moremi/body.png").css({width:"100%",height:"100%"})),n.children(".moremi-rhand").css("transform","scaleX(-1)")}function Ta(e){var t=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();t.test(e);)e=e.replace(t,"$1,$2");return e}function xa(e){location.hash=e?"#"+e:""}function Sa(e){return alert(L["error_"+e])}function Da(e){Ba.yell.show().css("opacity",1).html(e),_(function(){Ba.yell.animate({opacity:0},3e3),_(function(){Ba.yell.hide()},3e3)},1e3)}var ja,qa,Ra,za,Pa,Za,h,Ba,Oa,Ea,La=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],Fa={profile:{title:L.null},data:{score:0}},Ga=30,Na=[],Ma=new RegExp("(\uC2DC|\uC2C0|\uC26C|\uC288|\uC528|\uC4B8|\uC50C|\uC4D4|\uC464|\uC2DC\uC774{1,}|\uC2C0\uC774{1,}|\uC26C\uC774{1,}|\uC528\uC774{1,}|\uC4B8\uC774{1,}|\uC50C\uC774{1,}|\uCC0C\uC774{1,}|\uC2A4|\uC4F0|\uCBD4|\uC2A4\uC73C{1,}|\uC4F0\uC73C{1,}|\uCBD4\uC73C{1,}|\uC218\uC6B0{1,}|\uC464\uC6B0{1,}|\uC2ED|\uC2D1|\uC27D|\uC299|\uC539|\uC4C9|\uC51D|\uC4E5|\uC501|\uC2F6|\uC2DA|\uC286|\uC2BE|\uC542|\uC526|\uC4D2|\uC50A|\uC47E|\u3145|\u3146|\u3145\u3163{1,}|\u3145\uC774{1,}|\u3146\uC774{1,}|c|c\uC774{1,}|C|C\uC774{1,}|\u24B8|\u24B8\uC774{1,})[^\uAC00-\uD7A3]*(\uBC14|\uD30C|\uBC1C|\uD314|\uBE60|\uBE68|\uBD88|\uBC8C|\uBCA8|\uBC38|\uBE60|\u3142|\u3143|\u314D)|(\uBDE9|\uBCD1|\uBC61|\uBC45|\uBC61|\uBE59|\uBE05|\uBE3D|\uBDF0\uC6C5|\uBE44\uC789|\uBCED|\uBC7D|\uBF1D|\uBE91|\uC051|\uC0A5|\uC089|\uBEAD|\uBF08\uC5C9|\uC03C\uC6C5|\u3142)[^\uAC00-\uD7A3]*(\uC270|\uC2E0|\uC2C4|\uC2A8|\uC52C|\uC510|\uC9C4|\uC9A8|\u3145|\uB531|\uC2DC\uC778|\uC2DC\uB098)|(\uC0DB|\uC113|\uC327|\uC360|\uC328|\uC0DC|\uC114|\uC328|\uC360|\uC0C8|\uC100|\uC138|\uC170|\uC314|\uC384|\uC34C|\uC3BC)[^\uAC00-\uD7A3]*(\uB07C|\uB060|\uC560\uB07C|\uC5D0\uB07C)|(\uC800\uC0C8|\uC800\uC0C9|\uC800\uC0DB|\uC800\uC251|\uC800\uC0DB|\uC800\uC14B|\uC800\uC100|\uC800\uC138|\uC800\uC170|\uC800\uC314|\uC800\uC384|\uC800\uC34C|\uC800\uC3BC)[^\uAC00-\uD7A3]*(\uAE30|\uC560{1,}\uAE30|\uC5D0{1,}\uAE30|)|(\uAC1C|\uAC8C|\uAC54|\uAE68|\uAED8|\uAF10|\uAEA0)[^\uAC00-\uD7A3]*(\uC0C8|\uC0DB|\uC138|\uC100|\uC170)|(\uB2C8|\uB2DD|\uB290|\uB178|\uB2AC|\uB108|\uC7E4|\uC720|\uAC54|\u3134)[^\uAC00-\uD7A3]*(\u3131\u3141|\u3131\u3143|\u3147\u3141|\u3147\u3142|\uC5C4{1,}\uB9C8|\uAC80{1,}\uB9C8|\uAC80|\uAE08|\uBBF8|\uC570|\uC571|\uC560{1,}\uBE44|\uC560{1,}\uBBF8|\uC5D0{1,}\uBBF8|\uC5D0{1,}\uBE44|\uC560{1,}\uBBDC|\uC560{1,}\uBE28|\uC544{1,}\uBE60|\uC5C4{1,}\uBE60|\uC758\uBBF8|\uC758\uBE44|\uBE28|\uBBDC)|(\u3131\u3141|\u3131\u3143|\u3147\u3141|\u3147\u3142|\uC5C4\uB9C8|\uAC80\uB9C8|\uC570|\uC544\uBE60|\uC5C4\uBE60)[^\uAC00-\uD7A3]*(\uC8FD|\uB4A4|\uC0AC|\uB3CC|\uC5C6)|(\uC570|\uC5E0|\uC5A8|\uC618|\uC571|\uC5E1|\uC619|\uC5A9)[^\uAC00-\uD7A3]*(\uCC3D|\uCC75|\uCD39|\uC0DD|\uC115|\uC14D|\uC185|\uC265)|(\uC138|\uC139|\uC0C9|\uC251|\uC1E1|\uC138\uC5D1{1,}\uD06C|\uC138\uC561{1,}\uD06C|\uC138\uD06C|\uC0C8\uD06C|\uC0C8\uC5D0{1,}\uD06C|\uC0C8\uC560{1,}\uD06C|\uC14D|\uC171|\uC101|\uC138\uADF8|\uC138\uC5D1|\uC138\uC561|\uC138\uC5D0{1,}\uC5D1|\uC138\uC560{1,}\uC561|\uC385|\uC3BD|\uC386|\uC3BE|\uC172)[^\uAC00-\uD7A3]*(\u3145|\uC2A4|\uC2A5|\uC2A8|\uC2AB|\uC2B7|\uC2B9|\uB85C\uC2A4)|(\u3148|\uC813|\uC814|\uC807|\uC816|\uC89F|\uC8A0|\uC893|\uC8A2)[^\uAC00-\uD7A3]*(\uB48F|\uB41F|\uB42B|\uB42C|\uB40F|\uB410|\uB403|\uAC19|\uAC07|\uAE4C|\uAC00|\uAE4C)|(\uC790|\uC790\uC544{1,}|\uC7A0|\uC88C|\uC88C\uC544{1,}|\uC797|\uC7A3|\uC7C8|\uC7C8\uC544{1,}|\uBCF4|\uBCF4\uC624{1,}|\uBCFB|\uBD07|\uBD64)[^\uAC00-\uD7A3]*(\uC9C0|\uC9D3|\uC9C7|\uC9D5|\uC9A4|\uC9AB|\uC9B7|\uC9B9|\uBE68)|(\uC9C8|\uC785|\uC548|\uBC16)[^\uAC00-\uD7A3]*(\uC2F8)|(\uD6C4|\uD6DA|\uD6D7|\uD6CB)[^\uAC00-\uD7A3]*(\uC7A5|\uC7DD|\uC8A1)|(\uAF2C|\uBCF4|\uB538|\uB618|\uBE61)[^\uAC00-\uD7A3]*(\uCD94)|(\uBBF8\uCE5C|\uC7A1|\uC4F0\uB808\uAE30|\uAC70\uC9C0|\uADF8\uC9C0|\uB625|\u3163\uBC1C)[^\uAC00-\uD7A3]*(\uB140\uC11D|\uB188|\uCDA9|\uC790\uC2DD|\uB0D0|\uB0D4|\uC138|\uB124|\uAC83)|(\uBC84|\uBC85|\uBED0|\uBED1|\uD37C|\uD37D)[^\uAC00-\uD7A3]*(\uD050|\uB028)|(\uD638)[^\uAC00-\uD7A3]*(\uB85C|\uBAA8|\uAD6C)|(\uC2A4|\uC218|\uC288|\uC4F0|\uC464|\uC4D4|\uC2A4\uC73C{1,}|\uC218\uC6B0{1,}|\uC288\uC6B0{1,}|\uC4F0\uC6B0{1,}|\uC464\uC73C{1,}|\uC4D4\uC73C{1,})[^\uAC00-\uD7A3]*(\uB808|\uB798|\uB7D0|\uB840|\uB799|\uB809|\uB7D1|\uB841|\uB79A|\uB80A|\uB7D2|\uB842)|(\uC9C0|\uC9A4|\uB514|G|\u3163|\uCE58|\uCC0C|\uC9C0\uC774|\uC9C0\uC774{1,}|\uC9A4\uC774{1,}|G\uC774{1,}|\uC9A4|G\uC774)[^\uAC00-\uD7A3]*(\uB784|\uB77C\uC54C)|(\uB538)[^\uAC00-\uD7A3]*(\uB538|\uCE58|\uCCD0|\uCCE4|\uCE68)|\uBC1C[^\uAC00-\uD7A3]*\uAE30|\uD480[^\uAC00-\uD7A3]*\uBC1C|\uB538[^\uAC00-\uD7A3]*\uB538|\uAC15[^\uAC00-\uD7A3]*\uAC04|\uC790[^\uAC00-\uD7A3]*\uC704|\uBD80[^\uAC00-\uD7A3]*\uB784|\uBD88[^\uAC00-\uD7A3]*\uC54C|\uC624[^\uAC00-\uD7A3]*\uB974[^\uAC00-\uD7A3]*\uAC00[^\uAC00-\uD7A3]*\uC998|\uCC98[^\uAC00-\uD7A3]*\uB140[^\uAC00-\uD7A3]*\uB9C9|\uC9C8[^\uAC00-\uD7A3]*\uB0B4|\uC9C8[^\uAC00-\uD7A3]*\uC678|\uC815[^\uAC00-\uD7A3]*\uC561|\uC790[^\uAC00-\uD7A3]*\uAD81|\uC0DD[^\uAC00-\uD7A3]*\uB9AC|\uC6D4[^\uAC00-\uD7A3]*\uACBD|\uD398[^\uAC00-\uD7A3]*\uB3C4|\uB610[^\uAC00-\uD7A3]*\uB77C[^\uAC00-\uD7A3]*\uC774|\uC7A5[^\uAC00-\uD7A3]*\uC560|\uC885[^\uAC00-\uD7A3]*\uAC04|\uC4F0[^\uAC00-\uD7A3]*\uB808[^\uAC00-\uD7A3]*\uAE30|\uBB34[^\uAC00-\uD7A3]*\uB1CC|\uD559[^\uAC00-\uD7A3]*\uC2DD[^\uAC00-\uD7A3]*\uCDA9|\uAE09[^\uAC00-\uD7A3]*\uC2DD[^\uAC00-\uD7A3]*\uCDA9|\uBC84[^\uAC00-\uD7A3]*\uB7EC[^\uAC00-\uD7A3]*\uC9C0|\uCC0C[^\uAC00-\uD7A3]*\uAEBC[^\uAC00-\uD7A3]*\uAE30|\uC090[^\uAC00-\uD7A3]*\uAFB8|\uB2E5[^\uAC00-\uD7A3]*\uCCD0|\uAEBC[^\uAC00-\uD7A3]*\uC838|\uC560[^\uAC00-\uD7A3]*\uC790|\uCC0C[^\uAC00-\uD7A3]*\uADF8[^\uAC00-\uD7A3]*\uB808[^\uAC00-\uD7A3]*\uAE30|\uB300[^\uAC00-\uD7A3]*\uAC00[^\uAC00-\uD7A3]*\uB9AC|\uBA74[^\uAC00-\uD7A3]*\uC0C1|\uC640[^\uAC00-\uD7A3]*\uAFB8|\uC2DC[^\uAC00-\uD7A3]*\uBE60[^\uAC00-\uD7A3]*\uBE60|\uD30C[^\uAC00-\uD7A3]*\uC624[^\uAC00-\uD7A3]*\uD6C4|\uC0AC[^\uAC00-\uD7A3]*\uAE4C[^\uAC00-\uD7A3]*\uC2DC|\uC539[^\uAC00-\uD7A3]*\uB355|\uC560[^\uAC00-\uD7A3]*\uBBF8|\uC5FF[^\uAC00-\uD7A3]*\uBA39|\uC560[^\uAC00-\uD7A3]*\uBE44|\uC0C8[^\uAC00-\uD7A3]*\uB07C|\uC92C[^\uAC00-\uD7A3]*\uAE4C|(\uB4A4)[^\uAC00-\uD7A3]*(\uC838|\uC9C4|\uC84C|\uC9C8|\uC9D0)|\uC0B4[^\uAC00-\uD7A3]*\uC9C0[^\uAC00-\uD7A3]*\uB9C8|\uC790[^\uAC00-\uD7A3]*\uC0B4[^\uAC00-\uD7A3]*(\uD574|\uD558|\uD5E4)|(\uC886|\uC883|\uC884|\uC877|\uC92B|\uC92E|\uC91F|\uC8F6|\uC8F3|\uC8F4|\uC8E7|\uC870\uC624{1,}|\uC870\uC637{1,}|\uC870\uC63A{1,})|\uC539|\uC539|\uBD0A|\uBD0A|\uC7A6|\uC7A6|(\uC139|\uC13B)|\uC345|\uC345|\u3157{1,}|\u3144|\u3144|\u3132\u3148|\u3132\u3148|(\u3148)[^\uAC00-\uD7A3]*(\u3142\u3145|\u3132|\u3139|\u3134)|(f|F)[^A-Za-z]*(u|U)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)|(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)|(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(d|D)|(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(m|M)|(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)|(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)|(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(m|M)[^A-Za-z]*(n|N)|(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)|(b|B)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(c|C)[^A-Za-z]*(h|H)|(d|D)[^A-Za-z]*(i|I)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)|(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*x|(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)|(c|C)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(t|T)|(p|P)[^A-Za-z]*(u|U)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(y|Y)|(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(g|G)|(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)|(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(a|A)|(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(r|R)[^A-Za-z]*(o|O)|(j|J)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)|(m|M)[^A-Za-z]*(u|U)[^A-Za-z]*(f|F)[^A-Za-z]*(f|F)|(p|P)[^A-Za-z]*(i|I)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)|(r|R)[^A-Za-z]*(e|E)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)|(s|S)[^A-Za-z]*(l|L)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)|(t|T)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(s|S)|(t|T)[^A-Za-z]*(r|R)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)|(t|T)[^A-Za-z]*(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)|(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)|(w|W)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(r|R)[^A-Za-z]*(e|E)|(s|S)[^A-Za-z]*(i|I)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)|(g|G)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(a|A)[^A-Za-z]*(k|K)[^A-Za-z]*(i|I)|(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(l|L)[^A-Za-z]*(e|E)|(t|T)[^A-Za-z]*(l|L)[^A-Za-z]*q[^A-Za-z]*(k|K)[^A-Za-z]*(f|F)|(t|T)[^A-Za-z]*(p|P)[^A-Za-z]*(r|R)[^A-Za-z]*(t|T)[^A-Za-z]*(m|M)|(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*(e|E)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)"),Ka={},Ia={},Ua={},Ha={Classic:{},DaneoClassic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{},Drawing:{}},Wa=!!window.hasOwnProperty("AudioContext")&&new AudioContext,Va=window.WebSocket,Ja=setInterval,$a=setTimeout;$(document).ready(function(){function t(t,a,s){var l=t.position();$(window).on("mousemove",function(d){var e=d.pageX-a,n=d.pageY-s;t.css("left",l.left+e),t.css("top",l.top+n)})}function a(){$(window).off("mousemove")}function s(e,a){var t,s;for(t in Pa)s=Pa[t].name.toLowerCase(),-1==e.indexOf(t)?$("#"+a+"-"+s+"-panel").hide():$("#"+a+"-"+s+"-panel").show()}function l(e){var a,t,s={};for(a in Pa)t=Pa[a].name.toLowerCase(),$("#"+e+"-"+t).is(":checked")&&(s[t]=!0);return s}function d(t,a,s,l){if(!l){if(t.gaming)return!1;if(t.password)return!1;if(t.players.length>=t.limit)return!1}if(t.mode!=a)return!1;for(var d in s)if(!t.opts[d])return!1;return!0}function e(e){$(".team-selector").hasClass("team-unable")||m("team",{value:$(e.currentTarget).attr("id").slice(5)})}function n(){Ba.dialog.replayView.attr("disabled",!0)}function c(){Za=new Va(Ua.URL),Za.onopen=function(){p()},Za.onmessage=_onMessage=function(e){A(JSON.parse(e.data))},Za.onclose=function(e){var a=L.closed+" (#"+e.code+")";h&&h.close(),sa(),alert(a),$.get("/kkutu_notice.html",function(e){p(e)})},Za.onerror=function(e){console.warn(L.error,e)}}for(Ua.PUBLIC="true"==$("#PUBLIC").html(),Ua.URL=$("#URL").html(),Ua.version=$("#version").html(),Ua.server=location.href.match(/\?.*server=(\d+)/)[1],Ua.shop={},Ua._okg=0,Ua._playTime=0,Ua._kd="",Ua._timers=[],Ua._obtain=[],Ua._wblock={},Ua._shut={},Ua.usersR={},Na.push(Je(1)),f=2;366>f;f++)Na.push(Na[f-2]+Je(f));if(Na[365]=1/0,Na.push(1/0),Ba={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),onchating:$("#Chating"),chatLog:$("#chat-log-board"),talk:$(".ChatBox input").last(),chatBtn:$(".ChatBox button").last(),menu:{help:$("#HelpBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),cursing:$("#CursingBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),leaderboard:$("#LeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),cursing:$("#CursingDiag"),cursingValue:$("#CursingDiag #cursing-value").first(),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),rank:$("#rank"),lp:$("#rankpoint"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),tools:$(".GameBox .tools"),drawingTitle:$("#drawing-title"),themeisTitle:$("#themeis-title"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==Va)return p(L.websocketUnsupport),void alert(L.websocketUnsupport);for(Ua._soundList=[{key:"k",value:"/media/kkutu/k.mp3"},{key:"lobby",value:"/media/kkutu/LobbyBGM_newstart.mp3"},{key:"1",value:"/media/kkutu/LobbyBGM_newstart.mp3"},{key:"2",value:"/media/kkutu/LobbyBGM_bfkkutu.mp3"},{key:"jaqwi",value:"/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"/media/kkutu/game_start.mp3"},{key:"round_start",value:"/media/kkutu/round_start.mp3"},{key:"fail",value:"/media/kkutu/fail.mp3"},{key:"timeout",value:"/media/kkutu/timeout.mp3"},{key:"lvup",value:"/media/kkutu/lvup.mp3"},{key:"Al",value:"/media/kkutu/Al.mp3"},{key:"success",value:"/media/kkutu/success.mp3"},{key:"missing",value:"/media/kkutu/missing.mp3"},{key:"mission",value:"/media/kkutu/mission.mp3"},{key:"kung",value:"/media/kkutu/kung.mp3"},{key:"horr",value:"/media/kkutu/horr.mp3"}],f=0;10>=f;f++)Ua._soundList.push({key:"T"+f,value:"/media/kkutu/T"+f+".mp3"},{key:"K"+f,value:"/media/kkutu/K"+f+".mp3"},{key:"As"+f,value:"/media/kkutu/As"+f+".mp3"});for(var f in aa(Ua._soundList,function(){Ge(c)}),Ua.admin?null:delete Ua._soundList,qa=$("#MOREMI_PART").html().split(","),Ra=$("#AVAIL_EQUIP").html().split(","),za=JSON.parse($("#RULE").html()),Pa=JSON.parse($("#OPTIONS").html()),ja=Object.keys(za),Ea="true"==$("#mobile").html(),Ea&&(Ga=200),Ua._timePercent=function(){return 100-1e5*((Ua._turnSound.audio?Ua._turnSound.audio.currentTime:Wa.currentTime-Ua._turnSound.startedAt)/Ua.turnTime)+"%"},Ua.setRoom=function(e,a){var t="for-lobby"==Z();null==a?(Ua.admin?null:delete Ua.rooms[e],t&&$("#room-"+e).remove()):(t&&!Ua.rooms[e]&&Ba.lobby.roomList.append($("<div>").attr("id","room-"+e)),Ua.rooms[e]=a,t&&$("#room-"+e).replaceWith(U(a)))},Ua.setUser=function(t,a){var s,l=Z(),d="for-lobby"==l||"for-master"==l;return Ua._replay?void(Oa.users[t]=a):void(null==a?(Ua.admin?null:delete Ua.users[t],d&&$("#users-item-"+t+",#invite-item-"+t).remove()):(d&&!Ua.users[t]&&(s=M(a,"for-master"==l),"for-master"==l?Ba.dialog.inviteList.append(s):Ba.lobby.userList.append(s)),Ua.users[t]=a,d&&(s?$("#"+s.attr("id")).replaceWith(s):$("#"+("for-lobby"==l?"users-item-":"invite-item")+t).replaceWith(M(a,"for-master"==l)))))},$(document).on("paste",function(e){if(Ua.room&&Ua.room.gaming)return e.preventDefault(),!1}),Ba.talk.on("drop",function(e){if(Ua.room&&Ua.room.gaming)return e.preventDefault(),!1}),Ua.opts=$.cookie("kks"),Ua.opts&&g(JSON.parse(Ua.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var a=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),a.addClass("dialog-front"),t(a,e.pageX,e.pageY)}).on("mouseup",function(){a()}),Ba.chatBtn.on("click",function(){var e=Ea&&Ba.game.here.is(":visible")?Ba.game.hereText.val():Ba.talk.val(),a={value:e.trim()};e&&("/"==a.value[0]?(a.cmd=a.value.split(" "),D(a.cmd)):((Ba.game.here.is(":visible")||Ua._relay)&&(a.relay=!0),m("talk",a)),Ua._whisper?(Ba.talk.val("/e "+Ua._whisper+" "),Ua.admin?null:delete Ua._whisper):Ba.talk.val(""),Ba.game.hereText.val(""))}).hotkey(Ba.talk,13).hotkey(Ba.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){if(!t.trim())return;var a=$(e.currentTarget),t=a.val(),s={relay:!0,data:Ua._sel,value:t.trim()};m("talk",s),a.val("")}}).on("focusout",function(){$(".cw-q-body").empty(),Ba.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(e){var a=$(e.currentTarget),t=a.val();2>t||8<t?a.css("color","#FF4444"):a.css("color","")}),$("#room-round").on("change",function(e){var a=$(e.currentTarget),t=a.val();1>t||10<t?a.css("color","#FF4444"):a.css("color","")}),Ba.game.here.on("click",function(){Ea||Ba.talk.focus()}),Ba.talk.on("keyup",function(){Ba.game.hereText.val(Ba.talk.val())}),$(window).on("beforeunload",function(){if(Ua.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),Ba.dialog)Ba.dialog[f].children(".dialog-head").hasClass("no-close")||Ba.dialog[f].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(Ba.menu.help.on("click",function(){$("#help-board").attr("src","/help"),u(Ba.dialog.help)}),Ba.menu.setting.on("click",function(){u(Ba.dialog.setting)}),Ba.menu.community.on("click",function(){return Ua.guest?Sa(451):void u(Ba.dialog.community)}),Ba.dialog.commFriendAdd.on("click",function(){var e=prompt(L.friendAddNotice);if(e)return Ua.users[e]?void m("friendAdd",{target:e},!0):Sa(450)}),Ba.menu.newRoom.on("click",function(){var e;Ba.dialog.quick.hide(),Ua.typeRoom="enter",u(e=Ba.dialog.room),e.find(".dialog-title").html(L.newRoom)}),Ba.menu.setRoom.on("click",function(){var a,t,s,l=za[ja[Ua.room.mode]];for(t in Ua.typeRoom="setRoom",$("#room-title").val(Ua.room.title),$("#room-limit").val(Ua.room.limit),$("#room-mode").val(Ua.room.mode).trigger("change"),$("#room-round").val(Ua.room.round),$("#room-time").val(Ua.room.time/l.time),Pa)s=Pa[t].name.toLowerCase(),$("#room-"+s).attr("checked",Ua.room.opts[s]);Ua._injpick=Ua.room.opts.injpick,u(a=Ba.dialog.room),a.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(e){var a,t,n=$("#quick-mode").val(),m=0;for(a in"quick-mode"==e.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),t=l("quick"),s(za[ja[n]].opts,"quick"),Ua.rooms)d(Ua.rooms[a],n,t,!0)&&m++;$("#quick-status").html(L.quickStatus+" "+m)}),Ba.menu.quickRoom.on("click",function(){Ba.dialog.room.hide(),u(Ba.dialog.quick),Ba.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-queue").html(""),Ba.dialog.quickOK.removeClass("searching").html(L.OK))}),Ba.dialog.quickOK.on("click",function(){function e(){var e,l=[];if(!Ba.dialog.quick.is(":visible"))return void clearTimeout(Ua._quickT);for(e in $("#quick-queue").html(L.quickQueue+" "+G(1e3*Ua._quickn++)),Ua.rooms)d(Ua.rooms[e],t,s)&&l.push(e);l.length&&(e=l[Math.floor(Math.random()*l.length)],Ua._preQuick=!0,$("#room-"+e).trigger("click"))}var t=$("#quick-mode").val(),s=l("quick");if("for-lobby"==Z()){if(Ba.dialog.quickOK.hasClass("searching"))return Ba.dialog.quick.hide(),e(),void Ba.menu.quickRoom.trigger("click");$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),Ba.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),Ua._quickn=0,Ua._quickT=k(e,1e3)}}),$("#room-mode").on("change",function(){var e=$("#room-mode").val(),t=za[ja[e]];$("#game-mode-expl").html(L["modex"+e]),s(t.opts,"room"),Ua._injpick=[],-1==t.opts.indexOf("ijp")?$("#room-injpick-panel").hide():$("#room-injpick-panel").show(),"Typing"==t.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,a){$(a).html(+$(a).val()*t.time+L.SECOND)})}).trigger("change"),Ba.menu.spectate.on("click",function(){Ba.menu.spectate.hasClass("toggled")?(m("form",{mode:"J"}),Ba.menu.spectate.removeClass("toggled")):(m("form",{mode:"S"}),Ba.menu.spectate.addClass("toggled"))}),Ba.menu.shop.on("click",function(){(Ua._shop=!Ua._shop)?(Ee(),Ba.menu.shop.addClass("toggled")):Ba.menu.shop.removeClass("toggled"),B()}),$(".shop-type").on("click",function(e){var a=$(e.currentTarget),t=a.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),a.addClass("selected"),Le("all"==t||a.attr("value"))}),Ba.menu.dict.on("click",function(){u(Ba.dialog.dict)}),Ba.menu.wordPlus.on("click",function(){u(Ba.dialog.wordPlus)}),Ba.menu.invite.on("click",function(){u(Ba.dialog.invite),N(!0)}),Ba.menu.practice.on("click",function(){za[ja[Ua.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),u(Ba.dialog.practice)):m("practice",{level:-1})}),Ba.menu.ready.on("click",function(){m("ready")}),Ba.menu.start.on("click",function(){m("start")}),Ba.menu.exit.on("click",function(){if(Ua.room.gaming){if(!confirm(L.sureExit))return;pe()}m("leave")}),Ba.menu.replay.on("click",function(){Ua._replay&&ve(),u(Ba.dialog.replay),n(),Ba.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),Ba.menu.leaderboard.on("click",function(){Ua._lbpage=0,Ba.dialog.leaderboard.is(":visible")?Ba.dialog.leaderboard.hide():$.get("/ranking",function(e){se(e),u(Ba.dialog.leaderboard)})}),Ba.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(Ua._lbpage-1),function(e){se(e)})}),Ba.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+Ua.id,function(e){se(e)})}),Ba.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(Ua._lbpage+1),function(e){se(e)})}),Ba.dialog.settingServer.on("click",function(){location.href="/"}),Ba.dialog.settingOK.on("click",function(){g({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),Ba.dialog.setting.hide(),$.cookie("kks",JSON.stringify(Ua.opts))}),Ba.dialog.profileLevel.on("click",function(){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),u(Ba.dialog.practice)}),Ba.dialog.practiceOK.on("click",function(){var e=$("#practice-level").val(),a=$("#ai-team").val();Ba.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?m("setAI",{target:Ua._profiled,level:e,team:a}):m("practice",{level:e})}),Ba.dialog.roomOK.on("click",function(){var e,a,t={injpick:Ua._injpick};for(e in Pa)a=Pa[e].name.toLowerCase(),t[a]=$("#room-"+a).is(":checked");m(Ua.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),time:$("#room-time").val(),opts:t}),Ba.dialog.room.hide()}),Ba.dialog.resultOK.on("click",function(){return 1==Ua._resultPage&&Ua._resultRank?void Ze(Ua._resultRank[Ua.id]):void(Ua.practicing&&(Ua.room.gaming=!0,m("leave")),Ua.resulting=!1,Ba.dialog.result.hide(),Ua.admin?null:delete Ua._replay,Ua.admin?null:delete Ua._resultRank,Ba.box.room.height(360),ra("lobby"),na(),B())}),Ba.dialog.resultSave.on("click",function(){var a=new Date(Oa.time),t=new Blob([JSON.stringify(Oa)],{type:"text/plain"}),s=URL.createObjectURL(t),d="KKuTu"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+"-"+a.getMinutes()+"-"+a.getSeconds()+".bkr",e=$("<a>").attr({download:d,href:s}).on("click",function(){e.remove()});$("#Jungle").append(e),e[0].click()}),Ba.dialog.dictInjeong.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||$("#dict-theme").val()&&(a.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){return(_(function(){a.prop("disabled",!1)},2e3),e.error)?$("#dict-output").html(e.error+": "+L["wpFail_"+e.error]):void $("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),Ba.dialog.dictSearch.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||(a.prop("disabled",!0),$("#dict-output").html(L.searching),z($("#dict-input").val(),function(e){return(_(function(){a.prop("disabled",!1)},500),e.error)?$("#dict-output").html(e.error+": "+L["wpFail_"+e.error]):void $("#dict-output").html(We(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),Ba.dialog.wordPlusOK.on("click",function(e){var a;Ba.dialog.wordPlusOK.hasClass("searching")||(a=$("#wp-input").val())&&(a=a.replace(/[^a-z가-힣]/g,""),2>a.length||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),m("wp",{value:a})))}).hotkey($("#wp-input"),13),Ba.dialog.inviteRobot.on("click",function(){me("AI")}),Ba.box.me.on("click",function(){ne(Ua.id)}),Ba.dialog.roomInfoJoin.on("click",function(){Ba.dialog.roomInfo.hide(),da(Ua._roominfo)}),Ba.dialog.profileHandover.on("click",function(){confirm(L.sureHandover)&&m("handover",{target:Ua._profiled})}),Ba.dialog.profileKick.on("click",function(){m("kick",{robot:Ua.robots.hasOwnProperty(Ua._profiled),target:Ua._profiled})}),Ba.dialog.profileShut.on("click",function(){var e=Ua.users[Ua._profiled];e&&R(e.profile.title||e.profile.name)}),Ba.dialog.profileWhisper.on("click",function(){var e=Ua.users[Ua._profiled];Ba.talk.val("/e "+(e.profile.title||e.profile.name).replace(/\s/g,"")+" ").focus()}),Ba.dialog.profileDress.on("click",function(){return Ua.guest?Sa(421):Ua._gaming?Sa(438):void(u(Ba.dialog.dress)&&$.get("/box",function(e){return e.error?Sa(e.error):void(Ua.box=e,ae())}))}),Ba.dialog.dressOK.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.post("/exordial",{data:$("#dress-exordial").val()},function(e){return(Ba.dialog.dressOK.attr("disabled",!1),e.error)?Sa(e.error):void Ba.dialog.dress.hide()})}),Ba.dialog.dressOK.on("click",function(e){return $("#dress-nickname").val()?/[(ㄱ-ㅎ)]/gi.test($("#dress-nickname").val())?alert("\uB2C9\uB124\uC784\uC744 \uC790\uC74C\uB9CC\uC73C\uB85C \uC9C0\uC815\uD558\uC2E4 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."):/[(가-힣a-zA-Z)]/gi.test($("#dress-nickname").val())?void($(e.currentTarget).attr("disabled",!0),$.post("/nickname",{data:$("#dress-nickname").val()},function(e){return(Ba.dialog.dressOK.attr("disabled",!1),e.error)?Sa(e.error):void Ba.dialog.dress.hide()})):alert("\uB2C9\uB124\uC784\uC5D0 \uC798\uBABB\uB41C \uBB38\uC790\uAC00 \uD3EC\uD568\uB418\uC5B4 \uC788\uC2B5\uB2C8\uB2E4."):alert("\uB2C9\uB124\uC784\uC744 \uC785\uB825\uD574 \uC8FC\uC138\uC694.")}),$("#DressDiag .dress-type").on("click",function(e){var a=$(e.currentTarget),t=a.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),a.addClass("selected"),re("all"==t||a.attr("value"))}),$("#dress-cf").on("click",function(){return Ua._gaming?Sa(438):void(u(Ba.dialog.charFactory)&&ie())}),Ba.dialog.cfCompose.on("click",function(){return Ba.dialog.cfCompose.hasClass("cf-composable")?void(confirm(L.cfSureCompose)&&$.post("/cf",{tray:Ua._tray.join("|")},function(e){if(e.error)return Sa(e.error);for(var a in m("refresh"),alert(L.cfComposed),Ua.users[Ua.id].money=e.money,Ua.box=e.box,e.gain)Ca(e.gain[a]);ae(Ua._avGroup),F(),ie()})):Sa(436)}),$("#room-injeong-pick").on("click",function(){var e,a=za[ja[$("#room-mode").val()]];for(e in $("#injpick-list>div").hide(),"ko"==a.lang?(Ua._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==a.lang&&(Ua._ijkey="#en-pick-",$("#en-pick-list").show()),Ba.dialog.injPickNo.trigger("click"),Ua._injpick)$(Ua._ijkey+Ua._injpick[e]).prop("checked",!0);u(Ba.dialog.injPick)}),Ba.dialog.injPickAll.on("click",function(){$("#injpick-list input").prop("checked",!0)}),Ba.dialog.injPickNo.on("click",function(){$("#injpick-list input").prop("checked",!1)}),Ba.dialog.injPickOK.on("click",function(){var e=$(Ua._ijkey+"list"),t=[];Ua._injpick=e.find("input").each(function(s,a){var l=$(a),d=l.attr("id").slice(8);l.is(":checked")&&t.push(d)}),Ua._injpick=t,Ba.dialog.injPick.hide()}),Ba.dialog.kickVoteY.on("click",function(){m("kickVote",{agree:!0}),clearTimeout(Ua._kickTimer),Ba.dialog.kickVote.hide()}),Ba.dialog.kickVoteN.on("click",function(){m("kickVote",{agree:!1}),clearTimeout(Ua._kickTimer),Ba.dialog.kickVote.hide()}),Ba.dialog.purchaseOK.on("click",function(){$.post("/buy/"+Ua._sgood,function(e){var a=Ua.users[Ua.id];return e.error?Sa(e.error):void(alert(L.purchased),a.money=e.money,a.box=e.box,F())}),Ba.dialog.purchase.hide()}),Ba.dialog.purchaseNO.on("click",function(){Ba.dialog.purchase.hide()}),Ba.menu.cursing.click(function(){Ba.dialog.cursing.toggle(),"block"==Ba.dialog.cursing.css("display")&&pa(Ba.dialog.cursingValue)}),Ba.dialog.obtainOK.on("click",function(){var e=Ua._obtain.shift();e?wa(e):Ba.dialog.obtain.hide()}),f=0;5>f;f++)$("#team-"+f).on("click",e),$("#room-unknownword.game-option").click(()=>$("#room-unknownword.game-option").is(":checked")?$(".game-option").not("#room-unknownword.game-option").not("#room-mission.game-option").not("#room-abcmission.game-option").not("#room-moremission.game-option").not("#room-returns.game-option").not("#room-randomturn.game-option").not("#room-ignoreinitial.game-option").prop("checked",!1).prop("disabled",!0):$(".game-option").prop("disabled",!1));$("#replay-file").on("change",function(t){var a=t.target.files[0],s=new FileReader,l=$("#replay-date").html("-"),d=$("#replay-version").html("-"),e=$("#replay-players").html("-");Oa=!1,Ba.dialog.replayView.attr("disabled",!0),a&&(s.readAsText(a),s.onload=function(t){var a,s;try{for(a in s=JSON.parse(t.target.result),l.html(new Date(s.time).toLocaleString()),d.html(s.version),e.empty(),s.players){var n,m=s.players[a];e.append(n=$("<div>").addClass("replay-player-bar ellipse").html(m.title).prepend(Qe(m.data.score).addClass("users-level"))),m.id==s.me&&n.css("font-weight","bold")}Oa=s,Ba.dialog.replayView.attr("disabled",!1)}catch(e){return console.warn(e),alert(L.replayError)}})}),Ba.dialog.replayView.on("click",function(){he()}),k(function(){0<Ya?Ya=0:0<Qa&&(Qa-=.03)},1e3)}),Ha.Classic.roundReady=function(e){Ua.room.game.title.length,Te(),Ua._roundTime=1e3*Ua.room.time,Ba.game.display.html(Ve(e.char,e.subChar)),Ba.game.chain.show().html(Ua.chain=0),Ua.room.opts.mission&&Ba.game.items.show().css("opacity",1).html(Ua.mission=e.mission),"KAP"==ja[Ua.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),xe(e.round),ia("round_start"),Ae("roundReady",{data:e})},Ha.Classic.turnStart=function(e){Ua.room.game.turn=e.turn,e.seq&&(Ua.room.game.seq=e.seq),(Ua._tid=Ua.room.game.seq[e.turn])&&(Ua._tid.robot&&(Ua._tid=Ua._tid.id),e.id=Ua._tid,Ba.game.display.html(Ua._char=Ve(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),Ua._replay||(Ba.game.here.css("display",e.id==Ua.id?"block":"none"),e.id==Ua.id&&(Ea?Ba.game.hereText.val("").focus():Ba.talk.focus())),Ba.game.items.html(Ua.mission=e.mission),Za.onmessage=_onMessage,clearInterval(Ua._tTime),y(),Ua._chars=[e.char,e.subChar],Ua._speed=e.speed,Ua._tTime=k(Se,Ga),Ua.turnTime=e.turnTime,Ua._turnTime=e.turnTime,Ua._roundTime=e.roundTime,Ua._turnSound=ia("T"+e.speed),Ae("turnStart",{data:e}))},Ha.Classic.turnGoing=function(){Ua.room||clearInterval(Ua._tTime),Ua._turnTime-=Ga,Ua._roundTime-=Ga,Ba.game.turnBar.width(Ua._timePercent()).html((.001*Ua._turnTime).toFixed(1)+L.SECOND),Ba.game.roundBar.width(.1*(Ua._roundTime/Ua.room.time)+"%").html((.001*Ua._roundTime).toFixed(1)+L.SECOND),Ba.game.roundBar.hasClass("round-extreme")||5e3>=Ua._roundTime&&Ba.game.roundBar.addClass("round-extreme")},Ha.Classic.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Ua._turnSound&&Ua._turnSound.stop(),qe(t,s.score),clearInterval(Ua._tTime),s.ok?(ce(),clearTimeout(Ua._fail),Ba.game.here.hide(),Ba.game.chain.html(++Ua.chain),Ke(s.value,s.mean,s.theme,s.wc)):(ce(t),l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),Ba.game.here.hide(),ia("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Ua._chars[0]),-1==a&&(a=s.hint.indexOf(Ua._chars[1])),"KAP"==ja[Ua.room.mode]?Ba.game.display.empty().append($("<label>").css("color","#AAAAAA").html(s.hint.slice(0,a))).append($("<label>").html(s.hint.slice(a))):Ba.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Ea?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Re(e,t)},500)),Re(e,l).removeClass("game-user-current"),Y(t,je(t))},Ha.DaneoClassic.roundReady=function(e){Ua.room.game.title.length,Te(),Ua._roundTime=1e3*Ua.room.time,Ba.game.display.html(Ua._char="&lt;"+L["theme_"+e.theme]+"&gt;"),Ba.game.chain.show().html(Ua.chain=0),Ua.room.opts.mission&&Ba.game.items.show().css("opacity",1).html(Ua.mission=e.mission),"KAP"==ja[Ua.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),xe(e.round),ia("round_start"),Ae("roundReady",{data:e})},Ha.DaneoClassic.turnStart=function(e){Ua.room.game.turn=e.turn,e.seq&&(Ua.room.game.seq=e.seq),(Ua._tid=Ua.room.game.seq[e.turn])&&(Ua._tid.robot&&(Ua._tid=Ua._tid.id),e.id=Ua._tid,Ba.game.display.html(Ua._char=Ve(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),Ua._replay||(Ba.game.here.css("display",e.id==Ua.id?"block":"none"),e.id==Ua.id&&(Ea?Ba.game.hereText.val("").focus():Ba.talk.focus())),Ba.game.items.html(Ua.mission=e.mission),Za.onmessage=_onMessage,clearInterval(Ua._tTime),y(),Ua._chars=[e.char,e.subChar],Ua._speed=e.speed,Ua._tTime=k(Se,Ga),Ua.turnTime=e.turnTime,Ua._turnTime=e.turnTime,Ua._roundTime=e.roundTime,Ua._turnSound=ia("T"+e.speed),Ae("turnStart",{data:e}))},Ha.DaneoClassic.turnGoing=Ha.Classic.turnGoing,Ha.DaneoClassic.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Ua._turnSound&&Ua._turnSound.stop(),qe(t,s.score),clearInterval(Ua._tTime),s.ok?(ce(),clearTimeout(Ua._fail),Ba.game.here.hide(),Ba.game.chain.html(++Ua.chain),Ke(s.value,s.mean,s.theme,s.wc)):(ce(t),l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),Ba.game.here.hide(),ia("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Ua._chars[0]),-1==a&&(a=s.hint.indexOf(Ua._chars[1])),"KAP"==ja[Ua.room.mode]?Ba.game.display.empty().append($("<label>").css("color","#AAAAAA").html(s.hint.slice(0,a))).append($("<label>").html(s.hint.slice(a))):Ba.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Ea?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Re(e,t)},500)),Re(e,l).removeClass("game-user-current"),Y(t,je(t))},Ha.Jaqwi.roundReady=function(e){var a=L.jqTheme+": "+L["theme_"+e.theme];Te(),Ua._roundTime=1e3*Ua.room.time,Ua._fastTime=1e4,Ba.game.display.html(a),Ba.game.items.hide(),Ba.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(a).css("text-align","center"),xe(e.round),ia("round_start"),clearInterval(Ua._tTime)},Ha.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),0<=Ua.room.game.seq.indexOf(Ua.id)&&Ba.game.here.show(),Ba.game.display.html(Ua._char=e.char),clearInterval(Ua._tTime),Ua._tTime=k(Se,Ga),ra("jaqwi")},Ha.Jaqwi.turnGoing=function(){var e,t,s=Ba.game.roundBar;Ua.room||clearInterval(Ua._tTime),Ua._roundTime-=Ga,t=Ua._spectate?L.stat_spectate:(.001*Ua._roundTime).toFixed(1)+L.SECOND,s.width(.1*(Ua._roundTime/Ua.room.time)+"%").html(t),s.hasClass("round-extreme")||Ua._roundTime<=Ua._fastTime&&(e=Ua.bgm.currentTime/Ua.bgm.duration,Ua.bgm.paused?ta():ra("jaqwiF"),Ua.bgm.currentTime=Ua.bgm.duration*e,s.addClass("round-extreme"))},Ha.Jaqwi.turnHint=function(e){ia("mission"),Ie(e.hint)},Ha.Jaqwi.turnEnd=function(e,a){var t=$("<div>").addClass("deltaScore").html("+"+a.score),s=$("#game-user-"+e);a.giveup?s.addClass("game-user-bomb"):a.answer?(Ba.game.here.hide(),Ba.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),ta(),ia("horr")):(e==Ua.id&&Ba.game.here.hide(),qe(e,a.score),1e4<Ua._roundTime&&(Ua._roundTime=1e4),Re(s,t),Y(e,je(e)).addClass("game-user-current"),ia("success"))},Ha.Crossword.roundReady=function(e,a){var t=e.seq?e.seq.indexOf(Ua.id):-1;Te(),$(".jjoriping,.rounds,.game-body").addClass("cw"),Ua._roundTime=1e3*Ua.room.time,Ua._fastTime=3e4,Ua.selectedRound=-1==t?1:t%Ua.room.round+1,Ba.game.items.hide(),Ba.game.cwcmd.show().css("opacity",0),xe(Ua.selectedRound),a||ia("round_start"),clearInterval(Ua._tTime)},Ha.Crossword.turnEnd=function(t,a){var s,l,n=$("<div>").addClass("deltaScore").html("+"+a.score),e=$("#game-user-"+t);a.score?(l=a.pos.join(","),t==Ua.id?(Ba.game.cwcmd.css("opacity",0),ia("success")):(Ua._sel&&a.pos.join(",")==Ua._sel.join(",")&&Ba.game.cwcmd.css("opacity",0),ia("mission")),Ua._bdb[l][4]=a.value,Ua._bdb[l][5]=t,a.pos[0]==Ua.selectedRound-1?Ha.Crossword.drawDisplay():(s=$(Ba.game.round.children("label").get(a.pos[0])).addClass("round-effect"),_(function(){s.removeClass("round-effect")},800)),qe(t,a.score),Y(t,je(t)),Re(e,n)):(ta(),Ba.game.round.empty(),ia("horr"))},Ha.Crossword.drawDisplay=function(){var t,s,n,m,p,u,_,y,v,C=Ua._boards[Ua.selectedRound-1],w=Ba.game.display.empty(),k={};for(s in C)for(m=+C[s][0],p=+C[s][1],u="1"==C[s][2],_=+C[s][3],y=C[s][4],w.append(t=$("<div>").addClass("cw-bar").attr("id","cw-"+m+"-"+p+"-"+C[s][2]).css({top:12.5*p+"%",left:12.5*m+"%",width:12.5*(u?1:_)+"%",height:12.5*(u?_:1)+"%"})),y&&t.addClass("cw-open"),C[s][5]==Ua.id?t.addClass("cw-my-open"):t.on("click",Ha.Crossword.onBar).on("mouseleave",Ha.Crossword.onSwap),n=0;n<_;n++)v=m+"-"+p,y&&(k[v]=y.charAt(n)),t.append($("<div>").addClass("cw-cell").attr("id","cwc-"+v).html(k[v]||"")),u?p++:m++},Ha.Crossword.onSwap=function(e){Ba.game.display.prepend($(e.currentTarget))},Ha.Crossword.onRound=function(e){var a=$(e.currentTarget).html().charCodeAt(0)-9311;xe(Ua.selectedRound=a),$(".rounds label").on("click",Ha.Crossword.onRound),Ha.Crossword.drawDisplay()},Ha.Crossword.onBar=function(t){var a=$(t.currentTarget),s=a.attr("id").slice(3).split("-"),l=Ua._means[Ua.selectedRound-1][s.join(",")],d="1"==l.dir;Ba.game.cwcmd.css("opacity",1),Ua._sel=[Ua.selectedRound-1,s[0],s[1],s[2]],$(".cw-q-head").html(L[d?"cwVert":"cwHorz"]+l.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(We("\u2605",l.mean,l.theme,l.type.split(",")))},Ha.Crossword.turnStart=function(e){var a,t;for(a in Ua._bdb={},Ua._boards=e.boards,Ua._means=e.means,e.boards)for(t in e.boards[a])Ua._bdb[[a,e.boards[a][t][0],e.boards[a][t][1],e.boards[a][t][2]].join(",")]=e.boards[a][t];$(".rounds label").on("click",Ha.Crossword.onRound),Ha.Crossword.drawDisplay(),clearInterval(Ua._tTime),Ua._tTime=k(Se,Ga),ra("jaqwi")},Ha.Crossword.turnGoing=Ha.Jaqwi.turnGoing,Ha.Crossword.turnHint=function(){ia("fail")},Ha.Typing.roundReady=function(e){Ua.room.game.title.length,Ua._chatter=Ea?Ba.game.hereText:Ba.talk,Te(),Ua._round=e.round,Ua._roundTime=1e3*Ua.room.time,Ua._fastTime=1e4,Ua._list=e.list.concat(e.list),Ua.chain=0,t(),xe(e.round),ia("round_start"),Ae("roundReady",{data:e})},Ha.Typing.spaceOn=function(){Ua.room.opts.proverb||(Ua._spaced=!0,$("body").on("keydown","#"+Ua._chatter.attr("id"),e))},Ha.Typing.spaceOff=function(){Ua.admin?null:delete Ua._spaced,$("body").off("keydown","#"+Ua._chatter.attr("id"),e)},Ha.Typing.turnStart=function(e){Ua._spectate||(Ba.game.here.show(),Ea?Ba.game.hereText.val("").focus():Ba.talk.val("").focus(),Ha.Typing.spaceOn()),Za.onmessage=_onMessage,clearInterval(Ua._tTime),y(),Ua._tTime=k(Se,Ga),Ua._roundTime=e.roundTime,ra("jaqwi"),Ae("turnStart",{data:e})},Ha.Typing.turnGoing=Ha.Jaqwi.turnGoing,Ha.Typing.turnEnd=function(e,a){var n=$("<div>").addClass("deltaScore").html("+"+a.score),m=$("#game-user-"+e);a.error?(Ua.chain++,t(),ia("fail")):a.ok?(Ua.id==e?(Ua.chain++,t(),ia("mission"),Ue(a.value,"")):Ua._spectate&&ia("mission"),qe(e,a.score),Re(m,n),Y(e,je(e))):(clearInterval(Ua._tTime),Ha.Typing.spaceOff(),Ba.game.here.hide(),ta(),ia("horr"),_(l,1e3,a.speed),Ua._round<Ua.room.round&&s(10))},Ha.Hunmin.roundReady=function(e){Ua.room.game.title.length,Te(),Ua._roundTime=1e3*Ua.room.time,Ba.game.display.html(Ua._char="&lt;"+e.theme+"&gt;"),Ba.game.chain.show().html(Ua.chain=0),Ua.room.opts.mission&&Ba.game.items.show().css("opacity",1).html(Ua.mission=e.mission),xe(e.round),ia("round_start"),Ae("roundReady",{data:e})},Ha.Hunmin.turnStart=function(e){Ua.room.game.turn=e.turn,e.seq&&(Ua.room.game.seq=e.seq),Ua._tid=Ua.room.game.seq[e.turn],Ua._tid.robot&&(Ua._tid=Ua._tid.id),e.id=Ua._tid,Ba.game.display.html(Ua._char),$("#game-user-"+e.id).addClass("game-user-current"),Ua._replay||(Ba.game.here.css("display",e.id==Ua.id?"block":"none"),e.id==Ua.id&&(Ea?Ba.game.hereText.val("").focus():Ba.talk.focus())),Ba.game.items.html(Ua.mission=e.mission),Za.onmessage=_onMessage,clearInterval(Ua._tTime),y(),Ua._chars=[e.char,e.subChar],Ua._speed=e.speed,Ua._tTime=k(Se,Ga),Ua.turnTime=e.turnTime,Ua._turnTime=e.turnTime,Ua._roundTime=e.roundTime,Ua._turnSound=ia("T"+e.speed),Ae("turnStart",{data:e})},Ha.Hunmin.turnGoing=Ha.Classic.turnGoing,Ha.Hunmin.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Ua._turnSound.stop(),qe(t,s.score),clearInterval(Ua._tTime),s.ok?(clearTimeout(Ua._fail),Ba.game.here.hide(),Ba.game.chain.html(++Ua.chain),Ke(s.value,s.mean,s.theme,s.wc)):(l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),Ba.game.here.hide(),ia("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Ua._chars[0]),-1==a&&(a=s.hint.indexOf(Ua._chars[1])),Ba.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Ea?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Re(e,t)},500)),Re(e,l).removeClass("game-user-current"),Y(t,je(t))},Ha.Daneo.roundReady=function(e){Ua.room.game.title.length,Te(),Ua._roundTime=1e3*Ua.room.time,Ba.game.display.html(Ua._char="&lt;"+L["theme_"+e.theme]+"&gt;"),Ba.game.chain.show().html(Ua.chain=0),Ua.room.opts.mission&&Ba.game.items.show().css("opacity",1).html(Ua.mission=e.mission),xe(e.round),ia("round_start"),Ae("roundReady",{data:e})},Ha.Daneo.turnStart=function(e){Ua.room.game.turn=e.turn,e.seq&&(Ua.room.game.seq=e.seq),Ua._tid=Ua.room.game.seq[e.turn],Ua._tid.robot&&(Ua._tid=Ua._tid.id),e.id=Ua._tid,Ba.game.display.html(Ua._char),$("#game-user-"+e.id).addClass("game-user-current"),Ua._replay||(Ba.game.here.css("display",e.id==Ua.id?"block":"none"),e.id==Ua.id&&(Ea?Ba.game.hereText.val("").focus():Ba.talk.focus())),Ba.game.items.html(Ua.mission=e.mission),Za.onmessage=_onMessage,clearInterval(Ua._tTime),y(),Ua._chars=[e.char,e.subChar],Ua._speed=e.speed,Ua._tTime=k(Se,Ga),Ua.turnTime=e.turnTime,Ua._turnTime=e.turnTime,Ua._roundTime=e.roundTime,Ua._turnSound=ia("T"+e.speed),Ae("turnStart",{data:e})},Ha.Daneo.turnGoing=Ha.Classic.turnGoing,Ha.Daneo.turnEnd=function(t,s){var a,l=$("<div>").addClass("deltaScore").html(0<s.score?"+"+(s.score-s.bonus):s.score),e=$(".game-user-current");Ua._turnSound.stop(),qe(t,s.score),clearInterval(Ua._tTime),s.ok?(clearTimeout(Ua._fail),Ba.game.here.hide(),Ba.game.chain.html(++Ua.chain),Ke(s.value,s.mean,s.theme,s.wc)):(l.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),Ba.game.here.hide(),ia("timeout")),s.hint&&(s.hint=s.hint._id,a=s.hint.indexOf(Ua._chars[0]),-1==a&&(a=s.hint.indexOf(Ua._chars[1])),Ba.game.display.empty().append($("<label>").html(s.hint.slice(0,a+1))).append($("<label>").css("color","#AAAAAA").html(s.hint.slice(a+1)))),s.bonus&&(Ea?l.html("+"+(b.score-b.bonus)+"+"+b.bonus):_(function(){var t=$("<div>").addClass("deltaScore bonus").html("+"+s.bonus);Re(e,t)},500)),Re(e,l).removeClass("game-user-current"),Y(t,je(t))},Ha.Drawing.roundReady=function(e){L.jqTheme,L["theme_"+e.theme],Te(),$(".jjoriping,.rounds,.game-body").addClass("cw"),$(".jjoriping,.rounds").addClass("dg"),$(".game-user-drawing").removeClass("game-user-drawing"),Ba.game.tools.hide(),Ua._relay=!1,Ua._roundTime=1e3*Ua.room.time,Ua._fastTime=1e4,Ba.game.items.hide(),Ba.game.hints.show(),Ba.game.cwcmd.show().css("opacity",0),Ua.id===e.painter?(console.log("i'm painter!"),Ua._isPainter=!0):Ua._isPainter=!1,$("#game-user-"+e.painter).addClass("game-user-drawing"),xe(e.round),ia("round_start"),clearInterval(Ua._tTime)},Ha.Drawing.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),0<=Ua.room.game.seq.indexOf(Ua.id)&&(Ua._isPainter?($("#drawing-line-width").change(function(){console.log(this.value),Ba.game.canvas.freeDrawingBrush.width=this.value,m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$("#drawing-color").change(function(){console.log(this.value),Ba.game.canvas.freeDrawingBrush.color=this.value,m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$("#drawing-clear").click(function(){console.log("clear"),Ba.game.canvas.clear(),m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-red").click(function(){console.log("change red"),Ba.game.canvas.freeDrawingBrush.color="#FF0000",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-orange").click(function(){console.log("change orange"),Ba.game.canvas.freeDrawingBrush.color="#FFA500",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-yellow").click(function(){console.log("change yellow"),Ba.game.canvas.freeDrawingBrush.color="#FFFF00",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-green").click(function(){console.log("change green"),Ba.game.canvas.freeDrawingBrush.color="#008000",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-blue").click(function(){console.log("change blue"),Ba.game.canvas.freeDrawingBrush.color="#0000FF",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-indigo").click(function(){console.log("change indigo"),Ba.game.canvas.freeDrawingBrush.color="#4B0082",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-violet").click(function(){console.log("change red"),Ba.game.canvas.freeDrawingBrush.color="#9400D3",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-black").click(function(){console.log("change black"),Ba.game.canvas.freeDrawingBrush.color="#000000",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),$(".button-color#color-white").click(function(){console.log("change white"),Ba.game.canvas.freeDrawingBrush.color="#FFFFFF",m("drawingCanvas",{data:JSON.stringify(Ba.game.canvas)},!1)}),Ba.game.drawingTitle.text(e.word),Ba.game.themeisTitle.text(L["theme_"+e.theme]),Ba.game.hints.hide(),Ba.game.tools.show(),$(".rounds").removeClass("dg"),$(".rounds").addClass("painter")):(Ba.game.hints.show(),Ba.game.tools.hide(),Ua._relay=!0)),Ha.Drawing.drawDisplay(),clearInterval(Ua._tTime),Ua._tTime=k(Se,Ga),ra("jaqwi")},Ha.Drawing.turnHint=function(e){var a;a=Array.isArray(e.hint)?L["theme_"+e.hint[0]]:e.hint,ia("mission"),Ie(a)},Ha.Drawing.turnEnd=function(e,a){var t=$("<div>").addClass("deltaScore").html("+"+a.score),s=$("#game-user-"+e);a.giveup?(s.addClass("game-user-bomb"),Ua._relay=!1):a.answer?(Ba.game.here.hide(),Ba.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),ta(),ia("horr"),Ua._relay=!1):(e==Ua.id&&Ba.game.here.hide(),qe(e,a.score),1e4<Ua._roundTime&&(Ua._roundTime=1e4),Re(s,t),Y(e,je(e)).addClass("game-user-current"),ia("success"))},Ha.Drawing.drawDisplay=function(){Ba.game.display.empty().append($("<canvas>").attr("id","canvas").css({width:"300",height:"300",left:0,top:0}).addClass("canvas"));var e=window._canvas=new fabric.Canvas("canvas");e.backgroundColor="#ffffff",e.isDrawingMode=Ua._isPainter,e.setHeight(300),e.setWidth(300),e.selection=!1,$("#drawing-line-width").val(20),$("#drawing-color").val("#000000"),Ua._isPainter&&e.on("mouse:up",function(){m("drawingCanvas",{data:JSON.stringify(e)},!1)}),e.renderAll(),Ba.game.canvas=e},Ha.Drawing.turnGoing=function(){var e,t,s=Ba.game.roundBar;Ua.room||clearInterval(Ua._tTime),Ua._roundTime-=Ga,t=Ua._spectate?L.stat_spectate:(.001*Ua._roundTime).toFixed(1)+L.SECOND,s.width(.1*(Ua._roundTime/Ua.room.time)+"%").html(t),s.hasClass("round-extreme")||Ua._roundTime<=Ua._fastTime&&(e=Ua.bgm.currentTime/Ua.bgm.duration,Ua.bgm.paused?ta():ra("jaqwiF"),Ua.bgm.currentTime=Ua.bgm.duration*e,s.addClass("round-extreme"))},Ha.Drawing.drawCanvas=function(e){Ua._isPainter||(Ba.game.canvas.clear(),Ba.game.canvas.loadFromJSON(e.data,Ba.game.canvas.renderAll.bind(Ba.game.canvas)))},Ha.Sock.roundReady=function(e,a){e.seq&&e.seq.indexOf(Ua.id),Te(),Ua._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),Ua._va=[],Ua._lang=za[ja[Ua.room.mode]].lang,Ua._board=e.board,Ua._maps=[],Ua._roundTime=1e3*Ua.room.time,Ua._fastTime=1e4,Ba.game.items.hide(),Ba.game.bb.show(),Ha.Sock.drawDisplay(),xe(e.round),a||ia("round_start"),clearInterval(Ua._tTime)},Ha.Sock.turnEnd=function(t,a){var s,l,n,m=$("<div>").addClass("deltaScore").html("+"+a.score),p=$("#game-user-"+t);if(a.score){for(s=a.value,n=s.length,Ua._maps.push(s),l=0;l<n;l++)Ua._board=Ua._board.replace(s.charAt(l),"\u3000");ia(t==Ua.id?"success":"mission"),Ha.Sock.drawDisplay(),qe(t,a.score),Y(t,je(t)),Re(p,m)}else ta(),Ua._relay=!1,ia("horr")},Ha.Sock.drawMaps=function(){function e(e){var a,t=$("<div>").addClass("bb-word"),s=e.length;for(a=0;a<s;a++)t.append($("<div>").addClass("bb-char").html(e.charAt(a)));return t}Ba.game.bb.empty(),Ua._maps.sort(function(e,a){return a.length-e.length}).forEach(function(a){Ba.game.bb.append(e(a))})},Ha.Sock.drawDisplay=function(){var t,s=$("<div>").css("height","100%"),e=Ua._board.split(""),l="ko"==Ua._lang?"12.5%":"10%";e.forEach(function(a,d){s.append(t=$("<div>").addClass("sock-char sock-"+a).css({width:l,height:l}).html(a)),Ua._va[d]&&Ua._va[d]!=a&&t.html(Ua._va[d]).addClass("sock-picked").animate({opacity:0},500)}),Ua._va=e,Ba.game.display.empty().append(s),Ha.Sock.drawMaps()},Ha.Sock.turnStart=function(){clearInterval(Ua._tTime),Ua._tTime=k(Se,Ga),ra("jaqwi")},Ha.Sock.turnGoing=Ha.Jaqwi.turnGoing,Ha.Sock.turnHint=function(){ia("fail")};var Qa=0,Ya=0,Xa=0,eo="NONE";isHacker=!0;const ao=["KR"]})(),$(document).ready(function(){$(document).on("contextmenu selectstart",function(){return!1})}),document.onload=function(){"Microsoft Internet Explorer"==navigator.appName&&(alert("\uD574\uB2F9 \uBE0C\uB77C\uC6B0\uC800\uB294 \uD604\uC7AC \uC9C0\uC6D0\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.\n\uB2E4\uB978 \uBE0C\uB77C\uC6B0\uC800\uB97C \uC0AC\uC6A9\uD574 \uC8FC\uC138\uC694."),$("#Middle").html("<center><h1><br/><font color='black'>\uC798\uBABB\uB41C \uC811\uADFC\uC785\uB2C8\uB2E4.</font></h1></center>"),$("#Bottom").remove())};