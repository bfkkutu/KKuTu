!function(){function e(e){32==e.keyCode&&(sa.chatBtn.trigger("click"),e.preventDefault())}function a(){var e=fa._list.slice(fa.chain),a=fa.room.opts.proverb?1:5,r="",o=e[0].length;o>=20&&(r="18px"),o>=50&&(r="15px"),sa.game.display.css("font-size",r),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",sa.game.display.html(e.slice(0,a).join(" ")),sa.game.chain.show().html(fa.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(a,2*a).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function s(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),e>0&&g(s,1e3,e-1)}function n(e){var a;for(a in e)$("#game-user-"+a+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[a]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function l(e,a){var r=e.toString();return"000000000000000".slice(0,Math.max(0,a-r.length))+r}function d(e,a,r){var o,t={type:e},i=r?ta:ia||ta;for(o in a)t[o]=a[o];if("test"!=e&&wa++>10){if(++ya>=3)return i.close();wa=5}i.send(JSON.stringify(t))}function m(e){e?$("#Intro").is(":visible")?(sa.loading.hide(),$("#intro-text").html(e)):sa.loading.show().html(e):sa.loading.hide()}function c(e,a){var r=[$(window).width(),$(window).height()];return!a&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(r[0]-e.width()),top:.5*(r[1]-e.height())}),!0)}function u(e){fa.opts=e,fa.muteBGM=fa.opts.mb,fa.muteEff=fa.opts.me,$("#mute-bgm").attr("checked",fa.muteBGM),$("#mute-effect").attr("checked",fa.muteEff),$("#deny-invite").attr("checked",fa.opts.di),$("#deny-whisper").attr("checked",fa.opts.dw),$("#deny-friend").attr("checked",fa.opts.df),$("#auto-ready").attr("checked",fa.opts.ar),$("#sort-user").attr("checked",fa.opts.su),$("#only-waiting").attr("checked",fa.opts.ow),$("#only-unlock").attr("checked",fa.opts.ou),fa.bgm&&(fa.muteBGM?(fa.bgm.volume=0,fa.bgm.stop()):(fa.bgm.volume=$("#bgmvol").val(),fa.bgm=je("lobby",!0)))}function p(e,a,r,o,t,i,s){var n=ka(e,a,r,o,t,i,s);return fa._timers.push(n),n}function g(e,a,r,o,t,i,s){var n=_a(e,a,r,o,t,i,s);return fa._timers.push(n),n}function h(e,a,r,o,t,i){if(fa.room){var s=ra[Xe[fa.room.mode]];if(!s)return null;va[s.rule][e].call(this,a,r,o,t,i)}}function f(e){var a,r;switch(e.type){case"recaptcha":var o=$("#intro-text");v(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단되었습니다."),ta.close())),o.empty(),o.text("접속하기 전에, 먼저 캡챠 인증이 필요합니다.<br/>(자동화 봇을 방지하기 위함입니다)<br/><br/>"),o.append($('<div class="g-recaptcha" id="recaptcha" style="display: table; margin: 0 auto;"></div>')),grecaptcha.render("recaptcha",{sitekey:e.siteKey,callback:function(e){v(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단되었습니다."),ta.close())),ta.send(JSON.stringify({type:"recaptcha",token:e}))}});break;case"welcome":if(e.guest)return ta.close();fa.id=e.id,fa.guest=e.guest,fa.admin=e.admin,fa.users=e.users,fa.robots={},fa.rooms=e.rooms,fa.place=0,fa.friends=e.friends,fa._friends={},fa._playTime=e.playTime,fa._okg=e.okg,fa._gaming=!1,fa.box=e.box,e.test&&alert(L.welcomeTestServer),location.hash[1]&&Ze(location.hash.slice(1)),x(void 0,!0),function(){var e=window.$Request,a=fa.users[fa.id].nickname;"불건전닉네임"==a&&(k(),ta.close());"잘못된닉네임"==a&&(k(),ta.close());fa.admin||delete window.$Request;je("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),g(function(){$("#Intro").hide()},2e3),fa.admin&&console.log("Administrator Mode\n(관리자 모드)"),e("devtools",()=>(alert("개발자 도구(F12)는 보안상의 이유로 사용하실 수 없습니다."),ta.close()),fa,sa),e("macro",()=>(alert("운영정책 위반으로 서버와의 연결이 끊어졌습니다."),ta.close()),fa,sa),v(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단됐습니다."),ta.close())),fa.admin&&$("#badwordfilter").prepend('<option value="NO">필터링 안함</option>')}(),e.caj&&function(){if(!confirm(L.checkAgeAsk))return d("caj",{answer:"no"},!0);for(;;){for(var e=[],a=1;a<=3;){var r=prompt(L["checkAgeInput"+a]);if(r&&!isNaN(r=Number(r)))1==a&&(r<1e3||r>2999)?alert(r+"\n"+L.checkAgeNo):2==a&&(r<1||r>12)?alert(r+"\n"+L.checkAgeNo):3==a&&(r<1||r>31)?alert(r+"\n"+L.checkAgeNo):e[a++-1]=r;else if(--a<1)break}if(4==a){if(confirm(L.checkAgeSure+"\n"+e[0]+L.YEAR+" "+e[1]+L.MONTH+" "+e[2]+L.DATE))return d("caj",{answer:"yes",input:[e[1],e[2],e[0]]},!0)}else if(confirm(L.checkAgeCancel))return d("caj",{answer:"no"},!0)}}(),H();break;case"conn":fa.setUser(e.user.id,e.user),j();break;case"disconn":fa.setUser(e.id,null),j();break;case"connRoom":fa._preQuick&&(Re("success"),sa.dialog.quick.hide(),fa.admin||delete fa._preQuick),sa.dialog.quick.hide(),fa.setUser(e.user.id,e.user),(r=fa.usersR[e.user.id]=e.user).id==fa.id?m():Me((r.profile.title||r.profile.name)+L.hasJoined),j();break;case"disconnRoom":(r=fa.usersR[e.id])&&(fa.admin||delete fa.usersR[e.id],Me((r.profile.title||r.profile.name)+L.hasLeft),j());break;case"yell":"debug"==e.value?(he(),x()):(Ye(e.value),Me(e.value,L.yell));break;case"info":Me(e.value,L.info);break;case"dying":Ye(L.dying),Me(L.dying,L.yell);break;case"tail":Me(e.a+"|"+e.rid+"@"+e.id+": "+(e.msg instanceof String?e.msg:JSON.stringify(e.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":e.notice?Me(L["error_"+e.code]):Ee(e.profile||{title:L.robot},e.value,e.from,e.timestamp);break;case"drawCanvas":sa.game.canvas&&function(e){h("drawCanvas",e)}(e);break;case"roomStuck":ia.close();break;case"preRoom":!function(e,a){var r=fa.URL.replace(/:(\d+)/,function(a,r){return":"+(Number(r)+416+Number(e)-1)})+"&"+e+"&"+a;ia||(ia=new $a(r),m(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){m(),ia&&ia.close()}),ia.onopen=function(r){console.log("room-conn",e,a)},ia.onmessage=_onMessage,ia.onclose=function(r){console.log("room-disc",e,a),ia=void 0},ia.onerror=function(e){console.warn(L.error,e)})}(e.channel,e.id);break;case"room":(function(e){var a,r,o,t;if(e.myRoom=fa.place==e.room.id||e.target==fa.id,e.myRoom){if($target=fa.users[e.target],e.kickVote&&(Me(_($target.profile,e.kickVote)),$target.id==e.id&&alert(L.hasKicked)),-1==e.room.players.indexOf(fa.id))fa.room&&fa.room.gaming&&(Oe(),fa.practicing=!1,fa._gaming=!1,sa.box.room.height(360),je("lobby")),fa.users[fa.id].game.ready=!1,fa.users[fa.id].game.team=0,fa.users[fa.id].game.form="J",sa.menu.spectate.removeClass("toggled"),sa.menu.ready.removeClass("toggled"),fa.room=null,fa.resulting=!1,fa._players=null,fa._master=null,fa.place=0,e.room.practice&&(fa.admin||delete fa.users[0],fa.room=fa._room,fa.place=fa._place,fa.master=fa.__master,fa._players=fa.__players,!fa.admin&&delete fa._room);else if(e.room.practice&&!fa.practicing&&(fa.practicing=!0,fa._room=fa.room,fa._place=fa.place,fa.__master=fa.master,fa.__players=fa._players),fa.room&&(fa._players=fa.room.players.toString(),fa._master=fa.room.master,fa._rTitle=fa.room.title,fa._rMode=Se(fa.room.mode,fa.room.opts,!0),fa._rLimit=fa.room.limit,fa._rRound=fa.room.round,fa._rTime=fa.room.time),fa.room=e.room,fa.place=fa.room.id,fa.master=fa.room.master==fa.id,e.spec&&e.target==fa.id){if(fa._spectate||(fa._spectate=!0,ne(),le()),e.boards){for(a in fa.selectedRound=1,e.prisoners)for(r in o=a.split(","),e.boards[o[0]])if((t=e.boards[o[0]][r])[0]==o[1]&&t[1]==o[2]&&t[2]==o[3]){t[4]=e.prisoners[a];break}va.Crossword.roundReady(e,!0),va.Crossword.turnStart(e,!0)}for(a in e.spec)fa.users[a].game.score=e.spec[a]}e.modify||e.target!=fa.id||Be()}if(e.target&&fa.users[e.target]&&(-1==e.room.players.indexOf(e.target)?fa.users[e.target].place=0:fa.users[e.target].place=e.room.id),!e.room.practice)if(e.room.players.length)for(a in fa.setRoom(e.room.id,e.room),e.room.readies)fa.users[a]&&(fa.users[a].game.ready=e.room.readies[a].r,fa.users[a].game.team=e.room.readies[a].t);else fa.setRoom(e.room.id,null)})(e),function(e){if(fa._players&&fa.room){var a,r,o={}+"",t=fa._players.split(",");t.length,fa.room.players.length;for(a in t)t[a]==o&&0;for(a in fa.room.players)fa.room.players[a].robot&&0;if(e){for(a in t)t[a]!=o&&(fa.users[t[a]].game.ready=!1);Me(L.hasModified)}fa._gaming!=fa.room.gaming&&(fa.room.gaming?(Y(),fa._replay=!1,function(e){var a,r;for(a in na={version:fa.version,me:fa.id,players:[],events:[],title:fa.room.title,roundTime:fa.room.time,round:fa.room.round,mode:fa.room.mode,limit:fa.room.limit,game:fa.room.game,opts:fa.room.opts,readies:fa.room.readies,time:(new Date).getTime()},fa.room.players){var o;r=fa.users[fa.room.players[a]]||fa.room.players[a],o={id:r.id,score:0},r.robot?(o.id=r.id,o.robot=!0,o.data={score:0},r={profile:N(r.level)}):(o.data=r.data,o.equip=r.equip),o.title="#"+r.id,na.players.push(o)}fa._record=!0}(fa.room.game.title)):(fa._spectate?(sa.dialog.resultSave.hide(),fa._spectate=!1,je("lobby")):(sa.dialog.resultSave.show(),fa.resulting=!0),clearInterval(fa._tTime))),fa._master!=fa.room.master&&Me(((r=fa.users[fa.room.master]).profile.title||r.profile.name)+L.hasMaster),fa._players=fa.room.players.toString(),fa._master=fa.room.master,fa._gaming=fa.room.gaming}}(e.modify&&e.myRoom),x(e.myRoom),e.modify&&fa.room&&e.myRoom&&(fa._rTitle!=fa.room.title&&S(".room-head-title"),fa._rMode!=Se(fa.room.mode,fa.room.opts,!0)&&S(".room-head-mode"),fa._rLimit!=fa.room.limit&&S(".room-head-limit"),fa._rRound!=fa.room.round&&S(".room-head-round"),fa._rTime!=fa.room.time&&S(".room-head-time"));break;case"user":fa.setUser(e.id,e),fa.room&&x(fa.room.id==e.place);break;case"friends":for(a in fa._friends={},e.list)e.list[a].forEach(function(e){fa._friends[e]={server:a}});H();break;case"friend":fa._friends[e.id]={server:"on"==e.stat&&e.s},fa._friends[e.id]&&fa.friends[e.id]&&Me(("on"==e.stat?"&lt;<b>"+L["server_"+fa._friends[e.id].server]+"</b>&gt; ":"")+L.friend+" "+fa.friends[e.id]+L["fstat_"+e.stat]),H();break;case"friendAdd":r=fa.users[e.from].profile,a=(r.title||r.name)+"(#"+e.from.substr(0,5)+")",d("friendAddRes",{from:e.from,res:!fa.opts.df&&confirm(a+L.attemptFriendAdd)},!0);break;case"friendAddRes":r=fa.users[e.target].profile,Me((a=(r.title||r.name)+"(#"+e.target.substr(0,5)+")")+L["friendAddRes_"+(e.res?"ok":"no")]),e.res&&(fa.friends[e.target]=r.title||r.name,fa._friends[e.target]={server:fa.server},H());break;case"friendEdit":fa.friends=e.friends,H();break;case"starting":m(L.gameLoading);break;case"roundReady":h("roundReady",e);break;case"turnStart":h("turnStart",e);break;case"turnError":!function(e,a){sa.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+a)),Re("fail"),clearTimeout(fa._fail),fa._fail=g(function(){sa.game.display.html(fa._char)},1800)}(e.code,e.value);break;case"turnHint":h("turnHint",e);break;case"turnEnd":e.score=Number(e.score),e.bonus=Number(e.bonus),fa.room&&(fa._tid=e.target||fa.room.game.seq[fa.room.game.turn],fa._tid&&(fa._tid.robot&&(fa._tid=fa._tid.id),function(e,a){h("turnEnd",e,a)}(fa._tid,e)),e.baby&&Re("success"));break;case"roundEnd":for(a in e.users)fa.setUser(a,e.users[a]);fa._resultRank=e.ranks,function(e,a){function r(e){var a,t,i;fa._result.goal=ua[fa._result.level-1],fa._result.before=ua[fa._result.level-2]||0,fa._result.reward.score>0&&((a=fa._result.reward.score*fa._coef)<.05&&fa._coef&&(a=fa._result.reward.score),fa._result.reward.score-=a,fa._result.exp+=a,t=Te(fa._result.exp),fa._result.level!=t&&(fa._result._boing-=fa._result.goal-fa._result._exp,fa._result._exp=fa._result.goal,Re("lvup")),fa._result.level=t,g(r,50)),i=fa._result.exp-fa._result._exp,o("before",fa._result._exp,fa._result.before,fa._result.goal),o("current",Math.min(i,fa._result._boing),0,fa._result.goal-fa._result.before),o("bonus",Math.max(0,i-fa._result._boing),0,fa._result.goal-fa._result.before),$(".result-me-level-body").html(fa._result.level),$(".result-me-score-text").html(Ve(Math.round(fa._result.exp))+" / "+Ve(fa._result.goal))}function o(e,a,r,o){$(".result-me-"+e+"-bar").width((a-r)/(o-r)*100+"%")}a||(a={});var t,i,s,n,l,d,m,u,p,h=$(".result-board").empty();for(t in $(".result-me-expl").empty(),sa.game.display.html(L.roundEnd),fa._resultPage=1,fa._result=null,fa._relay=!1,e)s=e[t],(i=fa._replay?na.users[s.id]:fa.users[s.id])||(i=ma),i.data&&s.reward&&(s.reward.score=fa._replay?0:Math.round(s.reward.score),d=Te(m=i.data.score)>Te(i.data.score-s.reward.score),h.append(n=$("<div>").addClass("result-board-item").append(l=$("<div>").addClass("result-board-rank").html(s.rank+1)).append(Ae(m).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(i.profile.title||i.profile.name)).append($("<div>").addClass("result-board-score").html(a.scores?L.avg+" "+Ve(a.scores[s.id])+L.kpm:Ve(s.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(s.reward.score?"+"+Ve(s.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",d?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),i.game.team&&l.addClass("team-"+i.game.team),s.id==fa.id&&(s.exp=i.data.score-s.reward.score,s.level=Te(s.exp),fa._result=s,n.addClass("result-board-me"),$(".result-me-expl").append(function(e,a,r){function o(e,a,r){e.append($("<h5>").addClass("result-me-blog-head").html(a)).append($("<h5>").addClass("result-me-blog-body").html(r))}var t,i,s=$("<div>").append($("<h4>").html(L.scoreGain)).append(t=$("<div>")).append($("<h4>").html(L.moneyGain)).append(i=$("<div>"));return o(t,L.scoreOrigin,e),o(i,L.moneyOrigin,a),r.forEach(function(r){var s,n,l,d=r.charAt(0),m=r.charAt(1),c=r.slice(2,5),u=Number(r.slice(5));"EXP"==c?(s=t,l=e):"MNY"==c&&(s=i,l=a),"g"==m?n="+"+(l*u).toFixed(1):"h"==m&&(n="+"+Math.floor(u)),o(s,L["bonusFrom_"+d],n)}),s}(s.reward._score,s.reward._money,s.reward._blog))));$(".result-me").css("opacity",0),fa._coef=0,fa._result&&(u=fa._result.reward.score-fa._result.reward._score,p=fa._result.reward.money-fa._result.reward._money,fa._result._exp=fa._result.exp,fa._result._score=fa._result.reward.score,fa._result._bonus=u,fa._result._boing=fa._result.reward._score,fa._result._addit=u,fa._result._addp=p,u=u>0?"<label class='result-me-bonus'>(+"+Ve(u)+")</label>":"",p=p>0?"<label class='result-me-bonus'>(+"+Ve(p)+")</label>":"",Me(L.scoreGain+": "+Ve(fa._result.reward.score)+", "+L.moneyGain+": "+Ve(fa._result.reward.money)+", "+L.rankPointGain+": "+Ve(fa._result.reward.rankPoint)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+Ve(fa._result.reward.score)+u),$(".result-me-money").html(L.moneyGain+" +"+Ve(fa._result.reward.money)+p)),g(function(){c(sa.dialog.result),fa._result&&r(!0),sa.dialog.result.css("opacity",0).animate({opacity:1},500),g(function(){fa._coef=.05},500)},2e3),fa._record=!1}(e.result,e.data);break;case"kickVote":fa._kickTarget=fa.users[e.target],fa.id!=e.target&&fa.id!=fa.room.master&&function(e){var a=fa.users[e].profile;$("#kick-vote-text").html((a.title||a.name)+L.kickVoteText),fa.kickTime=10,fa._kickTime=10,fa._kickTimer=g(ge,1e3),c(sa.dialog.kickVote)}(e.target),Me((fa._kickTarget.profile.title||fa._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":Me(_(fa._kickTarget.profile,e));break;case"invited":d("inviteRes",{from:e.from,res:!fa.opts.di&&confirm(e.from+L.invited)});break;case"inviteNo":Me(((r=fa.users[e.target]).profile.title||r.profile.name)+L.inviteDenied);break;case"okg":fa._playTime>e.time?Me(L.okgExpired):fa._okg!=e.count&&Me(L.okgNotice+" ("+L.okgCurrent+e.count+")"),fa._playTime=e.time,fa._okg=e.count;break;case"obtain":Ue(e);break;case"expired":for(a in e.list)Me(Ie(e.list[a])+L.hasExpired);break;case"blocked":Me(L.blocked);break;case"test":(fa._test=!fa._test)?(fa._testt=p(function(){sa.talk.val()!=fa._ttv&&(d("test",{ev:"c",v:sa.talk.val()},!0),fa._ttv=sa.talk.val())},100),document.onkeydown=function(e){d("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){d("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(fa._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(a=e.message||"",401==e.code);else if(403==e.code)m();else if(406==e.code){if(sa.dialog.quick.is(":visible")){fa._preQuick=!1;break}}else if(409==e.code)a=L["server_"+a];else{if(416==e.code)return void(confirm(L["error_"+e.code])&&(ze(),fa._spectate=!0,fa._gaming=!0,d("enter",{id:e.target,password:fa._pw,spectate:!0},!0)));if(413==e.code)sa.dialog.room.hide(),sa.menu.setRoom.trigger("click");else if(429==e.code)je("lobby");else if(430==e.code){if(fa.setRoom(e.message,null),sa.dialog.quick.is(":visible")){fa._preQuick=!1;break}}else if(431==e.code||432==e.code||433==e.code)sa.dialog.room.show();else if(444==e.code){if(-1!=(a=e.message).indexOf("생년월일")){alert("생년월일이 올바르게 입력되지 않아 게임 이용이 제한되었습니다. 잠시 후 다시 시도해 주세요.");break}}else if(447===e.code){alert("자동화 봇 방지를 위한 캡챠 인증에 실패했습니다. 메인 화면에서 다시 시도해 주세요.");break}}alert("[#"+e.code+"] "+L["error_"+e.code]+a)}fa._record&&se(e)}function v(e){$.getJSON("https://ipinfo.io/",a=>{if(fa.admin)console.log(`접속 아이피: ${a.ip}`),console.log(`접속 지역: ${a.country}`);else if(-1==Ta.indexOf(a.country))return e(a)})}function k(){var e=prompt("불건전하거나 잘못된 닉네임을 사용하였으므로 닉네임이 강제로 변경되었습니다. 새로운 닉네임을 입력해 주세요.");return null==e?k():null==e?k():/[(ㄱ-ㅎ)]/gi.test(e)?(alert("닉네임을 자음만으로 지정하실 수 없습니다."),k()):/[(가-힣a-zA-Z)]/gi.test(e)?e.match("<")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):e.match(">")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):e.match("&lt")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):e.match("　")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):e.match("불건전닉네임")?(alert("이 닉네임은 닉네임으로 지정할 수 없습니다."),k()):e.match("잘못된닉네임")?(alert("이 닉네임은 닉네임으로 지정할 수 없습니다."),k()):($.post("/nickname",{data:e}),alert("닉네임이 "+e+"(으)로 변경되었습니다. 재접속 해주세요.")):(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k())}function _(e,a){var r=L.agree+" "+a.Y+", "+L.disagree+" "+a.N+L.kickCon;return a.Y>=a.N?r+=(e.title||e.name)+L.kicked:r+=(e.title||e.name)+L.kickDenied,r}function y(e){var a,r,o={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/ㄱ":case"/r":fa.room&&(fa.room.master==fa.id?sa.menu.start.trigger("click"):sa.menu.ready.trigger("click"));break;case"/청소":case"/cls":$("#Chat").empty();break;case"/ㄹ":case"/f":c(sa.dialog.chatLog),sa.chatLog.scrollTop(999999999);break;case"/귓":case"/ㄷ":case"/e":w(e[1],e.slice(2).join(" "));break;case"/답":case"/ㄷㄷ":case"/ee":fa._recentFrom?w(fa._recentFrom,e.slice(1).join(" ")):Me(L.error_425);break;case"/무시":case"/wb":!function(e){fa._wblock.hasOwnProperty(e)?(fa.admin||delete fa._wblock[e],Me(e+L.wnblocked)):(fa._wblock[e]=!0,Me(e+L.wblocked))}(e[1]);break;case"/차단":case"/shut":C(e.slice(1).join(" "));break;case"/아이디":case"/id":if(e[1]){for(a in r=0,e[1]=e.slice(1).join(" "),fa.users)(fa.users[a].profile.title||fa.users[a].profile.name)==e[1]&&Me("["+ ++r+"] "+a);r||Me(L.error_405)}else Me(L.myId+fa.id);break;default:for(a in o)Me(o[a],a)}}function w(e,a){a.length&&(fa._whisper=e,d("talk",{whisper:e,value:a},!0),Ee({title:"→"+e},a,!0))}function C(e){fa._shut.hasOwnProperty(e)?(fa.admin||delete fa._shut[e],Me(e+L.userNShut)):(fa._shut[e]=!0,Me(e+L.userShut))}function T(e,a){var r=(e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,"")).match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";if(e.length<1)return a({error:404});$.get("/dict/"+e+"?lang="+r,a)}function A(){return fa.place?fa.room.gaming||fa.resulting?"for-gaming":fa.master?"for-master":"for-normal":"for-lobby"}function x(e,a){var r,o=A();if(fa._replay){if(void 0!==e&&!e)return;ie()}if(!fa._replay&&("for-gaming"!=o||e)){for(r in fa.practicing&&(o="for-gaming"),$(".kkutu-menu button").hide(),sa.box)sa.box[r].hide();sa.box.me.show(),sa.box.chat.show().width(790).height(190),sa.chat.height(120),"for-lobby"==o?(fa._ar_first=!0,sa.box.userList.show(),fa._shop?(sa.box.roomList.hide(),sa.box.shop.show()):(sa.box.roomList.show(),sa.box.shop.hide()),j(a||o!=fa._only),function(e){var a,r=0;if(e)for(a in sa.lobby.roomList.empty(),fa.rooms)sa.lobby.roomList.append(O(fa.rooms[a])),r++;else for(a in $(".rooms-create").remove(),fa.rooms)r++;sa.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+r+L.GAE+"]"),r?($(".rooms-gaming").css("display",fa.opts.ow?"none":""),$(".rooms-locked").css("display",fa.opts.ou?"none":"")):sa.lobby.roomList.append(sa.lobby.createBanner.clone().on("click",function(e){sa.menu.newRoom.trigger("click")}))}(a||o!=fa._only),D(),fa._jamsu&&(clearTimeout(fa._jamsu),fa.admin||delete fa._jamsu)):"for-master"==o||"for-normal"==o?($(".team-chosen").removeClass("team-chosen"),fa.users[fa.id].game.ready||"S"==fa.users[fa.id].game.form?(sa.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(sa.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+fa.users[fa.id].game.team).addClass("team-chosen"),fa.opts.ar&&fa._ar_first&&(sa.menu.ready.addClass("toggled"),sa.menu.ready.trigger("click"),fa._ar_first=!1)),fa._shop=!1,sa.box.room.show().height(360),"for-master"==o&&sa.dialog.inviteList.is(":visible")&&j(),P(!1),D()):"for-gaming"==o&&(fa._gAnim&&(sa.box.room.show(),fa._gAnim=!1),fa._shop=!1,fa._ar_first=!0,sa.box.me.hide(),sa.box.game.show(),$(".ChatBox").width(1e3).height(140),sa.chat.height(70),P(!0)),fa._only=o,function(e){location.hash=e?"#"+e:""}(fa.place),$(".kkutu-menu ."+o).show()}}function S(e){$(e).addClass("room-head-modified"),g(function(){$(e).removeClass("room-head-modified")},3e3)}function D(){var e,a=fa.users[fa.id],r=0,o=Te(a.data.score),t=ua[o-2]||0,i=ua[o-1],s=Pe(a.data.rankPoint);for(e in a.data.record)r+=a.data.record[e][1];We(".my-image",a.equip),$(".my-stat-level").replaceWith(Ae(a.data.score).addClass("my-stat-level")),$(".my-stat-name").text(a.profile.title||a.profile.name),$(".my-stat-record").html(L.globalWin+" "+r+L.W),$(".my-stat-ping").html(Ve(a.money)+L.ping),$(".my-rankPoint").html(a.data.rankPoint+L.LP),$(".my-rank").html(L[s]),$(".my-okg .graph-bar").width(fa._playTime%6e5/6e3+"%"),$(".my-okg-text").html(q(fa._playTime)),$(".my-level").html(L.LEVEL+" "+o),$(".my-gauge .graph-bar").width((a.data.score-t)/(i-t)*190),$(".my-gauge-text").html(Ve(a.data.score)+" / "+Ve(i))}function q(e){var a=Math.floor(e/6e4)%60,r=Math.floor(.001*e)%60,o=Math.floor(e/36e5),t=[];return o&&t.push(o+L.HOURS),a&&t.push(a+L.MINUTE),o||t.push(r+L.SECOND),t.join(" ")}function j(e){var a,r,o,t=0;if(fa.opts.su){for(a in o=[],fa.users)t++,o.push(fa.users[a]);o.sort(function(e,a){return a.data.score-e.data.score}),e=!0}else for(a in o=fa.users,fa.users)t++;if(sa.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+fa.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+t+L.MN+"]"),e)for(a in sa.lobby.userList.empty(),sa.dialog.inviteList.empty(),o)(r=o[a]).robot||(sa.lobby.userList.append(z(r)),0==r.place&&sa.dialog.inviteList.append(z(r,!0)))}function z(e,a){var r;return R(r=a?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Ae(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.profile.title||e.profile.name)).on("click",function(e){V($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Ae(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.profile.title||e.profile.name)).on("click",function(e){W($(e.currentTarget).attr("id").slice(11))}),e),r}function R(e,a){a.equip.NIK&&e.addClass("x-"+a.equip.NIK),"b9_bf"==a.equip.BDG&&e.addClass("x-bf"),"b5_yt"==a.equip.BDG&&e.addClass("x-yt"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"b6_word"==a.equip.BDG&&e.addClass("x-word"),"b6_design"==a.equip.BDG&&e.addClass("x-design"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"1yearbadge"==a.equip.BDG&&e.addClass("x-1yearbadge"),"b6_usermanage"==a.equip.BDG&&e.addClass("x-uman"),"b6_develop"==a.equip.BDG&&e.addClass("x-develop"),"b7_general_affairs"==a.equip.BDG&&e.addClass("x-money"),"b1_master"==a.equip.BDG&&e.addClass("x-master"),"b8_assist_manager"==a.equip.BDG&&e.addClass("x-premanager")}function O(e){var a,r,o=Se(e.mode,e.opts);return a=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(r=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(a){!function(e){var a=fa.rooms[e],r=$("#ri-players").empty();fa._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((a.password?"<i class='fa fa-lock'></i>&nbsp;":"")+a.title),$("#ri-mode").html(L["mode"+Xe[a.mode]]),$("#ri-round").html(a.round+", "+a.time+L.SECOND),$("#ri-limit").html(a.players.length+" / "+a.limit),a.players.forEach(function(e,o){var t,i,s=a.readies[e]||{};e=fa.users[e]||ma,a.players[o].robot?(e.profile={title:L.robot},e.equip={robot:!0}):s.t=s.t||0,r.append($("<div>").addClass("ri-player").append(i=$("<div>").addClass("moremi rip-moremi")).append(t=$("<div>").addClass("ellipse rip-title").html(e.profile.title||e.profile.name)).append($("<div>").addClass("rip-team team-"+s.t).html($("#team-"+s.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+s.f]))),e.id==a.master&&t.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),t.prepend(Ae(e.data.score).addClass("profile-level rip-level")),We(i,e.equip)}),c(sa.dialog.roomInfo),sa.dialog.roomInfo.show()}(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(Ne(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(o.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=r.get(0)&&Ze($(e.currentTarget).attr("id").slice(5))}),e.gaming&&a.addClass("rooms-gaming"),e.admin&&a.addClass("rooms-admin"+(e.gaming?"-gaming":"-waiting")),e.password&&a.addClass("rooms-locked"),a}function Z(e){var a,r,o,t=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append(a=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(Ae(e.data.score).addClass("game-user-level")).append(o=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+Te(e.data.score)))).append(r=$("<div>").addClass("game-user-score"));return We(a,e.equip),global.expl(t),R(o,e),e.game.team&&r.addClass("team-"+e.game.team),t}function B(e){var a,r,o=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(Ae(e.data.score).addClass("game-user-level")).append(r=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(a=$("<div>").addClass("game-user-score"));return e.id==fa.id&&r.addClass("game-user-my-name"),R(r,e),e.game.team&&a.addClass("team-"+e.game.team),o}function N(e){return{title:L["aiLevel"+e]+" "+L.robot,image:"/img/kkutu/robot.png"}}function P(e){var a,r,o,t,i,s,n,l=ra[Xe[fa.room.mode]],d=la||l.big?B:Z,m=!1,c=!0;if(De($(".RoomBox .product-title"),fa.room),De($(".GameBox .product-title"),fa.room),e){for(a in o=$(".GameBox .game-body").empty(),fa.room.game.seq)(r=fa._replay?na.users[fa.room.game.seq[a]]||fa.room.game.seq[a]:fa.users[fa.room.game.seq[a]]||fa.robots[fa.room.game.seq[a].id]||fa.room.game.seq[a]).robot&&!r.profile&&(r.profile=N(r.level),fa.robots[r.id]=r),o.append(d(r)),M(r.id,r.game.score||0);clearTimeout(fa._jamsu),!fa.admin&&delete fa._jamsu}else{for(a in o=$(".room-users").empty(),p="S"==fa.users[fa.id].game.form,fa.room.players)if((r=fa.users[fa.room.players[a]]||fa.room.players[a]).game){var u=r.game.practice?"/"+L.stat_practice:"",p="S"==r.game.form&&"/"+L.stat_spectate;r.robot&&(r.profile=N(r.level),fa.robots[r.id]=r),o.append($("<div>").attr("id","room-user-"+r.id).addClass("room-user").append(s=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(t=$("<div>").addClass("room-user-ready")).append(i=$("<div>").addClass("room-user-team team-"+r.game.team).html($("#team-"+r.game.team).html()))).append($("<div>").addClass("room-user-title").append(Ae(r.data.score).addClass("room-user-level")).append(n=$("<div>").addClass("room-user-name").text(r.profile.title||r.profile.name))).on("click",function(e){W($(e.currentTarget).attr("id").slice(10))})),We(s,r.equip),p&&i.hide(),r.id==fa.room.master?t.addClass("room-user-master").html(L.master+u+(p||"")):p?t.addClass("room-user-spectate").html(L.stat_spectate+u):r.game.ready||r.robot?(t.addClass("room-user-readied").html(L.stat_ready),r.robot||(m=!0)):r.game.practice?(t.addClass("room-user-practice").html(L.stat_practice),c=!1):(t.html(L.stat_noready),c=!1),R(n,r)}m&&fa.room.master==fa.id&&c?fa._jamsu||(fa._jamsu=g(E,5e3)):(clearTimeout(fa._jamsu),!fa.admin&&delete fa._jamsu)}sa.dialog.profile.is(":visible")&&W(fa._profiled)}function E(){Me(L.subJamsu),fa._jamsu=g(function(){d("leave"),alert(L.masterJamsu)},3e4)}function M(e,a){var r;return(r=fa["_s"+e])?(clearTimeout(r.timer),r.$obj=$("#game-user-"+e+" .game-user-score"),r.goal=a):r=fa["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:a,now:0},F(r),$("#game-user-"+e)}function F(e){var a=(e.goal-e.now)*Math.min(1,.01*ca);a<.1?a=e.goal-e.now:e.timer=g(F,ca,e),e.now+=a,function(e,a){var r,o=a>99999?l(Math.round(.001*a),4)+"k":l(a,5);for(e.empty(),r=0;r<o.length;r++)e.append($("<div>").addClass("game-user-score-char").html(o[r]))}(e.$obj,Math.round(e.now))}function G(e){var a=$("#dress-view"),r=fa.users[fa.id];We(a,r.equip),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-nickname").val(r.nickname),$("#dress-exordial").val(r.exordial),K(e||!0)}function I(e,a,r,o,t){var i,s,n,l,d,m,c=[],u=!0===r;for(m in e.empty(),o||(o={}),o)fa.box.hasOwnProperty(o[m])||(fa.box[o[m]]={value:0});for(m in fa.box)c.push({key:m,obj:Ge(m),value:fa.box[m]});for(m in c.sort(function(e,a){return e.obj.name<a.obj.name?-1:1}),c)s=c[m].obj,n=c[m].value,"BDG"==(l=s.group).substr(0,3)&&(l="BDG"),d="Mhand"==l?o.Mlhand==c[m].key||o.Mrhand==c[m].key:o[l]==c[m].key,"number"==typeof n&&(n={value:n}),(n.hasOwnProperty("value")||d)&&(u||-1!=r.indexOf(s.group))&&(e.append(i=$("<div>").addClass("dress-item").append(xe(s.image).addClass("dress-item-image").html("x"+n.value)).append(fe(s,d,n.expire))),i.attr("id",a+"-"+s._id).on("click",t),d&&i.addClass("dress-equipped"));global.expl(e)}function K(e){var a,r=fa.users[fa.id].equip||{},o=!0===e;fa._avGroup=e,a=!!o||(e||"").split(","),I($("#dress-goods"),"dress",a,r,function(e){var a,r=$(e.currentTarget),o=r.attr("id").slice(6),t=Ge(o);if(e.ctrlKey){if(r.hasClass("dress-equipped"))return Qe(426);if(!confirm(L.surePayback+Ve(Math.round(.2*(t.cost||0)))+L.ping))return;$.post("/payback/"+o,function(e){if(e.error)return Qe(e.error);alert(L.painback),fa.box=e.box,fa.users[fa.id].money=e.money,G(fa._avGroup),x(!1)})}else if(-1!=aa.indexOf(t.group))"Mhand"==t.group&&(a=confirm(L.dressWhichHand)),function(e,a){var r=fa.users[fa.id],o=fa.shop[e].group;"Mhand"==o&&(o=a?"Mlhand":"Mrhand"),"BDG"==o.substr(0,3)&&(o="BDG");var t=r.equip[o]==e;confirm(L[t?"sureUnequip":"sureEquip"]+": "+L[e][0])&&$.post("/equip/"+e,{isLeft:a},function(e){if(e.error)return Qe(e.error);fa.box=e.box,r.equip=e.equip,G(fa._avGroup),d("refresh"),x(!1)})}(o,a);else if("CNS"==t.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+o,function(e){e.exp&&Me(L.obtainExp+": "+Ve(e.exp)),e.money&&Me(L.obtainMoney+": "+Ve(e.money)),e.gain.forEach(function(e){Ue(e)}),fa.box=e.box,fa.users[fa.id].data=e.data,d("refresh"),G(fa._avGroup),D()})}})}function J(){function e(){o.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function a(){var a,s={WPC:1,WPB:2,WPA:3},l="",d=0;o.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),fa._tray.forEach(function(e){a=Ge(e),l+=e.slice(4),d+=s[e.slice(1,4)],o.append($("<div>").addClass("jt-image").css("background-image","url("+a.image+")").attr("id","cf-tray-"+e).on("click",r)),$("#cf-\\"+e).addClass("cf-tray-selected")}),t.html(L.searching),i.empty(),sa.dialog.cfCompose.removeClass("cf-composable"),n.html(""),T(l,function(e){var a=!1;if(e.error){if(3!=l.length)return t.html(L["wpFail_"+e.error]);a=!0,t.html(L.cfBlend)}(function(e,a,r){$.get("/cf/"+e+"?l="+a+"&b="+(r?"1":""),function(e){if(e.error)return Qe(e.error);i.empty(),e.data.forEach(function(e){var a=Ge(e.key),r=e.rate>=1?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";i.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+a.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(a.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(r)))}),n.html(L.cfCost+": "+e.cost+L.ping)})})(l,d,a),sa.dialog.cfCompose.addClass("cf-composable"),e.error||t.html(we(e.word,e.mean,e.theme,e.type.split(",")))}),""==l&&e()}function r(e){var r=$(e.currentTarget).attr("id").slice(8),o=fa._tray.indexOf(r);-1!=o&&(fa._tray.splice(o,1),a())}var o=$("#cf-tray"),t=$("#cf-dict"),i=$("#cf-reward"),s=$("#cf-goods"),n=$("#cf-cost");fa._tray=[],t.empty(),i.empty(),n.html(""),sa.dialog.cfCompose.removeClass("cf-composable"),I(s,"cf",["PIX","PIY","PIZ"],null,function(e){var r,o=$(e.currentTarget).attr("id").slice(3),t=fa.box[o],i=0;if(fa._tray.length>=100)return Qe(435);for(r in fa._tray)fa._tray[r]==o&&i++;t-i>0?(fa._tray.push(o),a()):Qe(434)}),e()}function U(e){var a=sa.dialog.lbTable.empty(),r=e.data[0]?e.data[0].rank:0,o=(e.page||Math.floor(r/20))+1;e.data.forEach(function(e,r){var o=fa.users[e.id];o=o?o.profile.title||o.profile.name:L.hidden,e.score=Number(e.score),a.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(Ae(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(Te(e.score)))).append($("<td>").html(o)).append($("<td>").html(Ve(e.score))))}),$("#ranking-"+fa.id).addClass("ranking-me"),sa.dialog.lbPage.html(L.page+" "+o),sa.dialog.lbPrev.attr("disabled",o<=1),sa.dialog.lbNext.attr("disabled",e.data.length<15),sa.dialog.lbMe.attr("disabled",!!fa.guest),fa._lbpage=o-1}function H(){function e(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),r=fa.friends[a],o=prompt(L.friendEditMemo,r);o&&d("friendEdit",{id:a,memo:o},!0)}function a(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),r=fa.friends[a];if(fa._friends[a].server)return Qe(455);confirm(r+"(#"+a.substr(0,5)+")\n"+L.friendSureRemove)&&d("friendRemove",{id:a},!0)}var r,o,t,i,s=0;for(r in sa.dialog.commFriends.empty(),fa.friends)s++,i=fa.friends[r],o=fa._friends[r]||{},t=(fa.users[r]||{}).profile,sa.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+r).append($("<div>").addClass("cfi-status cfi-stat-"+(o.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(o.server?L["server_"+o.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(t?t.title||t.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(i)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",e)).append($("<i>").addClass("fa fa-remove").on("click",a))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+s+" / 100)")}function W(e){var a,r,o,t=fa.users[e]||fa.robots[e],i=$("#profile-record").empty(),s=fa.users[e];if(!t.robot)var n=Pe(s.data.rankPoint);if(t){if($("#ProfileDiag .dialog-title").text((t.profile.title||t.profile.name)+L.sProfile),$(".profile-head").empty().append(a=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(xe(t.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").text(t.profile.title||t.profile.name).append($("<label>").addClass("profile-tag").html(" #"+t.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(Ae(t.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(o=Te(t.data.score)))).append($("<div>").addClass("profile-score-text").html(Ve(t.data.score)+" / "+Ve(ua[o-1])+L.PTS))).append(r=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(Ne(t.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(t.exordial))),t.robot)sa.dialog.profileLevel.show(),sa.dialog.profileLevel.prop("disabled",fa.id!=fa.room.master),$("#rank").html(L.UNRANKED),$("#rankpoint").html(L["0LP"]),$("#profile-place").html(fa.room.id+L.roomNumber);else{for(o in sa.dialog.profileLevel.hide(),$("#rank").html(L[n]),$("#rankpoint").html(s.data.rankPoint+L.LP),$("#profile-place").html(t.place?t.place+L.roomNumber:L.lobby),t.data.record){var l=t.data.record[o];i.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+o])).append($("<div>").addClass("profile-field-record").html(l[0]+L.P+" "+l[1]+L.W)).append($("<div>").addClass("profile-field-score").html(Ve(l[2])+L.PTS)))}We(a,t.equip)}fa._profiled=e,sa.dialog.profileKick.hide(),sa.dialog.profileShut.hide(),sa.dialog.profileDress.hide(),sa.dialog.profileWhisper.hide(),sa.dialog.profileHandover.hide(),fa.id==e?sa.dialog.profileDress.show():t.robot||(sa.dialog.profileShut.show(),sa.dialog.profileWhisper.show()),fa.room&&fa.id!=e&&fa.id==fa.room.master&&(sa.dialog.profileKick.show(),sa.dialog.profileHandover.show()),c(sa.dialog.profile),sa.dialog.profile.show(),global.expl(r)}else Me(L.error_405)}function V(e){var a;("AI"==e||(a=fa.users[e].profile.title||fa.users[e].profile.name,confirm(a+L.sureInvite)))&&d("invite",{target:e})}function Q(e){fa._replay||fa.lastFail!=fa.id||fa.id!=e?fa.failCombo=0:(fa.failCombo++,1==fa.failCombo&&Me(L.trollWarning),fa.failCombo>1&&(d("leave"),Qe(437))),fa.lastFail=e}function Y(){var e;for(e in fa.room.players)(fa._replay?na.users[fa.room.players[e]]||fa.room.players[e]:fa.users[fa.room.players[e]]||fa.robots[fa.room.players[e].id]).game.score=0,!fa.admin&&delete fa["_s"+fa.room.players[e]];fa.admin||delete fa.lastFail,fa.failCombo=0,fa._spectate=-1==fa.room.game.seq.indexOf(fa.id),fa._gAnim=!0,sa.box.room.show().height(360).animate({height:1},500),sa.box.game.height(1).animate({height:410},500),ze(),sa.dialog.resultSave.attr("disabled",!1),ne(),sa.game.display.html(L.soon),Re("game_start"),Be(),g(function(){sa.box.room.height(360).hide(),sa.chat.scrollTop(999999999)},500)}function X(){var e;for(e in fa.room.game.seq)fa.room.game.seq[e].robot&&(fa.room.game.seq[e].game.score=0);for(e in na.users={},na.players){var a=na.players[e].id,r=na.readies[a]||{},o=fa.users[a]||fa.robots[a],t=a;na.players[e].robot?(o=na.users[a]={robot:!0},(t=na.players[e]).game={}):o=na.users[a]={},fa.room.players.push(t),o.id=t,o.profile=na.players[e],o.data=o.profile.data,o.equip=o.profile.equip,o.game={score:0,team:r.t}}fa._rf=0}function ee(e){var a,r,o=fa.room.events[--fa._rf];if(o){a=o.time;do{if(!(o=fa.room.events[--fa._rf]))break}while(a-o.time<1e3);for(r=fa._rf-1,X(),a=fa.muteEff,fa.muteEff=!0,i=0;i<r;i++)te();$(".deltaScore").remove(),fa.muteEff=a,te()}}function ae(e){var a=fa._rpause=!fa._rpause;$(e.target).html(a?L.replayResume:L.replayPause)}function re(e){clearTimeout(fa._rt),te()}function oe(){fa.$gpt.html(fa._gpp+" ("+(.001*fa._eventTime).toFixed(1)+L.SECOND+" / "+(.001*fa._gtt).toFixed(1)+L.SECOND+")")}function te(e){var a,r=fa.room.events[fa._rf];return clearTimeout(fa._rt),e||fa._rf++,r?fa._rpause?(fa._rf--,fa._rt=g(te,100)):((a=r.data).hint&&(a.hint={_id:a.hint}),"chat"==a.type&&(a.timestamp=na.time+r.time),f(a),fa._eventTime=r.time,oe(),void(fa.room.events.length>fa._rf?fa._rt=g(te,fa.room.events[fa._rf].time-r.time):ie())):void ie()}function ie(){fa.admin||delete fa.room,fa._replay=!1,sa.box.room.height(360),clearTimeout(fa._rt),x(),je("lobby")}function se(e){if(!fa._replay&&na){var a,r=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(a in e={},r)e[a]=r[a];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),na.events.push({data:e,time:(new Date).getTime()-na.time})}}}function ne(){fa._relay=!1,m(),sa.game.here.hide(),sa.dialog.result.hide(),sa.dialog.dress.hide(),sa.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),$(".jjoriping,.rounds").removeClass("dg"),$(".rounds").removeClass("painter"),sa.game.display.empty(),sa.game.chain.hide(),sa.game.hints.empty().hide(),sa.game.tools.hide(),sa.game.cwcmd.hide(),sa.game.bb.hide(),sa.game.round.empty(),sa.game.history.empty(),sa.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function le(e){var a;for(sa.game.round.empty(),a=0;a<fa.room.round;a++)sa.game.round.append($l=$("<label>").html(fa.room.game.title[a])),a+1==e&&$l.addClass("rounds-current")}function de(){h("turnGoing")}function me(e){return fa._replay?na.users[e].game.score:(fa.users[e]||fa.robots[e]).game.score}function ce(e,a){fa._replay?na.users[e].game.score+=a:(fa.users[e]||fa.robots[e]).game.score+=a}function ue(e,a){return e.append(a),g(function(){a.remove()},2e3),e}function pe(e){var a,t,s,n=$(".result-board").empty();if(fa._resultPage=2,!e)return sa.dialog.resultOK.trigger("click");for(i in e.list)r=e.list[i],o=fa.users[r.id]||{profile:{title:L.hidden}},s=r.id==fa.id,n.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(Ae(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(Ve(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(t=$("<div>").addClass("result-board-lvup").css("display",s?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(e.prev-r.rank)))),s&&(e.prev-r.rank<=0&&t.hide(),a.addClass("result-board-me"))}function ge(){$(".kick-vote-time .graph-bar").width(fa.kickTime/fa._kickTime*300),--fa.kickTime>0?fa._kickTimer=g(ge,1e3):sa.dialog.kickVoteY.trigger("click")}function he(){var e=$("#shop-shelf");e.html(L.LOADING),ve(function(a){if(e.empty(),fa.guest&&(a.error=423),a.error)return sa.menu.shop.trigger("click"),Qe(a.error);a.goods.sort(function(e,a){return a.updatedAt-e.updatedAt}).forEach(function(a,r,o){if(!(a.cost<0)){var t=Je(!1,a);e.append($("<div>").attr("id","goods_"+a._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+t+")")).append($("<div>").addClass("goods-title").html(Ie(a._id))).append($("<div>").addClass("goods-cost").html(Ve(a.cost)+L.ping)).append(fe(a,!1)).on("click",be))}}),global.expl(e)}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}function fe(e,a,r){var o,t,i=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(Ie(e._id)+(a?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+e.group])).append($("<div>").addClass("dress-item-expl").html(Ke(e._id))),s=$("<div>").addClass("dress-item-opts");for(o in e.term&&i.append($("<div>").addClass("dress-item-term").html(Math.floor(e.term/86400)+L.DATE+" "+L.ITEM_TERM)),r&&i.append($("<div>").addClass("dress-item-term").html(new Date(1e3*r).toLocaleString()+L.ITEM_TERMED)),e.options)if("gif"!=o){var n=o.charAt(0);t=e.options[o],"g"==n?t="+"+(100*t).toFixed(1)+"%p":"h"==n&&(t="+"+t),s.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+o])).append($("<label>").addClass("item-opts-body").html(t)).append($("<br>"))}return t&&i.append(s),i}function ve(e){var a;$.get("/shop",function(r){for(a in fa.shop={},r.goods)fa.shop[r.goods[a]._id]=r.goods[a];e&&e(r)})}function be(e){var a,r,o=$(e.currentTarget).attr("id").slice(6),t=fa.shop[o],i=fa.users[fa.id],s=i.money,n=s-t.cost,l=L.surePurchase,d={};for(r in fa.box&&fa.box[o]&&(l=L.alreadyGot+" "+l),c(sa.dialog.purchase,!0),$("#purchase-ping-before").html(Ve(s)+L.ping),$("#purchase-ping-cost").html(Ve(t.cost)+L.ping),$("#purchase-item-name").html(L[o][0]),a=$("#purchase-ping-after").html(Ve(n)+L.ping),$("#purchase-item-desc").html(n<0?L.notEnoughMoney:l),i.equip)d[r]=i.equip[r];d["Mhand"==t.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:t.group]=o,We("#moremi-after",d),fa._sgood=o,sa.dialog.purchaseOK.attr("disabled",n<0),n<0?a.addClass("purchase-not-enough"):a.removeClass("purchase-not-enough")}function $e(e){e<1||($("#Middle").css("padding-top",e),g(function(){$("#Middle").css("padding-top",0),g($e,50,.7*e)},50))}function ke(e,a,r,o){var t,i,s,n,l,d=Xe[fa.room.mode],m="KKT"==d,c="KAP"==d,u=da[t=e.length],p=0,h=fa.turnTime/96,f=fa.turnTime/12;if(sa.game.display.empty(),u?(i="As"+fa._speed,u=u.split("")):"en"==ra[d].lang&&t<10?i="As"+fa._speed:(i="Al",$e(t)),s="K"+fa._speed,u){for(n in u)"0"!=u[n]&&(sa.game.display.append(l=$("<div>").addClass("display-text").css({float:c?"right":"left","margin-top":-6,"font-size":36}).hide().html(c?e.charAt(t-p-1):e.charAt(p))),p++,g(function(e,a){var r={"margin-top":0};Re(a),e.html()==fa.mission?(Re("mission"),e.css({color:"#66FF66"}),r["font-size"]=24):r["font-size"]=20,e.show().animate(r,100)},Number(n)*h,l,i));n=sa.game.display.children("div").get(0),$(n).css(c?"margin-right":"margin-left",.5*(sa.game.display.width()-20*t))}else if(p="",c)for(n=0;n<t;n++)g(function(e){Re(i),e==fa.mission?(Re("mission"),p="<label style='color: #66FF66;'>"+e+"</label>"+p):p=e+p,sa.game.display.html(p)},Number(n)*f/t,e[t-n-1]);else for(n=0;n<t;n++)g(function(e){Re(i),e==fa.mission?(Re("mission"),p+="<label style='color: #66FF66;'>"+e+"</label>"):p+=e,sa.game.display.html(p)},Number(n)*f/t,e[n]);g(function(){for(n=0;n<3;n++)g(function(e){if(m){if(1==e)return;Re("kung")}(u?sa.game.display.children(".display-text"):sa.game.display).css("font-size",21).animate({"font-size":20},h)},n*h*2,n);g(ye,4*h,e,a,r,o),m||Re(s)},f)}function _e(e){var a,r=we("",e);sa.game.hints.append(a=$("<div>").addClass("hint-item").append($("<label>").html(r)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(r.html()))),la||a.width(0).animate({width:215}),global.expl(a)}function ye(e,a,r,o){var t,i,s,n=o?o.split(","):[],l={};sa.game.history.prepend(t=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(e)),(i=sa.game.history.children()).length>6&&i.last().remove(),s=we(e,a,r,n),n.forEach(function(e){l[e]||L["class_"+e]&&(l[e]=!0,t.append($("<label>").addClass("history-class").html(L["class_"+e])))}),t.append(i=$("<div>").addClass("history-mean ellipse").append(s)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+s.html()+"</h5>")),global.expl(t)}function we(e,a,r,o){if(!a||-1==a.indexOf("＂"))return function(e,a){return $("<label>").addClass("word").html(a)}(0,a);var t=$("<label>").addClass("word"),i=a.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("［")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),s=(o&&o.map(function(e){return L["class_"+e]}),r?r.split(",").map(function(e){return L["theme_"+e]}):[]),n=i.length>1;return i.forEach(function(e,a){var r=$("<label>").addClass("word-m1"),o=e.length>1;n&&r.append($("<label>").addClass("word-head word-m1-head").html(a+1)),e.forEach(function(e,a){var t=$("<label>").addClass("word-m2"),i=e.length,n=i>1,l=s.splice(0,i);o&&t.append($("<label>").addClass("word-head word-m2-head").html(a+1)),e.forEach(function(e,a){var r=$("<label>").addClass("word-m3"),o=l.shift();n&&r.append($("<label>").addClass("word-head word-m3-head").html(a+1)),o&&r.append($("<label>").addClass("word-theme").html(o)),r.append($("<label>").addClass("word-m3-body").html(function(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"≥")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}(e))),t.append(r)}),r.append(t)}),t.append(r)}),t}function Ce(e,a,r){var o=e+(a?"("+a+")":"");return r&&(o+="<label class='jjo-display-word-length'>("+r+")</label>"),o}function Le(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function Te(e){var a,r=ua.length;for(a=0;a<r&&!(e<ua[a]);a++);return a+1}function Ae(e,a,r){if(e<="-1")var o="admin";else o=Te(e)-1;var t=o%25*-100,i=-100*Math.floor(.04*o);return"admin"==o?$("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/lvGM.png')","background-position":t+"% "+i+"%","background-size":"100%"}):$("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/newlv.png')","background-position":t+"% "+i+"%","background-size":"2560%"})}function xe(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function Se(e,a,r){var o,t=[L["mode"+Xe[e]]];for(o in oa)a[oa[o].name.toLowerCase()]&&t.push(L["opt"+oa[o].name]);return r&&t.push(a.injpick.join("|")),r?t.toString():t}function De(e,a){var r,o=Se(a.mode,a.opts),t=ra[Xe[a.mode]];e.empty().append($("<h5>").addClass("room-head-number").html("["+(a.practice?L.practice:a.id)+"]")).append($("<h5>").addClass("room-head-title").text(Ne(a.title))).append(r=$("<h5>").addClass("room-head-mode").html(o.join(" / "))).append($("<h5>").addClass("room-head-limit").html((la?"":L.players+" ")+a.players.length+" / "+a.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+a.round)).append($("<h5>").addClass("room-head-time").html(a.time+L.SECOND)),-1!=t.opts.indexOf("ijp")&&(r.append($("<div>").addClass("expl").html("<h5>"+a.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(e))}function qe(e,a){fa._lsRemain=e.length,e.forEach(function(e){!function(e,a,r){function o(r){ga[e]=new i(a),t()}function t(){0==--fa._lsRemain?r&&r():m(L.loadRemain+fa._lsRemain)}function i(e){var a=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){a.audio.play()},this.stop=function(){a.audio.currentTime=0,a.audio.pause()}}var s=new XMLHttpRequest;s.open("GET",a),s.responseType="arraybuffer",s.onload=function(a){ba?ba.decodeAudioData(a.target.response,function(a){ga[e]=a,t()},o):o()},s.send()}(e.key,e.value,a)})}function je(e,a){"lobby"==e&&(e=$("#bgmselect").val().substr(0,1));return fa.bgm&&fa.bgm.stop(),fa.bgm=Re(e,!0,$("#bgmvol").val())}function ze(){fa.bgm&&(fa.bgm.stop(),!fa.admin&&delete fa.bgm)}function Re(e,a,r){var o,t,i=a&&fa.muteBGM||!a&&fa.muteEff;return t=ga[e]||ga.missing,window.hasOwnProperty("AudioBuffer")&&t instanceof AudioBuffer?((o=ba.createBufferSource()).startedAt=ba.currentTime,o.loop=a,o.buffer=i?ba.createBuffer(2,t.length,ba.sampleRate):t,o.connect(ba.destination)):(t.readyState&&(t.audio.currentTime=0),t.audio.loop=a||!1,t.audio.volume=i?0:1,o=t),ha[e]&&ha[e].stop(),ha[e]=o,o.key=e,o.start(),o}function Oe(){var e;for(e in ha)ha[e].stop()}function Ze(e){var a;fa.rooms[e]&&(fa.rooms[e].password&&!(a=prompt(L.putPassword))||(fa._pw=a,d("enter",{id:e,password:a})))}function Be(){var e=$("#Chat,#chat-log-board"),a=e.children(".chat-item").last().get(0);a&&"HR"==a.tagName||(e.append($("<hr>").addClass("chat-item")),sa.chat.scrollTop(999999999))}function Ne(e){if(pa.test(e)){var a=$("#badwordfilter").val().substr(0,2);return"NO"==a?fa.admin?e.toString():e.replace(pa,"**"):"**"==a?e.replace(pa,a):"♥♥"==a?e.replace(pa,a):"★★"==a?e.replace(pa,a):(++Ca,e.replace(pa,"**"))}return e}function Pe(e){return e<50?"UNRANKED":e>=50&&e<1e3?"BRONZE":e>=1e3&&e<2e3?"SILVER":e>=2e3&&e<3e3?"GOLD":e>=3e3&&e<4e3?"PLATINUM":e>=4e3&&e<5e3?"DIAMOND":e>=5e3?"MASTER":""}function Ee(e,a,r,o){var t,i,s,n,l=o?new Date(o):new Date,d=fa.users[e.id]?fa.users[e.id].equip:{};if(!fa._shut[e.title||e.name]){if(r){if(fa.opts.dw)return;if(fa._wblock[r])return}a=Ne(a,fa.users[e.id]),Re("k"),Fe(),!la&&fa.room&&(t=(fa.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),function(e,a,r){$("#cb-"+a).remove();var o,t,i=(2&r?$("#game-user-"+a):$("#room-user-"+a)).offset(),s=2==r?"chat-balloon-bot":"chat-balloon-tip",n=$("<div>").addClass("chat-balloon").attr("id","cb-"+a).append($("<div>").addClass("jt-image "+s))[2==r?"prepend":"append"]($("<h4>").html(e));i&&(sa.balloons.append(n),1==r?(o=0,t=220):2==r?(o=35-n.height(),t=-2):3==r?(o=5,t=210):(o=40,t=110),n.css({top:i.top+o,left:i.left+t}),g(function(){n.animate({opacity:0},500,function(){n.remove()})},2500))}(a,e.id,t)),sa.chat.append(s=$("<div>").addClass("chat-item").append(t=$("<div>").addClass("chat-head ellipse").text(e.title||e.name)).append(i=$("<div>").addClass("chat-body").html(a)).append($("<div>").addClass("chat-stamp").text(l.toLocaleTimeString()))),o&&t.prepend($("<i>").addClass("fa fa-video-camera")),t.on("click",function(a){W(e.id)}),sa.chatLog.append(s=s.clone()),s.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(e.id||"").substr(0,5))),(n=a.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(a=i.html(),n.forEach(function(e){a=a.replace(e,"<a href='#' style='color: #2222FF;' onclick='if(confirm(\""+L.linkWarning+'")) window.open("'+e+"\");'>"+e+"</a>")}),i.html(a)),r&&(!0!==r&&(fa._recentFrom=r),i.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+i.html())),R(t,{equip:d}),sa.chat.scrollTop(999999999)}}function Me(e,a){var r=new Date;Re("k"),Fe(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(a||L.notice)).append($("<div>").addClass("chat-body").text(e)).append($("<div>").addClass("chat-stamp").text(r.toLocaleTimeString()))),sa.chat.scrollTop(999999999),"tail"==a&&console.warn(r.toLocaleString(),e)}function Fe(){var e=$("#Chat .chat-item"),a=$("#chat-log-board .chat-item");e.length>99&&e.first().remove(),a.length>199&&a.first().remove()}function Ge(e){var a;return a="$"==e.charAt()?fa.shop[e.slice(0,4)]:fa.shop[e],{_id:e,group:a.group,term:a.term,name:Ie(e),cost:a.cost,image:Je(e,a),desc:Ke(e),options:a.options}}function Ie(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function Ke(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function Je(e,a){var r,o;if(e){if("$"==e.charAt())return function(e,a){var r,o=document.createElement("canvas"),t=o.getContext("2d");switch(o.width=o.height=50,t.font="24px NBGothic",t.textAlign="center",t.textBaseline="middle",e){case"WPC":case"WPB":case"WPA":r=["WPC","WPB","WPA"].indexOf(e),t.beginPath(),t.arc(25,25,25,0,2*Math.PI),t.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][r],t.fill(),t.fillStyle=["#000000","#4465C3","#E69D12"][r],t.fillText(a,25,25)}return o.toDataURL()}(e.slice(1,4),e.slice(4))}else"string"==typeof a&&(a={_id:"def",group:a,options:{}});return o=(r=fa.shop[e]||a).options.hasOwnProperty("gif")?".gif":".png","BDG"==r.group.slice(0,3)?"/img/kkutu/moremi/badge/"+r._id+o:"M"==r.group.charAt(0)?"/img/kkutu/moremi/"+r.group.slice(1)+"/"+r._id+o:"/img/kkutu/shop/"+r._id+".png"}function Ue(e){sa.dialog.obtain.is(":visible")?fa._obtain.push(e):(He(e),c(sa.dialog.obtain,!0))}function He(e){Re("success"),$("#obtain-image").css("background-image","url("+Je(e.key)+")"),$("#obtain-name").html(Ie(e.key))}function We(e,a){var r,o,t=$(e).empty(),i={Mlhand:"Mhand",Mrhand:"Mhand"};for(r in a||(a={}),ea)o="M"+ea[r],t.append($("<img>").addClass("moremies moremi-"+o.slice(1)).attr("src",Je(a[o],i[o]||o)).css({width:"100%",height:"100%"}));(o=a.BDG)&&t.append($("<img>").addClass("moremies moremi-badge").attr("src",Je(o)).css({width:"100%",height:"100%"})),t.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",a.robot?"/img/kkutu/moremi/robot.png":"/img/kkutu/moremi/body.png").css({width:"100%",height:"100%"})),t.children(".moremi-rhand").css("transform","scaleX(-1)")}function Ve(e){var a=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();a.test(e);)e=e.replace(a,"$1,$2");return e}function Qe(e){return alert(L["error_"+e])}function Ye(e){sa.yell.show().css("opacity",1).html(e),g(function(){sa.yell.animate({opacity:0},3e3),g(function(){sa.yell.hide()},3e3)},1e3)}var Xe,ea,aa,ra,oa,ta,ia,sa,na,la,da=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],ma={profile:{title:L.null},data:{score:0}},ca=30,ua=[],pa=new RegExp(["(시|싀|쉬|슈|씨|쒸|씌|쓔|쑤|시이{1,}|싀이{1,}|쉬이{1,}|씨이{1,}|쒸이{1,}|씌이{1,}|찌이{1,}|스|쓰|쯔|스으{1,}|쓰으{1,}|쯔으{1,}|수우{1,}|쑤우{1,}|십|싑|쉽|슙|씹|쓉|씝|쓥|씁|싶|싚|슆|슾|앂|씦|쓒|씊|쑾|ㅅ|ㅆ|ㅅㅣ{1,}|ㅅ이{1,}|ㅆ이{1,}|c|c이{1,}|C|C이{1,}|Ⓒ|Ⓒ이{1,})[^가-힣]*(바|파|발|팔|빠|빨|불|벌|벨|밸|빠|ㅂ|ㅃ|ㅍ)","(뷩|병|뱡|뱅|뱡|빙|븅|븽|뷰웅|비잉|볭|뱽|뼝|뺑|쁑|삥|삉|뺭|뼈엉|쀼웅|ㅂ)[^가-힣]*(쉰|신|싄|슨|씬|씐|진|즨|ㅅ|딱|시인|시나)","(샛|섓|쌧|썠|쌨|샜|섔|쌨|썠|새|섀|세|셰|쌔|쎄|썌|쎼)[^가-힣]*(끼|끠|애끼|에끼)","(저새|저색|저샛|저쉑|저샛|저셋|저섀|저셰|저쌔|저쎄|저썌|저쎼)[^가-힣]*(기|애{1,}기|에{1,}기|)","(개|게|걔|깨|께|꼐|꺠)[^가-힣]*(새|샛|세|섀|셰)","(니|닝|느|노|늬|너|쟤|유|걔|ㄴ)[^가-힣]*(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄{1,}마|검{1,}마|검|금|미|앰|앱|애{1,}비|애{1,}미|에{1,}미|에{1,}비|애{1,}믜|애{1,}븨|아{1,}빠|엄{1,}빠|의미|의비|븨|믜)","(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄마|검마|앰|아빠|엄빠)[^가-힣]*(죽|뒤|사|돌|없)","(앰|엠|얨|옘|앱|엡|옙|얩)[^가-힣]*(창|챵|촹|생|섕|셍|솅|쉥)","(세|섹|색|쉑|쇡|세엑{1,}크|세액{1,}크|세크|새크|새에{1,}크|새애{1,}크|셍|셱|섁|세그|세엑|세액|세에{1,}엑|세애{1,}액|쎅|쎽|쎆|쎾|셲)[^가-힣]*(ㅅ|스|슥|슨|슫|슷|승|로스)","(ㅈ|젓|젔|젇|젖|좟|좠|좓|좢)[^가-힣]*(뒏|됟|됫|됬|됏|됐|됃|같|갇|까|가|까)","(자|자아{1,}|잠|좌|좌아{1,}|잗|잣|쟈|쟈아{1,}|보|보오{1,}|볻|봇|뵤)[^가-힣]*(지|짓|짇|징|즤|즫|즷|즹|빨)","(질|입|안|밖)[^가-힣]*(싸)","(후|훚|훗|훋)[^가-힣]*(장|쟝|좡)","(꼬|보|딸|똘|빡)[^가-힣]*(추)","(미친|잡|쓰레기|거지|그지|똥|ㅣ발)[^가-힣]*(녀석|놈|충|자식|냐|냔|세|네|것)","(버|벅|뻐|뻑|퍼|퍽)[^가-힣]*(큐|뀨)","(호)[^가-힣]*(로|모|구)","(스|수|슈|쓰|쑤|쓔|스으{1,}|수우{1,}|슈우{1,}|쓰우{1,}|쑤으{1,}|쓔으{1,})[^가-힣]*(랙|렉|럑|롁|랚|렊|럒|롂)","(지|즤|디|G|ㅣ|치|찌|지이|지이{1,}|즤이{1,}|G이{1,}|즤|G이)[^가-힣]*(랄|라알)","(딸)[^가-힣]*(딸|치|쳐|쳤|침)","발[^가-힣]*기","풀[^가-힣]*발","딸[^가-힣]*딸","강[^가-힣]*간","자[^가-힣]*위","부[^가-힣]*랄","불[^가-힣]*알","오[^가-힣]*르[^가-힣]*가[^가-힣]*즘","처[^가-힣]*녀[^가-힣]*막","질[^가-힣]*내","질[^가-힣]*외","정[^가-힣]*액","자[^가-힣]*궁","생[^가-힣]*리","월[^가-힣]*경","페[^가-힣]*도","또[^가-힣]*라[^가-힣]*이","장[^가-힣]*애","종[^가-힣]*간","쓰[^가-힣]*레[^가-힣]*기","무[^가-힣]*뇌","학[^가-힣]*식[^가-힣]*충","급[^가-힣]*식[^가-힣]*충","버[^가-힣]*러[^가-힣]*지","찌[^가-힣]*꺼[^가-힣]*기","삐[^가-힣]*꾸","닥[^가-힣]*쳐","꺼[^가-힣]*져","애[^가-힣]*자","찌[^가-힣]*그[^가-힣]*레[^가-힣]*기","대[^가-힣]*가[^가-힣]*리","면[^가-힣]*상","와[^가-힣]*꾸","시[^가-힣]*빠[^가-힣]*빠","파[^가-힣]*오[^가-힣]*후","사[^가-힣]*까[^가-힣]*시","씹[^가-힣]*덕","애[^가-힣]*미","엿[^가-힣]*먹","애[^가-힣]*비","새[^가-힣]*끼","줬[^가-힣]*까","(뒤)[^가-힣]*(져|진|졌|질|짐)","살[^가-힣]*지[^가-힣]*마","자[^가-힣]*살[^가-힣]*(해|하|헤)","(좆|좃|좄|졷|줫|줮|줟|죶|죳|죴|죧|조오{1,}|조옷{1,}|조옺{1,})","씹|씹","봊|봊","잦|잦","(섹|섻)","썅|썅","ㅗ{1,}","ㅄ|ㅄ","ㄲㅈ|ㄲㅈ","(ㅈ)[^가-힣]*(ㅂㅅ|ㄲ|ㄹ|ㄴ)","(f|F)[^A-Za-z]*(u|U)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(d|D)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(m|M)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(m|M)[^A-Za-z]*(n|N)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(b|B)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(c|C)[^A-Za-z]*(h|H)","(d|D)[^A-Za-z]*(i|I)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*x","(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(c|C)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(t|T)","(p|P)[^A-Za-z]*(u|U)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(y|Y)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(g|G)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(a|A)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(r|R)[^A-Za-z]*(o|O)","(j|J)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(m|M)[^A-Za-z]*(u|U)[^A-Za-z]*(f|F)[^A-Za-z]*(f|F)","(p|P)[^A-Za-z]*(i|I)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)","(r|R)[^A-Za-z]*(e|E)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(s|S)[^A-Za-z]*(l|L)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(t|T)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(s|S)","(t|T)[^A-Za-z]*(r|R)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)","(t|T)[^A-Za-z]*(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)","(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(w|W)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(r|R)[^A-Za-z]*(e|E)","(s|S)[^A-Za-z]*(i|I)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)","(g|G)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(a|A)[^A-Za-z]*(k|K)[^A-Za-z]*(i|I)","(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(l|L)[^A-Za-z]*(e|E)","(t|T)[^A-Za-z]*(l|L)[^A-Za-z]*q[^A-Za-z]*(k|K)[^A-Za-z]*(f|F)","(t|T)[^A-Za-z]*(p|P)[^A-Za-z]*(r|R)[^A-Za-z]*(t|T)[^A-Za-z]*(m|M)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*(e|E)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)"].join("|")),ga={},ha={},fa={},va={Classic:{},DaneoClassic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{},Drawing:{}},ba=!!window.hasOwnProperty("AudioContext")&&new AudioContext,$a=window.WebSocket,ka=setInterval,_a=setTimeout;$(document).ready(function(){function e(e,a){var r,o;for(r in oa)o=oa[r].name.toLowerCase(),-1==e.indexOf(r)?$("#"+a+"-"+o+"-panel").hide():$("#"+a+"-"+o+"-panel").show()}function a(e){var a,r,o={};for(a in oa)r=oa[a].name.toLowerCase(),$("#"+e+"-"+r).is(":checked")&&(o[r]=!0);return o}function r(e,a,r,o){var t;if(!o){if(e.gaming)return!1;if(e.password)return!1;if(e.players.length>=e.limit)return!1}if(e.mode!=a)return!1;for(t in r)if(!e.opts[t])return!1;return!0}function o(e){$(".team-selector").hasClass("team-unable")||d("team",{value:$(e.currentTarget).attr("id").slice(5)})}function i(){(ta=new $a(fa.URL)).onopen=function(e){m()},ta.onmessage=_onMessage=function(e){f(JSON.parse(e.data))},ta.onclose=function(e){var a=L.closed+" (#"+e.code+")";ia&&ia.close(),Oe(),alert(a),$.get("/kkutu_notice.html",function(e){m(e)})},ta.onerror=function(e){console.warn(L.error,e)}}var s;for(fa.PUBLIC="true"==$("#PUBLIC").html(),fa.URL=$("#URL").html(),fa.version=$("#version").html(),fa.server=location.href.match(/\?.*server=(\d+)/)[1],fa.shop={},fa._okg=0,fa._playTime=0,fa._kd="",fa._timers=[],fa._obtain=[],fa._wblock={},fa._shut={},fa.usersR={},ua.push(Le(1)),s=2;s<366;s++)ua.push(ua[s-2]+Le(s));if(ua[365]=1/0,ua.push(1/0),sa={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),onchating:$("#Chating"),chatLog:$("#chat-log-board"),talk:$(".ChatBox input").last(),chatBtn:$(".ChatBox button").last(),menu:{help:$("#HelpBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),cursing:$("#CursingBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),leaderboard:$("#LeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),cursing:$("#CursingDiag"),cursingValue:$("#CursingDiag #cursing-value").first(),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),rank:$("#rank"),lp:$("#rankpoint"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),tools:$(".GameBox .tools"),drawingTitle:$("#drawing-title"),themeisTitle:$("#themeis-title"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==$a)return m(L.websocketUnsupport),void alert(L.websocketUnsupport);for(fa._soundList=[{key:"k",value:"/media/kkutu/k.mp3"},{key:"lobby",value:"/media/kkutu/LobbyBGM_allgro.mp3"},{key:"2",value:"/media/kkutu/LobbyBGM_newstart.mp3"},{key:"3",value:"/media/kkutu/LobbyBGM_bfkkutu.mp3"},{key:"1",value:"/media/kkutu/LobbyBGM_allgro.mp3"},{key:"jaqwi",value:"/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"/media/kkutu/game_start.mp3"},{key:"round_start",value:"/media/kkutu/round_start.mp3"},{key:"fail",value:"/media/kkutu/fail.mp3"},{key:"timeout",value:"/media/kkutu/timeout.mp3"},{key:"lvup",value:"/media/kkutu/lvup.mp3"},{key:"Al",value:"/media/kkutu/Al.mp3"},{key:"success",value:"/media/kkutu/success.mp3"},{key:"missing",value:"/media/kkutu/missing.mp3"},{key:"mission",value:"/media/kkutu/mission.mp3"},{key:"kung",value:"/media/kkutu/kung.mp3"},{key:"horr",value:"/media/kkutu/horr.mp3"}],s=0;s<=10;s++)fa._soundList.push({key:"T"+s,value:"/media/kkutu/T"+s+".mp3"},{key:"K"+s,value:"/media/kkutu/K"+s+".mp3"},{key:"As"+s,value:"/media/kkutu/As"+s+".mp3"});for(s in qe(fa._soundList,function(){ve(i)}),fa.admin||delete fa._soundList,ea=$("#MOREMI_PART").html().split(","),aa=$("#AVAIL_EQUIP").html().split(","),ra=JSON.parse($("#RULE").html()),oa=JSON.parse($("#OPTIONS").html()),Xe=Object.keys(ra),(la="true"==$("#mobile").html())&&(ca=200),fa._timePercent=function(){return 100-(fa._turnSound.audio?fa._turnSound.audio.currentTime:ba.currentTime-fa._turnSound.startedAt)/fa.turnTime*1e5+"%"},fa.setRoom=function(e,a){var r="for-lobby"==A();null==a?(fa.admin||delete fa.rooms[e],r&&$("#room-"+e).remove()):(r&&!fa.rooms[e]&&sa.lobby.roomList.append($("<div>").attr("id","room-"+e)),fa.rooms[e]=a,r&&$("#room-"+e).replaceWith(O(a)))},fa.setUser=function(e,a){var r,o=A(),t="for-lobby"==o||"for-master"==o;fa._replay?na.users[e]=a:null==a?(fa.admin||delete fa.users[e],t&&$("#users-item-"+e+",#invite-item-"+e).remove()):(t&&!fa.users[e]&&(r=z(a,"for-master"==o),"for-master"==o?sa.dialog.inviteList.append(r):sa.lobby.userList.append(r)),fa.users[e]=a,t&&(r?$("#"+r.attr("id")).replaceWith(r):$("#"+("for-lobby"==o?"users-item-":"invite-item")+e).replaceWith(z(a,"for-master"==o))))},$(document).on("paste",function(e){if(fa.room&&fa.room.gaming)return e.preventDefault(),!1}),sa.talk.on("drop",function(e){if(fa.room&&fa.room.gaming)return e.preventDefault(),!1}),fa.opts=$.cookie("kks"),fa.opts&&u(JSON.parse(fa.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var a=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),a.addClass("dialog-front"),function(e,a,r){var o=e.position();$(window).on("mousemove",function(t){var i=t.pageX-a,s=t.pageY-r;e.css("left",o.left+i),e.css("top",o.top+s)})}(a,e.pageX,e.pageY)}).on("mouseup",function(e){$(window).off("mousemove")}),sa.chatBtn.on("click",function(e){var a=la&&sa.game.here.is(":visible")?sa.game.hereText.val():sa.talk.val(),r={value:a.trim()};a&&("/"==r.value[0]?(r.cmd=r.value.split(" "),y(r.cmd)):((sa.game.here.is(":visible")||fa._relay)&&(r.relay=!0),d("talk",r)),fa._whisper?(sa.talk.val("/e "+fa._whisper+" "),fa.admin||delete fa._whisper):sa.talk.val(""),sa.game.hereText.val(""))}).hotkey(sa.talk,13).hotkey(sa.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){if(!r.trim())return;var a=$(e.currentTarget),r=a.val();d("talk",{relay:!0,data:fa._sel,value:r.trim()}),a.val("")}}).on("focusout",function(e){$(".cw-q-body").empty(),sa.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(e){var a=$(e.currentTarget),r=a.val();r<2||r>8?a.css("color","#FF4444"):a.css("color","")}),$("#room-round").on("change",function(e){var a=$(e.currentTarget),r=a.val();r<1||r>10?a.css("color","#FF4444"):a.css("color","")}),$("#room-wordLimit").on("change",function(e){var a=$(e.currentTarget),r=a.val();r<2||r>9?a.css("color","#FF4444"):a.css("color","")}),sa.game.here.on("click",function(e){la||sa.talk.focus()}),sa.talk.on("keyup",function(e){sa.game.hereText.val(sa.talk.val())}),$(window).on("beforeunload",function(e){if(fa.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),sa.dialog)sa.dialog[s].children(".dialog-head").hasClass("no-close")||sa.dialog[s].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(sa.menu.help.on("click",function(e){$("#help-board").attr("src","/help"),c(sa.dialog.help)}),sa.menu.setting.on("click",function(e){c(sa.dialog.setting)}),sa.menu.community.on("click",function(e){if(fa.guest)return Qe(451);c(sa.dialog.community)}),sa.dialog.commFriendAdd.on("click",function(e){var a=prompt(L.friendAddNotice);if(a)return fa.users[a]?void d("friendAdd",{target:a},!0):Qe(450)}),sa.menu.newRoom.on("click",function(e){var a;sa.dialog.quick.hide(),fa.typeRoom="enter",c(a=sa.dialog.room),a.find(".dialog-title").html(L.newRoom)}),sa.menu.setRoom.on("click",function(e){var a,r,o,t=ra[Xe[fa.room.mode]];for(r in fa.typeRoom="setRoom",$("#room-title").val(fa.room.title),$("#room-limit").val(fa.room.limit),$("#room-mode").val(fa.room.mode).trigger("change"),$("#room-round").val(fa.room.round),$("#room-wordLimit").val(fa.room.wordLimit),$("#room-time").val(fa.room.time/t.time),oa)o=oa[r].name.toLowerCase(),$("#room-"+o).attr("checked",fa.room.opts[o]);fa._injpick=fa.room.opts.injpick,c(a=sa.dialog.room),a.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(o){var i,s,n=$("#quick-mode").val(),l=0;for(i in"quick-mode"==o.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),s=a("quick"),e(ra[Xe[n]].opts,"quick"),fa.rooms)r(fa.rooms[i],n,s,t)&&l++;$("#quick-status").html(L.quickStatus+" "+l)}),sa.menu.quickRoom.on("click",function(e){sa.dialog.room.hide(),c(sa.dialog.quick),sa.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-queue").html(""),sa.dialog.quickOK.removeClass("searching").html(L.OK))}),sa.dialog.quickOK.on("click",function(e){function o(){var e,a=[];if(sa.dialog.quick.is(":visible")){for(e in $("#quick-queue").html(L.quickQueue+" "+q(1e3*fa._quickn++)),fa.rooms)r(fa.rooms[e],i,s,t)&&a.push(e);a.length&&(e=a[Math.floor(Math.random()*a.length)],fa._preQuick=!0,$("#room-"+e).trigger("click"))}else clearTimeout(fa._quickT)}var i=$("#quick-mode").val(),s=a("quick");if("for-lobby"==A()){if(sa.dialog.quickOK.hasClass("searching"))return sa.dialog.quick.hide(),o(),void sa.menu.quickRoom.trigger("click");$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),sa.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),fa._quickn=0,fa._quickT=p(o,1e3)}}),$("#room-mode").on("change",function(a){var r=$("#room-mode").val(),o=ra[Xe[r]];18==r?$("#room-wordLimit-panel").show():$("#room-wordLimit-panel").hide(),$("#game-mode-expl").html(L["modex"+r]),e(o.opts,"room"),fa._injpick=[],-1!=o.opts.indexOf("ijp")?$("#room-injpick-panel").show():$("#room-injpick-panel").hide(),"Typing"==o.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,a){$(a).html(Number($(a).val())*o.time+L.SECOND)})}).trigger("change"),sa.menu.spectate.on("click",function(e){sa.menu.spectate.hasClass("toggled")?(d("form",{mode:"J"}),sa.menu.spectate.removeClass("toggled")):(d("form",{mode:"S"}),sa.menu.spectate.addClass("toggled"))}),sa.menu.shop.on("click",function(e){(fa._shop=!fa._shop)?(he(),sa.menu.shop.addClass("toggled")):sa.menu.shop.removeClass("toggled"),x()}),$(".shop-type").on("click",function(e){var a=$(e.currentTarget),r=a.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),a.addClass("selected"),function(e){var a,r,o,t=!0===e;for(o in t||(e=e.split(",")),fa.shop)(r=fa.shop[o]).cost<0||(a=$("#goods_"+o).show(),t||-1==e.indexOf(r.group)&&a.hide())}("all"==r||a.attr("value"))}),sa.menu.dict.on("click",function(e){c(sa.dialog.dict)}),sa.menu.wordPlus.on("click",function(e){c(sa.dialog.wordPlus)}),sa.menu.invite.on("click",function(e){c(sa.dialog.invite),j(!0)}),sa.menu.practice.on("click",function(e){ra[Xe[fa.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),c(sa.dialog.practice)):d("practice",{level:-1})}),sa.menu.ready.on("click",function(e){d("ready")}),sa.menu.start.on("click",function(e){d("start")}),sa.menu.exit.on("click",function(e){if(fa.room.gaming){if(!confirm(L.sureExit))return;fa._spaced&&va.Typing.spaceOff(),clearInterval(fa._tTime),fa._relay=!1}d("leave")}),sa.menu.replay.on("click",function(e){fa._replay&&ie(),c(sa.dialog.replay),sa.dialog.replayView.attr("disabled",!0),sa.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),sa.menu.leaderboard.on("click",function(e){fa._lbpage=0,sa.dialog.leaderboard.is(":visible")?sa.dialog.leaderboard.hide():$.get("/ranking",function(e){U(e),c(sa.dialog.leaderboard)})}),sa.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(fa._lbpage-1),function(e){U(e)})}),sa.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+fa.id,function(e){U(e)})}),sa.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(fa._lbpage+1),function(e){U(e)})}),sa.dialog.settingServer.on("click",function(e){location.href="/"}),sa.dialog.settingOK.on("click",function(e){u({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),sa.dialog.setting.hide(),$.cookie("kks",JSON.stringify(fa.opts))}),sa.dialog.profileLevel.on("click",function(e){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),c(sa.dialog.practice)}),sa.dialog.practiceOK.on("click",function(e){var a=$("#practice-level").val(),r=$("#ai-team").val();sa.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?d("setAI",{target:fa._profiled,level:a,team:r}):d("practice",{level:a})}),sa.dialog.roomOK.on("click",function(e){var a,r,o={injpick:fa._injpick};for(a in oa)o[r=oa[a].name.toLowerCase()]=$("#room-"+r).is(":checked");d(fa.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),wordLimit:$("#room-wordLimit").val(),time:$("#room-time").val(),opts:o}),sa.dialog.room.hide()}),sa.dialog.resultOK.on("click",function(e){1==fa._resultPage&&fa._resultRank?pe(fa._resultRank[fa.id]):(fa.practicing&&(fa.room.gaming=!0,d("leave")),fa.resulting=!1,sa.dialog.result.hide(),fa.admin||delete fa._replay,fa.admin||delete fa._resultRank,sa.box.room.height(360),je("lobby"),Be(),x())}),sa.dialog.resultSave.on("click",function(e){var a=new Date(na.time),r=new Blob([JSON.stringify(na)],{type:"text/plain"}),o=URL.createObjectURL(r),t="KKuTu"+a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+"-"+a.getMinutes()+"-"+a.getSeconds()+".bkr",i=$("<a>").attr({download:t,href:o}).on("click",function(e){i.remove()});$("#Jungle").append(i),i[0].click()}),sa.dialog.dictInjeong.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||$("#dict-theme").val()&&(a.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){if(g(function(){a.prop("disabled",!1)},2e3),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),sa.dialog.dictSearch.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||(a.prop("disabled",!0),$("#dict-output").html(L.searching),T($("#dict-input").val(),function(e){if(g(function(){a.prop("disabled",!1)},500),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(we(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),sa.dialog.wordPlusOK.on("click",function(e){var a;sa.dialog.wordPlusOK.hasClass("searching")||(a=$("#wp-input").val())&&((a=a.replace(/[^a-z가-힣]/g,"")).length<2||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),d("wp",{value:a})))}).hotkey($("#wp-input"),13),sa.dialog.inviteRobot.on("click",function(e){V("AI")}),sa.box.me.on("click",function(e){W(fa.id)}),sa.dialog.roomInfoJoin.on("click",function(e){sa.dialog.roomInfo.hide(),Ze(fa._roominfo)}),sa.dialog.profileHandover.on("click",function(e){confirm(L.sureHandover)&&d("handover",{target:fa._profiled})}),sa.dialog.profileKick.on("click",function(e){d("kick",{robot:fa.robots.hasOwnProperty(fa._profiled),target:fa._profiled})}),sa.dialog.profileShut.on("click",function(e){var a=fa.users[fa._profiled];a&&C(a.profile.title||a.profile.name)}),sa.dialog.profileWhisper.on("click",function(e){var a=fa.users[fa._profiled];sa.talk.val("/e "+(a.profile.title||a.profile.name).replace(/\s/g,"")+" ").focus()}),sa.dialog.profileDress.on("click",function(e){return fa.guest?Qe(421):fa._gaming?Qe(438):void(c(sa.dialog.dress)&&$.get("/box",function(e){if(e.error)return Qe(e.error);fa.box=e,G()}))}),sa.dialog.dressOK.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.post("/exordial",{data:$("#dress-exordial").val()},function(e){if(sa.dialog.dressOK.attr("disabled",!1),e.error)return Qe(e.error);sa.dialog.dress.hide()})}),sa.dialog.dressOK.on("click",function(e){return $("#dress-nickname").val()?/[(ㄱ-ㅎ)]/gi.test($("#dress-nickname").val())?alert("닉네임을 자음만으로 지정하실 수 없습니다."):/[(가-힣a-zA-Z)]/gi.test($("#dress-nickname").val())?$("#dress-nickname").val().match("<")?alert("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match(">")?alert("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match("&lt")?alert("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match("　")?alert("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match("불건전닉네임")?alert("이 닉네임은 닉네임으로 지정할 수 없습니다."):$("#dress-nickname").val().match("잘못된닉네임")?alert("이 닉네임은 닉네임으로 지정할 수 없습니다."):($(e.currentTarget).attr("disabled",!0),void $.post("/nickname",{data:$("#dress-nickname").val()},function(e){if(sa.dialog.dressOK.attr("disabled",!1),e.error)return Qe(e.error);sa.dialog.dress.hide()})):alert("닉네임에 잘못된 문자가 포함되어 있습니다."):alert("닉네임을 입력해 주세요.")}),$("#DressDiag .dress-type").on("click",function(e){var a=$(e.currentTarget),r=a.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),a.addClass("selected"),K("all"==r||a.attr("value"))}),$("#dress-cf").on("click",function(e){if(fa._gaming)return Qe(438);c(sa.dialog.charFactory)&&J()}),sa.dialog.cfCompose.on("click",function(e){if(!sa.dialog.cfCompose.hasClass("cf-composable"))return Qe(436);confirm(L.cfSureCompose)&&$.post("/cf",{tray:fa._tray.join("|")},function(e){var a;if(e.error)return Qe(e.error);for(a in d("refresh"),alert(L.cfComposed),fa.users[fa.id].money=e.money,fa.box=e.box,e.gain)Ue(e.gain[a]);G(fa._avGroup),D(),J()})}),$("#room-injeong-pick").on("click",function(e){var a,r=ra[Xe[$("#room-mode").val()]];for(a in $("#injpick-list>div").hide(),"ko"==r.lang?(fa._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==r.lang&&(fa._ijkey="#en-pick-",$("#en-pick-list").show()),sa.dialog.injPickNo.trigger("click"),fa._injpick)$(fa._ijkey+fa._injpick[a]).prop("checked",!0);c(sa.dialog.injPick)}),sa.dialog.injPickAll.on("click",function(e){$("#injpick-list input").prop("checked",!0)}),sa.dialog.injPickNo.on("click",function(e){$("#injpick-list input").prop("checked",!1)}),sa.dialog.injPickOK.on("click",function(e){var a=$(fa._ijkey+"list"),r=[];fa._injpick=a.find("input").each(function(e,a){var o=$(a),t=o.attr("id").slice(8);o.is(":checked")&&r.push(t)}),fa._injpick=r,sa.dialog.injPick.hide()}),sa.dialog.kickVoteY.on("click",function(e){d("kickVote",{agree:!0}),clearTimeout(fa._kickTimer),sa.dialog.kickVote.hide()}),sa.dialog.kickVoteN.on("click",function(e){d("kickVote",{agree:!1}),clearTimeout(fa._kickTimer),sa.dialog.kickVote.hide()}),sa.dialog.purchaseOK.on("click",function(e){$.post("/buy/"+fa._sgood,function(e){var a=fa.users[fa.id];if(e.error)return Qe(e.error);alert(L.purchased),a.money=e.money,a.box=e.box,D()}),sa.dialog.purchase.hide()}),sa.dialog.purchaseNO.on("click",function(e){sa.dialog.purchase.hide()}),sa.menu.cursing.click(function(){var e;sa.dialog.cursing.toggle(),"block"==sa.dialog.cursing.css("display")&&(e=sa.dialog.cursingValue,"NONE"==La&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">확인된 욕설이 없습니다.(횟수: ${Ca.toString()})</div>`),"LIT"==La&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 낮음(사용횟수: ${Ca.toString()})</div>`),"LOW"==La&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">낮음(사용횟수: ${Ca.toString()})</div>`),"MID"==La&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">조금 높음(사용횟수: ${Ca.toString()})</div>`),"HIGH"==La&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">높음(사용횟수: ${Ca.toString()})</div>`),"WARN"==La&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 높음(사용횟수: ${Ca.toString()})</div>`))}),sa.dialog.obtainOK.on("click",function(e){var a=fa._obtain.shift();a?He(a):sa.dialog.obtain.hide()}),s=0;s<5;s++)$("#team-"+s).on("click",o),$("#room-unknownword.game-option").click(()=>$("#room-unknownword.game-option").is(":checked")?$(".game-option").not("#room-unknownword.game-option").not("#room-mission.game-option").not("#room-abcmission.game-option").not("#room-moremission.game-option").not("#room-returns.game-option").not("#room-randomturn.game-option").not("#room-ignoreinitial.game-option").prop("checked",!1).prop("disabled",!0):$(".game-option").prop("disabled",!1));$("#replay-file").on("change",function(e){var a=e.target.files[0],r=new FileReader,o=$("#replay-date").html("-"),t=$("#replay-version").html("-"),i=$("#replay-players").html("-");na=!1,sa.dialog.replayView.attr("disabled",!0),a&&(r.readAsText(a),r.onload=function(e){var a,r;try{for(a in r=JSON.parse(e.target.result),o.html(new Date(r.time).toLocaleString()),t.html(r.version),i.empty(),r.players){var s,n=r.players[a];i.append(s=$("<div>").addClass("replay-player-bar ellipse").html(n.title).prepend(Ae(n.data.score).addClass("users-level"))),n.id==r.me&&s.css("font-weight","bold")}na=r,sa.dialog.replayView.attr("disabled",!1)}catch(e){return console.warn(e),alert(L.replayError)}})}),sa.dialog.replayView.on("click",function(e){!function(){var e;for(e in ie(),fa._replay=!0,fa.room={title:na.title,players:[],events:[],time:na.roundTime,round:na.round,mode:na.mode,limit:na.limit,game:na.game,opts:na.opts,readies:na.readies},X(),na.events)fa.room.events.push(na.events[e]);sa.box.userList.hide(),sa.box.roomList.hide(),sa.box.game.show(),sa.dialog.replay.hide(),Y(),P(!0),fa.$gp=$(".GameBox .product-title").empty().append(fa.$gpt=$("<div>").addClass("game-replay-title")).append(fa.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",re)).append($("<button>").html(L.replayPause).on("click",ae)).append($("<button>").html(L.replayPrev).on("click",ee))),fa._gpp=L.replay+" - "+new Date(na.time).toLocaleString(),fa._gtt=fa.room.events[fa.room.events.length-1].time,fa._eventTime=0,fa._rt=g(te,2e3),fa._rprev=0,fa._rpause=!1,oe()}()}),p(function(){wa>0?wa=0:ya>0&&(ya-=.03)},1e3)}),va.Classic.roundReady=function(e){fa.room.game.title.length,ne(),fa._roundTime=1e3*fa.room.time,sa.game.display.html(Ce(e.char,e.subChar)),sa.game.chain.show().html(fa.chain=0),fa.room.opts.mission&&sa.game.items.show().css("opacity",1).html(fa.mission=e.mission),"KAP"==Xe[fa.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),le(e.round),Re("round_start"),se("roundReady")},va.Classic.turnStart=function(e){fa.room.game.turn=e.turn,e.seq&&(fa.room.game.seq=e.seq),(fa._tid=fa.room.game.seq[e.turn])&&(fa._tid.robot&&(fa._tid=fa._tid.id),e.id=fa._tid,sa.game.display.html(fa._char=Ce(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),fa._replay||(sa.game.here.css("display",e.id==fa.id?"block":"none"),e.id==fa.id&&(la?sa.game.hereText.val("").focus():sa.talk.focus())),sa.game.items.html(fa.mission=e.mission),ta.onmessage=_onMessage,clearInterval(fa._tTime),fa._chars=[e.char,e.subChar],fa._speed=e.speed,fa._tTime=p(de,ca),fa.turnTime=e.turnTime,fa._turnTime=e.turnTime,fa._roundTime=e.roundTime,fa._turnSound=Re("T"+e.speed),se("turnStart"))},va.Classic.turnGoing=function(){fa.room||clearInterval(fa._tTime),fa._turnTime-=ca,fa._roundTime-=ca,sa.game.turnBar.width(fa._timePercent()).html((.001*fa._turnTime).toFixed(1)+L.SECOND),sa.game.roundBar.width(fa._roundTime/fa.room.time*.1+"%").html((.001*fa._roundTime).toFixed(1)+L.SECOND),sa.game.roundBar.hasClass("round-extreme")||fa._roundTime<=5e3&&sa.game.roundBar.addClass("round-extreme")},va.Classic.turnEnd=function(e,a){var r,o=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");fa._turnSound&&fa._turnSound.stop(),ce(e,a.score),clearInterval(fa._tTime),a.ok?(Q(),clearTimeout(fa._fail),sa.game.here.hide(),sa.game.chain.html(++fa.chain),ke(a.value,a.mean,a.theme,a.wc)):(Q(e),o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),sa.game.here.hide(),Re("timeout")),a.hint&&(a.hint=a.hint._id,-1==(r=a.hint.indexOf(fa._chars[0]))&&(r=a.hint.indexOf(fa._chars[1])),"KAP"==Xe[fa.room.mode]?sa.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,r))).append($("<label>").html(a.hint.slice(r))):sa.game.display.empty().append($("<label>").html(a.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(r+1)))),a.bonus&&(la?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ue(t,e)},500)),ue(t,o).removeClass("game-user-current"),M(e,me(e))},va.DaneoClassic.roundReady=function(e){fa.room.game.title.length,ne(),fa._roundTime=1e3*fa.room.time,sa.game.display.html(fa._char="&lt;"+L["theme_"+e.theme]+"&gt;"),sa.game.chain.show().html(fa.chain=0),fa.room.opts.mission&&sa.game.items.show().css("opacity",1).html(fa.mission=e.mission),"KAP"==Xe[fa.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),le(e.round),Re("round_start"),se("roundReady")},va.DaneoClassic.turnStart=function(e){fa.room.game.turn=e.turn,e.seq&&(fa.room.game.seq=e.seq),(fa._tid=fa.room.game.seq[e.turn])&&(fa._tid.robot&&(fa._tid=fa._tid.id),e.id=fa._tid,sa.game.display.html(fa._char=Ce(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),fa._replay||(sa.game.here.css("display",e.id==fa.id?"block":"none"),e.id==fa.id&&(la?sa.game.hereText.val("").focus():sa.talk.focus())),sa.game.items.html(fa.mission=e.mission),ta.onmessage=_onMessage,clearInterval(fa._tTime),fa._chars=[e.char,e.subChar],fa._speed=e.speed,fa._tTime=p(de,ca),fa.turnTime=e.turnTime,fa._turnTime=e.turnTime,fa._roundTime=e.roundTime,fa._turnSound=Re("T"+e.speed),se("turnStart"))},va.DaneoClassic.turnGoing=va.Classic.turnGoing,va.DaneoClassic.turnEnd=function(e,a){var r,o=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");fa._turnSound&&fa._turnSound.stop(),ce(e,a.score),clearInterval(fa._tTime),a.ok?(Q(),clearTimeout(fa._fail),sa.game.here.hide(),sa.game.chain.html(++fa.chain),ke(a.value,a.mean,a.theme,a.wc)):(Q(e),o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),sa.game.here.hide(),Re("timeout")),a.hint&&(a.hint=a.hint._id,-1==(r=a.hint.indexOf(fa._chars[0]))&&(r=a.hint.indexOf(fa._chars[1])),"KAP"==Xe[fa.room.mode]?sa.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,r))).append($("<label>").html(a.hint.slice(r))):sa.game.display.empty().append($("<label>").html(a.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(r+1)))),a.bonus&&(la?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ue(t,e)},500)),ue(t,o).removeClass("game-user-current"),M(e,me(e))},va.Jaqwi.roundReady=function(e){var a=L.jqTheme+": "+L["theme_"+e.theme];ne(),fa._roundTime=1e3*fa.room.time,fa._fastTime=1e4,sa.game.display.html(a),sa.game.items.hide(),sa.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(a).css("text-align","center"),le(e.round),Re("round_start"),clearInterval(fa._tTime)},va.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),fa.room.game.seq.indexOf(fa.id)>=0&&sa.game.here.show(),sa.game.display.html(fa._char=e.char),clearInterval(fa._tTime),fa._tTime=p(de,ca),je("jaqwi")},va.Jaqwi.turnGoing=function(){var e,a,r=sa.game.roundBar;fa.room||clearInterval(fa._tTime),fa._roundTime-=ca,a=fa._spectate?L.stat_spectate:(.001*fa._roundTime).toFixed(1)+L.SECOND,r.width(fa._roundTime/fa.room.time*.1+"%").html(a),r.hasClass("round-extreme")||fa._roundTime<=fa._fastTime&&(e=fa.bgm.currentTime/fa.bgm.duration,fa.bgm.paused?ze():je("jaqwiF"),fa.bgm.currentTime=fa.bgm.duration*e,r.addClass("round-extreme"))},va.Jaqwi.turnHint=function(e){Re("mission"),_e(e.hint)},va.Jaqwi.turnEnd=function(e,a){var r=$("<div>").addClass("deltaScore").html("+"+a.score),o=$("#game-user-"+e);a.giveup?o.addClass("game-user-bomb"):a.answer?(sa.game.here.hide(),sa.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),ze(),Re("horr")):(e==fa.id&&sa.game.here.hide(),ce(e,a.score),fa._roundTime>1e4&&(fa._roundTime=1e4),ue(o,r),M(e,me(e)).addClass("game-user-current"),Re("success"))},va.Crossword.roundReady=function(e,a){var r=e.seq?e.seq.indexOf(fa.id):-1;ne(),$(".jjoriping,.rounds,.game-body").addClass("cw"),fa._roundTime=1e3*fa.room.time,fa._fastTime=3e4,fa.selectedRound=-1==r?1:r%fa.room.round+1,sa.game.items.hide(),sa.game.cwcmd.show().css("opacity",0),le(fa.selectedRound),a||Re("round_start"),clearInterval(fa._tTime)},va.Crossword.turnEnd=function(e,a){var r,o,t=$("<div>").addClass("deltaScore").html("+"+a.score),i=$("#game-user-"+e);a.score?(o=a.pos.join(","),e==fa.id?(sa.game.cwcmd.css("opacity",0),Re("success")):(fa._sel&&a.pos.join(",")==fa._sel.join(",")&&sa.game.cwcmd.css("opacity",0),Re("mission")),fa._bdb[o][4]=a.value,fa._bdb[o][5]=e,a.pos[0]==fa.selectedRound-1?va.Crossword.drawDisplay():(r=$(sa.game.round.children("label").get(a.pos[0])).addClass("round-effect"),g(function(){r.removeClass("round-effect")},800)),ce(e,a.score),M(e,me(e)),ue(i,t)):(ze(),sa.game.round.empty(),Re("horr"))},va.Crossword.drawDisplay=function(){var e,a,r,o,t,i,s,n,l,d=fa._boards[fa.selectedRound-1],m=sa.game.display.empty(),c={};for(a in d)for(o=Number(d[a][0]),t=Number(d[a][1]),i="1"==d[a][2],s=Number(d[a][3]),n=d[a][4],m.append(e=$("<div>").addClass("cw-bar").attr("id","cw-"+o+"-"+t+"-"+d[a][2]).css({top:12.5*t+"%",left:12.5*o+"%",width:12.5*(i?1:s)+"%",height:12.5*(i?s:1)+"%"})),n&&e.addClass("cw-open"),d[a][5]==fa.id?e.addClass("cw-my-open"):e.on("click",va.Crossword.onBar).on("mouseleave",va.Crossword.onSwap),r=0;r<s;r++)l=o+"-"+t,n&&(c[l]=n.charAt(r)),e.append($("<div>").addClass("cw-cell").attr("id","cwc-"+l).html(c[l]||"")),i?t++:o++},va.Crossword.onSwap=function(e){sa.game.display.prepend($(e.currentTarget))},va.Crossword.onRound=function(e){var a=$(e.currentTarget).html().charCodeAt(0)-9311;le(fa.selectedRound=a),$(".rounds label").on("click",va.Crossword.onRound),va.Crossword.drawDisplay()},va.Crossword.onBar=function(e){var a=$(e.currentTarget).attr("id").slice(3).split("-"),r=fa._means[fa.selectedRound-1][a.join(",")],o="1"==r.dir;sa.game.cwcmd.css("opacity",1),fa._sel=[fa.selectedRound-1,a[0],a[1],a[2]],$(".cw-q-head").html(L[o?"cwVert":"cwHorz"]+r.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(we(0,r.mean,r.theme,r.type.split(",")))},va.Crossword.turnStart=function(e,a){var r,o;for(r in fa._bdb={},fa._boards=e.boards,fa._means=e.means,e.boards)for(o in e.boards[r])fa._bdb[[r,e.boards[r][o][0],e.boards[r][o][1],e.boards[r][o][2]].join(",")]=e.boards[r][o];$(".rounds label").on("click",va.Crossword.onRound),va.Crossword.drawDisplay(),clearInterval(fa._tTime),fa._tTime=p(de,ca),je("jaqwi")},va.Crossword.turnGoing=va.Jaqwi.turnGoing,va.Crossword.turnHint=function(e){Re("fail")},va.Typing.roundReady=function(e){fa.room.game.title.length,fa._chatter=la?sa.game.hereText:sa.talk,ne(),fa._round=e.round,fa._roundTime=1e3*fa.room.time,fa._fastTime=1e4,fa._list=e.list.concat(e.list),fa.chain=0,a(),le(e.round),Re("round_start"),se("roundReady")},va.Typing.spaceOn=function(){fa.room.opts.proverb||(fa._spaced=!0,$("body").on("keydown","#"+fa._chatter.attr("id"),e))},va.Typing.spaceOff=function(){fa.admin||delete fa._spaced,$("body").off("keydown","#"+fa._chatter.attr("id"),e)},va.Typing.turnStart=function(e){fa._spectate||(sa.game.here.show(),la?sa.game.hereText.val("").focus():sa.talk.val("").focus(),va.Typing.spaceOn()),ta.onmessage=_onMessage,clearInterval(fa._tTime),fa._tTime=p(de,ca),fa._roundTime=e.roundTime,je("jaqwi"),se("turnStart")},va.Typing.turnGoing=va.Jaqwi.turnGoing,va.Typing.turnEnd=function(e,r){var o=$("<div>").addClass("deltaScore").html("+"+r.score),t=$("#game-user-"+e);r.error?(fa.chain++,a(),Re("fail")):r.ok?(fa.id==e?(fa.chain++,a(),Re("mission"),ye(r.value,"")):fa._spectate&&Re("mission"),ce(e,r.score),ue(t,o),M(e,me(e))):(clearInterval(fa._tTime),va.Typing.spaceOff(),sa.game.here.hide(),ze(),Re("horr"),g(n,1e3,r.speed),fa._round<fa.room.round&&s(10))},va.Hunmin.roundReady=function(e){fa.room.game.title.length,ne(),fa._roundTime=1e3*fa.room.time,sa.game.display.html(fa._char="&lt;"+e.theme+"&gt;"),sa.game.chain.show().html(fa.chain=0),fa.room.opts.mission&&sa.game.items.show().css("opacity",1).html(fa.mission=e.mission),le(e.round),Re("round_start"),se("roundReady")},va.Hunmin.turnStart=function(e){fa.room.game.turn=e.turn,e.seq&&(fa.room.game.seq=e.seq),fa._tid=fa.room.game.seq[e.turn],fa._tid.robot&&(fa._tid=fa._tid.id),e.id=fa._tid,sa.game.display.html(fa._char),$("#game-user-"+e.id).addClass("game-user-current"),fa._replay||(sa.game.here.css("display",e.id==fa.id?"block":"none"),e.id==fa.id&&(la?sa.game.hereText.val("").focus():sa.talk.focus())),sa.game.items.html(fa.mission=e.mission),ta.onmessage=_onMessage,clearInterval(fa._tTime),fa._chars=[e.char,e.subChar],fa._speed=e.speed,fa._tTime=p(de,ca),fa.turnTime=e.turnTime,fa._turnTime=e.turnTime,fa._roundTime=e.roundTime,fa._turnSound=Re("T"+e.speed),se("turnStart")},va.Hunmin.turnGoing=va.Classic.turnGoing,va.Hunmin.turnEnd=function(e,a){var r,o=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");fa._turnSound.stop(),ce(e,a.score),clearInterval(fa._tTime),a.ok?(clearTimeout(fa._fail),sa.game.here.hide(),sa.game.chain.html(++fa.chain),ke(a.value,a.mean,a.theme,a.wc)):(o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),sa.game.here.hide(),Re("timeout")),a.hint&&(a.hint=a.hint._id,-1==(r=a.hint.indexOf(fa._chars[0]))&&(r=a.hint.indexOf(fa._chars[1])),sa.game.display.empty().append($("<label>").html(a.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(r+1)))),a.bonus&&(la?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ue(t,e)},500)),ue(t,o).removeClass("game-user-current"),M(e,me(e))},va.Daneo.roundReady=function(e){fa.room.game.title.length,ne(),fa._roundTime=1e3*fa.room.time,sa.game.display.html(fa._char="&lt;"+L["theme_"+e.theme]+"&gt;"),sa.game.chain.show().html(fa.chain=0),fa.room.opts.mission&&sa.game.items.show().css("opacity",1).html(fa.mission=e.mission),le(e.round),Re("round_start"),se("roundReady")},va.Daneo.turnStart=function(e){fa.room.game.turn=e.turn,e.seq&&(fa.room.game.seq=e.seq),fa._tid=fa.room.game.seq[e.turn],fa._tid.robot&&(fa._tid=fa._tid.id),e.id=fa._tid,sa.game.display.html(fa._char),$("#game-user-"+e.id).addClass("game-user-current"),fa._replay||(sa.game.here.css("display",e.id==fa.id?"block":"none"),e.id==fa.id&&(la?sa.game.hereText.val("").focus():sa.talk.focus())),sa.game.items.html(fa.mission=e.mission),ta.onmessage=_onMessage,clearInterval(fa._tTime),fa._chars=[e.char,e.subChar],fa._speed=e.speed,fa._tTime=p(de,ca),fa.turnTime=e.turnTime,fa._turnTime=e.turnTime,fa._roundTime=e.roundTime,fa._turnSound=Re("T"+e.speed),se("turnStart")},va.Daneo.turnGoing=va.Classic.turnGoing,va.Daneo.turnEnd=function(e,a){var r,o=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");fa._turnSound.stop(),ce(e,a.score),clearInterval(fa._tTime),a.ok?(clearTimeout(fa._fail),sa.game.here.hide(),sa.game.chain.html(++fa.chain),ke(a.value,a.mean,a.theme,a.wc)):(o.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),sa.game.here.hide(),Re("timeout")),a.hint&&(a.hint=a.hint._id,-1==(r=a.hint.indexOf(fa._chars[0]))&&(r=a.hint.indexOf(fa._chars[1])),sa.game.display.empty().append($("<label>").html(a.hint.slice(0,r+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(r+1)))),a.bonus&&(la?o.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ue(t,e)},500)),ue(t,o).removeClass("game-user-current"),M(e,me(e))},va.Drawing.roundReady=function(e,a){L.jqTheme,L["theme_"+e.theme],ne(),$(".jjoriping,.rounds,.game-body").addClass("cw"),$(".jjoriping,.rounds").addClass("dg"),$(".game-user-drawing").removeClass("game-user-drawing"),sa.game.tools.hide(),fa._relay=!1,fa._roundTime=1e3*fa.room.time,fa._fastTime=1e4,sa.game.items.hide(),sa.game.hints.show(),sa.game.cwcmd.show().css("opacity",0),fa.id===e.painter?(console.log("i'm painter!"),fa._isPainter=!0):fa._isPainter=!1,$("#game-user-"+e.painter).addClass("game-user-drawing"),le(e.round),Re("round_start"),clearInterval(fa._tTime)},va.Drawing.turnStart=function(e,a){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),fa.room.game.seq.indexOf(fa.id)>=0&&(fa._isPainter?($("#drawing-line-width").change(function(){console.log(this.value),sa.game.canvas.freeDrawingBrush.width=this.value,d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$("#drawing-color").change(function(){console.log(this.value),sa.game.canvas.freeDrawingBrush.color=this.value,d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$("#drawing-clear").click(function(){console.log("clear"),sa.game.canvas.clear(),d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-red").click(function(){console.log("change red"),sa.game.canvas.freeDrawingBrush.color="#FF0000",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-orange").click(function(){console.log("change orange"),sa.game.canvas.freeDrawingBrush.color="#FFA500",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-yellow").click(function(){console.log("change yellow"),sa.game.canvas.freeDrawingBrush.color="#FFFF00",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-green").click(function(){console.log("change green"),sa.game.canvas.freeDrawingBrush.color="#008000",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-blue").click(function(){console.log("change blue"),sa.game.canvas.freeDrawingBrush.color="#0000FF",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-indigo").click(function(){console.log("change indigo"),sa.game.canvas.freeDrawingBrush.color="#4B0082",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-violet").click(function(){console.log("change red"),sa.game.canvas.freeDrawingBrush.color="#9400D3",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-black").click(function(){console.log("change black"),sa.game.canvas.freeDrawingBrush.color="#000000",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),$(".button-color#color-white").click(function(){console.log("change white"),sa.game.canvas.freeDrawingBrush.color="#FFFFFF",d("drawingCanvas",{data:JSON.stringify(sa.game.canvas)},!1)}),sa.game.drawingTitle.text(e.word),sa.game.themeisTitle.text(L["theme_"+e.theme]),sa.game.hints.hide(),sa.game.tools.show(),$(".rounds").removeClass("dg"),$(".rounds").addClass("painter")):(sa.game.hints.show(),sa.game.tools.hide(),fa._relay=!0)),va.Drawing.drawDisplay(),clearInterval(fa._tTime),fa._tTime=p(de,ca),je("jaqwi")},va.Drawing.turnHint=function(e){var a;a=Array.isArray(e.hint)?L["theme_"+e.hint[0]]:e.hint,Re("mission"),_e(a)},va.Drawing.turnEnd=function(e,a){var r=$("<div>").addClass("deltaScore").html("+"+a.score),o=$("#game-user-"+e);a.giveup?(o.addClass("game-user-bomb"),fa._relay=!1):a.answer?(sa.game.here.hide(),sa.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),ze(),Re("horr"),fa._relay=!1):(e==fa.id&&sa.game.here.hide(),ce(e,a.score),fa._roundTime>1e4&&(fa._roundTime=1e4),ue(o,r),M(e,me(e)).addClass("game-user-current"),Re("success"))},va.Drawing.drawDisplay=function(){sa.game.display.empty().append($("<canvas>").attr("id","canvas").css({width:"300",height:"300",left:0,top:0}).addClass("canvas"));var e=window._canvas=new fabric.Canvas("canvas");e.backgroundColor="#ffffff",e.isDrawingMode=fa._isPainter,e.setHeight(300),e.setWidth(300),e.selection=!1,$("#drawing-line-width").val(20),$("#drawing-color").val("#000000"),fa._isPainter&&e.on("mouse:up",function(a){d("drawingCanvas",{data:JSON.stringify(e)},!1)}),e.renderAll(),sa.game.canvas=e},va.Drawing.turnGoing=function(){var e,a,r=sa.game.roundBar;fa.room||clearInterval(fa._tTime),fa._roundTime-=ca,a=fa._spectate?L.stat_spectate:(.001*fa._roundTime).toFixed(1)+L.SECOND,r.width(fa._roundTime/fa.room.time*.1+"%").html(a),r.hasClass("round-extreme")||fa._roundTime<=fa._fastTime&&(e=fa.bgm.currentTime/fa.bgm.duration,fa.bgm.paused?ze():je("jaqwiF"),fa.bgm.currentTime=fa.bgm.duration*e,r.addClass("round-extreme"))},va.Drawing.drawCanvas=function(e){fa._isPainter||(sa.game.canvas.clear(),sa.game.canvas.loadFromJSON(e.data,sa.game.canvas.renderAll.bind(sa.game.canvas)))},va.Sock.roundReady=function(e,a){e.seq&&e.seq.indexOf(fa.id),ne(),fa._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),fa._va=[],fa._lang=ra[Xe[fa.room.mode]].lang,fa._board=e.board,fa._maps=[],fa._roundTime=1e3*fa.room.time,fa._fastTime=1e4,sa.game.items.hide(),sa.game.bb.show(),va.Sock.drawDisplay(),le(e.round),a||Re("round_start"),clearInterval(fa._tTime)},va.Sock.turnEnd=function(e,a){var r,o,t,i=$("<div>").addClass("deltaScore").html("+"+a.score),s=$("#game-user-"+e);if(a.score){for(t=(r=a.value).length,fa._maps.push(r),o=0;o<t;o++)fa._board=fa._board.replace(r.charAt(o),"　");Re(e==fa.id?"success":"mission"),va.Sock.drawDisplay(),ce(e,a.score),M(e,me(e)),ue(s,i)}else ze(),fa._relay=!1,Re("horr")},va.Sock.drawMaps=function(){sa.game.bb.empty(),fa._maps.sort(function(e,a){return a.length-e.length}).forEach(function(e){sa.game.bb.append(function(e){var a,r=$("<div>").addClass("bb-word"),o=e.length;for(a=0;a<o;a++)r.append($("<div>").addClass("bb-char").html(e.charAt(a)));return r}(e))})},va.Sock.drawDisplay=function(){var e,a=$("<div>").css("height","100%"),r=fa._board.split(""),o="ko"==fa._lang?"12.5%":"10%";r.forEach(function(r,t){a.append(e=$("<div>").addClass("sock-char sock-"+r).css({width:o,height:o}).html(r)),fa._va[t]&&fa._va[t]!=r&&e.html(fa._va[t]).addClass("sock-picked").animate({opacity:0},500)}),fa._va=r,sa.game.display.empty().append(a),va.Sock.drawMaps()},va.Sock.turnStart=function(e,a){clearInterval(fa._tTime),fa._tTime=p(de,ca),je("jaqwi")},va.Sock.turnGoing=va.Jaqwi.turnGoing,va.Sock.turnHint=function(e){Re("fail")};var ya=0,wa=0,Ca=0,La="NONE";isHacker=!0;const Ta=["KR"]}(),$(document).ready(function(){$(document).on("contextmenu selectstart",function(e){return!1})}),document.onload=function(){"Microsoft Internet Explorer"==navigator.appName&&(alert("해당 브라우저는 현재 지원하지 않습니다.\n다른 브라우저를 사용해 주세요."),$("#Middle").html("<center><h1><br/><font color='black'>잘못된 접근입니다.</font></h1></center>"),$("#Bottom").remove())};