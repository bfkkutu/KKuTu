!function(){function e(e){32==e.keyCode&&(fa.chatBtn.trigger("click"),e.preventDefault())}function a(){var e=ja._list.slice(ja.chain),a=ja.room.opts.proverb?1:5,t="",r=e[0].length;r>=20&&(t="18px"),r>=50&&(t="15px"),fa.game.display.css("font-size",t),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",fa.game.display.html(e.slice(0,a).join(" ")),fa.game.chain.show().html(ja.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(a,2*a).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function t(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),e>0&&g(t,1e3,e-1)}function n(e){var a;for(a in e)$("#game-user-"+a+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[a]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function s(e,a){var t=e.toString();return"000000000000000".slice(0,Math.max(0,a-t.length))+t}function l(e,a,t){var r,i={type:e},o=t?ga:ha||ga;for(r in a)i[r]=a[r];if("test"!=e&&Pa++>10){if(++Na>=3)return o.close();Pa=5}o.send(JSON.stringify(i))}function d(e){e?$("#Intro").is(":visible")?(fa.loading.hide(),$("#intro-text").html(e)):fa.loading.show().html(e):fa.loading.hide()}function c(e){e&&!ja._gaming?(fa.loading.show().html("새 클라이언트로 업데이트 중입니다...0%<p><p>패치 내용은 다음과 같습니다: "+e),setTimeout(function(){fa.loading.html("새 클라이언트로 업데이트 중입니다...50%<p><p>패치 내용은 다음과 같습니다: "+e),setTimeout(function(){fa.loading.html("새 클라이언트로 업데이트 중입니다...100%<p><p>패치 내용은 다음과 같습니다: "+e),setTimeout(function(){fa.loading.html("적용을 위해 새로고침합니다..."),location.reload()},1e3)},1e3)},1e3)):e||ja._gaming||(fa.loading.show().html("새 클라이언트로 업데이트 중입니다...0%"),setTimeout(function(){fa.loading.html("새 클라이언트로 업데이트 중입니다...50%"),setTimeout(function(){fa.loading.html("새 클라이언트로 업데이트 중입니다...100%"),setTimeout(function(){fa.loading.html("적용을 위해 새로고침합니다..."),location.reload()},1e3)},1e3)},1e3))}function m(e,a){var t=[$(window).width(),$(window).height()];return!a&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(t[0]-e.width()),top:.5*(t[1]-e.height())}),!0)}function u(e){ja.opts=e,ja.muteBGM=ja.opts.mb,ja.muteEff=ja.opts.me,$("#mute-bgm").attr("checked",ja.muteBGM),$("#mute-effect").attr("checked",ja.muteEff),$("#deny-invite").attr("checked",ja.opts.di),$("#deny-whisper").attr("checked",ja.opts.dw),$("#deny-friend").attr("checked",ja.opts.df),$("#auto-ready").attr("checked",ja.opts.ar),$("#sort-user").attr("checked",ja.opts.su),$("#only-waiting").attr("checked",ja.opts.ow),$("#only-unlock").attr("checked",ja.opts.ou),N(!0),Z(!0),ja.bgm&&(ja.muteBGM?(ja.bgm.volume=0,ja.bgm.stop()):(ja.bgm.volume=$("#bgmvol").val(),ja.bgm=Pe("lobby",!0)))}function p(e,a,t,r,i,o,n){var s=Oa(e,a,t,r,i,o,n);return ja._timers.push(s),s}function g(e,a,t,r,i,o,n){var s=za(e,a,t,r,i,o,n);return ja._timers.push(s),s}function h(e,a,t,r,i,o){if(ja.room){var n=ua[da[ja.room.mode]];if(!n)return null;qa[n.rule][e].call(this,a,t,r,i,o)}}function f(e){var a;switch(e.type){case"recaptcha":var t=$("#intro-text");v(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단되었습니다."),ga.close())),t.empty(),t.text("접속하기 전에, 먼저 캡챠 인증이 필요합니다.<br/>(자동화 봇을 방지하기 위함입니다)<br/><br/>"),t.append($('<div class="g-recaptcha" id="recaptcha" style="display: table; margin: 0 auto;"></div>')),grecaptcha.render("recaptcha",{sitekey:e.siteKey,callback:function(e){v(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단되었습니다."),ga.close())),ga.send(JSON.stringify({type:"recaptcha",token:e}))}});break;case"welcome":if(e.guest)return ga.close();ja.id=e.id,ja.guest=e.guest,ja.admin=e.admin,ja.careful=e.careful,ja.soundLoadCount=0,ja.nickname=e.nickname,ja.users=e.users,ja.robots={},ja.rooms=e.rooms,ja.place=0,ja.friends=e.friends,ja._friends={},ja._playTime=e.playTime,ja._okg=e.okg,ja._cF=e.chatFreeze,ja._gaming=!1,ja.honor="b9_honor"===ja.users[ja.id].equip.BDG,ja.box=e.box,e.test&&alert(L.welcomeTestServer),location.hash[1]&&Ee(location.hash.slice(1)),R(void 0,!0),function(){var e=window.$Request;if($("#room-injeong-pick").hide(),$("#quick-selecttheme-panel").remove(),$(".footer-div").css("z-index","-1"),$(".footer-left").css("z-index","-1"),$(".footer-right").css("z-index","-1"),$("#AlertDiag").css("z-index",5),$("#PromptDiag").css("z-index",5),!ja.admin){delete window.$Request,$("#room-tournament-panel").remove(),$("#quick-tournament-panel").remove(),$("#room-time").children("option")[9].remove();try{var a=console;Object.defineProperty(window,"console",{get:function(){if(a._commandLineAPI)throw"보안 정책상 일반 유저에게는 개발자 도구 사용이 금지됩니다.";return a},set:function(e){a=e}})}catch(e){}$(document).ready(function(){$(document).on("contextmenu dragstart selectstart",function(e){return!1})})}ja._cF?ja.admin?$("#chatinput").attr("placeholder","관리자 전용 채팅"):($("#chatinput").attr("readonly",!0),$("#chatinput").attr("placeholder","관리자 전용 채팅")):ja.admin?$("#chatinput").attr("placeholder",""):($("#chatinput").attr("readonly",!1),$("#chatinput").attr("placeholder",""));"불건전닉네임"!=ja.nickname&&"잘못된닉네임"!=ja.nickname||(function e(){var a=prompt("불건전하거나 잘못된 닉네임을 사용하였으므로 닉네임이 강제로 변경되었습니다. 새로운 닉네임을 입력해 주세요.");var t=y(a);return t?$.post("/updateme",{nickname:Ue(a)},function(e){if(e.error)return sa(e.error);alert("닉네임이 "+a+"(으)로 변경되었습니다. 재접속 해주세요."),location.reload()}):e()}(),ga.close());x("BF끄투는 끄투 원작자 쪼리핑님의 끄투 오픈소스 프로젝트를 기반으로 제작된 온라인 게임입니다.<br>다른 끄투 서버를 모방하거나 베끼지 않았습니다.<br>또한 다른 서버를 홍보하는 행위는 금지됩니다."),ja.honor&&$("#alertText").html("BF끄투 초창기부터 기여했던 관리자입니다. 영구적으로 BF끄투에서 1세대 관리자 전용 혜택을 받게 됩니다.");"msedge"==jQuery.browser.name&&$("#alertText").html("더 원할한 플레이를 위해서는 크롬 브라우저 사용을 권장합니다.");null!=ja.careful&&"null"!=ja.careful&&(fa.loading.show(),T(`귀하께서는 최근 부적절한 활동으로 인해 운영자에게 주의 받았습니다.<p>경고를 받거나 제재된 것은 아니지만, 운영자에게 모니터링 될 수 있습니다.<p>사유: ${ja.careful}<p>내용을 확인하셨다면 '확인했습니다'를 입력해주세요.`,function(e){"확인했습니다"==e&&(fa.loading.hide(),fa.dialog.promptKKuTu.hide(),l("careful",{value:ja.id}))},460,230));Pe("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),g(function(){$("#Intro").hide()},2e3),ja.admin&&console.log("Administrator Mode\n(관리자 모드)"),e("devtools",()=>(alert("개발자 도구(F12)는 보안상의 이유로 사용하실 수 없습니다."),ga.close()),ja,fa),e("macro",()=>(alert("운영정책 위반으로 서버와의 연결이 끊어졌습니다."),ga.close()),ja,fa),v(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단됐습니다."),ga.close())),$.get(`/newUser?id=${ja.id}`,function(e){if(e.newUser)return fa.dialog.alertKKuTu.hide(),$("#Loading").show().html(""),$("#promptHead").append($("<textarea>").attr("id","nickAgreement")),$("#nickAgreement").attr("readonly",!0).attr("style","width: 97%; height: 300px;").attr("rows","17").val(_("/public_info_use.html").replace(/<p>/gi,"\n\n").replace(/<br>/gi,"\n").replace("<title>","").replace("</title>","").substr(80)),$("#PromptDiag").attr("style","width: 370px; height: 475px; display: block; left: 288px; top: 547.5px;"),$("#AlertDiag").css("z-index",6),$("#PromptDiag").css("z-index",5),function e(){T("BF끄투에서 사용할 닉네임을 입력하세요.<br>닉네임을 설정하면 상기 이용 약관, <a href='/public_info_personal.html' target='_blank'>개인정보 취급 방침</a> 및 <a href='http://bfk.kro.kr' target='_blank'>운영 정책</a>에<br>동의하는 것으로 간주합니다.");fa.dialog.promptKKuTuOK.on("click",function(a){var t=y($("#prompt-input").val());return t?$.post("/updateme",{nickname:Ue($("#prompt-input").val())},function(e){if(e.error)return sa(e.error);x("닉네임 설정이 완료되었습니다."),$.get(`/newUser?id=${ja.id}&cp=${ja.id}cp`),location.reload()}):e()})}(),console.log(`NEWUSER: ${e.newuser}`)}),Ma=!0}(),e.caj&&function(){if(!confirm(L.checkAgeAsk))return l("caj",{answer:"no"},!0);for(;;){for(var e=[],a=1;a<=3;){var t=prompt(L["checkAgeInput"+a]);if(t&&!isNaN(t=Number(t)))1==a&&(t<1e3||t>2999)?alert(t+"\n"+L.checkAgeNo):2==a&&(t<1||t>12)?alert(t+"\n"+L.checkAgeNo):3==a&&(t<1||t>31)?alert(t+"\n"+L.checkAgeNo):e[a++-1]=t;else if(--a<1)break}if(4==a){if(confirm(L.checkAgeSure+"\n"+e[0]+L.YEAR+" "+e[1]+L.MONTH+" "+e[2]+L.DATE))return l("caj",{answer:"yes",input:[e[1],e[2],e[0]]},!0)}else if(confirm(L.checkAgeCancel))return l("caj",{answer:"no"},!0)}}(),ae();break;case"conn":ja.setUser(e.user.id,e.user),N();break;case"disconn":ja.setUser(e.id,null),N();break;case"connRoom":ja._preQuick&&(Ze("success"),fa.dialog.quick.hide(),ja.admin||delete ja._preQuick),fa.dialog.quick.hide(),ja.setUser(e.user.id,e.user),(u=ja.usersR[e.user.id]=e.user).id==ja.id?d():Qe((u.profile.title||u.profile.name)+L.hasJoined),N();break;case"disconnRoom":(u=ja.usersR[e.id])&&(ja.admin||delete ja.usersR[e.id],Qe((u.profile.title||u.profile.name)+L.hasLeft),N());break;case"forceleave":ja.id==e.id&&(l("leave"),alert("방이 관리자에 의해 삭제되었습니다."));break;case"forceready":ja.id==e.id&&(ja.room&&(ja.room.master==ja.id?fa.menu.start.trigger("click"):fa.menu.ready.trigger("click")),alert("관리자에 의해 준비 상태로 변경되었습니다."));break;case"forcespectate":ja.id==e.id&&(fa.menu.spectate.trigger("click"),alert("관리자에 의해 관전 상태로 변경되었습니다."));break;case"alert":ja.id==e.id&&x(e.value);break;case"sweetalert":ja.id==e.id&&Swal.fire(e.title,e.comment,e.kind);break;case"yellto":ja.id==e.id&&(la(e.value),Qe(e.value,L.yell));break;case"roomsize":ja.room.opts.tournament&&fa.box.room.height(e.value);break;case"gamesize":ja.room.opts.tournament&&fa.box.game.height(e.value);break;case"notice":Qe(e.value,L.yell);break;case"loadimage":!function(e,a,t,r){fa.dialog.popupKKuTu.hide(),$("#popup-img").attr("src",""),$("#popup-text").text(""),e&&$("#popup-img").attr("src",e);a&&$("#popup-text").text(a);fa.dialog.popupKKuTu.attr("style",`width: ${t}px; height: ${r}px;`),m(fa.dialog.popupKKuTu)}(e.imgLoc,"관리자로부터 이미지가 전송되었습니다.",e.imgW,e.imgH);break;case"loadsound":ja.soundLoadCount+=1,Ne([{key:"custom"+ja.soundLoadCount,value:e.soundLoc}],function(){console.log(`File Loaded: ${e.soundLoc}`)});break;case"playmedia":Ze(e.value);break;case"clearchat":Ie(),Qe("채팅이 관리자에 의해 청소되었습니다.","채팅");break;case"updateUser":ja.users[e.id].nickname=e.nickname,ja.users[e.id].exordial=e.exordial,N(!0);break;case"banned":if(ja.id==e.id){if("영구"!=e.enddate)var r=`${(s=e.enddate.toString()).slice(0,4)}년 ${s.slice(4,6)}월 ${u=s.slice(6,8)}일 ${s.slice(8,10)}시 ${s.slice(10,12)}분 ${s.slice(12,14)}초`;else r=e.enddate;ga.onclose=function(a){fa.loading.show().html(`차단되었습니다. 관리자에게 문의하세요.<p>사유: ${e.reason}<br>종료일: ${r}`),x(`차단되었습니다. 관리자에게 문의하세요.<p>사유: ${e.reason}<br>종료일: ${r}`),$("#alertbtn").hide()},ga.close()}break;case"yell":la(e.value),Qe(e.value,L.yell);break;case"update":ga.onclose=function(e){Me(),c(e.value)},ga.close();break;case"updateSel":var i=e.major?"중요":"중요하지 않음";cf=confirm(`새 클라이언트가 발견되었습니다: ${e.filename}\n\n업데이트 하시겠습니까? (중요도: ${i})\n\n※주의※ 게임 중일 경우 진행 중인 게임에서 나가게 됩니다.`),cf&&(ga.onclose=function(e){Me(),c(e.value)},ga.close());break;case"freeze":ja._cF=!0,ja._gaming||(ja.admin?$("#chatinput").attr("placeholder","관리자 전용 채팅"):($("#chatinput").attr("readonly",!0),$("#chatinput").attr("placeholder","관리자 전용 채팅")));break;case"unfreeze":ja._cF=!1,ja._gaming||(ja.admin?$("#chatinput").attr("placeholder",""):($("#chatinput").attr("readonly",!1),$("#chatinput").attr("placeholder","")));break;case"info":Qe(e.value,L.info);break;case"dying":la(L.dying),Qe(L.dying,L.yell);break;case"opentail":m(fa.dialog.tail);break;case"tail":e.msg=(e.msg instanceof String?e.msg:JSON.stringify(e.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;");var o,n=JSON.parse(e.msg);switch(e.a){case"tr":o=`${e.rid}번 방 | 감시 시작 | 비밀번호: ${""==n.pw?"없음":n.pw}, 플레이어: ${n.players}`;break;case"trX":o=`${e.rid}번 방 | 감시 종료 | 비밀번호: ${""==n.pw?"없음":n.pw}, 플레이어: ${n.players}`;break;case"tu":o=`유저 ${e.rid} | 감시 시작 | 닉네임: ${n.nickname?n.nickname:n.profile.title}, 자기 소개: ${""==n.exordial?"없음":n.exordial}, 보유 핑: ${n.money}, 상태: ${n.game.ready?"준비":"대기"}, 위치: ${0==n.place?"로비":jqmsg.place+"번 방"}`;break;case"tuX":o=`유저 ${e.rid} | 감시 종료 | 닉네임: ${n.nickname?n.nickname:n.profile.title}, 자기 소개: ${""==n.exordial?"없음":n.exordial}, 보유 핑: ${n.money}, 상태: ${n.game.ready?"준비":"대기"}, 위치: ${0==n.place?"로비":jqmsg.place+"번 방"}`;break;case"room":o=`${e.rid}번 방 | `;break;case"user":o=`유저 ${e.id!=e.rid?e.id:e.rid} | `;break;case void 0:break;default:o+=e.msg}switch(n.type){case"talk":o+=`${n.relay?"끝말잇기":"채팅"} | ${e.id}: ${n.value}`;break;case"leave":o+=`방 나감 | ${"user"==e.a?e.rid+"번 방":e.id}`;break;case"handover":o+=`방장 인계 | ${e.id} -> ${n.target}`;break;case"invite":o+=`초대 전송 | ${e.id} -> ${n.target}`;break;case"kick":o+=`강퇴 | ${e.id} -> ${n.robot?"AI":n.target}`;break;case"ready":o+=`준비 상태 변경 | ${"user"==e.a?e.rid+"번 방":e.id}`;break;case"form":o+=`${"S"==n.mode?"관전":"준비"} 상태 변경 | ${"user"==e.a?e.rid+"번 방":e.id}`;break;case"practice":o+=`연습 | 플레이어: ${e.id}, AI 수준: ${L["aiLevel"+n.level]}`;break;case"start":o+=`게임 시작 | 방장: ${e.id}`;break;case void 0:break;case"test":return;default:o+=e.msg}$("#tail-board").append($(`<div class="tail-item" style="color: #CCC;">${o}</div>`)),$("#tail-board").scrollTop(99999999);break;case"chat":ja.admin?e.notice?Qe(L["error_"+e.code]):Ve(e.profile||{title:L.robot},e.value,e.from,e.timestamp):ja._cF?($("#chatinput").attr("readonly",!0),$("#chatinput").attr("placeholder","관리자 전용 채팅"),alert("채팅이 얼었습니다. 관리자만 채팅할 수 있습니다.")):Ve(e.profile||{title:L.robot},e.value,e.from,e.timestamp);break;case"drawCanvas":fa.game.canvas&&function(e){h("drawCanvas",e)}(e);break;case"roomStuck":ha.close();break;case"preRoom":!function(e,a){var t=ja.URL.replace(/\/g([0-9]{5})\//,function(a,t){return"/g"+(Number(t)+416+Number(e)-1)+"/"})+"&"+e+"&"+a;ha||(ha=new Ba(t),d(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){d(),ha&&ha.close()}),ha.onopen=function(t){console.log("room-conn",e,a)},ha.onmessage=_onMessage,ha.onclose=function(t){console.log("room-disc",e,a),ha=void 0},ha.onerror=function(e){console.warn(L.error,e)})}(e.channel,e.id);break;case"room":(function(e){var a,t,r,i;if(e.myRoom=ja.place==e.room.id||e.target==ja.id,e.myRoom){if($target=ja.users[e.target],e.kickVote&&(Qe(w($target.profile,e.kickVote)),$target.id==e.id&&alert(L.hasKicked)),-1==e.room.players.indexOf(ja.id))ja.room&&ja.room.gaming&&(Me(),ja.practicing=!1,ja._gaming=!1,ja.room.opts.tournament?fa.box.room.height(460):fa.box.room.height(360),Pe("lobby")),ja.users[ja.id].game.ready=!1,ja.users[ja.id].game.team=0,ja.users[ja.id].game.form="J",fa.menu.spectate.removeClass("toggled"),fa.menu.ready.removeClass("toggled"),ja.room=null,ja.resulting=!1,ja._players=null,ja._master=null,ja.place=0,e.room.practice&&(ja.admin||delete ja.users[0],ja.room=ja._room,ja.place=ja._place,ja.master=ja.__master,ja._players=ja.__players,!ja.admin&&delete ja._room);else if(e.room.practice&&!ja.practicing&&(ja.practicing=!0,ja._room=ja.room,ja._place=ja.place,ja.__master=ja.master,ja.__players=ja._players),ja.room&&(ja._players=ja.room.players.toString(),ja._master=ja.room.master,ja._rTitle=ja.room.title,ja._rMode=Oe(ja.room.mode,ja.room.opts,!0),ja._rLimit=ja.room.limit,ja._rRound=ja.room.round,ja._rTime=ja.room.time),ja.room=e.room,ja.place=ja.room.id,ja.master=ja.room.master==ja.id,e.spec&&e.target==ja.id){if(ja._spectate||(ja._spectate=!0,ge(),he()),e.boards){for(a in ja.selectedRound=1,e.prisoners)for(t in r=a.split(","),e.boards[r[0]])if((i=e.boards[r[0]][t])[0]==r[1]&&i[1]==r[2]&&i[2]==r[3]){i[4]=e.prisoners[a];break}qa.Crossword.roundReady(e,!0),qa.Crossword.turnStart(e,!0)}for(a in e.spec)ja.users[a].game.score=e.spec[a]}e.modify||e.target!=ja.id||Ke()}if(e.target&&ja.users[e.target]&&(-1==e.room.players.indexOf(e.target)?ja.users[e.target].place=0:ja.users[e.target].place=e.room.id),!e.room.practice)if(e.room.players.length)for(a in ja.setRoom(e.room.id,e.room),e.room.readies)ja.users[a]&&(ja.users[a].game.ready=e.room.readies[a].r,ja.users[a].game.team=e.room.readies[a].t);else ja.setRoom(e.room.id,null)})(e),function(e){if(ja._players&&ja.room){var a,t,r={}+"",i=ja._players.split(",");i.length,ja.room.players.length;for(a in i)i[a]==r&&0;for(a in ja.room.players)ja.room.players[a].robot&&0;if(e){for(a in i)i[a]!=r&&(ja.users[i[a]].game.ready=!1);Qe(L.hasModified)}ja._gaming!=ja.room.gaming&&(ja.room.gaming?(oe(),ja._replay=!1,function(e){var a,t;for(a in $a={version:ja.version,me:ja.id,players:[],events:[],title:ja.room.title,roundTime:ja.room.time,round:ja.room.round,mode:ja.room.mode,limit:ja.room.limit,game:ja.room.game,opts:ja.room.opts,readies:ja.room.readies,time:(new Date).getTime()},ja.room.players){var r;t=ja.users[ja.room.players[a]]||ja.room.players[a],r={id:t.id,score:0},t.robot?(r.id=t.id,r.robot=!0,r.data={score:0},t={profile:K(t.level)}):(r.data=t.data,r.equip=t.equip),r.title="#"+t.id,$a.players.push(r)}ja._record=!0}(ja.room.game.title)):(ja._spectate?(fa.dialog.resultSave.hide(),ja._spectate=!1,Pe("lobby")):(fa.dialog.resultSave.show(),ja.resulting=!0),clearInterval(ja._tTime))),ja._master!=ja.room.master&&Qe(((t=ja.users[ja.room.master]).profile.title||t.profile.name)+L.hasMaster),ja._players=ja.room.players.toString(),ja._master=ja.room.master,ja._gaming=ja.room.gaming}}(e.modify&&e.myRoom),R(e.myRoom),e.modify&&ja.room&&e.myRoom&&(ja._rTitle!=ja.room.title&&B(".room-head-title"),ja._rMode!=Oe(ja.room.mode,ja.room.opts,!0)&&B(".room-head-mode"),ja._rLimit!=ja.room.limit&&B(".room-head-limit"),ja._rRound!=ja.room.round&&B(".room-head-round"),ja._rTime!=ja.room.time&&B(".room-head-time"));break;case"user":ja.setUser(e.id,e),ja.room&&R(ja.room.id==e.place);break;case"friends":for(a in ja._friends={},e.list)e.list[a].forEach(function(e){ja._friends[e]={server:a}});ae();break;case"friend":ja._friends[e.id]={server:"on"==e.stat&&e.s},ja._friends[e.id]&&ja.friends[e.id]&&Qe(("on"==e.stat?"&lt;<b>"+L["server_"+ja._friends[e.id].server]+"</b>&gt; ":"")+L.friend+" "+ja.friends[e.id]+L["fstat_"+e.stat]),ae();break;case"friendAdd":u=ja.users[e.from].profile,a=(u.title||u.name)+"(#"+e.from.substr(0,5)+")",l("friendAddRes",{from:e.from,res:!ja.opts.df&&confirm(a+L.attemptFriendAdd)},!0);break;case"friendAddRes":u=ja.users[e.target].profile,Qe((a=(u.title||u.name)+"(#"+e.target.substr(0,5)+")")+L["friendAddRes_"+(e.res?"ok":"no")]),e.res&&(ja.friends[e.target]=u.title||u.name,ja._friends[e.target]={server:ja.server},ae());break;case"friendEdit":ja.friends=e.friends,ae();break;case"starting":d(L.gameLoading);break;case"roundReady":h("roundReady",e);break;case"turnStart":h("turnStart",e);break;case"turnError":!function(e,a){fa.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+a)),Ze("fail"),clearTimeout(ja._fail),ja._fail=g(function(){fa.game.display.html(ja._char)},1800)}(e.code,e.value);break;case"turnHint":h("turnHint",e);break;case"turnEnd":e.score=Number(e.score),e.bonus=Number(e.bonus),ja.room&&(ja._tid=e.target||ja.room.game.seq[ja.room.game.turn],ja._tid&&(ja._tid.robot&&(ja._tid=ja._tid.id),function(e,a){h("turnEnd",e,a)}(ja._tid,e)),e.baby&&Ze("success"));break;case"roundEnd":for(a in e.users)ja.setUser(a,e.users[a]);ja._resultRank=e.ranks,function(e,a){function t(e){var a,i,o;ja._result.goal=ya[ja._result.level-1],ja._result.before=ya[ja._result.level-2]||0,ja._result.reward.score>0&&((a=ja._result.reward.score*ja._coef)<.05&&ja._coef&&(a=ja._result.reward.score),ja._result.reward.score-=a,ja._result.exp+=a,i=qe(ja._result.exp),ja._result.level!=i&&(ja._result._boing-=ja._result.goal-ja._result._exp,ja._result._exp=ja._result.goal,Ze("lvup")),ja._result.level=i,g(t,50)),o=ja._result.exp-ja._result._exp,r("before",ja._result._exp,ja._result.before,ja._result.goal),r("current",Math.min(o,ja._result._boing),0,ja._result.goal-ja._result.before),r("bonus",Math.max(0,o-ja._result._boing),0,ja._result.goal-ja._result.before),$(".result-me-level-body").html(ja._result.level),$(".result-me-score-text").html(na(Math.round(ja._result.exp))+" / "+na(ja._result.goal))}function r(e,a,t,r){$(".result-me-"+e+"-bar").width((a-t)/(r-t)*100+"%")}a||(a={});var i,o,n,s,d,c,u,p,h,f=$(".result-board").empty();for(i in $(".result-me-expl").empty(),fa.game.display.html(L.roundEnd),ja._resultPage=1,ja._result=null,ja._relay=!1,e)n=e[i],(o=ja._replay?$a.users[n.id]:ja.users[n.id])||(o=ba),o.data&&n.reward&&(n.reward.score=ja._replay?0:Math.round(n.reward.score),c=qe(u=o.data.score)>qe(o.data.score-n.reward.score),f.append(s=$("<div>").addClass("result-board-item").append(d=$("<div>").addClass("result-board-rank").html(n.rank+1)).append(Re(u).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(a.scores?L.avg+" "+na(a.scores[n.id])+L.kpm:na(n.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(n.reward.score?"+"+na(n.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",c?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),o.game.team&&d.addClass("team-"+o.game.team),n.id==ja.id&&(n.exp=o.data.score-n.reward.score,n.level=qe(n.exp),ja._result=n,s.addClass("result-board-me"),$(".result-me-expl").append(function(e,a,t){function r(e,a,t){e||(ja.practicing&&(ja.room.gaming=!0,l("leave")),ja.resulting=!1,fa.dialog.result.hide(),ja.admin||delete ja._replay,ja.admin||delete ja._resultRank,fa.box.room.height(360),Pe("lobby"),Ke(),R()),e.append($("<h5>").addClass("result-me-blog-head").html(a)).append($("<h5>").addClass("result-me-blog-body").html(t))}var i,o,n=$("<div>").append($("<h4>").html(L.scoreGain)).append(i=$("<div>")).append($("<h4>").html(L.moneyGain)).append(o=$("<div>"));return r(i,L.scoreOrigin,e),r(o,L.moneyOrigin,a),t.forEach(function(t){var n,s,l,d=t.charAt(0),c=t.charAt(1),m=t.slice(2,5),u=Number(t.slice(5));"EXP"==m?(n=i,l=e):"MNY"==m&&(n=o,l=a),"g"==c?s="+"+(l*u).toFixed(1):"h"==c&&(s="+"+Math.floor(u)),r(n,L["bonusFrom_"+d],s)}),n}(n.reward._score,n.reward._money,n.reward._blog))));$(".result-me").css("opacity",0),ja._coef=0,ja._result&&(p=ja._result.reward.score-ja._result.reward._score,h=ja._result.reward.money-ja._result.reward._money,ja._result._exp=ja._result.exp,ja._result._score=ja._result.reward.score,ja._result._bonus=p,ja._result._boing=ja._result.reward._score,ja._result._addit=p,ja._result._addp=h,p=p>0?"<label class='result-me-bonus'>(+"+na(p)+")</label>":"",h=h>0?"<label class='result-me-bonus'>(+"+na(h)+")</label>":"",Qe(L.scoreGain+": "+na(ja._result.reward.score)+", "+L.moneyGain+": "+na(ja._result.reward.money)+", "+L.rankPointGain+": "+na(ja._result.reward.rankPoint)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+na(ja._result.reward.score)+p),$(".result-me-money").html(L.moneyGain+" +"+na(ja._result.reward.money)+h)),g(function(){m(fa.dialog.result),ja._result&&t(!0),fa.dialog.result.css("opacity",0).animate({opacity:1},500),g(function(){ja._coef=.05},500)},2e3),ja._record=!1,ja.room.opts.tournament?fa.box.room.height(460):fa.box.room.height(360),Pe("lobby"),Ke(),R()}(e.result,e.data),ja.room.opts.tournament?fa.box.room.height(460):fa.box.room.height(360),Pe("lobby"),Ke(),R();break;case"kickVote":ja._kickTarget=ja.users[e.target],ja.id!=e.target&&ja.id!=ja.room.master&&function(e){var a=ja.users[e].profile;$("#kick-vote-text").html((a.title||a.name)+L.kickVoteText),ja.kickTime=10,ja._kickTime=10,ja._kickTimer=g(_e,1e3),m(fa.dialog.kickVote)}(e.target),Qe((ja._kickTarget.profile.title||ja._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":Qe(w(ja._kickTarget.profile,e));break;case"invited":l("inviteRes",{from:e.from,res:!ja.opts.di&&confirm(e.from+L.invited)});break;case"inviteNo":Qe(((u=ja.users[e.target]).profile.title||u.profile.name)+L.inviteDenied);break;case"okg":ja._playTime>e.time?Qe(L.okgExpired):ja._okg!=e.count&&Qe(L.okgNotice+" ("+L.okgCurrent+e.count+")"),ja._playTime=e.time,ja._okg=e.count;break;case"obtain":ra(e);break;case"expired":for(a in e.list)Qe(ea(e.list[a])+L.hasExpired);break;case"blocked":Qe(L.blocked);break;case"test":(ja._test=!ja._test)?(ja._testt=p(function(){fa.talk.val()!=ja._ttv&&(l("test",{ev:"c",v:fa.talk.val()},!0),ja._ttv=fa.talk.val())},100),document.onkeydown=function(e){l("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){l("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(ja._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(a=e.message||"",401==e.code);else if(403==e.code)d();else if(406==e.code){if(fa.dialog.quick.is(":visible")){ja._preQuick=!1;break}}else if(409==e.code)a=L["server_"+a];else{if(416==e.code)return void(confirm(L["error_"+e.code])&&(Fe(),ja._spectate=!0,ja._gaming=!0,l("enter",{id:e.target,password:ja._pw,spectate:!0},!0)));if(413==e.code)fa.dialog.room.hide(),fa.menu.setRoom.trigger("click");else if(429==e.code)Pe("lobby");else if(430==e.code){if(ja.setRoom(e.message,null),fa.dialog.quick.is(":visible")){ja._preQuick=!1;break}}else if(431==e.code||432==e.code||433==e.code)fa.dialog.room.show();else if(447===e.code){alert("자동화 봇 방지를 위한 캡챠 인증에 실패했습니다. 메인 화면에서 다시 시도해 주세요.");break}}if(402==e.code)ga.onclose=function(){alert("보안을 위해 비로그인 유저의 접근을 제한합니다.\n로그인 페이지로 이동합니다.")},$("#intro-text").html("보안을 위해 비로그인 유저의 접근을 제한합니다."),$("#intro").attr("src",`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/def.png`),location.href="/login";else if(444==e.code)if(e.reason){if("영구"!=e.enddate){var s,u;r=`${(s=e.enddate.toString()).slice(0,4)}년 ${s.slice(4,6)}월 ${u=s.slice(6,8)}일 ${s.slice(8,10)}시 ${s.slice(10,12)}분 ${s.slice(12,14)}초`}else r=e.enddate;ga.onclose=function(a){$("#Intro").hide(),fa.loading.show().html(`차단되었습니다. 관리자에게 문의하세요.<p>사유: ${e.reason}<br>종료일: ${r}`),x(`차단되었습니다. 관리자에게 문의하세요.<p>사유: ${e.reason}<br>종료일: ${r}`),$("#alertbtn").hide()},ga.close()}else alert("차단이 해제되었습니다. 재접속합니다."),ga.onclose=function(e){$("#intro").attr("src",`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/def.png`),$("#Bottom").empty(),$("#intro-text").html("차단이 해제되었습니다. 재접속 해주세요.")},location.reload();else 410==e.code?ga.onclose=function(e){L.closed,e.code;ha&&ha.close(),Me(),x("[#410] "+L.error_410+a),$.get("/kkutu_notice.html",function(e){d(e)})}:alert("[#"+e.code+"] "+L["error_"+e.code]+a)}ja._record&&pe(e)}function v(e){$.getJSON("https://ipinfo.io/",a=>{if(ja.admin)console.log(`접속 아이피: ${a.ip}`),console.log(`접속 지역: ${a.country}`);else if(-1==Ea.indexOf(a.country))return e(a)})}function k(e){return Da={},$.get(`/clan/user?id=${e}`,function(e){e&&(Da=e)}),console.log("Loaded Clan Data Successfully")}function _(e){return $.ajax({url:e,method:"GET",async:!1}).responseText}function y(e){return e?/[(ㄱ-ㅎ)]/gi.test(e)?x("닉네임을 자음만으로 지정하실 수 없습니다."):/[(가-힣a-zA-Z)]/gi.test(e)?e.length>14?x("닉네임 길이 제한은 최대 14글자까지입니다."):e.match("<")?x("닉네임에 잘못된 문자가 포함되어 있습니다."):e.match(">")?x("닉네임에 잘못된 문자가 포함되어 있습니다."):e.match("&lt")?x("닉네임에 잘못된 문자가 포함되어 있습니다."):e.match("　")?x("닉네임에 잘못된 문자가 포함되어 있습니다."):e.match("불건전닉네임")?x("이 닉네임은 닉네임으로 지정할 수 없습니다."):!e.match("잘못된닉네임")||x("이 닉네임은 닉네임으로 지정할 수 없습니다."):x("닉네임에 잘못된 문자가 포함되어 있습니다."):x("닉네임을 입력해 주세요.")}function w(e,a){var t=L.agree+" "+a.Y+", "+L.disagree+" "+a.N+L.kickCon;return a.Y>=a.N?t+=(e.title||e.name)+L.kicked:t+=(e.title||e.name)+L.kickDenied,t}function C(e){var a,t,r={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/ㄱ":case"/r":ja.room&&(ja.room.master==ja.id?fa.menu.start.trigger("click"):fa.menu.ready.trigger("click"));break;case"/청소":case"/cls":Ie();break;case"/ㄹ":case"/f":m(fa.dialog.chatLog),fa.chatLog.scrollTop(999999999);break;case"/귓":case"/ㄷ":case"/e":S(e[1],e.slice(2).join(" "));break;case"/답":case"/ㄷㄷ":case"/ee":ja._recentFrom?S(ja._recentFrom,e.slice(1).join(" ")):Qe(L.error_425);break;case"/무시":case"/wb":!function(e){ja._wblock.hasOwnProperty(e)?(ja.admin||delete ja._wblock[e],Qe(e+L.wnblocked)):(ja._wblock[e]=!0,Qe(e+L.wblocked))}(e[1]);break;case"/차단":case"/shut":j(e.slice(1).join(" "));break;case"/아이디":case"/id":if(e[1]){for(a in t=0,e[1]=e.slice(1).join(" "),ja.users)(ja.users[a].profile.title||ja.users[a].profile.name)==e[1]&&Qe("["+ ++t+"] "+a);t||Qe(L.error_405)}else Qe(L.myId+ja.id);break;default:for(a in r)Qe(r[a],a)}}function x(e){fa.dialog.alertKKuTu.hide(),m(fa.dialog.alertKKuTu),$("#alert").css("text-align","center"),$("#alertbtn").attr("style","float: right;"),$("#alertText").html(e)}function T(e,a,t,r){fa.dialog.promptKKuTu.hide(),$("#prompt").css("text-align","center"),$("#promptbtn").attr("style","float: right;").on("click",e=>{a($("#prompt-input").val()),$("#prompt-input").val("")}),$("#promptText").html(e),$("#prompt-input").attr("style","width: 97%;"),t&&$("#PromptDiag").css("width",`${t}px`),r&&$("#PromptDiag").css("height",`${r}px`),m(fa.dialog.promptKKuTu)}function A(e,a,t){fa.dialog.confirmKKuTu.hide(),$("#confirm").css("text-align","center"),$("#confirmbtn").attr("style","float: right;"),$("#confirmText").html(e),$("#confirm-yes").on("click",e=>a(e)),$("#confirm-no").on("click",e=>t(e)),m(fa.dialog.confirmKKuTu)}function S(e,a){a.length&&(ja._whisper=e,l("talk",{whisper:e,value:a},!0),Ve({title:"→"+e},a,!0))}function j(e){ja._shut.hasOwnProperty(e)?(ja.admin||delete ja._shut[e],Qe(e+L.userNShut)):(ja._shut[e]=!0,Qe(e+L.userShut))}function D(e,a){var t=(e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,"")).match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";if(e.length<1)return a({error:404});$.get("/dict/"+e+"?lang="+t,a)}function q(){return ja.place?ja.room.gaming||ja.resulting?"for-gaming":ja.master?"for-master":"for-normal":"for-lobby"}function R(e,a){var t,r=q();if(ja._replay){if(void 0!==e&&!e)return;ue()}if(!ja._replay&&("for-gaming"!=r||e)){for(t in ja.practicing&&(r="for-gaming"),$(".kkutu-menu button").hide(),fa.box)fa.box[t].hide();fa.box.me.show(),fa.box.chat.show().width(790).height(190),fa.chat.height(120),"for-lobby"==r?(ja._ar_first=!0,fa.box.userList.show(),ja._shop?(fa.box.roomList.hide(),fa.box.shop.show()):(fa.box.roomList.show(),fa.box.shop.hide()),N(a||r!=ja._only),Z(a||r!=ja._only),O(),ja._jamsu&&(clearTimeout(ja._jamsu),ja.admin||delete ja._jamsu)):"for-master"==r||"for-normal"==r?($(".team-chosen").removeClass("team-chosen"),ja.users[ja.id].game.ready||"S"==ja.users[ja.id].game.form?(fa.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(fa.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+ja.users[ja.id].game.team).addClass("team-chosen"),ja.opts.ar&&ja._ar_first&&(fa.menu.ready.addClass("toggled"),fa.menu.ready.trigger("click"),ja._ar_first=!1)),ja._shop=!1,ja.room.opts.tournament?fa.box.room.show().height(460):fa.box.room.show().height(360),"for-master"==r&&fa.dialog.inviteList.is(":visible")&&N(),G(!1),O()):"for-gaming"==r&&(ja._gAnim&&(fa.box.room.show(),ja._gAnim=!1),ja._shop=!1,ja._ar_first=!0,fa.box.me.hide(),fa.box.game.show(),$(".ChatBox").width(1e3).height(140),fa.chat.height(70),G(!0)),ja._only=r,function(e){location.hash=e?"#"+e:""}(ja.place),$(".kkutu-menu ."+r).show()}}function B(e){$(e).addClass("room-head-modified"),g(function(){$(e).removeClass("room-head-modified")},3e3)}function O(){var e,a=ja.users[ja.id],t=0,r=qe(a.data.score),i=ya[r-2]||0,o=ya[r-1],n=a.data.rankPoint<5e3?We(a.data.rankPoint,null,null):Je(a);for(e in a.data.record)t+=a.data.record[e][1];oa(".my-image",a.equip,a.id),$(".my-stat-level").replaceWith(Re(a.data.score).addClass("my-stat-level")),$(".my-stat-name").text(a.profile.title||a.profile.name),$(".my-stat-record").html(L.globalWin+" "+t+L.W),$(".my-stat-ping").html(na(a.money)+L.ping),$(".my-rankPoint").html(a.data.rankPoint+L.LP),$(".my-rank").html(L[n]),$(".my-okg .graph-bar").width(ja._playTime%6e5/6e3+"%"),$(".my-okg-text").html(z(ja._playTime)),$(".my-level").html(L.LEVEL+" "+r),$(".my-gauge .graph-bar").width((a.data.score-i)/(o-i)*190),$(".my-gauge-text").html(na(a.data.score)+" / "+na(o))}function z(e){var a=Math.floor(e/6e4)%60,t=Math.floor(.001*e)%60,r=Math.floor(e/36e5),i=[];return r&&i.push(r+L.HOURS),a&&i.push(a+L.MINUTE),r||i.push(t+L.SECOND),i.join(" ")}function N(e){var a,t,r,i=0;if(ja.opts.su){for(a in r=[],ja.users)i++,r.push(ja.users[a]);r.sort(function(e,a){return a.data.score-e.data.score}),e=!0}else for(a in r=ja.users,ja.users)i++;if(fa.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+ja.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+i+L.MN+"]"),e)for(a in fa.lobby.userList.empty(),fa.dialog.inviteList.empty(),r)(t=r[a]).robot||(fa.lobby.userList.append(P(t)),0==t.place&&fa.dialog.inviteList.append(P(t,!0)))}function P(e,a){var t;return F(t=a?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Re(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.nickname)).on("click",function(e){re($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(Re(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.nickname)).on("click",function(a){ja.admin&&a.shiftKey?(m(fa.dialog.management),$("#target-id").text(e.id),$("#target-nickname").text(e.nickname)):te($(a.currentTarget).attr("id").slice(11))}),e),t}function F(e,a){var t,r,i=a.equip.BDG;"string"==typeof i?(t=i.includes("master"),r=i.includes("challenger"),i=i.includes("champion")):(t=!1,r=!1,i=!1),a.equip.NIK&&e.addClass("x-"+a.equip.NIK),"b9_bf"==a.equip.BDG&&e.addClass("x-bf"),"b5_yt"==a.equip.BDG&&e.addClass("x-yt"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"b6_word"==a.equip.BDG&&e.addClass("x-word"),"b6_design"==a.equip.BDG&&e.addClass("x-design"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"1yearbadge"==a.equip.BDG&&e.addClass("x-1yearbadge"),"b6_usermanage"==a.equip.BDG&&e.addClass("x-uman"),"b6_develop"==a.equip.BDG&&e.addClass("x-develop"),"b7_general_affairs"==a.equip.BDG&&e.addClass("x-money"),t&&e.addClass("x-master"),"b8_assist_manager"==a.equip.BDG&&e.addClass("x-premanager"),"b6_music"==a.equip.BDG&&e.addClass("x-music"),r&&e.addClass("x-challenger"),i&&e.addClass("x-champion"),"b9_honor"==a.equip.BDG&&e.addClass("x-honor")}function Z(e){var a,t=0;if(e){for(a in fa.lobby.roomList.empty(),ja.rooms)fa.lobby.roomList.append(M(ja.rooms[a])),t++;$("#roomlist-loading").hide()}else for(a in $(".rooms-create").remove(),ja.rooms)t++;fa.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+t+L.GAE+"]"),t?($(".rooms-gaming").css("display",ja.opts.ow?"none":""),$(".rooms-locked").css("display",ja.opts.ou?"none":"")):fa.lobby.roomList.append(fa.lobby.createBanner.clone().on("click",function(e){fa.menu.newRoom.trigger("click")}))}function M(e){var a,t,r=Oe(e.mode,e.opts);return a=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(t=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(a){!function(e){var a=ja.rooms[e],t=$("#ri-players").empty();ja._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((a.password?"<i class='fa fa-lock'></i>&nbsp;":"")+a.title),$("#ri-mode").html(L["mode"+da[a.mode]]),$("#ri-round").html(a.round+", "+a.time+L.SECOND),$("#ri-limit").html(a.players.length+" / "+a.limit),a.players.forEach(function(e,r){var i,o,n=a.readies[e]||{};e=ja.users[e]||ba,a.players[r].robot?(e.profile={title:L.robot},e.equip={robot:!0}):n.t=n.t||0,t.append($("<div>").addClass("ri-player").append(o=$("<div>").addClass("moremi rip-moremi")).append(i=$("<div>").addClass("ellipse rip-title").html(e.profile.title||e.profile.name)).append($("<div>").addClass("rip-team team-"+n.t).html($("#team-"+n.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+n.f]))),e.id==a.master&&i.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),i.prepend(Re(e.data.score).addClass("profile-level rip-level")),oa(o,e.equip,e.id)}),m(fa.dialog.roomInfo),fa.dialog.roomInfo.show()}(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(Ge(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(r.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=t.get(0)&&Ee($(e.currentTarget).attr("id").slice(5))}),e.gaming&&a.addClass("rooms-gaming"),e.admin&&a.addClass("rooms-admin"+(e.gaming?"-gaming":"-waiting")),e.password&&a.addClass("rooms-locked"),a}function E(e){var a,t,r,i=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append(a=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(Re(e.data.score).addClass("game-user-level")).append(r=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+qe(e.data.score)))).append(t=$("<div>").addClass("game-user-score"));return oa(a,e.equip,e.id),global.expl(i),F(r,e),e.game.team&&t.addClass("team-"+e.game.team),i}function I(e){var a,t,r=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(Re(e.data.score).addClass("game-user-level")).append(t=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(a=$("<div>").addClass("game-user-score"));return e.id==ja.id&&t.addClass("game-user-my-name"),F(t,e),e.game.team&&a.addClass("team-"+e.game.team),r}function K(e){return{title:L["aiLevel"+e]+" "+L.robot,image:`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/robot.png`}}function G(e){var a,t,r,i,o,n,s,l=ua[da[ja.room.mode]],d=va||l.big?I:E,c=!1,m=!0;if(ze($(".RoomBox .product-title"),ja.room),ze($(".GameBox .product-title"),ja.room),e){for(a in r=$(".GameBox .game-body").empty(),ja.room.game.seq)(t=ja._replay?$a.users[ja.room.game.seq[a]]||ja.room.game.seq[a]:ja.users[ja.room.game.seq[a]]||ja.robots[ja.room.game.seq[a].id]||ja.room.game.seq[a]).robot&&!t.profile&&(t.profile=K(t.level),ja.robots[t.id]=t),r.append(d(t)),J(t.id,t.game.score||0);clearTimeout(ja._jamsu),!ja.admin&&delete ja._jamsu}else{for(a in r=$(".room-users").empty(),p="S"==ja.users[ja.id].game.form,ja.room.players)if((t=ja.users[ja.room.players[a]]||ja.room.players[a]).game){var u=t.game.practice?"/"+L.stat_practice:"",p="S"==t.game.form&&"/"+L.stat_spectate;t.robot&&(t.profile=K(t.level),ja.robots[t.id]=t),r.append($("<div>").attr("id","room-user-"+t.id).addClass("room-user").append(n=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(i=$("<div>").addClass("room-user-ready")).append(o=$("<div>").addClass("room-user-team team-"+t.game.team).html($("#team-"+t.game.team).html()))).append($("<div>").addClass("room-user-title").append(Re(t.data.score).addClass("room-user-level")).append(s=$("<div>").addClass("room-user-name").text(t.profile.title||t.profile.name))).on("click",function(e){te($(e.currentTarget).attr("id").slice(10))})),oa(n,t.equip,t.id),p&&o.hide(),t.id==ja.room.master?i.addClass("room-user-master").html(L.master+u+(p||"")):p?i.addClass("room-user-spectate").html(L.stat_spectate+u):t.game.ready||t.robot?(i.addClass("room-user-readied").html(L.stat_ready),t.robot||(c=!0)):t.game.practice?(i.addClass("room-user-practice").html(L.stat_practice),m=!1):(i.html(L.stat_noready),m=!1),F(s,t)}c&&ja.room.master==ja.id&&m?ja._jamsu||(ja._jamsu=g(U,5e3)):(clearTimeout(ja._jamsu),!ja.admin&&delete ja._jamsu)}fa.dialog.profile.is(":visible")&&te(ja._profiled)}function U(){Qe(L.subJamsu),ja._jamsu=g(function(){l("leave"),alert(L.masterJamsu)},3e4)}function J(e,a){var t;return(t=ja["_s"+e])?(clearTimeout(t.timer),t.$obj=$("#game-user-"+e+" .game-user-score"),t.goal=a):t=ja["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:a,now:0},H(t),$("#game-user-"+e)}function H(e){var a=(e.goal-e.now)*Math.min(1,.01*_a);a<.1?a=e.goal-e.now:e.timer=g(H,_a,e),e.now+=a,function(e,a){var t,r=a>99999?s(Math.round(.001*a),4)+"k":s(a,5);for(e.empty(),t=0;t<r.length;t++)e.append($("<div>").addClass("game-user-score-char").html(r[t]))}(e.$obj,Math.round(e.now))}function W(e){var a=$("#dress-view"),t=ja.users[ja.id];oa(a,t.equip,t.id),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-nickname").val(t.nickname),$("#dress-exordial").val(t.exordial),Q(e||!0)}function V(e,a,t,r,i){var o,n,s,l,d,c,m=[],u=!0===t;for(c in e.empty(),r||(r={}),r)ja.box.hasOwnProperty(r[c])||(ja.box[r[c]]={value:0});for(c in ja.box)m.push({key:c,obj:Xe(c),value:ja.box[c]});for(c in m.sort(function(e,a){return e.obj.name<a.obj.name?-1:1}),m)n=m[c].obj,s=m[c].value,"BDG"==(l=n.group).substr(0,3)&&(l="BDG"),d="Mhand"==l?r.Mlhand==m[c].key||r.Mrhand==m[c].key:r[l]==m[c].key,"number"==typeof s&&(s={value:s}),(s.hasOwnProperty("value")||d)&&(u||-1!=t.indexOf(n.group))&&(e.append(o=$("<div>").addClass("dress-item").append(Be(n.image).addClass("dress-item-image").html("x"+s.value)).append(ye(n,d,s.expire))),o.attr("id",a+"-"+n._id).on("click",i),d&&o.addClass("dress-equipped"));global.expl(e)}function Q(e){var a,t=ja.users[ja.id].equip||{},r=!0===e;ja._avGroup=e,a=!!r||(e||"").split(","),V($("#dress-goods"),"dress",a,t,function(e){var a,t=$(e.currentTarget),r=t.attr("id").slice(6),i=Xe(r);if(e.ctrlKey){if(t.hasClass("dress-equipped"))return sa(426);if(!confirm(L.surePayback+na(Math.round(.2*(i.cost||0)))+L.ping))return;$.post("/payback/"+r,function(e){if(e.error)return sa(e.error);alert(L.painback),ja.box=e.box,ja.users[ja.id].money=e.money,W(ja._avGroup),R(!1)})}else if(-1!=ma.indexOf(i.group))"Mhand"==i.group&&(a=confirm(L.dressWhichHand)),function(e,a){var t=ja.users[ja.id],r=ja.shop[e].group;"Mhand"==r&&(r=a?"Mlhand":"Mrhand"),"BDG"==r.substr(0,3)&&(r="BDG");var i=t.equip[r]==e;confirm(L[i?"sureUnequip":"sureEquip"]+": "+L[e][0])&&$.post("/equip/"+e,{isLeft:a},function(e){if(e.error)return sa(e.error);ja.box=e.box,t.equip=e.equip,W(ja._avGroup),l("refresh"),R(!1)})}(r,a);else if("CNS"==i.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+r,function(e){e.exp&&Qe(L.obtainExp+": "+na(e.exp)),e.money&&Qe(L.obtainMoney+": "+na(e.money)),e.gain.forEach(function(e){ra(e)}),ja.box=e.box,ja.users[ja.id].data=e.data,l("refresh"),W(ja._avGroup),O()})}})}function Y(){function e(){r.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function a(){var a,n={WPE:1,WPC:1,WPB:2,WPA:3},l="",d=0,c=!1;r.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),ja._tray.forEach(function(e){c=e.includes("$WPE"),a=Xe(e),l+=e.slice(4),d+=n[e.slice(1,4)],r.append($("<div>").addClass("jt-image").css("background-image","url("+a.image+")").attr("id","cf-tray-"+e).on("click",t)),$("#cf-\\"+e).addClass("cf-tray-selected")}),i.html(L.searching),o.empty(),fa.dialog.cfCompose.removeClass("cf-composable"),s.html(""),D(l,function(e){var a=!1;if(e.error){if(3!=l.length)return i.html(L["wpFail_"+e.error]);a=!0,i.html(L.cfBlend)}(function(e,a,t,r){$.get(`/cf/${e}?l=${a}&b=${t?"1":""}&e=${r}`,function(e){if(e.error)return sa(e.error);o.empty(),e.data.forEach(function(e){var a=Xe(e.key),t=e.rate>=1?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";o.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+a.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(a.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(t)))}),s.html(L.cfCost+": "+e.cost+L.ping)})})(l,d,a,c),fa.dialog.cfCompose.addClass("cf-composable"),e.error||i.html(Se(e.word,e.mean,e.theme,e.type.split(",")))}),""==l&&e()}function t(e){var t=$(e.currentTarget).attr("id").slice(8),r=ja._tray.indexOf(t);-1!=r&&(ja._tray.splice(r,1),a())}var r=$("#cf-tray"),i=$("#cf-dict"),o=$("#cf-reward"),n=$("#cf-goods"),s=$("#cf-cost");ja._tray=[],i.empty(),o.empty(),s.html(""),fa.dialog.cfCompose.removeClass("cf-composable"),V(n,"cf",["PIX","PIY","PIZ"],null,function(e){var t,r=$(e.currentTarget).attr("id").slice(3),i=ja.box[r],o=0;if(ja._tray.length>=100)return sa(435);for(t in ja._tray)ja._tray[t]==r&&o++;i-o>0?(ja._tray.push(r),a()):sa(434)}),e()}function X(e){var a=fa.dialog.lbTable.empty(),t=e.data[0]?e.data[0].rank:0,r=(e.page||Math.floor(t/20))+1;e.data.forEach(function(e,t){var r=ja.users[e.id];r=r?r.profile.title||r.profile.name:L.hidden,e.score=Number(e.score),a.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(Re(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(qe(e.score)))).append($("<td>").html(r)).append($("<td>").html(na(e.score))))}),$("#ranking-"+ja.id).addClass("ranking-me"),fa.dialog.lbPage.html(L.page+" "+r),fa.dialog.lbPrev.attr("disabled",r<=1),fa.dialog.lbNext.attr("disabled",e.data.length<15),fa.dialog.lbMe.attr("disabled",!!ja.guest),ja._lbpage=r-1}function ee(e){var a=fa.dialog.rplbTable.empty(),t=e.data[0]?e.data[0].rank:0,r=(e.page||Math.floor(t/20))+1,i=function(e){var a,t={};if(e){for(a in e.data)t[e.data[a].id]=We(e.data[a].score,e.data[a].id,e);return t}var r=_("/rpRanking"),i=JSON.parse(r);for(a in i.data)t[i.data[a].id]=We(i.data[a].score,i.data[a].id,i);return t}(e);e.data.forEach(function(e,t){var r=ja.users[e.id];r=r?r.profile.title||r.profile.name:L.hidden,a.append($("<tr>").attr("id","rpranking-"+e.id).addClass("rpranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append($("<div>").css({float:"left","background-image":`url('https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/rankicon/${i[e.id]}.png')`,"background-position":"100% 100%","background-size":"100%"}).addClass("rpranking-image")).append($("<label>").css("padding-top",2).html(L[`${i[e.id]}`]))).append($("<td>").html(r)).append($("<td>").html(na(e.score))))}),$("#rpranking-"+ja.id).addClass("rpranking-me"),fa.dialog.rplbPage.html(L.page+" "+r),fa.dialog.rplbPrev.attr("disabled",r<=1),fa.dialog.rplbNext.attr("disabled",e.data.length<15),fa.dialog.rplbMe.attr("disabled",!!ja.guest),ja._rplbpage=r-1}function ae(){function e(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),t=ja.friends[a],r=prompt(L.friendEditMemo,t);r&&l("friendEdit",{id:a,memo:r},!0)}function a(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),t=ja.friends[a];if(ja._friends[a].server)return sa(455);confirm(t+"(#"+a.substr(0,5)+")\n"+L.friendSureRemove)&&l("friendRemove",{id:a},!0)}var t,r,i,o,n=0;for(t in fa.dialog.commFriends.empty(),ja.friends)n++,o=ja.friends[t],r=ja._friends[t]||{},i=(ja.users[t]||{}).profile,fa.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+t).append($("<div>").addClass("cfi-status cfi-stat-"+(r.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(r.server?L["server_"+r.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(i?i.title||i.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(o)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",e)).append($("<i>").addClass("fa fa-remove").on("click",a))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+n+" / 100)")}function te(e){var a,t,r,i,o=ja.users[e]||ja.robots[e],n=$("#profile-record").empty(),s=ja.users[e],l=495;if(o){if(!o.robot){var d=o.data.rankPoint<5e3?We(o.data.rankPoint,null,null):Je(s);$(".profile-level-progress").show(),$(".profile-score-text").show(),fa.dialog.profileCopyID.on("click",function(e){var a=document.createElement("textarea");a.value=o.id,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),Swal.fire("BF끄투","이 유저의 식별번호 "+a.value+"가 복사되었습니다.<br>(일부 브라우저의 경우 수동으로 복사해야 할 수 있습니다)","success")})}if($("#ProfileDiag .dialog-title").text((o.profile.title||o.profile.name)+L.sProfile),$(".profile-head").empty().append(a=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(Be(o.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").text(o.profile.title||o.profile.name).append($("<label>").addClass("profile-tag").html(" #"+o.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").css("width","75%").append(Re(o.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(r=qe(o.data.score)))).append($("<div>").addClass("profile-score-text").html(na(o.data.score)+" / "+na(ya[r-1])+L.PTS))).append($("<div>").css("width","75%").append($("<progress>").addClass("profile-level-progress").css("width","100%").attr("max",100).attr("value",Math.floor((o.data.score-(ya[r-2]||0))/(ya[r-1]-(ya[r-2]||0))*100)))).append(t=$("<div>").addClass("profile-head-item profile-exordial ellipse").css("width","75%").text(Ge(o.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(o.exordial))),o.robot)fa.dialog.profileLevel.show(),fa.dialog.profileLevel.prop("disabled",ja.id!=ja.room.master),$("#rank").html(L.UNRANKED),$("#rankpoint").html(L["0LP"]),$("#profile-place").html(ja.room.id+L.roomNumber);else{for(r in fa.dialog.profileLevel.hide(),$("#profile-rank").empty().append(i=$("<div>").attr("id","profile-rankicon").append($("<img>").attr("id","rankicon").attr("src",`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/rankicon/${d}.png`)).append($("<div>").addClass("expl").css({"white-space":"normal",width:50,"font-size":"11px"}).text(L[d]))),$("#rankpoint").html(s.data.rankPoint+L.LP),$("#profile-place").html(o.place?o.place+L.roomNumber:L.lobby),o.data.record){var c=o.data.record[r];n.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+r])).append($("<div>").addClass("profile-field-record").html(c[0]+L.P+" "+c[1]+L.W)).append($("<div>").addClass("profile-field-score").html(na(c[2])+L.PTS)))}oa(a,o.equip,o.id)}o.data.score<=-1&&($(".profile-level-progress").hide(),$(".profile-level-text").text("운영자"),$(".profile-score-text").hide()),ja.id==o.id?l=465:o.exordial&&(l=510),$("#ProfileDiag").css("height",`${l}px`),$("#profile-friendadd").hide(),ja._profiled=e,fa.dialog.profileKick.hide(),fa.dialog.profileReport.hide(),fa.dialog.profileShut.hide(),fa.dialog.profileDress.hide(),fa.dialog.profileWhisper.hide(),fa.dialog.profileHandover.hide(),ja.id==e?fa.dialog.profileDress.show():o.robot||(fa.dialog.profileShut.show(),fa.dialog.profileReport.show(),fa.dialog.profileWhisper.show()),ja.room&&ja.id!=e&&ja.id==ja.room.master&&(fa.dialog.profileKick.show(),fa.dialog.profileHandover.show()),ja.id!=o.id?$("#profile-warn").hide():($("#profile-warn").show(),$("#warnRecord").text(function(e){var a=_(`/getwarn?target=${e}`),t=JSON.parse(a);return t.message?t.message:alert("경고 누적 횟수를 조회하지 못했습니다."+t.error)}(e)+L.WARNCOUNT)),m(fa.dialog.profile),fa.dialog.profile.show(),global.expl(t),global.expl(i)}else Qe(L.error_405)}function re(e){var a;("AI"==e||(a=ja.users[e].profile.title||ja.users[e].profile.name,confirm(a+L.sureInvite)))&&l("invite",{target:e})}function ie(e){ja._replay||ja.lastFail!=ja.id||ja.id!=e?ja.failCombo=0:(ja.failCombo++,1==ja.failCombo&&Qe(L.trollWarning),ja.failCombo>1&&(l("leave"),sa(437))),ja.lastFail=e}function oe(){var e;for(e in ja.room.players)(ja._replay?$a.users[ja.room.players[e]]||ja.room.players[e]:ja.users[ja.room.players[e]]||ja.robots[ja.room.players[e].id]).game.score=0,!ja.admin&&delete ja["_s"+ja.room.players[e]];ja.admin||delete ja.lastFail,ja.failCombo=0,ja._spectate=-1==ja.room.game.seq.indexOf(ja.id),ja._gAnim=!0,fa.box.room.show().height(360).animate({height:1},500),fa.box.game.height(1).animate({height:410},500),Fe(),fa.dialog.resultSave.attr("disabled",!1),ge(),fa.game.display.html(L.soon),Ze("game_start"),Ke(),g(function(){ja.room.opts.tournament?fa.box.room.height(460).hide():fa.box.room.height(360).hide(),fa.chat.scrollTop(999999999)},500)}function ne(){var e;for(e in ja.room.game.seq)ja.room.game.seq[e].robot&&(ja.room.game.seq[e].game.score=0);for(e in $a.users={},$a.players){var a=$a.players[e].id,t=$a.readies[a]||{},r=ja.users[a]||ja.robots[a],i=a;$a.players[e].robot?(r=$a.users[a]={robot:!0},(i=$a.players[e]).game={}):r=$a.users[a]={},ja.room.players.push(i),r.id=i,r.profile=$a.players[e],r.data=r.profile.data,r.equip=r.profile.equip,r.game={score:0,team:t.t}}ja._rf=0}function se(e){var a,t,r=ja.room.events[--ja._rf];if(r){a=r.time;do{if(!(r=ja.room.events[--ja._rf]))break}while(a-r.time<1e3);for(t=ja._rf-1,ne(),a=ja.muteEff,ja.muteEff=!0,i=0;i<t;i++)me();$(".deltaScore").remove(),ja.muteEff=a,me()}}function le(e){var a=ja._rpause=!ja._rpause;$(e.target).html(a?L.replayResume:L.replayPause)}function de(e){clearTimeout(ja._rt),me()}function ce(){ja.$gpt.html(ja._gpp+" ("+(.001*ja._eventTime).toFixed(1)+L.SECOND+" / "+(.001*ja._gtt).toFixed(1)+L.SECOND+")")}function me(e){var a,t=ja.room.events[ja._rf];return clearTimeout(ja._rt),e||ja._rf++,t?ja._rpause?(ja._rf--,ja._rt=g(me,100)):((a=t.data).hint&&(a.hint={_id:a.hint}),"chat"==a.type&&(a.timestamp=$a.time+t.time),f(a),ja._eventTime=t.time,ce(),void(ja.room.events.length>ja._rf?ja._rt=g(me,ja.room.events[ja._rf].time-t.time):ue())):void ue()}function ue(){ja.admin||delete ja.room,ja._replay=!1,fa.box.room.height(360),clearTimeout(ja._rt),R(),Pe("lobby")}function pe(e){if(!ja._replay&&$a){var a,t=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(a in e={},t)e[a]=t[a];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),$a.events.push({data:e,time:(new Date).getTime()-$a.time})}}}function ge(){ja._relay=!1,d(),fa.game.here.hide(),fa.dialog.result.hide(),fa.dialog.dress.hide(),fa.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),$(".jjoriping,.rounds").removeClass("dg"),$(".rounds").removeClass("painter"),fa.game.display.empty(),fa.game.chain.hide(),fa.game.hints.empty().hide(),fa.game.tools.hide(),fa.game.cwcmd.hide(),fa.game.bb.hide(),fa.game.round.empty(),fa.game.history.empty(),fa.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function he(e){var a;for(fa.game.round.empty(),a=0;a<ja.room.round;a++)fa.game.round.append($l=$("<label>").html(ja.room.game.title[a])),a+1==e&&$l.addClass("rounds-current")}function fe(){h("turnGoing")}function $e(e){return ja._replay?$a.users[e].game.score:(ja.users[e]||ja.robots[e]).game.score}function ve(e,a){ja._replay?$a.users[e].game.score+=a:(ja.users[e]||ja.robots[e]).game.score+=a}function ke(e,a){return e.append(a),g(function(){a.remove()},2e3),e}function be(e){var a,t,n,s=$(".result-board").empty();if(ja._resultPage=2,!e)return fa.dialog.resultOK.trigger("click");for(i in e.list)r=e.list[i],o=ja.users[r.id]||{profile:{title:L.hidden}},n=r.id==ja.id,s.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(Re(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(na(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(t=$("<div>").addClass("result-board-lvup").css("display",n?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(e.prev-r.rank)))),n&&(e.prev-r.rank<=0&&t.hide(),a.addClass("result-board-me"))}function _e(){$(".kick-vote-time .graph-bar").width(ja.kickTime/ja._kickTime*300),--ja.kickTime>0?ja._kickTimer=g(_e,1e3):fa.dialog.kickVoteY.trigger("click")}function ye(e,a,t){var r,i,o=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(ea(e._id)+(a?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+e.group])).append($("<div>").addClass("dress-item-expl").html(aa(e._id))),n=$("<div>").addClass("dress-item-opts");for(r in e.term&&o.append($("<div>").addClass("dress-item-term").html(Math.floor(e.term/86400)+L.DATE+" "+L.ITEM_TERM)),t&&o.append($("<div>").addClass("dress-item-term").html(new Date(1e3*t).toLocaleString()+L.ITEM_TERMED)),e.options)if("gif"!=r){var s=r.charAt(0);i=e.options[r],"g"==s?i="+"+(100*i).toFixed(1)+"%p":"h"==s&&(i="+"+i),n.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+r])).append($("<label>").addClass("item-opts-body").html(i)).append($("<br>"))}return i&&o.append(n),o}function we(e){var a;$.get("/shop",function(t){for(a in ja.shop={},t.goods)ja.shop[t.goods[a]._id]=t.goods[a];e&&e(t)})}function Ce(e){var a,t,r=$(e.currentTarget).attr("id").slice(6),i=ja.shop[r],o=ja.users[ja.id],n=o.money,s=n-i.cost,l=L.surePurchase,d={};for(t in ja.box&&ja.box[r]&&(l=L.alreadyGot+" "+l),m(fa.dialog.purchase,!0),$("#purchase-ping-before").html(na(n)+L.ping),$("#purchase-ping-cost").html(na(i.cost)+L.ping),$("#purchase-item-name").html(L[r][0]),a=$("#purchase-ping-after").html(na(s)+L.ping),$("#purchase-item-desc").html(s<0?L.notEnoughMoney:l),o.equip)d[t]=o.equip[t];d["Mhand"==i.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:i.group]=r,oa("#moremi-after",d,"shop"),ja._sgood=r,fa.dialog.purchaseOK.attr("disabled",s<0),s<0?a.addClass("purchase-not-enough"):a.removeClass("purchase-not-enough")}function Le(e){e<1||($("#Middle").css("padding-top",e),g(function(){$("#Middle").css("padding-top",0),g(Le,50,.7*e)},50))}function xe(e,a,t,r){da[ja.room.mode];var i,o,n,s,l,d=JSON.parse($("#RULE").html()),c="KKT"==da[ja.room.mode],m="KAP"==da[ja.room.mode],u=ka[i=e.length],p=0,h=ja.turnTime/96,f=ja.turnTime/12;if(fa.game.display.empty(),u?(o="As"+ja._speed,u=u.split("")):"en"==d[da[ja.room.mode]].lang&&i<10?o="As"+ja._speed:(o="Al",Le(i)),n="K"+ja._speed,u){for(s in u)"0"!=u[s]&&(fa.game.display.append(l=$("<div>").addClass("display-text").css({float:m?"right":"left","margin-top":-6,"font-size":36}).hide().html(m?e.charAt(i-p-1):e.charAt(p))),p++,g(function(e,a){var t={"margin-top":0};Ze(a),e.html()==ja.mission?(Ze("mission"),e.css({color:"#66FF66"}),t["font-size"]=24):t["font-size"]=20,e.show().animate(t,100)},Number(s)*h,l,o));s=fa.game.display.children("div").get(0),$(s).css(m?"margin-right":"margin-left",.5*(fa.game.display.width()-20*i))}else if(p="",m)for(s=0;s<i;s++)g(function(e){Ze(o),e==ja.mission?(Ze("mission"),p="<label style='color: #66FF66;'>"+e+"</label>"+p):p=e+p,fa.game.display.html(p)},Number(s)*f/i,e[i-s-1]);else for(s=0;s<i;s++)g(function(e){Ze(o),e==ja.mission?(Ze("mission"),p+="<label style='color: #66FF66;'>"+e+"</label>"):p+=e,fa.game.display.html(p)},Number(s)*f/i,e[s]);g(function(){for(s=0;s<3;s++)g(function(e){if(c){if(1==e)return;Ze("kung")}(u?fa.game.display.children(".display-text"):fa.game.display).css("font-size",21).animate({"font-size":20},h)},s*h*2,s);g(Ae,4*h,e,a,t,r),c||Ze(n)},f)}function Te(e){var a,t=Se("",e);fa.game.hints.append(a=$("<div>").addClass("hint-item").append($("<label>").html(t)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(t.html()))),va||a.width(0).animate({width:215}),global.expl(a)}function Ae(e,a,t,r){var i,o,n,s=r?r.split(","):[],l={};fa.game.history.prepend(i=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(e)),(o=fa.game.history.children()).length>6&&o.last().remove(),n=Se(e,a,t,s),s.forEach(function(e){l[e]||L["class_"+e]&&(l[e]=!0,i.append($("<label>").addClass("history-class").html(L["class_"+e])))}),i.append(o=$("<div>").addClass("history-mean ellipse").append(n)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+n.html()+"</h5>")),global.expl(i)}function Se(e,a,t,r){if(!a||-1==a.indexOf("＂"))return function(e,a){return $("<label>").addClass("word").html(a)}(0,a);var i=$("<label>").addClass("word"),o=a.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("［")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),n=(r&&r.map(function(e){return L["class_"+e]}),t?t.split(",").map(function(e){return L["theme_"+e]}):[]),s=o.length>1;return o.forEach(function(e,a){var t=$("<label>").addClass("word-m1"),r=e.length>1;s&&t.append($("<label>").addClass("word-head word-m1-head").html(a+1)),e.forEach(function(e,a){var i=$("<label>").addClass("word-m2"),o=e.length,s=o>1,l=n.splice(0,o);r&&i.append($("<label>").addClass("word-head word-m2-head").html(a+1)),e.forEach(function(e,a){var t=$("<label>").addClass("word-m3"),r=l.shift();s&&t.append($("<label>").addClass("word-head word-m3-head").html(a+1)),r&&t.append($("<label>").addClass("word-theme").html(r)),t.append($("<label>").addClass("word-m3-body").html(function(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"≥")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}(e))),i.append(t)}),t.append(i)}),i.append(t)}),i}function je(e,a,t){var r=e+(a?"("+a+")":"");return t&&(r+="<label class='jjo-display-word-length'>("+t+")</label>"),r}function De(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function qe(e){var a,t=ya.length;for(a=0;a<t&&!(e<ya[a]);a++);return a+1}function Re(e){var a=qe(e)-1,t=a%25*-100,r=-100*Math.floor(.04*a);return e<="-1"?$("<div>").css({float:"left","background-image":`url('https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/lv/lvGM.png')`,"background-position":"100% 100%","background-size":"100%"}):$("<div>").css({float:"left","background-image":`url('https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/lv/newlv.png')`,"background-position":t+"% "+r+"%","background-size":"2560%"})}function Be(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function Oe(e,a,t){var r,i=[L["mode"+da[e]]];for(r in pa)a[pa[r].name.toLowerCase()]&&i.push(L["opt"+pa[r].name]);return t&&i.push(a.injpick.join("|")),t?i.toString():i}function ze(e,a){var t,r=Oe(a.mode,a.opts),i=ua[da[a.mode]];e.empty().append($("<h5>").addClass("room-head-number").html("["+(a.practice?L.practice:a.id)+"]")).append($("<h5>").addClass("room-head-title").text(Ge(a.title))).append(t=$("<h5>").addClass("room-head-mode").html(r.join(" / "))).append($("<h5>").addClass("room-head-limit").html((va?"":L.players+" ")+a.players.length+" / "+a.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+a.round)).append($("<h5>").addClass("room-head-time").html(a.time+L.SECOND)),-1!=i.opts.indexOf("ijp")&&(t.append($("<div>").addClass("expl").html("<h5>"+a.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(e))}function Ne(e,a){ja._lsRemain=e.length,e.forEach(function(e){!function(e,a,t){function r(t){Aa[e]=new o(a),i()}function i(){0==--ja._lsRemain?t&&t():d(L.loadRemain+ja._lsRemain)}function o(e){var a=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){a.audio.play()},this.stop=function(){a.audio.currentTime=0,a.audio.pause()}}var n=new XMLHttpRequest;n.open("GET",a),n.responseType="arraybuffer",n.onload=function(a){Ra?Ra.decodeAudioData(a.target.response,function(a){Aa[e]=a,i()},r):r()},n.send()}(e.key,e.value,a)})}function Pe(e,a){return ja.bgm&&ja.bgm.stop(),ja.bgm=Ze("lobby"==e?$("#bgmselect").val():e,!0)}function Fe(){ja.bgm&&(ja.bgm.stop(),!ja.admin&&delete ja.bgm)}function Ze(e,a){var t,r,i=a&&ja.muteBGM||!a&&ja.muteEff;return r=Aa[e]||Aa.missing,window.hasOwnProperty("AudioBuffer")&&r instanceof AudioBuffer?((t=Ra.createBufferSource()).startedAt=Ra.currentTime,t.loop=a,t.buffer=i?Ra.createBuffer(2,r.length,Ra.sampleRate):r,t.connect(Ra.destination)):(r.readyState&&(r.audio.currentTime=0),r.audio.loop=a||!1,r.audio.volume=i?0:$("#bgmvol").val(),t=r),Sa[e]&&Sa[e].stop(),Sa[e]=t,t.key=e,t.start(),t}function Me(){var e;for(e in Sa)Sa[e].stop()}async function Ee(e){var a;ja.rooms[e]&&(ja.rooms[e].password&&!(a=await new Promise(e=>{e(Swal.fire({title:L.putPassword,input:"password",inputPlaceholder:L.putPassword,inputAttributes:{autocapitalize:"off",autocorrect:"off"}}))}))||(ja._pw=ja.rooms[e].password?a.value:a,l("enter",{id:e,password:ja.rooms[e].password?a.value:a})))}function Ie(){$("#Chat").empty()}function Ke(){var e=$("#Chat,#chat-log-board"),a=e.children(".chat-item").last().get(0);a&&"HR"==a.tagName||(e.append($("<hr>").addClass("chat-item")),fa.chat.scrollTop(999999999))}function Ge(e,a){var t=$("#badwordfilter").val().substr(0,2);return xa.test(e)&&$("#hide-otherkkutu").is(":checked")&&(e=e.replace(xa,"[타서버 필터링]")),Ta.test(e)&&(e=e.replace(Ta,"[타서버 링크 공유 금지]")),La.test(e)&&!a.admin&&(e=e.replace(La,"-")),Ca.test(e)&&"NO"!=t&&(e=e.replace(Ca,t)),e}function Ue(e){return xa.test(e)&&(e=e.replace(xa,"")),La.test(e)&&(e=e.replace(La,"")),Ca.test(e)&&(e=e.replace(Ca,"")),e}function Je(e){return e.data.rankPoint<5e3?We(e.data.rankPoint,null,null):He(e.data.rankPoint,e.id)}function He(e,a){return We(e,a,JSON.parse(_("/rpRanking")))}function We(e,a,t){var r;return e>=5e3?(r="MASTER",t.data[0].id==a&&(r="CHAMPION"),t.data[1].id!=a&&t.data[2].id!=a||(r="CHALLENGER")):e<50?r="UNRANKED":e>=50&&e<1e3?r="BRONZE":e>=1e3&&e<2e3?r="SILVER":e>=2e3&&e<3e3?r="GOLD":e>=3e3&&e<4e3?r="PLATINUM":e>=4e3&&e<5e3&&(r="DIAMOND"),r}function Ve(e,a,t,r){var i,o,n,s,l,d,c=r?new Date(r):new Date,u=ja.users[e.id]?ja.users[e.id].equip:{},p="";if(ja.room&&((l=$(".room-users")[0].children[`room-user-${e.id}`])?d=l.innerText.includes(L.stat_spectate):(G(!1),d=(l=$(".room-users")[0].children[`room-user-${e.id}`]).innerText.includes(L.stat_spectate))),p=d?"x-spectator":"",!ja._shut[e.title||e.name]){if(t){if(ja.opts.dw)return;if(ja._wblock[t])return}a=Ge(a=function(e){return!!e.includes("http")&&!!Ca.test(e)&&($.post("/report",{target:ja.id,submitter:"BadURL_AutoChecker",reason:`${e}`}),alert("유해 링크로 판단되어 자동으로 신고처리 되었습니다."),!0)}(a)?"유해 링크로 판단되어 검열되었습니다.":a,ja.users[e.id]),Ze("k"),Ye(),!va&&ja.room&&(i=(ja.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),function(e,a,t){$("#cb-"+a).remove();var r,i,o=(2&t?$("#game-user-"+a):$("#room-user-"+a)).offset(),n=2==t?"chat-balloon-bot":"chat-balloon-tip",s=$("<div>").addClass("chat-balloon").attr("id","cb-"+a).append($("<div>").addClass("jt-image "+n))[2==t?"prepend":"append"]($("<h4>").html(e));o&&(fa.balloons.append(s),1==t?(r=0,i=220):2==t?(r=35-s.height(),i=-2):3==t?(r=5,i=210):(r=40,i=110),s.css({top:o.top+r,left:o.left+i}),g(function(){s.animate({opacity:0},500,function(){s.remove()})},2500))}(a,e.id,i)),fa.chat.append(n=$("<div>").addClass("chat-item").append(i=$("<div>").addClass(`chat-head ellipse ${p}`).text(e.title||e.name)).append(o=$("<div>").addClass("chat-body").html(a)).append($("<div>").addClass("chat-stamp").text(c.toLocaleTimeString()))),r&&i.prepend($("<i>").addClass("fa fa-video-camera")),i.on("click",function(a){ja.admin&&a.shiftKey?(m(fa.dialog.management),$("#target-id").text(e.id),$("#target-nickname").text(ja.users[e.id].nickname)):te(e.id)}),fa.chatLog.append(n=n.clone()),n.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(e.id||"").substr(0,5))),(s=a.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(a=o.html(),s.forEach(function(e){a=a.replace(e,`<a href='#' style='color: #2222FF;' onclick='if(confirm("${L.linkWarning}")) window.open("${e}");'>${e}</a>`)}),o.html(a)),t&&(!0!==t&&(ja._recentFrom=t),o.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+o.html())),F(i,{equip:u}),fa.chat.scrollTop(999999999)}}function Qe(e,a){var t=new Date;Ze("k"),Ye(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(a||L.notice)).append($("<div>").addClass("chat-body").text(e)).append($("<div>").addClass("chat-stamp").text(t.toLocaleTimeString()))),fa.chat.scrollTop(999999999),"tail"==a&&console.warn(t.toLocaleString(),e)}function Ye(){var e=$("#Chat .chat-item"),a=$("#chat-log-board .chat-item");e.length>99&&e.first().remove(),a.length>199&&a.first().remove()}function Xe(e){var a;return a="$"==e.charAt()?ja.shop[e.slice(0,4)]:ja.shop[e],{_id:e,group:a.group,term:a.term,name:ea(e),cost:a.cost,image:ta(e,a),desc:aa(e),options:a.options}}function ea(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function aa(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function ta(e,a){var t,r;if(e){if("$"==e.charAt())return function(e,a){var t,r=document.createElement("canvas"),i=r.getContext("2d");switch(r.width=r.height=50,i.font="24px NBGothic",i.textAlign="center",i.textBaseline="middle",e){case"WPE":case"WPC":case"WPB":case"WPA":t=["WPE","WPC","WPB","WPA"].indexOf(e),i.beginPath(),i.arc(25,25,25,0,2*Math.PI),i.fillStyle=["#FFCC00","#DDDDDD","#A6C5FF","#FFEF31"][t],i.fill(),i.fillStyle=["#000000","#000000","#4465C3","#E69D12"][t],i.fillText(a,25,25)}return r.toDataURL()}(e.slice(1,4),e.slice(4))}else"string"==typeof a&&(a={_id:"def",group:a,options:{}});return r=(t=ja.shop[e]||a).options.hasOwnProperty("gif")?".gif":".png","BDG"==t.group.slice(0,3)?`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/moremi/badge/`+t._id+r:"M"==t.group.charAt(0)?`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/moremi/`+("heco"!=t.group.slice(1)?t.group.slice(1):"head")+"/"+t._id+r:`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/shop/`+t._id+".png"}function ra(e){fa.dialog.obtain.is(":visible")?ja._obtain.push(e):(ia(e),m(fa.dialog.obtain,!0))}function ia(e){Ze("success"),$("#obtain-image").css("background-image","url("+ta(e.key)+")"),$("#obtain-name").html(ea(e.key))}function oa(e,a,t){var r,i,o=a.MSKIN,n=$(e).empty(),s={Mlhand:"Mhand",Mrhand:"Mhand"};if("shop"!==t){var l=ja.users[t];if(void 0!==l)var d=l.data.rankPoint<5e3?We(l.data.rankPoint,null,null):Je(l)}if(o){if("hide_moremi"==o){for(r in ca)i="M"+ca[r],n.append($("<img>").addClass("moremies moremi-"+i.slice(1)).attr("src",`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/def.png`).css({width:"100%",height:"100%"}));return}}else o="def";for(r in a||(a={}),ca)i="M"+ca[r],n.append($("<img>").addClass("moremies moremi-"+i.slice(1)).attr("src",ta(a[i],s[i]||i)).css({width:"100%",height:"100%"}));(i=a.BDG)&&n.append($("<img>").addClass("moremies moremi-badge").attr("src",ta(i)).css({width:"100%",height:"100%"})),n.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",a.robot?`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/moremi/robot.png`:`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/moremi/skin/${o}.png`).css({width:"100%",height:"100%"})),n.children(".moremi-rhand").css("transform","scaleX(-1)"),"shop"!=t&&null!=l&&"UNRANKED"!==d&&n.append($("<img>").addClass("moremies moremi-tier").attr("src",`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/rankedge/`+d+".png").css({width:"100%",height:"100%"}))}function na(e){var a=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();a.test(e);)e=e.replace(a,"$1,$2");return e}function sa(e){return alert(L["error_"+e])}function la(e){fa.yell.show().css("opacity",1).html(e),g(function(){fa.yell.animate({opacity:0},3e3),g(function(){fa.yell.hide()},3e3)},1e3)}var da,ca,ma,ua,pa,ga,ha,fa,$a,va,ka=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],ba={profile:{title:L.null},data:{score:0}},_a=30,ya=[],wa="bwBuAGwAeQBiAGYAawBrAHUAdAB1AGMAYQBuAHIAZQBhAGQAdABoAGkAcwBmAGkAbABlAHQAaABhAHQAdgBlAHIAaQBmAGkAZQBkAGIAeQBiAGYAawBrAHUAdAB1AGMAbABpAGUAbgB0AA==",Ca=new RegExp(["(시|싀|쉬|슈|씨|쒸|씌|쓔|쑤|시이{1,}|싀이{1,}|쉬이{1,}|씨이{1,}|쒸이{1,}|씌이{1,}|찌이{1,}|스|쓰|쯔|스으{1,}|쓰으{1,}|쯔으{1,}|수우{1,}|쑤우{1,}|십|싑|쉽|슙|씹|쓉|씝|쓥|씁|싶|싚|슆|슾|앂|씦|쓒|씊|쑾|ㅅ|ㅆ|ㅅㅣ{1,}|ㅅ이{1,}|ㅆ이{1,}|c|c이{1,}|C|C이{1,}|Ⓒ|Ⓒ이{1,}|^^ㅣ|^^I|^^l)[^가-힣]*(바|발|팔|빠|빨|불|벌|벨|밸|빠|ㅂ|ㅃ|ㅍ)","(뷩|병|뱡|뱅|뱡|빙|븅|븽|뷰웅|비잉|볭|뱽|뼝|뺑|쁑|삥|삉|뺭|뼈엉|쀼웅|ㅂ)[^가-힣]*(쉰|신|싄|슨|씬|씐|진|즨|ㅅ|딱|시인|시나)","(샛|섓|쌧|썠|쌨|샜|섔|쌨|썠|새|섀|세|셰|썌|쎼)[^가-힣]*(기|끼|끠|애끼|에끼)","(저새|저색|저샛|저쉑|저샛|저셋|저섀|저셰|저쌔|저쎄|저썌|저쎼)[^가-힣]*(기|애{1,}기|에{1,}기|)","(개|게|걔|깨|께|꼐|꺠)[^가-힣]*(같|새|샛|세|섀|셰)","(니|닝|느|노|늬|너|쟤|걔|ㄴ)[^가-힣]*(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄{1,}마|검{1,}마|검|금|앰|앱|애{1,}비|애{1,}미|에{1,}미|에{1,}비|애{1,}믜|애{1,}븨|아{1,}빠|엄{1,}빠|의미|의비|븨|믜)","(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄마|검마|앰|아빠|엄빠)[^가-힣]*(죽|뒤|돌|없)","(앰|엠|얨|옘|앱|엡|옙|얩)[^가-힣]*(창|챵|촹|생|섕|셍|솅|쉥)","(세|섹|색|쉑|쇡|세엑{1,}크|세액{1,}크|세크|새크|새에{1,}크|새애{1,}크|셍|셱|섁|세그|세엑|세액|세에{1,}엑|세애{1,}액|쎅|쎽|쎆|쎾|셲)[^가-힣]*(ㅅ|스|슥|슨|슫|슷|승|로스)","(ㅈ|젓|젔|젇|젖|좟|좠|좓|좢)[^가-힣]*(뒏|됟|됫|됬|됏|됐|됃|같|갇|까|가|까)","(자|쥬|자아{1,}|잠|좌|좌아{1,}|잗|잣|쟈|쟈아{1,}|보|뷰|보오{1,}|볻|봇|뵤)[^가-힣]*(지|짓|짇|즤|즫|즷|즹|빨)","(질|입|안|밖)[^가-힣]*(싸)","(후|훚|훗|훋)[^가-힣]*(장|쟝|좡)","(꼬|보|딸|똘|빡)[^가-힣]*(추)","(미친|잡|쓰레기|거지|그지|똥|ㅣ발)[^가-힣]*(녀석|놈|충|자식|냐|냔|세|네|것)","미친","(버|벅|뻐|뻑|퍼|퍽)[^가-힣]*(큐|뀨)","(호)[^가-힣]*(로|모|구)","(스|수|쓰|쑤|쓔|스으{1,}|수우{1,}|슈우{1,}|쓰우{1,}|쑤으{1,}|쓔으{1,})[^가-힣]*(랙|렉|럑|롁|랚|렊|럒|롂)","(지|즤|디|G|ㅣ|치|찌|지이|지이{1,}|즤이{1,}|G이{1,}|즤|G이)[^가-힣]*(랄|라알)","(딸)[^가-힣]*(딸|치|쳐|쳤|침)","발[^가-힣]*기","풀[^가-힣]*발","딸[^가-힣]*딸","강[^가-힣]*간","자[^가-힣]*위","부[^가-힣]*랄","불[^가-힣]*알","오[^가-힣]*르[^가-힣]*가[^가-힣]*즘","처[^가-힣]*녀[^가-힣]*막","질[^가-힣]*내","질[^가-힣]*외","정[^가-힣]*액","자[^가-힣]*궁","생[^가-힣]*리","월[^가-힣]*경","페[^가-힣]*도","또[^가-힣]*라[^가-힣]*이","장[^가-힣]*애","종[^가-힣]*간","쓰[^가-힣]*레[^가-힣]*기","무[^가-힣]*뇌","학[^가-힣]*식[^가-힣]*충","급[^가-힣]*식[^가-힣]*충","버[^가-힣]*러[^가-힣]*지","찌[^가-힣]*꺼[^가-힣]*기","삐[^가-힣]*꾸","닥[^가-힣]*쳐","꺼[^가-힣]*져","애[^가-힣]*자","찌[^가-힣]*그[^가-힣]*레[^가-힣]*기","대[^가-힣]*가[^가-힣]*리","면[^가-힣]*상","와[^가-힣]*꾸","시[^가-힣]*빠[^가-힣]*빠","파[^가-힣]*오[^가-힣]*후","사[^가-힣]*까[^가-힣]*시","씹[^가-힣]*덕","애[^가-힣]*미","엿[^가-힣]*먹","애[^가-힣]*비","새[^가-힣]*끼","줬[^가-힣]*까","(뒤)[^가-힣]*(져|진|졌|질|짐)","살[^가-힣]*지[^가-힣]*마","자[^가-힣]*살[^가-힣]*(해|하|헤)","자[^가-힣]*살","살[^가-힣]*해","(좆|좃|좄|졷|줫|줮|줟|죶|죳|죴|죧|조오{1,}|조옷{1,}|조옺{1,})","(좆|좃|좄|졷|줫|줮|줟|죶|죳|죴|죧|존|조오{1,}|조옷{1,}|조옺{1,})[^가-힣]*나","씹|씹","봊|봊","잦|잦","(섹|섻)","썅|썅","ㅗ{1,}","ㅄ|ㅄ","ㄲㅈ|ㄲㅈ","(ㅈ)[^가-힣]*(ㅂㅅ|ㄲ|ㄹ|ㄴ)","조[^가-힣]*건[^가-힣]*만[^가-힣]*남","(f|F)[^A-Za-z]*(u|U)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(d|D)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(m|M)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(m|M)[^A-Za-z]*(n|N)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(b|B)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(c|C)[^A-Za-z]*(h|H)","(d|D)[^A-Za-z]*(i|I)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*x","(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(c|C)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(t|T)","(p|P)[^A-Za-z]*(u|U)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(y|Y)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(g|G)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(a|A)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(r|R)[^A-Za-z]*(o|O)","(j|J)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(m|M)[^A-Za-z]*(u|U)[^A-Za-z]*(f|F)[^A-Za-z]*(f|F)","(p|P)[^A-Za-z]*(i|I)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)","(r|R)[^A-Za-z]*(e|E)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(s|S)[^A-Za-z]*(l|L)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(t|T)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(s|S)","(t|T)[^A-Za-z]*(r|R)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)","(t|T)[^A-Za-z]*(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)","(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(w|W)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(r|R)[^A-Za-z]*(e|E)","(s|S)[^A-Za-z]*(i|I)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)","(g|G)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(a|A)[^A-Za-z]*(k|K)[^A-Za-z]*(i|I)","(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(l|L)[^A-Za-z]*(e|E)","(t|T)[^A-Za-z]*(l|L)[^A-Za-z]*q[^A-Za-z]*(k|K)[^A-Za-z]*(f|F)","(t|T)[^A-Za-z]*(p|P)[^A-Za-z]*(r|R)[^A-Za-z]*(t|T)[^A-Za-z]*(m|M)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*(e|E)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)","PORN"].join("|")),La=new RegExp(["(&lt;|<)(i|I)(m|M)(g|G)","(&lt;|<)(s|S)(c|C)(r|R)(i|I)(p|P)(t|T)","(&lt;|<)(h|H)(1|2|3|4|5|6)","(&lt;|<)(a|A)"].join("|")),xa=new RegExp(["(끄투|끄)[^가-힣]*(코리아|코)","(끄투|끄)[^가-힣]*(닷)[^가-힣]*(컴)","(끄)[^가-힣]*(닷)","(끄투)[^가-힣]*(리오)","(끄투)[^가-힣]*(한국)","(끄)[^가-힣]*(리)","(끄)[^가-힣]*(한)","(태풍)[^가-힣]*(끄튬|끄툼|끄투)","(분홍|핑크|핑크빛)[^가-힣]*(끄투)","(투데이)[^가-힣]*(끄투)","(이름)[^가-힣]*(없는)[^가-힣]*(끄투)","(김)[^가-힣]*(대|머)[^가-힣]*(운)","(리)[^가-힣]*(오)","(행)[^가-힣]*(끄|끄투)","(끄투|끄)[^가-힣]*(플러스|플)","(뜨|뚜)[^가-힣]*(투|트)","(나비|케이니|오메가|투데이)[^가-힣]*(끄투|그투)"].join("|")),Ta=new RegExp(["kkutu.co.kr","kkutu.club","kkutu.io","typhoonkkuteum.kro.kr","kkutu.pinkflower.kro.kr","kkutu.today","kkutu.org","edutu.kro.kr","kkutu.pw"].join("|")),Aa={},Sa=(new Audio,{}),ja={},Da=!1,qa={Classic:{},DaneoClassic:{},Jaqwi:{},Crossword:{},Typing:{},Reverse:{},Hunmin:{},Daneo:{},Sock:{},Drawing:{}},Ra=!!window.hasOwnProperty("AudioContext")&&new AudioContext,Ba=window.WebSocket,Oa=setInterval,za=setTimeout;$(document).ready(function(){function e(e,a){var t,r;for(t in pa)r=pa[t].name.toLowerCase(),-1==e.indexOf(t)?$("#"+a+"-"+r+"-panel").hide():$("#"+a+"-"+r+"-panel").show()}function a(e){var a,t,r={};for(a in pa)t=pa[a].name.toLowerCase(),$("#"+e+"-"+t).is(":checked")&&(r[t]=!0);return r}function t(e,a,t,r,i){var o;if(!i){if(e.gaming)return!1;if(e.password)return!1;if(e.players.length>=e.limit)return!1}if(e.mode!=a)return!1;if(-1==r&&e.time!=r)return!1;for(o in t)if(!e.opts[o])return!1;return!0}function r(e){$(".team-selector").hasClass("team-unable")||l("team",{value:$(e.currentTarget).attr("id").slice(5)})}function i(){fa.dialog.replayView.attr("disabled",!0)}function o(){(ga=new Ba(ja.URL)).onopen=function(e){d()},ga.onmessage=_onMessage=function(e){f(JSON.parse(e.data))},ga.onclose=function(e){var a=L.closed+" (#"+e.code+")";ha&&ha.close(),Me(),x(a),$.get("/kkutu_notice.html",function(e){d(e),Ma=!1})},ga.onerror=function(e){console.warn(L.error,e)}}var n;for(Oa(function(){Ma&&(l("wsrefresh"),ja.room&&l("wsrefresh",void 0,!0))},18e3),ja.PUBLIC="true"==$("#PUBLIC").html(),ja.URL=$("#URL").html(),ja.version=$("#version").html(),ja.server=location.href.match(/\?.*server=(\d+)/)[1],ja.shop={},ja._okg=0,ja._playTime=0,ja._kd="",ja._timers=[],ja._obtain=[],ja._wblock={},ja._shut={},ja.usersR={},ya.push(De(1)),n=2;n<366;n++)ya.push(ya[n-2]+De(n));if(ya[365]=1/0,ya.push(1/0),fa={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),chatLog:$("#chat-log-board"),talk:$(".ChatBox input").last(),chatBtn:$(".ChatBox button").last(),menu:{help:$("#HelpBtn"),inquire:$("#InquireBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),cursing:$("#CursingBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),reloadRoom:$("#ReloadRoom"),Clan:$("#ClanBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),findUser:$("#FindUserBtn"),leaderboard:$("#LeaderboardBtn"),rankpointlb:$("#RPLeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),inquire:$("#InquireDiag"),inquireSubmitDiag:$("#InquireSubmitDiag"),inquireDetailDiag:$("#InquireDetailDiag"),inquireWrite:$("#inquire-write"),inquireLoad:$("#inquire-load"),community:$("#CommunityDiag"),cursing:$("#CursingDiag"),cursingValue:$("#CursingDiag #cursing-value").first(),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),clanDiag:$("#ClanDiag"),newClanDiag:$("#NewClanDiag"),viewClanDiag:$("#ViewClanDiag"),newClan:$("#newClan"),makeClan:$("#makeClan"),kickUser:$("#kickUser"),extendMax:$("#extendMax"),viewClan:$("#viewClan"),leaveClan:$("#leaveClan"),joinClan:$("#joinClan"),deleteClan:$("#deleteClan"),tail:$("#TailDiag"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),findUser:$("#FindUserDiag"),rank:$("#rank"),lp:$("#rankpoint"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),profileReport:$("#profile-report"),profileFriendAdd:$("#profile-friendadd"),profileCopyID:$("#profile-copyid"),management:$("#ManagementDiag"),managementBan:$("#MngBanDiag"),mngKick:$("#mngKick"),mngBan:$("#mngBan"),mngBanSubmit:$("#ban-submit"),mngBanPermanent:$("#ban-permanent"),findIDOK:$("#find-id-ok"),findNickOK:$("#find-nick-ok"),reportDiag:$("#ReportDiag"),reportSubmit:$("#report-submit"),inquireSubmit:$("#inquire-submit"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),rankpointlb:$("#RPLeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),rplbTable:$("#rpranking tbody"),rplbPage:$("#rplb-page"),rplbNext:$("#rplb-next"),rplbMe:$("#rplb-me"),rplbPrev:$("#rplb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),alertKKuTu:$("#AlertDiag"),alertKKuTuOK:$("#alert-ok"),promptKKuTu:$("#PromptDiag"),promptKKuTuOK:$("#prompt-ok"),popupKKuTu:$("#PopupDiag"),confirmKKuTu:$("#ConfirmDiag"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),tools:$(".GameBox .tools"),drawingTitle:$("#drawing-title"),themeisTitle:$("#themeis-title"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==Ba)return d(L.websocketUnsupport),void alert(L.websocketUnsupport);for(ja._soundList=[{key:"k",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/k.mp3"},{key:"lobby",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_newbfkkutu.mp3"},{key:"1",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_Blanding_Future.mp3"},{key:"2",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_bf.mp3"},{key:"3",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_newbfkkutu.mp3"},{key:"4",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_newstart.mp3"},{key:"5",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_tlok.mp3"},{key:"6",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/LB_original.mp3"},{key:"jaqwi",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/game_start.mp3"},{key:"round_start",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/round_start.mp3"},{key:"fail",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/fail.mp3"},{key:"timeout",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/timeout.mp3"},{key:"lvup",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/lvup.mp3"},{key:"Al",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/Al.mp3"},{key:"success",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/success.mp3"},{key:"missing",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/missing.mp3"},{key:"mission",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/mission.mp3"},{key:"kung",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/kung.mp3"},{key:"horr",value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/horr.mp3"}],n=0;n<=10;n++)ja._soundList.push({key:"T"+n,value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/T"+n+".mp3"},{key:"K"+n,value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/K"+n+".mp3"},{key:"As"+n,value:"https://cdn.jsdelivr.net/npm/bfkkutudelivr@latest/media/kkutu/As"+n+".mp3"});for(n in Ne(ja._soundList,function(){we(o)}),ja.admin||delete ja._soundList,ca=$("#MOREMI_PART").html().split(","),ma=$("#AVAIL_EQUIP").html().split(","),ua=JSON.parse($("#RULE").html()),pa=JSON.parse($("#OPTIONS").html()),da=Object.keys(ua),(va="true"==$("#mobile").html())&&(_a=200),ja._timePercent=function(){return 100-(ja._turnSound.audio?ja._turnSound.audio.currentTime:Ra.currentTime-ja._turnSound.startedAt)/ja.turnTime*1e5+"%"},ja.setRoom=function(e,a){var t="for-lobby"==q();null==a?(ja.admin||delete ja.rooms[e],t&&$("#room-"+e).remove()):(t&&!ja.rooms[e]&&fa.lobby.roomList.append($("<div>").attr("id","room-"+e)),ja.rooms[e]=a,t&&$("#room-"+e).replaceWith(M(a)))},ja.setUser=function(e,a){var t,r=q(),i="for-lobby"==r||"for-master"==r;ja._replay?$a.users[e]=a:null==a?(ja.admin||delete ja.users[e],i&&$("#users-item-"+e+",#invite-item-"+e).remove()):(i&&!ja.users[e]&&(t=P(a,"for-master"==r),"for-master"==r?fa.dialog.inviteList.append(t):fa.lobby.userList.append(t)),ja.users[e]=a,i&&(t?$("#"+t.attr("id")).replaceWith(t):$("#"+("for-lobby"==r?"users-item-":"invite-item")+e).replaceWith(P(a,"for-master"==r))))},$(document).on("paste",function(e){if(ja.room&&ja.room.gaming)return e.preventDefault(),!1}),fa.talk.on("drop",function(e){if(ja.room&&ja.room.gaming)return e.preventDefault(),!1}),ja.opts=$.cookie("kks"),ja.opts&&u(JSON.parse(ja.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var a=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),a.addClass("dialog-front"),function(e,a,t){var r=e.position();$(window).on("mousemove",function(i){var o=i.pageX-a,n=i.pageY-t;e.css("left",r.left+o),e.css("top",r.top+n)})}(a,e.pageX,e.pageY)}).on("mouseup",function(e){$(window).off("mousemove")}),fa.chatBtn.on("click",function(e){var a=va&&fa.game.here.is(":visible")?fa.game.hereText.val():fa.talk.val(),t={value:a.trim()};a&&("/"==t.value[0]?(t.cmd=t.value.split(" "),C(t.cmd)):((fa.game.here.is(":visible")||ja._relay)&&(t.relay=!0),l("talk",t)),ja._whisper?(fa.talk.val("/e "+ja._whisper+" "),ja.admin||delete ja._whisper):fa.talk.val(""),fa.game.hereText.val(""))}).hotkey(fa.talk,13).hotkey(fa.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){if(!t.trim())return;var a=$(e.currentTarget),t=a.val();l("talk",{relay:!0,data:ja._sel,value:t.trim()}),a.val("")}}).on("focusout",function(e){$(".cw-q-body").empty(),fa.game.cwcmd.css("opacity",0)}),$("#tail-btn").on("click",function(e){l("talk",{relay:!1,data:ja._sel,value:"#"+$("#tail-input").val().trim()}),$("#tail-input").val("")}),$("#room-limit").on("change",function(e){var a=$(e.currentTarget),t=a.val();t<2||t>8?a.css("color","#FF4444"):a.css("color","")}),$("#room-round").on("change",function(e){var a=$(e.currentTarget),t=a.val();t<1||t>10?a.css("color","#FF4444"):a.css("color","")}),$("#room-wordLimit").on("change",function(e){var a=$(e.currentTarget),t=a.val();t<2||t>9?a.css("color","#FF4444"):a.css("color","")}),fa.game.here.on("click",function(e){va||fa.talk.focus()}),fa.talk.on("keyup",function(e){fa.game.hereText.val(fa.talk.val())}),$(window).on("beforeunload",function(e){if(ja.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),fa.dialog)fa.dialog[n].children(".dialog-head").hasClass("no-close")||fa.dialog[n].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(fa.menu.help.on("click",function(e){$("#help-board").attr("src","/help"),m(fa.dialog.help)}),fa.menu.setting.on("click",function(e){m(fa.dialog.setting)}),fa.menu.community.on("click",function(e){if(ja.guest)return sa(451);m(fa.dialog.community)}),fa.dialog.commFriendAdd.on("click",function(e){var a=prompt(L.friendAddNotice);if(a)return ja.users[a]?void l("friendAdd",{target:a},!0):sa(450)}),fa.menu.newRoom.on("click",function(e){var a,t=$("#room-selecttheme").is(":checked"),r=ua[da[$("#room-mode").val()]];void 0!==r.ijr||r.opts.includes("ijp")?t&&!r.ijr?($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):t||r.ijr?r.ijr&&($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-injeong-pick").hide()):($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").hide()),fa.dialog.quick.hide(),ja.typeRoom="enter",m(a=fa.dialog.room),a.find(".dialog-title").html(L.newRoom)}),fa.menu.setRoom.on("click",function(e){var a,t,r,i=ua[da[ja.room.mode]],o=$("#room-selecttheme").is(":checked"),n=ua[da[$("#room-mode").val()]];for(t in ja.typeRoom="setRoom",$("#room-title").val(ja.room.title),$("#room-limit").val(ja.room.limit),$("#room-mode").val(ja.room.mode).trigger("change"),$("#room-round").val(ja.room.round),$("#room-wordLimit").val(ja.room.wordLimit),$("#room-time").val(ja.room.time/i.time),pa)r=pa[t].name.toLowerCase(),$("#room-"+r).attr("checked",ja.room.opts[r]);ja._injpick=ja.room.opts.injpick,void 0!==n.ijr||n.opts.includes("ijp")?o&&!n.ijr?($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):o||n.ijr?n.ijr&&($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-injeong-pick").hide()):($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").hide()),m(a=fa.dialog.room),a.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(r){var i,o,n=$("#quick-mode").val(),s=$("#quick-time").val(),l=0;for(i in"quick-mode"==r.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),o=a("quick"),e(ua[da[n]].opts,"quick"),e(ua[da[n]].time,"quick"),ja.rooms)t(ja.rooms[i],n,o,s,!0)&&l++;$("#quick-status").html(L.quickStatus+" "+l)}),fa.menu.quickRoom.on("click",function(e){fa.dialog.room.hide(),m(fa.dialog.quick),fa.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-time").trigger("change"),$("#quick-queue").html(""),fa.dialog.quickOK.removeClass("searching").html(L.OK))}),fa.dialog.quickOK.on("click",function(e){function r(){var e,a=[];if(fa.dialog.quick.is(":visible")){for(e in $("#quick-queue").html(L.quickQueue+" "+z(1e3*ja._quickn++)),ja.rooms)t(ja.rooms[e],i,n,o)&&a.push(e);a.length&&(e=a[Math.floor(Math.random()*a.length)],ja._preQuick=!0,$("#room-"+e).trigger("click"))}else clearTimeout(ja._quickT)}var i=$("#quick-mode").val(),o=$("#quick-time").val(),n=a("quick");if("for-lobby"==q()){if(fa.dialog.quickOK.hasClass("searching"))return r(),clearTimeout(ja._quickT),$("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-queue").html(""),fa.dialog.quickOK.removeClass("searching").html(L.OK);$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),fa.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),ja._quickn=0,ja._quickT=p(r,1e3)}}),fa.dialog.injPickOK.on("click",function(e){var a=$(ja._ijkey+"list"),r=[],i=$(".dialog-opt#ko-pick-list").find("input").is(":checked");ua[da[$("#room-mode").val()]];i||t.ijr||($("#room-selecttheme")[0].checked=!1,$("#room-selecttheme-panel").show(),$("#room-injeong-pick").hide()),ja._injpick=a.find("input").each(function(e,a){var t=$(a),i=t.attr("id").slice(8);t.is(":checked")&&r.push(i)}),ja._injpick=r,fa.dialog.injPick.hide()}),$("#room-mode").on("change",function(a){var t=$("#room-mode").val(),r=$("#room-selecttheme").is(":checked"),i=ua[da[t]];$("#room-selecttheme").change(function(){$("#room-selecttheme")[0].checked?($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-injeong-pick").hide())}),$("#room-wordLimit-panel").hide(),$("#game-mode-expl").html(L["modex"+t]),e(i.opts,"room"),ja._injpick=[],"Typing"==i.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,a){$(a).html(Number($(a).val())*i.time+L.SECOND)}),$("#quick-time").children("option").each(function(e,a){-1==$(a).val()?$(a).html("상관 없음"):$(a).html(Number($(a).val())*i.time+L.SECOND)}),fa.dialog.quick.is(":visible")||-1==i.opts.indexOf("ijp")||$("#room-injeong-pick").show(),void 0!==i.ijr||i.opts.includes("ijp")?r&&!i.ijr?($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):r||i.ijr?i.ijr&&($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-injeong-pick").hide()):($("#room-selecttheme-panel").hide(),$("#room-injeong-pick").hide())}).trigger("change"),fa.menu.spectate.on("click",function(e){fa.menu.spectate.hasClass("toggled")?(l("form",{mode:"J"}),fa.menu.spectate.removeClass("toggled")):(l("form",{mode:"S"}),fa.menu.spectate.addClass("toggled"))}),fa.menu.shop.on("click",function(e){(ja._shop=!ja._shop)?(function(){var e=$("#shop-shelf");e.html(L.LOADING),we(function(a){if(e.empty(),ja.guest&&(a.error=423),a.error)return fa.menu.shop.trigger("click"),sa(a.error);a.goods.sort(function(e,a){return a.updatedAt-e.updatedAt}).forEach(function(a,t,r){if(!(a.cost<0)){var i=ta(!1,a);e.append($("<div>").attr("id","goods_"+a._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+i+")")).append($("<div>").addClass("goods-title").html(ea(a._id))).append($("<div>").addClass("goods-cost").html(na(a.cost)+L.ping)).append(ye(a,!1)).on("click",Ce))}}),global.expl(e)}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}(),fa.menu.shop.addClass("toggled")):fa.menu.shop.removeClass("toggled"),R()}),fa.menu.inquire.on("click",function(e){m(fa.dialog.inquire)}),fa.dialog.inquireWrite.on("click",function(e){ja.users[ja._profiled];$("#inquire-text").val(""),m(fa.dialog.inquireSubmitDiag),$("#inquirer").text(ja.id)}),fa.dialog.inquireLoad.on("click",function(e){fa.loading.show(),$.get(`/inquire?id=${ja.id}`,function(e){var a=$("#inquiries tbody").empty();fa.loading.hide();for(let t in e)inquiry=JSON.parse(e[t]).inquiry,answer=JSON.parse(e[t]).answer,a.append($("<tr>").append($("<td>").text(Number(t)+1)).append($("<td>").text(inquiry.title)).append($("<td>").text(answer.answered?L.inquire_answered:L.inquire_waiting)).append($("<td>").append($(`<button id="showdetail_${inquiry.submitter}_${inquiry.date}">`).text(L.inquire_showdetail)))),$(`#showdetail_${inquiry.submitter}_${inquiry.date}`).click(function(){fa.loading.show(),$("#inquiry-detail-date").val(JSON.parse(e[t]).inquiry.date),$("#inquiry-detail-title").val(JSON.parse(e[t]).inquiry.title),$("#inquiry-detail-body").val(JSON.parse(e[t]).inquiry.body),JSON.parse(e[t]).answer.answered?($("#answer-detail-name").show().val(JSON.parse(e[t]).answer.nickname),$("#answer-detail-date").show().val(JSON.parse(e[t]).answer.date),$("#answer-detail-body").show().val(JSON.parse(e[t]).answer.body),$("#inquiry-detail-answerer").show(),$("#inquiry-detail-text").show(),$("#inquiry-detail-description").text(L.answer_date).css("width","")):($("#answer-detail-name").hide(),$("#answer-detail-date").hide(),$("#answer-detail-body").hide(),$("#inquiry-detail-answerer").hide(),$("#inquiry-detail-text").hide(),$("#inquiry-detail-description").text("아직 답변되지 않은 문의입니다.").css("width","100%")),m(fa.dialog.inquireDetailDiag),fa.loading.hide()})})}),fa.dialog.inquireSubmit.on("click",function(e){if(""==$("#inquire-text").val())return alert("문의 내용을 입력해주세요.");$.post("/inquire",{inquirer:$("#inquirer").text(),sender:ja.id,nickname:ja.nickname,title:$("#inquire-title").val(),data:$("#inquire-text").val()},function(e){200==e.result?alert("문의가 접수되었습니다."):alert("문의 접수에 실패했습니다.")})}),$(".shop-type").on("click",function(e){var a=$(e.currentTarget),t=a.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),a.addClass("selected"),function(e){var a,t,r,i=!0===e;for(r in i||(e=e.split(",")),ja.shop)(t=ja.shop[r]).cost<0||(a=$("#goods_"+r).show(),i||-1==e.indexOf(t.group)&&a.hide())}("all"==t||a.attr("value"))}),fa.menu.dict.on("click",function(e){m(fa.dialog.dict)}),fa.menu.wordPlus.on("click",function(e){m(fa.dialog.wordPlus)}),fa.menu.reloadRoom.on("click",function(e){$("#roomlist-loading").show(),Z(!0),N(!0)}),fa.menu.Clan.on("click",function(e){Da||k(ja.id),m(fa.dialog.clanDiag),$.get("/clan/list",function(e){var a,t=e.list;for(a in $("#clanList tbody").empty(),t)$("#clanList").append($("<tr>").attr("id","clan-"+t[a].name).addClass("clan-"+t[a].name).append($("<td>").html(t[a].name)).append($("<td>").html(t[a]._id)).append($("<td>").html(t[a].score)))})}),fa.menu.invite.on("click",function(e){m(fa.dialog.invite),N(!0)}),fa.menu.practice.on("click",function(e){ua[da[ja.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),m(fa.dialog.practice)):l("practice",{level:-1})}),fa.menu.ready.on("click",function(e){l("ready")}),fa.menu.start.on("click",function(e){l("start")}),fa.menu.exit.on("click",function(e){if(ja.room.gaming){if(!confirm(L.sureExit))return;ja._spaced&&qa.Typing.spaceOff(),clearInterval(ja._tTime),ja._relay=!1}ha.close(),l("leave")}),fa.menu.replay.on("click",function(e){ja._replay&&ue(),m(fa.dialog.replay),i(),fa.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),fa.menu.leaderboard.on("click",function(e){ja._lbpage=0,fa.dialog.leaderboard.is(":visible")?fa.dialog.leaderboard.hide():$.get("/ranking",function(e){X(e),m(fa.dialog.leaderboard)})}),fa.dialog.mngKick.on("click",function(e){A(`${$("#target-nickname").text()}님을 강퇴하시겠습니까?`,e=>{$("#tail-input").val(`kick ${$("#target-id").text()}`),$("#tail-btn").trigger("click"),fa.dialog.management.hide(),fa.dialog.confirmKKuTu.hide(),x(`${$("#target-nickname").text()}님을 강퇴했습니다.`)},e=>{fa.dialog.confirmKKuTu.hide()})}),fa.dialog.mngBan.on("click",function(e){m(fa.dialog.managementBan)}),fa.dialog.mngBanSubmit.on("click",function(e){$("#target-id").val();var a,t=$("#ban-reason").val(),r=$("#ban-permanent").is(":checked")?"영구":$("#ban-date").val(),i=new Date,o="";return""==t?x("차단 사유를 입력해주세요."):"영구"!=r&&0==Number(r)?x("차단 기간을 입력해주세요."):("영구"!=r?(i.setTime(i.getTime()+24*Number(r)*60*60*1e3),o=`${$("#target-nickname").text()}님을 차단하시겠습니까?<p></p>사유: ${t}<br></br>기간: ${r}일<br></br>종료일: ${i.getFullYear()}년 ${i.getMonth()+1}월 ${i.getDate()}일 ${i.getHours()}시 ${i.getMinutes()}분`):o=`${$("#target-nickname").text()}님을 영구적으로 차단하시겠습니까?<p></p>사유: ${t}<br></br>기간: 영구`,a=`${i.getFullYear()}${i.getMonth()+1}${i.getDate()}${i.getHours()}${i.getMinutes()}${i.getSeconds()}`,void A(o,e=>{$("#tail-input").val(`ban ${$("#target-id").text()},${t},${"영구"!=r?a:"영구"}`),$("#tail-btn").trigger("click"),fa.dialog.managementBan.hide(),fa.dialog.management.hide(),fa.dialog.confirmKKuTu.hide(),x("영구"!=r?`${$("#target-nickname").text()}님을 차단했습니다.<p></p>사유: ${t}<br></br>기간: ${r}<br></br>종료일: ${i.getFullYear()}년 ${i.getMonth()+1}월 ${i.getDate()}일 ${i.getHours()}시 ${i.getMinutes()}분`:`${$("#target-nickname").text()}님을 영구적으로 차단했습니다.<p></p>사유: ${t}<br></br>기간: 영구`)},e=>{fa.dialog.confirmKKuTu.hide()}))}),fa.dialog.mngBanPermanent.on("change",function(e){$("#ban-date").attr("disabled",$("#ban-permanent").is(":checked"))}),fa.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(ja._lbpage-1),function(e){X(e)})}),fa.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+ja.id,function(e){X(e)})}),fa.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(ja._lbpage+1),function(e){X(e)})}),fa.menu.rankpointlb.on("click",function(e){ja._rplbpage=0,fa.dialog.rankpointlb.is(":visible")?fa.dialog.rankpointlb.hide():$.get("/rpRanking",function(e){ee(e),m(fa.dialog.rankpointlb)})}),fa.dialog.rplbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/rpRanking?p="+(ja._rplbpage-1),function(e){ee(e)})}),fa.dialog.rplbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/rpRanking?id="+ja.id,function(e){ee(e)})}),fa.dialog.rplbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/rpRanking?p="+(ja._rplbpage+1),function(e){ee(e)})}),fa.dialog.settingServer.on("click",function(e){$("#setting-server").prop("disabled",!0),alert("이동할 서버가 없습니다.")}),fa.dialog.settingOK.on("click",function(e){u({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),fa.dialog.setting.hide(),$.cookie("kks",JSON.stringify(ja.opts))}),fa.dialog.profileLevel.on("click",function(e){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),m(fa.dialog.practice)}),fa.dialog.practiceOK.on("click",function(e){var a=$("#practice-level").val(),t=$("#ai-team").val();fa.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?l("setAI",{target:ja._profiled,level:a,team:t}):l("practice",{level:a})}),fa.dialog.roomOK.on("click",function(e){var a,t,r={injpick:ja._injpick};for(a in pa)r[t=pa[a].name.toLowerCase()]=$("#room-"+t).is(":checked");l(ja.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),wordLimit:$("#room-wordLimit").val(),time:$("#room-time").val(),opts:r}),fa.dialog.room.hide()}),fa.dialog.resultOK.on("click",function(e){1==ja._resultPage&&ja._resultRank?be(ja._resultRank[ja.id]):(ja.practicing&&(ja.room.gaming=!0,l("leave")),ja.resulting=!1,fa.dialog.result.hide(),ja.admin||delete ja._replay,ja.admin||delete ja._resultRank,fa.box.room.height(360),Pe("lobby"),Ke(),R())}),fa.dialog.resultSave.on("click",function(e){var o=new Date($a.time),n=JSON.stringify($a)+wa;i=new Blob([n],{type:"text/plain"}),a=URL.createObjectURL(i),t="KKuTu"+o.getFullYear()+"-"+(o.getMonth()+1)+"-"+o.getDate()+" "+o.getHours()+"-"+o.getMinutes()+"-"+o.getSeconds()+".bkr",r=$("<a>").attr({download:t,href:a}).on("click",function(e){r.remove()}),$("#Jungle").append(r),r[0].click()}),fa.dialog.dictInjeong.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||$("#dict-theme").val()&&(a.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){if(g(function(){a.prop("disabled",!1)},2e3),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),fa.dialog.dictSearch.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||(a.prop("disabled",!0),$("#dict-output").html(L.searching),D($("#dict-input").val(),function(e){if(g(function(){a.prop("disabled",!1)},500),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(Se(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),fa.dialog.wordPlusOK.on("click",function(e){var a;fa.dialog.wordPlusOK.hasClass("searching")||(a=$("#wp-input").val())&&((a=a.replace(/[^a-z가-힣]/g,"")).length<2||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),l("wp",{value:a})))}).hotkey($("#wp-input"),13),fa.dialog.inviteRobot.on("click",function(e){re("AI")}),fa.box.me.on("click",function(e){te(ja.id)}),fa.dialog.roomInfoJoin.on("click",function(e){fa.dialog.roomInfo.hide(),Ee(ja._roominfo)}),fa.dialog.profileHandover.on("click",function(e){confirm(L.sureHandover)&&l("handover",{target:ja._profiled})}),fa.dialog.profileFriendAdd.on("click",function(e){ja.users[$("#find-target").val()]?l("friendAdd",{target:$("#find-target").val()},!0):sa(450)}),fa.dialog.profileKick.on("click",function(e){l("kick",{robot:ja.robots.hasOwnProperty(ja._profiled),target:ja._profiled})}),fa.dialog.profileShut.on("click",function(e){var a=ja.users[ja._profiled];a&&j(a.profile.title||a.profile.name)}),fa.dialog.profileWhisper.on("click",function(e){var a=ja.users[ja._profiled];fa.talk.val("/e "+(a.profile.title||a.profile.name).replace(/\s/g,"")+" ").focus()}),fa.dialog.profileReport.on("click",function(e){var a=ja.users[ja._profiled];$("#report-reason").val(""),$("#report-accept").attr("checked",!1),m(fa.dialog.reportDiag),$("#report-target").text(a.id),$("#submitter").text(ja.id)}),fa.dialog.profileDress.on("click",function(e){return ja.guest?sa(421):ja._gaming?sa(438):void(m(fa.dialog.dress)&&$.get("/box",function(e){if(e.error)return sa(e.error);ja.box=e,W()}))}),fa.dialog.dressOK.on("click",function(e){var a=$("#dress-nickname").val()!=ja.nickname;y($("#dress-nickname").val())&&($(e.currentTarget).attr("disabled",!0),$.post("/updateme",{nickname:a?Ue($("#dress-nickname").val()):"",exordial:Ue($("#dress-exordial").val())},function(e){if(e.error)return sa(e.error);a&&(ja.users[ja.id].nickname=Ue($("#dress-nickname").val()),ja.nickname=Ue($("#dress-nickname").val()),l("updatedMe",{id:ja.id,nickname:ja.nickname,exordial:ja.users[ja.id].exordial}),alert(`닉네임이 ${ja.nickname}(으)로 변경되었습니다.`),N(!0)),ja.users[ja.id].exordial=Ue($("#dress-exordial").val()),fa.dialog.dressOK.attr("disabled",!1),fa.dialog.dress.hide()}))}),$("#DressDiag .dress-type").on("click",function(e){var a=$(e.currentTarget),t=a.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),a.addClass("selected"),Q("all"==t||a.attr("value"))}),$("#dress-cf").on("click",function(e){if(ja._gaming)return sa(438);m(fa.dialog.charFactory)&&Y()}),fa.dialog.cfCompose.on("click",function(e){if(!fa.dialog.cfCompose.hasClass("cf-composable"))return sa(436);confirm(L.cfSureCompose)&&$.post("/cf",{tray:ja._tray.join("|")},function(e){var a;if(e.error)return sa(e.error);for(a in l("refresh"),alert(L.cfComposed),ja.users[ja.id].money=e.money,ja.box=e.box,e.gain)ra(e.gain[a]);W(ja._avGroup),O(),Y()})}),$("#room-injeong-pick").on("click",function(e){var a,t=ua[da[$("#room-mode").val()]];for(a in $("#injpick-list>div").hide(),"ko"==t.lang?(ja._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==t.lang&&(ja._ijkey="#en-pick-",$("#en-pick-list").show()),fa.dialog.injPickNo.trigger("click"),ja._injpick)$(ja._ijkey+ja._injpick[a]).prop("checked",!0);m(fa.dialog.injPick)}),fa.dialog.injPickAll.on("click",function(e){$("#injpick-list input").prop("checked",!0)}),fa.dialog.injPickNo.on("click",function(e){$("#injpick-list input").prop("checked",!1)}),fa.dialog.kickVoteY.on("click",function(e){l("kickVote",{agree:!0}),clearTimeout(ja._kickTimer),fa.dialog.kickVote.hide()}),fa.dialog.kickVoteN.on("click",function(e){l("kickVote",{agree:!1}),clearTimeout(ja._kickTimer),fa.dialog.kickVote.hide()}),fa.dialog.reportSubmit.on("click",function(e){$("#report-accept").is(":checked")?($.post("/report",{target:$("#report-target").text(),submitter:ja.id,reason:$("#report-reason").val()}),alert(`신고가 완료되었습니다.\n\n대상: ${$("#report-target").text()}\n신고자: ${ja.id}\n사유: ${$("#report-reason").val()}`),fa.dialog.reportDiag.hide()):alert("본인 또한 처벌 받을 수 있음에 동의해주세요.")}),fa.dialog.purchaseOK.on("click",function(e){$.post("/buy/"+ja._sgood,function(e){var a=ja.users[ja.id];if(e.error)return sa(e.error);alert(L.purchased),a.money=e.money,a.box=e.box,O()}),fa.dialog.purchase.hide()}),fa.dialog.purchaseNO.on("click",function(e){fa.dialog.purchase.hide()}),fa.menu.cursing.click(function(){var e;fa.dialog.cursing.toggle(),"block"==fa.dialog.cursing.css("display")&&(e=fa.dialog.cursingValue,"NONE"==Za&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">확인된 욕설이 없습니다.(횟수: ${Fa.toString()})</div>`),"LIT"==Za&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 낮음(사용횟수: ${Fa.toString()})</div>`),"LOW"==Za&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">낮음(사용횟수: ${Fa.toString()})</div>`),"MID"==Za&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">조금 높음(사용횟수: ${Fa.toString()})</div>`),"HIGH"==Za&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">높음(사용횟수: ${Fa.toString()})</div>`),"WARN"==Za&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 높음(사용횟수: ${Fa.toString()})</div>`))}),fa.dialog.obtainOK.on("click",function(e){var a=ja._obtain.shift();a?ia(a):fa.dialog.obtain.hide()}),fa.dialog.alertKKuTuOK.on("click",function(e){fa.dialog.alertKKuTu.hide()}),$("#popup-ok").on("click",function(e){fa.dialog.popupKKuTu.hide()}),fa.dialog.newClan.on("click",function(e){m(fa.dialog.newClanDiag)}),fa.dialog.viewClan.on("click",function(e){if(m(fa.dialog.viewClanDiag),Da.name){var a,t=qe(Da.score);for(a in $("#deleteClan").hide(),$("#kickTarget").hide(),$("#kickUser").hide(),$("#leaveClan").show(),$("#extendMax").hide(),2==Da.users[ja.id]?($("#deleteClan").show(),$("#kickTarget").show(),$("#kickUser").show(),$("#leaveClan").hide(),$("#extendMax").show()):1==Da.users[ja.id]&&($("#kickTarget").show(),$("#kickUser").show(),$("#extendMax").show()),$("#myClanName").html(`클랜 이름: ${Da.name}`),$("#myClanID").html(`클랜 ID: ${Da._id}`),$("#myClanMax").html(`클랜원 수: ${Object.keys(Da.users).length}/${Da.max}명`),$("#myClanActivate").html(`클랜 활동량: ${Da.score}`),$("#myClanLevel").attr("src",`https://cdn.jsdelivr.net/npm/bfkkutudelivr@${L.cdn_version}/img/kkutu/clanlv/lv${t}.png`),$("#clanUserList tbody").empty(),Da.users)$("#clanUserList tbody").append($("<tr>").append($("<td>").text(a)).append($("<td>").text(Da.uname[a])).append($("<td>").text(`${L["clanPerm"+Da.users[a]]}`)))}else alert("클랜에 가입하지 않았습니다."),fa.dialog.viewClanDiag.hide()}),fa.dialog.deleteClan.on("click",function(e){var a=prompt(`${Da.name} 클랜을 삭제하시려면 클랜 생성 시 입력한 비밀번호를 입력해주세요.`);$.post("/clan/remove",{id:Da._id,me:ja.id,password:a},function(e){"PERMISSIONFAIL"==e.message?alert("클랜 마스터만 클랜을 삭제할 수 있습니다."):"PASSWORDFAIL"==e.message?alert("비밀번호가 잘못되었습니다."):(alert(`${Da.name} 클랜이 삭제되었습니다.`),Da={},fa.dialog.viewClanDiag.hide())})}),fa.dialog.makeClan.on("click",function(e){var a=$("#clanName").val();if(Da._id)alert("이미 클랜에 가입되어 있습니다!"),fa.dialog.newClanDiag.hide();else if(null==a)alert("클랜 이름을 자음만으로 지정하실 수 없습니다.");else if(null==a)alert("클랜 이름을 자음만으로 지정하실 수 없습니다.");else if(/[(ㄱ-ㅎ)]/gi.test(a))alert("클랜 이름을 자음만으로 지정하실 수 없습니다.");else if(/[(가-힣a-zA-Z)]/gi.test(a))if(a.length>8)alert("클랜 이름 길이 제한은 최대 8글자까지입니다.");else if(a.match("<"))alert("클랜 이름에 잘못된 문자가 포함되어 있습니다.");else if(a.match(">"))alert("클랜 이름에 잘못된 문자가 포함되어 있습니다.");else if(a.match("&lt"))alert("클랜 이름에 잘못된 문자가 포함되어 있습니다.");else if(a.match("　"))alert("클랜 이름에 잘못된 문자가 포함되어 있습니다.");else{a=Ue(a);var t=prompt("클랜 관리 시 사용할 비밀번호를 입력해주세요.\n클랜 부마스터도 이 비밀번호를 알아야 클랜 관리 기능을 사용할 수 있습니다.\n※ 비밀번호는 암호화되어 저장되므로 잊을 경우 다시 찾을 수 없습니다. ※");if(""==t||null==t)return alert("비밀번호를 입력하세요.");$.post("/clan/create",{me:ja.id,name:a,password:t},function(e){"MONEYFAIL"==e.message?(alert("핑이 부족합니다! (5000핑 필요)"),fa.dialog.newClanDiag.hide()):(alert(`5000핑을 소비하여 ${a} 클랜을 만들었습니다!`),k(ja.id),fa.dialog.newClanDiag.hide())})}else alert("클랜 이름에 잘못된 문자가 포함되어 있습니다.")}),fa.dialog.kickUser.on("click",function(e){var a=$("#kickTarget").val(),t=confirm(`정말 ${a}님을 추방하시겠습니까?`);if(t&&a===ja.id)alert("자기 자신은 추방할 수 없습니다!");else if(t&&2==Da.users[ja.id])alert("클랜 마스터와 클랜 관리자만 추방할 수 있습니다.");else if(t){var r=prompt("클랜 생성 시 지정한 비밀번호를 입력해주세요.");$.post("/clan/user/remove",{me:a,id:Da._id,password:r},function(e){"FAIL"==e.message?alert("추방 실패! 추방 대상 유저 ID가 잘못되었을 수 있습니다."):"PERMISSIONFAIL"==e.message?alert("권한이 부족합니다."):"PASSWORDFAIL"==e.message?alert("비밀번호가 잘못되었습니다."):(alert(`${a}님을 추방했습니다!`),k(ja.id))})}}),fa.dialog.extendMax.on("click",function(e){var a=confirm(`5000핑을 소비하여 클랜원 제한을 ${Number(Da.max)+10}명으로 늘리시겠습니까?`);if(a&&0==Da.users[ja.id])alert("클랜 마스터 또는 부마스터만 확장할 수 있습니다.");else if(a){var t=prompt("클랜 생성 시 지정한 비밀번호를 입력해주세요.");$.post("/clan/extend",{me:ja.id,id:Da._id,password:t},function(e){"FAIL"==e.message?alert("알 수 없는 문제로 인해 실패했습니다."):"PERMISSIONFAIL"==e.message?alert("권한이 부족합니다."):"MAX"==e.message?alert("클랜 확장 한도에 도달했습니다. (50명)"):(alert(`클랜원 제한을 ${Number(Da.max)+10}명으로 늘렸습니다.`),fa.dialog.viewClanDiag.hide(),Da.max=Number(Da.max)+10,fa.dialog.viewClan.trigger("click"))})}}),fa.dialog.joinClan.on("click",function(e){if(Da.name)alert("이미 클랜에 가입되어 있습니다.");else{var a=$("#joinTarget").val();$.post("/clan/user/add",{me:ja.id,id:a},function(e){"FAIL"==e.message?alert("가입 실패! 가입 대상 클랜 ID가 잘못되었을 수 있습니다."):"USERLIMITFAIL"==e.message?alert("가입 실패! 클랜원 한도에 도달한 클랜입니다."):"BANNED"==e.message?alert("가입 실패! 차단 당한 클랜에는 다시 가입할 수 없습니다."):(alert(`${a} 클랜에 가입했습니다!`),k(ja.id))})}}),fa.dialog.leaveClan.on("click",function(e){Da.name?confirm(`정말 ${Da.name} 클랜을 떠나시겠습니까?`)&&$.get("/clan/user/leave",{me:ja.id},function(e){"FAIL"==e.message?(alert("알 수 없는 오류로 인해 클랜 탈퇴에 실패했습니다."),fa.dialog.viewClanDiag.hide()):(alert(`${Da.name} 클랜을 떠났습니다!`),Da={},fa.dialog.viewClanDiag.hide())}):alert("클랜에 가입되어 있지 않습니다!")}),n=0;n<5;n++)$("#team-"+n).on("click",r),$("#room-unknownword.game-option").click(()=>$("#room-unknownword.game-option").is(":checked")?$(".game-option").not("#room-unknownword.game-option").not("#room-mission.game-option").not("#room-abcmission.game-option").not("#room-moremission.game-option").not("#room-returns.game-option").not("#room-randomturn.game-option").not("#room-ignoreinitial.game-option").prop("checked",!1).prop("disabled",!0):$(".game-option").prop("disabled",!1));$("#replay-file").on("change",function(e){var a=e.target.files[0],t=new FileReader,r=$("#replay-date").html("-"),i=$("#replay-version").html("-"),o=$("#replay-players").html("-");$a=!1,fa.dialog.replayView.attr("disabled",!0),a&&(t.readAsText(a),t.onload=function(e){var a,t;try{if(-1==e.target.result.indexOf(wa))alert("BF끄투의 리플레이 파일이 아닌 것 같습니다."),fa.dialog.replayView.attr("disabled",!0);else{for(a in security=e.target.result.replace(wa,""),t=JSON.parse(security),r.html(new Date(t.time).toLocaleString()),i.html(t.version),o.empty(),t.players){var n,s=t.players[a];o.append(n=$("<div>").addClass("replay-player-bar ellipse").html(s.title).prepend(Re(s.data.score).addClass("users-level"))),s.id==t.me&&n.css("font-weight","bold")}$a=t,fa.dialog.replayView.attr("disabled",!1)}}catch(e){return console.warn(e),alert(L.replayError)}})}),fa.dialog.replayView.on("click",function(e){!function(){var e;for(e in ue(),ja._replay=!0,ja.room={title:$a.title,players:[],events:[],time:$a.roundTime,round:$a.round,mode:$a.mode,limit:$a.limit,game:$a.game,opts:$a.opts,readies:$a.readies},ne(),$a.events)ja.room.events.push($a.events[e]);fa.box.userList.hide(),fa.box.roomList.hide(),fa.box.game.show(),fa.dialog.replay.hide(),oe(),G(!0),ja.$gp=$(".GameBox .product-title").empty().append(ja.$gpt=$("<div>").addClass("game-replay-title")).append(ja.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",de)).append($("<button>").html(L.replayPause).on("click",le)).append($("<button>").html(L.replayPrev).on("click",se))),ja._gpp=L.replay+" - "+new Date($a.time).toLocaleString(),ja._gtt=ja.room.events[ja.room.events.length-1].time,ja._eventTime=0,ja._rt=g(me,2e3),ja._rprev=0,ja._rpause=!1,ce()}()}),$("button.item").click(function(e){var a={item:{id:this.id,count:ja.itemCount}};ja.room&&ja._gaming&&ja.room.opts.item&&(1==ja.itemCount?Qe(L.itemCount,L.item):(ja.itemCount++,l("item",a),$("#items").hide()))}),p(function(){Pa>0?Pa=0:Na>0&&(Na-=.03)},1e3)}),qa.Classic.roundReady=function(e){$("#items").hide(),ja.itemCount=0,ja.room.game.title.length,ge(),ja._roundTime=1e3*ja.room.time,fa.game.display.html(je(e.char,e.subChar)),fa.game.chain.show().html(ja.chain=0),ja.room.opts.mission&&fa.game.items.show().css("opacity",1).html(ja.mission=e.mission),"KAP"==da[ja.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),he(e.round),Ze("round_start"),pe("roundReady")},qa.Classic.turnStart=function(e){ja.room.game.turn=e.turn,e.seq&&(ja.room.game.seq=e.seq),(ja._tid=ja.room.game.seq[e.turn])&&(ja._tid.robot&&(ja._tid=ja._tid.id),e.id=ja._tid,fa.game.display.html(ja._char=je(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),e.id==ja.id&&ja.room.opts.item&&0!=ja.chain?$("#items").show():$("#items").hide(),ja._replay||(fa.game.here.css("display",e.id==ja.id?"block":"none"),e.id==ja.id&&(va?fa.game.hereText.val("").focus():fa.talk.focus())),fa.game.items.html(ja.mission=e.mission),ga.onmessage=_onMessage,clearInterval(ja._tTime),ja._chars=[e.char,e.subChar],ja._speed=e.speed,ja._tTime=p(fe,_a),ja.turnTime=e.turnTime,ja._turnTime=e.turnTime,ja._roundTime=e.roundTime,ja._turnSound=Ze("T"+e.speed),pe("turnStart"))},qa.Classic.turnGoing=function(){ja.room||clearInterval(ja._tTime),ja._turnTime-=_a,ja._roundTime-=_a,fa.game.turnBar.width(ja._timePercent()).html((.001*ja._turnTime).toFixed(1)+L.SECOND),fa.game.roundBar.width(ja._roundTime/ja.room.time*.1+"%").html((.001*ja._roundTime).toFixed(1)+L.SECOND),fa.game.roundBar.hasClass("round-extreme")||ja._roundTime<=5e3&&fa.game.roundBar.addClass("round-extreme")},qa.Classic.turnEnd=function(e,a){var t,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),i=$(".game-user-current");ja._turnSound&&ja._turnSound.stop(),ve(e,a.score),clearInterval(ja._tTime),a.ok?(ie(),clearTimeout(ja._fail),fa.game.here.hide(),fa.game.chain.html(++ja.chain),xe(a.value,a.mean,a.theme,a.wc)):(ie(e),r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),fa.game.here.hide(),Ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(t=a.hint.indexOf(ja._chars[0]))&&(t=a.hint.indexOf(ja._chars[1])),"KAP"==da[ja.room.mode]?fa.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,t))).append($("<label>").html(a.hint.slice(t))):fa.game.display.empty().append($("<label>").html(a.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(t+1)))),a.bonus&&(va?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ke(i,e)},500)),ke(i,r).removeClass("game-user-current"),J(e,$e(e))},qa.DaneoClassic.roundReady=function(e){ja.room.game.title.length,ge(),ja._roundTime=1e3*ja.room.time,fa.game.display.html(ja._char="&lt;"+L["theme_"+e.theme]+"&gt;"),fa.game.chain.show().html(ja.chain=0),ja.room.opts.mission&&fa.game.items.show().css("opacity",1).html(ja.mission=e.mission),"KAP"==da[ja.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),he(e.round),Ze("round_start"),pe("roundReady")},qa.DaneoClassic.turnStart=function(e){ja.room.game.turn=e.turn,e.seq&&(ja.room.game.seq=e.seq),(ja._tid=ja.room.game.seq[e.turn])&&(ja._tid.robot&&(ja._tid=ja._tid.id),e.id=ja._tid,fa.game.display.html(ja._char=je(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),ja._replay||(fa.game.here.css("display",e.id==ja.id?"block":"none"),e.id==ja.id&&(va?fa.game.hereText.val("").focus():fa.talk.focus())),fa.game.items.html(ja.mission=e.mission),ga.onmessage=_onMessage,clearInterval(ja._tTime),ja._chars=[e.char,e.subChar],ja._speed=e.speed,ja._tTime=p(fe,_a),ja.turnTime=e.turnTime,ja._turnTime=e.turnTime,ja._roundTime=e.roundTime,ja._turnSound=Ze("T"+e.speed),pe("turnStart"))},qa.DaneoClassic.turnGoing=qa.Classic.turnGoing,qa.DaneoClassic.turnEnd=function(e,a){var t,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),i=$(".game-user-current");ja._turnSound&&ja._turnSound.stop(),ve(e,a.score),clearInterval(ja._tTime),a.ok?(ie(),clearTimeout(ja._fail),fa.game.here.hide(),fa.game.chain.html(++ja.chain),xe(a.value,a.mean,a.theme,a.wc)):(ie(e),r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),fa.game.here.hide(),Ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(t=a.hint.indexOf(ja._chars[0]))&&(t=a.hint.indexOf(ja._chars[1])),"KAP"==da[ja.room.mode]?fa.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,t))).append($("<label>").html(a.hint.slice(t))):fa.game.display.empty().append($("<label>").html(a.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(t+1)))),a.bonus&&(va?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ke(i,e)},500)),ke(i,r).removeClass("game-user-current"),J(e,$e(e))},qa.Jaqwi.roundReady=function(e){var a=L.jqTheme+": "+L["theme_"+e.theme];ge(),ja._roundTime=1e3*ja.room.time,ja._fastTime=1e4,fa.game.display.html(a),fa.game.items.hide(),fa.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(a).css("text-align","center"),he(e.round),Ze("round_start"),clearInterval(ja._tTime)},qa.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),ja.room.game.seq.indexOf(ja.id)>=0&&fa.game.here.show(),fa.game.display.html(ja._char=e.char),clearInterval(ja._tTime),ja._tTime=p(fe,_a),Pe("jaqwi")},qa.Jaqwi.turnGoing=function(){var e,a,t=fa.game.roundBar;ja.room||clearInterval(ja._tTime),ja._roundTime-=_a,a=ja._spectate?L.stat_spectate:(.001*ja._roundTime).toFixed(1)+L.SECOND,t.width(ja._roundTime/ja.room.time*.1+"%").html(a),t.hasClass("round-extreme")||ja._roundTime<=ja._fastTime&&(e=ja.bgm.currentTime/ja.bgm.duration,ja.bgm.paused?Fe():Pe("jaqwiF"),ja.bgm.currentTime=ja.bgm.duration*e,t.addClass("round-extreme"))},qa.Jaqwi.turnHint=function(e){Ze("mission"),Te(e.hint)},qa.Jaqwi.turnEnd=function(e,a){var t=$("<div>").addClass("deltaScore").html("+"+a.score),r=$("#game-user-"+e);a.giveup?r.addClass("game-user-bomb"):a.answer?(fa.game.here.hide(),fa.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),Fe(),Ze("horr")):(e==ja.id&&fa.game.here.hide(),ve(e,a.score),ja._roundTime>1e4&&(ja._roundTime=1e4),ke(r,t),J(e,$e(e)).addClass("game-user-current"),Ze("success"))},qa.Crossword.roundReady=function(e,a){var t=e.seq?e.seq.indexOf(ja.id):-1;ge(),$(".jjoriping,.rounds,.game-body").addClass("cw"),ja._roundTime=1e3*ja.room.time,ja._fastTime=3e4,ja.selectedRound=-1==t?1:t%ja.room.round+1,fa.game.items.hide(),fa.game.cwcmd.show().css("opacity",0),he(ja.selectedRound),a||Ze("round_start"),clearInterval(ja._tTime)},qa.Crossword.turnEnd=function(e,a){var t,r,i=$("<div>").addClass("deltaScore").html("+"+a.score),o=$("#game-user-"+e);a.score?(r=a.pos.join(","),e==ja.id?(fa.game.cwcmd.css("opacity",0),Ze("success")):(ja._sel&&a.pos.join(",")==ja._sel.join(",")&&fa.game.cwcmd.css("opacity",0),Ze("mission")),ja._bdb[r][4]=a.value,ja._bdb[r][5]=e,a.pos[0]==ja.selectedRound-1?qa.Crossword.drawDisplay():(t=$(fa.game.round.children("label").get(a.pos[0])).addClass("round-effect"),g(function(){t.removeClass("round-effect")},800)),ve(e,a.score),J(e,$e(e)),ke(o,i)):(Fe(),fa.game.round.empty(),Ze("horr"))},qa.Crossword.drawDisplay=function(){var e,a,t,r,i,o,n,s,l,d=ja._boards[ja.selectedRound-1],c=fa.game.display.empty(),m={};for(a in d)for(r=Number(d[a][0]),i=Number(d[a][1]),o="1"==d[a][2],n=Number(d[a][3]),s=d[a][4],c.append(e=$("<div>").addClass("cw-bar").attr("id","cw-"+r+"-"+i+"-"+d[a][2]).css({top:12.5*i+"%",left:12.5*r+"%",width:12.5*(o?1:n)+"%",height:12.5*(o?n:1)+"%"})),s&&e.addClass("cw-open"),d[a][5]==ja.id?e.addClass("cw-my-open"):e.on("click",qa.Crossword.onBar).on("mouseleave",qa.Crossword.onSwap),t=0;t<n;t++)l=r+"-"+i,s&&(m[l]=s.charAt(t)),e.append($("<div>").addClass("cw-cell").attr("id","cwc-"+l).html(m[l]||"")),o?i++:r++},qa.Crossword.onSwap=function(e){fa.game.display.prepend($(e.currentTarget))},qa.Crossword.onRound=function(e){var a=$(e.currentTarget).html().charCodeAt(0)-9311;he(ja.selectedRound=a),$(".rounds label").on("click",qa.Crossword.onRound),qa.Crossword.drawDisplay()},qa.Crossword.onBar=function(e){var a=$(e.currentTarget).attr("id").slice(3).split("-"),t=ja._means[ja.selectedRound-1][a.join(",")],r="1"==t.dir;fa.game.cwcmd.css("opacity",1),ja._sel=[ja.selectedRound-1,a[0],a[1],a[2]],$(".cw-q-head").html(L[r?"cwVert":"cwHorz"]+t.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(Se(0,t.mean,t.theme,t.type.split(",")))},qa.Crossword.turnStart=function(e,a){var t,r;for(t in ja._bdb={},ja._boards=e.boards,ja._means=e.means,e.boards)for(r in e.boards[t])ja._bdb[[t,e.boards[t][r][0],e.boards[t][r][1],e.boards[t][r][2]].join(",")]=e.boards[t][r];$(".rounds label").on("click",qa.Crossword.onRound),qa.Crossword.drawDisplay(),clearInterval(ja._tTime),ja._tTime=p(fe,_a),Pe("jaqwi")},qa.Crossword.turnGoing=qa.Jaqwi.turnGoing,qa.Crossword.turnHint=function(e){Ze("fail")},qa.Typing.roundReady=function(e){ja.room.game.title.length,ja._chatter=va?fa.game.hereText:fa.talk,ge(),ja._round=e.round,ja._roundTime=1e3*ja.room.time,ja._fastTime=1e4,ja._list=e.list.concat(e.list),ja.chain=0,a(),he(e.round),Ze("round_start"),pe("roundReady")},qa.Typing.spaceOn=function(){ja.room.opts.proverb||(ja._spaced=!0,$("body").on("keydown","#"+ja._chatter.attr("id"),e))},qa.Typing.spaceOff=function(){ja.admin||delete ja._spaced,$("body").off("keydown","#"+ja._chatter.attr("id"),e)},qa.Typing.turnStart=function(e){ja._spectate||(fa.game.here.show(),va?fa.game.hereText.val("").focus():fa.talk.val("").focus(),qa.Typing.spaceOn()),ga.onmessage=_onMessage,clearInterval(ja._tTime),ja._tTime=p(fe,_a),ja._roundTime=e.roundTime,Pe("jaqwi"),pe("turnStart")},qa.Typing.turnGoing=qa.Jaqwi.turnGoing,qa.Typing.turnEnd=function(e,r){var i=$("<div>").addClass("deltaScore").html("+"+r.score),o=$("#game-user-"+e);r.error?(ja.chain++,a(),Ze("fail")):r.ok?(ja.id==e?(ja.chain++,a(),Ze("mission"),Ae(r.value,"")):ja._spectate&&Ze("mission"),ve(e,r.score),ke(o,i),J(e,$e(e))):(clearInterval(ja._tTime),qa.Typing.spaceOff(),fa.game.here.hide(),Fe(),Ze("horr"),g(n,1e3,r.speed),ja._round<ja.room.round&&t(10))},qa.Reverse.roundReady=function(e){ja.room.game.title.length,ja._chatter=va?fa.game.hereText:fa.talk,ge(),ja._round=e.round,ja._roundTime=1e3*ja.room.time,ja._fastTime=1e4,ja.chain=0,he(e.round),Ze("round_start"),pe("roundReady")},qa.Reverse.turnStart=function(e){ja._spectate||(fa.game.here.show(),va?fa.game.hereText.val("").focus():fa.talk.val("").focus(),qa.Typing.spaceOn()),ga.onmessage=_onMessage,clearInterval(ja._tTime),ja._tTime=p(fe,_a),ja._roundTime=e.roundTime,Pe("jaqwi"),pe("turnStart"),fa.game.display.html($("<label>").css("color","#FFFF44").html(ja.chain%2?"거꾸로!":"제시어를 입력하세요"))},qa.Reverse.turnGoing=function(){var e,a,t=fa.game.roundBar;ja.room||clearInterval(ja._tTime),ja._roundTime-=_a,a=ja._spectate?L.stat_spectate:(.001*ja._roundTime).toFixed(1)+L.SECOND,t.width(ja._roundTime/ja.room.time*.1+"%").html(a),t.hasClass("round-extreme")||ja._roundTime<=ja._fastTime&&(e=ja.bgm.currentTime/ja.bgm.duration,ja.bgm.paused?Fe():Pe("jaqwiF"),ja.bgm.currentTime=ja.bgm.duration*e,t.addClass("round-extreme"))},qa.Reverse.turnEnd=function(e,r){var i=$("<div>").addClass("deltaScore").html("+"+r.score),o=$("#game-user-"+e);r.error?(ja.chain++,a(),Ze("fail")):r.ok?(ja.id==e?(ja.chain++,a(),Ze("mission"),Ae(r.value,"")):ja._spectate&&Ze("mission"),ve(e,r.score),ke(o,i),J(e,$e(e))):(clearInterval(ja._tTime),qa.Typing.spaceOff(),fa.game.here.hide(),Fe(),Ze("horr"),g(n,1e3,r.speed),ja._round<ja.room.round&&t(10))},qa.Hunmin.roundReady=function(e){ja.room.game.title.length,ge(),ja._roundTime=1e3*ja.room.time,fa.game.display.html(ja._char="&lt;"+e.theme+"&gt;"),fa.game.chain.show().html(ja.chain=0),ja.room.opts.mission&&fa.game.items.show().css("opacity",1).html(ja.mission=e.mission),he(e.round),Ze("round_start"),pe("roundReady")},qa.Hunmin.turnStart=function(e){ja.room.game.turn=e.turn,e.seq&&(ja.room.game.seq=e.seq),ja._tid=ja.room.game.seq[e.turn],ja._tid.robot&&(ja._tid=ja._tid.id),e.id=ja._tid,fa.game.display.html(ja._char),$("#game-user-"+e.id).addClass("game-user-current"),ja._replay||(fa.game.here.css("display",e.id==ja.id?"block":"none"),e.id==ja.id&&(va?fa.game.hereText.val("").focus():fa.talk.focus())),fa.game.items.html(ja.mission=e.mission),ga.onmessage=_onMessage,clearInterval(ja._tTime),ja._chars=[e.char,e.subChar],ja._speed=e.speed,ja._tTime=p(fe,_a),ja.turnTime=e.turnTime,ja._turnTime=e.turnTime,ja._roundTime=e.roundTime,ja._turnSound=Ze("T"+e.speed),pe("turnStart")},qa.Hunmin.turnGoing=qa.Classic.turnGoing,qa.Hunmin.turnEnd=function(e,a){var t,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),i=$(".game-user-current");ja._turnSound.stop(),ve(e,a.score),clearInterval(ja._tTime),a.ok?(clearTimeout(ja._fail),fa.game.here.hide(),fa.game.chain.html(++ja.chain),xe(a.value,a.mean,a.theme,a.wc)):(r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),fa.game.here.hide(),Ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(t=a.hint.indexOf(ja._chars[0]))&&(t=a.hint.indexOf(ja._chars[1])),fa.game.display.empty().append($("<label>").html(a.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(t+1)))),a.bonus&&(va?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ke(i,e)},500)),ke(i,r).removeClass("game-user-current"),J(e,$e(e))},qa.Daneo.roundReady=function(e){ja.room.game.title.length,ge(),ja._roundTime=1e3*ja.room.time,fa.game.display.html(ja._char="&lt;"+L["theme_"+e.theme]+"&gt;"),fa.game.chain.show().html(ja.chain=0),ja.room.opts.mission&&fa.game.items.show().css("opacity",1).html(ja.mission=e.mission),he(e.round),Ze("round_start"),pe("roundReady")},qa.Daneo.turnStart=function(e){ja.room.game.turn=e.turn,e.seq&&(ja.room.game.seq=e.seq),ja._tid=ja.room.game.seq[e.turn],ja._tid.robot&&(ja._tid=ja._tid.id),e.id=ja._tid,fa.game.display.html(ja._char),$("#game-user-"+e.id).addClass("game-user-current"),ja._replay||(fa.game.here.css("display",e.id==ja.id?"block":"none"),e.id==ja.id&&(va?fa.game.hereText.val("").focus():fa.talk.focus())),fa.game.items.html(ja.mission=e.mission),ga.onmessage=_onMessage,clearInterval(ja._tTime),ja._chars=[e.char,e.subChar],ja._speed=e.speed,ja._tTime=p(fe,_a),ja.turnTime=e.turnTime,ja._turnTime=e.turnTime,ja._roundTime=e.roundTime,ja._turnSound=Ze("T"+e.speed),pe("turnStart")},qa.Daneo.turnGoing=qa.Classic.turnGoing,qa.Daneo.turnEnd=function(e,a){var t,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),i=$(".game-user-current");ja._turnSound.stop(),ve(e,a.score),clearInterval(ja._tTime),a.ok?(clearTimeout(ja._fail),fa.game.here.hide(),fa.game.chain.html(++ja.chain),xe(a.value,a.mean,a.theme,a.wc)):(r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),fa.game.here.hide(),Ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(t=a.hint.indexOf(ja._chars[0]))&&(t=a.hint.indexOf(ja._chars[1])),fa.game.display.empty().append($("<label>").html(a.hint.slice(0,t+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(t+1)))),a.bonus&&(va?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):g(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);ke(i,e)},500)),ke(i,r).removeClass("game-user-current"),J(e,$e(e))},qa.Drawing.roundReady=function(e,a){L.jqTheme,L["theme_"+e.theme],ge(),$(".jjoriping,.rounds,.game-body").addClass("cw"),$(".jjoriping,.rounds").addClass("dg"),$(".game-user-drawing").removeClass("game-user-drawing"),fa.game.tools.hide(),ja._relay=!1,ja._roundTime=1e3*ja.room.time,ja._fastTime=1e4,fa.game.items.hide(),fa.game.hints.show(),fa.game.cwcmd.show().css("opacity",0),ja.id===e.painter?(console.log("i'm painter!"),ja._isPainter=!0):ja._isPainter=!1,$("#game-user-"+e.painter).addClass("game-user-drawing"),he(e.round),Ze("round_start"),clearInterval(ja._tTime)},qa.Drawing.turnStart=function(e,a){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),ja.room.game.seq.indexOf(ja.id)>=0&&(ja._isPainter?($("#drawing-line-width").change(function(){console.log(this.value),fa.game.canvas.freeDrawingBrush.width=this.value,l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$("#drawing-color").change(function(){console.log(this.value),fa.game.canvas.freeDrawingBrush.color=this.value,l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$("#drawing-clear").click(function(){console.log("clear"),fa.game.canvas.clear(),l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-red").click(function(){console.log("change red"),fa.game.canvas.freeDrawingBrush.color="#FF0000",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-orange").click(function(){console.log("change orange"),fa.game.canvas.freeDrawingBrush.color="#FFA500",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-yellow").click(function(){console.log("change yellow"),fa.game.canvas.freeDrawingBrush.color="#FFFF00",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-green").click(function(){console.log("change green"),fa.game.canvas.freeDrawingBrush.color="#008000",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-blue").click(function(){console.log("change blue"),fa.game.canvas.freeDrawingBrush.color="#0000FF",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-indigo").click(function(){console.log("change indigo"),fa.game.canvas.freeDrawingBrush.color="#4B0082",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-violet").click(function(){console.log("change red"),fa.game.canvas.freeDrawingBrush.color="#9400D3",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-black").click(function(){console.log("change black"),fa.game.canvas.freeDrawingBrush.color="#000000",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),$(".button-color#color-white").click(function(){console.log("change white"),fa.game.canvas.freeDrawingBrush.color="#FFFFFF",l("drawingCanvas",{data:JSON.stringify(fa.game.canvas)},!1)}),fa.game.drawingTitle.text(e.word),fa.game.themeisTitle.text(L["theme_"+e.theme]),fa.game.hints.hide(),fa.game.tools.show(),$(".rounds").removeClass("dg"),$(".rounds").addClass("painter")):(fa.game.hints.show(),fa.game.tools.hide(),ja._relay=!0)),qa.Drawing.drawDisplay(),clearInterval(ja._tTime),ja._tTime=p(fe,_a),Pe("jaqwi")},qa.Drawing.turnHint=function(e){var a;a=Array.isArray(e.hint)?L["theme_"+e.hint[0]]:e.hint,Ze("mission"),Te(a)},qa.Drawing.turnEnd=function(e,a){var t=$("<div>").addClass("deltaScore").html("+"+a.score),r=$("#game-user-"+e);a.giveup?(r.addClass("game-user-bomb"),ja._relay=!1):a.answer?(fa.game.here.hide(),fa.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),Fe(),Ze("horr"),ja._relay=!1):(e==ja.id&&fa.game.here.hide(),ve(e,a.score),ja._roundTime>1e4&&(ja._roundTime=1e4),ke(r,t),J(e,$e(e)).addClass("game-user-current"),Ze("success"))},qa.Drawing.drawDisplay=function(){fa.game.display.empty().append($("<canvas>").attr("id","canvas").css({width:"300",height:"300",left:0,top:0}).addClass("canvas"));var e=window._canvas=new fabric.Canvas("canvas");e.backgroundColor="#ffffff",e.isDrawingMode=ja._isPainter,e.setHeight(300),e.setWidth(300),e.selection=!1,$("#drawing-line-width").val(20),$("#drawing-color").val("#000000"),ja._isPainter&&e.on("mouse:up",function(a){l("drawingCanvas",{data:JSON.stringify(e)},!1)}),e.renderAll(),fa.game.canvas=e},qa.Drawing.turnGoing=function(){var e,a,t=fa.game.roundBar;ja.room||clearInterval(ja._tTime),ja._roundTime-=_a,a=ja._spectate?L.stat_spectate:(.001*ja._roundTime).toFixed(1)+L.SECOND,t.width(ja._roundTime/ja.room.time*.1+"%").html(a),t.hasClass("round-extreme")||ja._roundTime<=ja._fastTime&&(e=ja.bgm.currentTime/ja.bgm.duration,ja.bgm.paused?Fe():Pe("jaqwiF"),ja.bgm.currentTime=ja.bgm.duration*e,t.addClass("round-extreme"))},qa.Drawing.drawCanvas=function(e){ja._isPainter||(fa.game.canvas.clear(),fa.game.canvas.loadFromJSON(e.data,fa.game.canvas.renderAll.bind(fa.game.canvas)))},qa.Sock.roundReady=function(e,a){e.seq&&e.seq.indexOf(ja.id),ge(),ja._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),ja._va=[],ja._lang=ua[da[ja.room.mode]].lang,ja._board=e.board,ja._maps=[],ja._roundTime=1e3*ja.room.time,ja._fastTime=1e4,fa.game.items.hide(),fa.game.bb.show(),qa.Sock.drawDisplay(),he(e.round),a||Ze("round_start"),clearInterval(ja._tTime)},qa.Sock.turnEnd=function(e,a){var t,r,i,o=$("<div>").addClass("deltaScore").html("+"+a.score),n=$("#game-user-"+e);if(a.score){for(i=(t=a.value).length,ja._maps.push(t),r=0;r<i;r++)ja._board=ja._board.replace(t.charAt(r),"　");Ze(e==ja.id?"success":"mission"),qa.Sock.drawDisplay(),ve(e,a.score),J(e,$e(e)),ke(n,o)}else Fe(),ja._relay=!1,Ze("horr")},qa.Sock.drawMaps=function(){fa.game.bb.empty(),ja._maps.sort(function(e,a){return a.length-e.length}).forEach(function(e){fa.game.bb.append(function(e){var a,t=$("<div>").addClass("bb-word"),r=e.length;for(a=0;a<r;a++)t.append($("<div>").addClass("bb-char").html(e.charAt(a)));return t}(e))})},qa.Sock.drawDisplay=function(){var e,a=$("<div>").css("height","100%"),t=ja._board.split(""),r="ko"==ja._lang?"12.5%":"10%";t.forEach(function(t,i){a.append(e=$("<div>").addClass("sock-char sock-"+t).css({width:r,height:r}).html(t)),ja._va[i]&&ja._va[i]!=t&&e.html(ja._va[i]).addClass("sock-picked").animate({opacity:0},500)}),ja._va=t,fa.game.display.empty().append(a),qa.Sock.drawMaps()},qa.Sock.turnStart=function(e,a){clearInterval(ja._tTime),ja._tTime=p(fe,_a),Pe("jaqwi")},qa.Sock.turnGoing=qa.Jaqwi.turnGoing,qa.Sock.turnHint=function(e){Ze("fail")};var Na=0,Pa=0,Fa=0,Za="NONE",Ma=!1;const Ea=["KR"]}();