!function(){function e(e){32==e.keyCode&&(ca.chatBtn.trigger("click"),e.preventDefault())}function a(){var e=wa._list.slice(wa.chain),a=wa.room.opts.proverb?1:5,o="",r=e[0].length;r>=20&&(o="18px"),r>=50&&(o="15px"),ca.game.display.css("font-size",o),e[0]="<label style='color: #FFFF44;'>"+e[0]+"</label>",ca.game.display.html(e.slice(0,a).join(" ")),ca.game.chain.show().html(wa.chain),$(".jjo-turn-time .graph-bar").width("100%").html(e.slice(a,2*a).join(" ")).css({"text-align":"center","background-color":"#70712D"})}function t(e){$(".jjo-turn-time .graph-bar").html(e+L.afterRun),e>0&&p(t,1e3,e-1)}function n(e){var a;for(a in e)$("#game-user-"+a+" .game-user-score").empty().append($("<div>").css({float:"none",color:"#4444FF","text-align":"center"}).html(e[a]+"<label style='font-size: 11px;'>"+L.kpm+"</label>"))}function s(e,a){var o=e.toString();return"000000000000000".slice(0,Math.max(0,a-o.length))+o}function l(e,a,o){var r,t={type:e},i=o?la:da||la;for(r in a)t[r]=a[r];if("test"!=e&&Sa++>10){if(++Da>=3)return i.close();Sa=5}i.send(JSON.stringify(t))}function d(e){e?$("#Intro").is(":visible")?(ca.loading.hide(),$("#intro-text").html(e)):ca.loading.show().html(e):ca.loading.hide()}function c(e,a){var o=[$(window).width(),$(window).height()];return!a&&e.is(":visible")?(e.hide(),!1):($(".dialog-front").removeClass("dialog-front"),e.show().addClass("dialog-front").css({left:.5*(o[0]-e.width()),top:.5*(o[1]-e.height())}),!0)}function m(e){wa.opts=e,wa.muteBGM=wa.opts.mb,wa.muteEff=wa.opts.me,$("#mute-bgm").attr("checked",wa.muteBGM),$("#mute-effect").attr("checked",wa.muteEff),$("#deny-invite").attr("checked",wa.opts.di),$("#deny-whisper").attr("checked",wa.opts.dw),$("#deny-friend").attr("checked",wa.opts.df),$("#auto-ready").attr("checked",wa.opts.ar),$("#sort-user").attr("checked",wa.opts.su),$("#only-waiting").attr("checked",wa.opts.ow),$("#only-unlock").attr("checked",wa.opts.ou),R(!0),z(!0),$("#darkTheme").is(":checked")&&(ca.loading.show().html("다크 테마를 적용하고 있습니다..."),setTimeout(function(){$("#Background").attr("src","/img/bg/dark.png"),$(".UserListBox").css("background-color","#363434"),$(".RoomListBox").css("background-color","#363434"),$(".ShopBox").css("background-color","#363434"),$(".RoomBox").css("background-color","#363434"),$(".GameBox").css("background-color","#363434"),$(".MeBox").css("background-color","#363434"),$(".ChatBox").css("background-color","#363434"),$(".Product").css("color","#ffffff"),$(".product-title").css("background-color","#363434"),$("h5").css("color","#ffffff"),$("h4").css("color","#ffffff"),$("select").css("color","#ffffff"),$("select").css("background-color","#363434"),$("button").css("color","#ffffff"),$("button").css("background-color","#363434"),$("label").css("color","#ffffff"),$("#Top").css("background-color","#363434"),$("#Top").css("color","#ffffff"),$(".for-master").css("background-color","#363434"),$(".for-lobby").css("background-color","#363434"),$(".for-normal").css("background-color","#363434"),$(".for-master").css("color","#ffffff"),$(".for-lobby").css("color","#ffffff"),$(".for-normal").css("color","#ffffff"),$("input").css("background-color","#363434"),$("input").css("color","#ffffff"),$(".rooms-create").css({"background-image":"url()","background-color":"#363434"}),$(".rooms-item").css({"background-image":"url()","background-color":"#363434"}),$(".rooms-admin-waiting").css({background:"url()","background-color":"#363434"}),$(".rooms-testing-waiting").css({background:"url()","background-color":"#363434"}),$(".rooms-admin-gaming").css({background:"url()","background-color":"#363434"}),$(".rooms-testing-gaming").css({background:"url()","background-color":"#363434"}),$(".rooms-gaming").css({"background-image":"url()","background-color":"#363434"}),$(".dialog").css("background-color","#363434"),$(".dialog-head").css("background-color","#363434"),$(".dialog-title").css("color","#ffffff"),$(".menu-btn").css("color","#ffffff"),$(".menu-btn").css("background-color","#363434"),ca.loading.hide()},2500)),wa.bgm&&(wa.muteBGM?(wa.bgm.volume=0,wa.bgm.stop()):(wa.bgm.volume=$("#bgmvol").val(),wa.bgm=qe("lobby",!0)))}function u(e,a,o,r,t,i,n){var s=Ta(e,a,o,r,t,i,n);return wa._timers.push(s),s}function p(e,a,o,r,t,i,n){var s=xa(e,a,o,r,t,i,n);return wa._timers.push(s),s}function g(e,a,o,r,t,i){if(wa.room){var n=na[ra[wa.room.mode]];if(!n)return null;Ca[n.rule][e].call(this,a,o,r,t,i)}}function h(e){var a,o;switch(e.type){case"recaptcha":var r=$("#intro-text");f(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단되었습니다."),la.close())),r.empty(),r.text("접속하기 전에, 먼저 캡챠 인증이 필요합니다.<br/>(자동화 봇을 방지하기 위함입니다)<br/><br/>"),r.append($('<div class="g-recaptcha" id="recaptcha" style="display: table; margin: 0 auto;"></div>')),grecaptcha.render("recaptcha",{sitekey:e.siteKey,callback:function(e){f(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단되었습니다."),la.close())),la.send(JSON.stringify({type:"recaptcha",token:e}))}});break;case"welcome":if(e.guest)return la.close();wa.id=e.id,wa.guest=e.guest,wa.admin=e.admin,wa.nickname=e.nickname,wa.users=e.users,wa.robots={},wa.rooms=e.rooms,wa.place=0,wa.friends=e.friends,wa._friends={},wa._playTime=e.playTime,wa._okg=e.okg,wa._cF=e.chatFreeze,wa._gaming=!1,wa.honor="b9_honor"===wa.users[wa.id].equip.BDG,wa.box=e.box,e.test&&alert(L.welcomeTestServer),location.hash[1]&&Ze(location.hash.slice(1)),D(void 0,!0),function(){var e=window.$Request;$("#Chatting").hide(),$("#room-injeong-pick").hide(),$("#quick-selecttheme-panel").remove(),$("#quick-bantheme-panel").remove(),wa._cF?wa.admin?$("#chatinput").attr("placeholder","관리자 전용 채팅"):($("#chatinput").attr("readonly",!0),$("#chatinput").attr("placeholder","관리자 전용 채팅")):wa.admin?$("#chatinput").attr("placeholder",""):($("#chatinput").attr("readonly",!1),$("#chatinput").attr("placeholder",""));"불건전닉네임"==wa.nickname&&(v(),la.close());"잘못된닉네임"==wa.nickname&&(v(),la.close());if(!wa.admin){$("#room-time").children("option")[9].remove();try{var a=console;Object.defineProperty(window,"console",{get:function(){if(a._commandLineAPI)throw"보안 정책상 일반 유저에게는 개발자 도구 사용이 금지됩니다.";return a},set:function(e){a=e}})}catch(e){}}wa.admin||(delete window.$Request,$(document).ready(function(){$(document).on("contextmenu dragstart selectstart",function(e){return!1})}));wa.honor?(console.log("1ST Gen"),w("BF끄투 초창기부터 기여했던 관리자입니다. 영구적으로 BF끄투에서 1세대 관리자 전용 혜택을 받게 됩니다.")):w("BF끄투는 끄투 원작자 쪼리핑님의 끄투 오픈소스 프로젝트를 기반으로 제작된 온라인 게임입니다.<br>다른 끄투 서버를 모방하거나 베끼지 않았습니다.<br>또한 다른 서버를 홍보하는 행위는 금지됩니다.");"msedge"==jQuery.browser.name&&$("#alertText").html("더 원할한 플레이를 위해서는 크롬 브라우저 사용을 권장합니다.");qe("lobby"),$("#Intro").animate({opacity:1},1e3).animate({opacity:0},1e3),$("#intro-text").text(L.welcome),p(function(){$("#Intro").hide()},2e3),wa.admin&&console.log("Administrator Mode\n(관리자 모드)"),e("devtools",()=>(alert("개발자 도구(F12)는 보안상의 이유로 사용하실 수 없습니다."),la.close()),wa,ca),e("macro",()=>(alert("운영정책 위반으로 서버와의 연결이 끊어졌습니다."),la.close()),wa,ca),f(e=>(alert("비정상적인 아이피로 판단되어 접근이 차단됐습니다."),la.close())),$.get(`/newUser?id=${wa.id}`,function(e){return 1==e.newUser?(k(),console.log(`NEWUSER: ${e.newuser}`)):console.log(`NEWUSER: ${e.newuser}`)}),wa.admin&&$("#badwordfilter").prepend('<option value="NO">필터링 안함</option>')}(),e.caj&&function(){if(!confirm(L.checkAgeAsk))return l("caj",{answer:"no"},!0);for(;;){for(var e=[],a=1;a<=3;){var o=prompt(L["checkAgeInput"+a]);if(o&&!isNaN(o=Number(o)))1==a&&(o<1e3||o>2999)?alert(o+"\n"+L.checkAgeNo):2==a&&(o<1||o>12)?alert(o+"\n"+L.checkAgeNo):3==a&&(o<1||o>31)?alert(o+"\n"+L.checkAgeNo):e[a++-1]=o;else if(--a<1)break}if(4==a){if(confirm(L.checkAgeSure+"\n"+e[0]+L.YEAR+" "+e[1]+L.MONTH+" "+e[2]+L.DATE))return l("caj",{answer:"yes",input:[e[1],e[2],e[0]]},!0)}else if(confirm(L.checkAgeCancel))return l("caj",{answer:"no"},!0)}}(),Q();break;case"conn":wa.setUser(e.user.id,e.user),R();break;case"disconn":wa.setUser(e.id,null),R();break;case"connRoom":wa._preQuick&&(ze("success"),ca.dialog.quick.hide(),wa.admin||delete wa._preQuick),ca.dialog.quick.hide(),wa.setUser(e.user.id,e.user),(o=wa.usersR[e.user.id]=e.user).id==wa.id?d():Ke((o.profile.title||o.profile.name)+L.hasJoined),R();break;case"disconnRoom":(o=wa.usersR[e.id])&&(wa.admin||delete wa.usersR[e.id],Ke((o.profile.title||o.profile.name)+L.hasLeft),R());break;case"forceleave":wa.id==e.id&&(l("leave"),alert("방이 관리자에 의해 삭제되었습니다."));break;case"forceready":wa.id==e.id&&(wa.room&&(wa.room.master==wa.id?ca.menu.start.trigger("click"):ca.menu.ready.trigger("click")),alert("관리자에 의해 준비 상태로 변경되었습니다."));break;case"forcespectate":wa.id==e.id&&(ca.menu.spectate.trigger("click"),alert("관리자에 의해 관전 상태로 변경되었습니다."));break;case"alert":wa.id==e.id&&alert(e.value);break;case"yellto":wa.id==e.id&&(oa(e.value),Ke(e.value,L.yell));break;case"banned":wa.id==e.id&&(alert(`차단되었습니다. 관리자에게 문의하세요.\n\n사유: ${e.reason}\n종료일: ${e.enddate}`),la.onclose=function(a){$("#Middle").empty(),$("#Bottom").html(`차단되었습니다. 관리자에게 문의하세요.<p>사유: ${e.reason}<br>종료일: ${e.enddate}`)},la.close());break;case"yell":oa(e.value),Ke(e.value,L.yell);break;case"update":la.onclose=function(e){Ne(),function(e){e||wa._gaming?wa._gaming||(ca.loading.show().html("새 클라이언트로 업데이트 중입니다...0%<p><p>패치 내용은 다음과 같습니다: "+e),setTimeout(function(){ca.loading.html("새 클라이언트로 업데이트 중입니다...50%<p><p>패치 내용은 다음과 같습니다: "+e),setTimeout(function(){ca.loading.html("새 클라이언트로 업데이트 중입니다...100%<p><p>패치 내용은 다음과 같습니다: "+e),setTimeout(function(){ca.loading.html("적용을 위해 새로고침합니다..."),location.reload()},1e3)},1e3)},1e3)):(ca.loading.show().html("새 클라이언트로 업데이트 중입니다...0%"),setTimeout(function(){ca.loading.html("새 클라이언트로 업데이트 중입니다...50%"),setTimeout(function(){ca.loading.html("새 클라이언트로 업데이트 중입니다...100%"),setTimeout(function(){ca.loading.html("적용을 위해 새로고침합니다..."),location.reload()},1e3)},1e3)},1e3))}(e.value)},la.close();break;case"freeze":wa._cF=!0,wa._gaming||(wa.admin?$("#chatinput").attr("placeholder","관리자 전용 채팅"):($("#chatinput").attr("readonly",!0),$("#chatinput").attr("placeholder","관리자 전용 채팅")));break;case"unfreeze":wa._cF=!1,wa._gaming||(wa.admin?$("#chatinput").attr("placeholder",""):($("#chatinput").attr("readonly",!1),$("#chatinput").attr("placeholder","")));break;case"info":Ke(e.value,L.info);break;case"dying":oa(L.dying),Ke(L.dying,L.yell);break;case"tail":Ke(e.a+"|"+e.rid+"@"+e.id+": "+(e.msg instanceof String?e.msg:JSON.stringify(e.msg)).replace(/</g,"&lt;").replace(/>/g,"&gt;"),"tail");break;case"chat":wa.admin?e.notice?Ke(L["error_"+e.code]):Ie(e.profile||{title:L.robot},e.value,e.from,e.timestamp):wa._cF?($("#chatinput").attr("readonly",!0),$("#chatinput").attr("placeholder","관리자 전용 채팅"),alert("채팅이 얼었습니다. 관리자만 채팅할 수 있습니다.")):Ie(e.profile||{title:L.robot},e.value,e.from,e.timestamp);break;case"drawCanvas":ca.game.canvas&&function(e){g("drawCanvas",e)}(e);break;case"roomStuck":da.close();break;case"preRoom":!function(e,a){var o=wa.URL.replace(/:(\d+)/,function(a,o){return":"+(Number(o)+416+Number(e)-1)})+"&"+e+"&"+a;da||(da=new Aa(o),d(L.connectToRoom+"\n<center><button id='ctr-close'>"+L.ctrCancel+"</button></center>"),$("#ctr-close").on("click",function(){d(),da&&da.close()}),da.onopen=function(o){console.log("room-conn",e,a)},da.onmessage=_onMessage,da.onclose=function(o){console.log("room-disc",e,a),da=void 0},da.onerror=function(e){console.warn(L.error,e)})}(e.channel,e.id);break;case"room":(function(e){var a,o,r,t;if(e.myRoom=wa.place==e.room.id||e.target==wa.id,e.myRoom){if($target=wa.users[e.target],e.kickVote&&(Ke(_($target.profile,e.kickVote)),$target.id==e.id&&alert(L.hasKicked)),-1==e.room.players.indexOf(wa.id))wa.room&&wa.room.gaming&&(Ne(),wa.practicing=!1,wa._gaming=!1,ca.box.room.height(360),qe("lobby")),wa.users[wa.id].game.ready=!1,wa.users[wa.id].game.team=0,wa.users[wa.id].game.form="J",ca.menu.spectate.removeClass("toggled"),ca.menu.ready.removeClass("toggled"),wa.room=null,wa.resulting=!1,wa._players=null,wa._master=null,wa.place=0,e.room.practice&&(wa.admin||delete wa.users[0],wa.room=wa._room,wa.place=wa._place,wa.master=wa.__master,wa._players=wa.__players,!wa.admin&&delete wa._room);else if(e.room.practice&&!wa.practicing&&(wa.practicing=!0,wa._room=wa.room,wa._place=wa.place,wa.__master=wa.master,wa.__players=wa._players),wa.room&&(wa._players=wa.room.players.toString(),wa._master=wa.room.master,wa._rTitle=wa.room.title,wa._rMode=Be(wa.room.mode,wa.room.opts,!0),wa._rLimit=wa.room.limit,wa._rRound=wa.room.round,wa._rTime=wa.room.time),wa.room=e.room,wa.place=wa.room.id,wa.master=wa.room.master==wa.id,e.spec&&e.target==wa.id){if(wa._spectate||(wa._spectate=!0,ce(),me()),e.boards){for(a in wa.selectedRound=1,e.prisoners)for(o in r=a.split(","),e.boards[r[0]])if((t=e.boards[r[0]][o])[0]==r[1]&&t[1]==r[2]&&t[2]==r[3]){t[4]=e.prisoners[a];break}Ca.Crossword.roundReady(e,!0),Ca.Crossword.turnStart(e,!0)}for(a in e.spec)wa.users[a].game.score=e.spec[a]}e.modify||e.target!=wa.id||Me()}if(e.target&&wa.users[e.target]&&(-1==e.room.players.indexOf(e.target)?wa.users[e.target].place=0:wa.users[e.target].place=e.room.id),!e.room.practice)if(e.room.players.length)for(a in wa.setRoom(e.room.id,e.room),e.room.readies)wa.users[a]&&(wa.users[a].game.ready=e.room.readies[a].r,wa.users[a].game.team=e.room.readies[a].t);else wa.setRoom(e.room.id,null)})(e),function(e){if(wa._players&&wa.room){var a,o,r={}+"",t=wa._players.split(",");t.length,wa.room.players.length;for(a in t)t[a]==r&&0;for(a in wa.room.players)wa.room.players[a].robot&&0;if(e){for(a in t)t[a]!=r&&(wa.users[t[a]].game.ready=!1);Ke(L.hasModified)}wa._gaming!=wa.room.gaming&&(wa.room.gaming?(ae(),wa._replay=!1,function(e){var a,o;for(a in ma={version:wa.version,me:wa.id,players:[],events:[],title:wa.room.title,roundTime:wa.room.time,round:wa.room.round,mode:wa.room.mode,limit:wa.room.limit,game:wa.room.game,opts:wa.room.opts,readies:wa.room.readies,time:(new Date).getTime()},wa.room.players){var r;o=wa.users[wa.room.players[a]]||wa.room.players[a],r={id:o.id,score:0},o.robot?(r.id=o.id,r.robot=!0,r.data={score:0},o={profile:E(o.level)}):(r.data=o.data,r.equip=o.equip),r.title="#"+o.id,ma.players.push(r)}wa._record=!0}(wa.room.game.title)):(wa._spectate?(ca.dialog.resultSave.hide(),wa._spectate=!1,qe("lobby")):(ca.dialog.resultSave.show(),wa.resulting=!0),clearInterval(wa._tTime))),wa._master!=wa.room.master&&Ke(((o=wa.users[wa.room.master]).profile.title||o.profile.name)+L.hasMaster),wa._players=wa.room.players.toString(),wa._master=wa.room.master,wa._gaming=wa.room.gaming}}(e.modify&&e.myRoom),D(e.myRoom),e.modify&&wa.room&&e.myRoom&&(wa._rTitle!=wa.room.title&&S(".room-head-title"),wa._rMode!=Be(wa.room.mode,wa.room.opts,!0)&&S(".room-head-mode"),wa._rLimit!=wa.room.limit&&S(".room-head-limit"),wa._rRound!=wa.room.round&&S(".room-head-round"),wa._rTime!=wa.room.time&&S(".room-head-time"));break;case"user":wa.setUser(e.id,e),wa.room&&D(wa.room.id==e.place);break;case"friends":for(a in wa._friends={},e.list)e.list[a].forEach(function(e){wa._friends[e]={server:a}});Q();break;case"friend":wa._friends[e.id]={server:"on"==e.stat&&e.s},wa._friends[e.id]&&wa.friends[e.id]&&Ke(("on"==e.stat?"&lt;<b>"+L["server_"+wa._friends[e.id].server]+"</b>&gt; ":"")+L.friend+" "+wa.friends[e.id]+L["fstat_"+e.stat]),Q();break;case"friendAdd":o=wa.users[e.from].profile,a=(o.title||o.name)+"(#"+e.from.substr(0,5)+")",l("friendAddRes",{from:e.from,res:!wa.opts.df&&confirm(a+L.attemptFriendAdd)},!0);break;case"friendAddRes":o=wa.users[e.target].profile,Ke((a=(o.title||o.name)+"(#"+e.target.substr(0,5)+")")+L["friendAddRes_"+(e.res?"ok":"no")]),e.res&&(wa.friends[e.target]=o.title||o.name,wa._friends[e.target]={server:wa.server},Q());break;case"friendEdit":wa.friends=e.friends,Q();break;case"starting":d(L.gameLoading);break;case"roundReady":g("roundReady",e);break;case"turnStart":g("turnStart",e);break;case"turnError":!function(e,a){ca.game.display.empty().append($("<label>").addClass("game-fail-text").text((L["turnError_"+e]?L["turnError_"+e]+": ":"")+a)),ze("fail"),clearTimeout(wa._fail),wa._fail=p(function(){ca.game.display.html(wa._char)},1800)}(e.code,e.value);break;case"turnHint":g("turnHint",e);break;case"turnEnd":e.score=Number(e.score),e.bonus=Number(e.bonus),wa.room&&(wa._tid=e.target||wa.room.game.seq[wa.room.game.turn],wa._tid&&(wa._tid.robot&&(wa._tid=wa._tid.id),function(e,a){g("turnEnd",e,a)}(wa._tid,e)),e.baby&&ze("success"));break;case"roundEnd":for(a in e.users)wa.setUser(a,e.users[a]);wa._resultRank=e.ranks,function(e,a){function o(e){var a,t,i;wa._result.goal=fa[wa._result.level-1],wa._result.before=fa[wa._result.level-2]||0,wa._result.reward.score>0&&((a=wa._result.reward.score*wa._coef)<.05&&wa._coef&&(a=wa._result.reward.score),wa._result.reward.score-=a,wa._result.exp+=a,t=xe(wa._result.exp),wa._result.level!=t&&(wa._result._boing-=wa._result.goal-wa._result._exp,wa._result._exp=wa._result.goal,ze("lvup")),wa._result.level=t,p(o,50)),i=wa._result.exp-wa._result._exp,r("before",wa._result._exp,wa._result.before,wa._result.goal),r("current",Math.min(i,wa._result._boing),0,wa._result.goal-wa._result.before),r("bonus",Math.max(0,i-wa._result._boing),0,wa._result.goal-wa._result.before),$(".result-me-level-body").html(wa._result.level),$(".result-me-score-text").html(ea(Math.round(wa._result.exp))+" / "+ea(wa._result.goal))}function r(e,a,o,r){$(".result-me-"+e+"-bar").width((a-o)/(r-o)*100+"%")}a||(a={});var t,i,n,s,l,d,m,u,g,h=$(".result-board").empty();for(t in $(".result-me-expl").empty(),ca.game.display.html(L.roundEnd),wa._resultPage=1,wa._result=null,wa._relay=!1,e)n=e[t],(i=wa._replay?ma.users[n.id]:wa.users[n.id])||(i=ga),i.data&&n.reward&&(n.reward.score=wa._replay?0:Math.round(n.reward.score),d=xe(m=i.data.score)>xe(i.data.score-n.reward.score),h.append(s=$("<div>").addClass("result-board-item").append(l=$("<div>").addClass("result-board-rank").html(n.rank+1)).append(De(m).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(i.profile.title||i.profile.name)).append($("<div>").addClass("result-board-score").html(a.scores?L.avg+" "+ea(a.scores[n.id])+L.kpm:ea(n.score||0)+L.PTS)).append($("<div>").addClass("result-board-reward").html(n.reward.score?"+"+ea(n.reward.score):"-")).append($("<div>").addClass("result-board-lvup").css("display",d?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(L.lvUp)))),i.game.team&&l.addClass("team-"+i.game.team),n.id==wa.id&&(n.exp=i.data.score-n.reward.score,n.level=xe(n.exp),wa._result=n,s.addClass("result-board-me"),$(".result-me-expl").append(function(e,a,o){function r(e,a,o){e.append($("<h5>").addClass("result-me-blog-head").html(a)).append($("<h5>").addClass("result-me-blog-body").html(o))}var t,i,n=$("<div>").append($("<h4>").html(L.scoreGain)).append(t=$("<div>")).append($("<h4>").html(L.moneyGain)).append(i=$("<div>"));return r(t,L.scoreOrigin,e),r(i,L.moneyOrigin,a),o.forEach(function(o){var n,s,l,d=o.charAt(0),c=o.charAt(1),m=o.slice(2,5),u=Number(o.slice(5));"EXP"==m?(n=t,l=e):"MNY"==m&&(n=i,l=a),"g"==c?s="+"+(l*u).toFixed(1):"h"==c&&(s="+"+Math.floor(u)),r(n,L["bonusFrom_"+d],s)}),n}(n.reward._score,n.reward._money,n.reward._blog))));$(".result-me").css("opacity",0),wa._coef=0,wa._result&&(u=wa._result.reward.score-wa._result.reward._score,g=wa._result.reward.money-wa._result.reward._money,wa._result._exp=wa._result.exp,wa._result._score=wa._result.reward.score,wa._result._bonus=u,wa._result._boing=wa._result.reward._score,wa._result._addit=u,wa._result._addp=g,u=u>0?"<label class='result-me-bonus'>(+"+ea(u)+")</label>":"",g=g>0?"<label class='result-me-bonus'>(+"+ea(g)+")</label>":"",Ke(L.scoreGain+": "+ea(wa._result.reward.score)+", "+L.moneyGain+": "+ea(wa._result.reward.money)+", "+L.rankPointGain+": "+ea(wa._result.reward.rankPoint)),$(".result-me").css("opacity",1),$(".result-me-score").html(L.scoreGain+" +"+ea(wa._result.reward.score)+u),$(".result-me-money").html(L.moneyGain+" +"+ea(wa._result.reward.money)+g)),p(function(){c(ca.dialog.result),wa._result&&o(!0),ca.dialog.result.css("opacity",0).animate({opacity:1},500),p(function(){wa._coef=.05},500)},2e3),wa._record=!1}(e.result,e.data);break;case"kickVote":wa._kickTarget=wa.users[e.target],wa.id!=e.target&&wa.id!=wa.room.master&&function(e){var a=wa.users[e].profile;$("#kick-vote-text").html((a.title||a.name)+L.kickVoteText),wa.kickTime=10,wa._kickTime=10,wa._kickTimer=p($e,1e3),c(ca.dialog.kickVote)}(e.target),Ke((wa._kickTarget.profile.title||wa._kickTarget.profile.name)+L.kickVoting);break;case"kickDeny":Ke(_(wa._kickTarget.profile,e));break;case"invited":l("inviteRes",{from:e.from,res:!wa.opts.di&&confirm(e.from+L.invited)});break;case"inviteNo":Ke(((o=wa.users[e.target]).profile.title||o.profile.name)+L.inviteDenied);break;case"okg":wa._playTime>e.time?Ke(L.okgExpired):wa._okg!=e.count&&Ke(L.okgNotice+" ("+L.okgCurrent+e.count+")"),wa._playTime=e.time,wa._okg=e.count;break;case"obtain":Qe(e);break;case"expired":for(a in e.list)Ke(He(e.list[a])+L.hasExpired);break;case"blocked":Ke(L.blocked);break;case"test":(wa._test=!wa._test)?(wa._testt=u(function(){ca.talk.val()!=wa._ttv&&(l("test",{ev:"c",v:ca.talk.val()},!0),wa._ttv=ca.talk.val())},100),document.onkeydown=function(e){l("test",{ev:"d",c:e.keyCode},!0)},document.onkeyup=function(e){l("test",{ev:"u",c:e.keyCode},!0)}):(clearInterval(wa._testt),document.onkeydown=void 0,document.onkeyup=void 0);break;case"error":if(a=e.message||"",401==e.code);else if(403==e.code)d();else if(406==e.code){if(ca.dialog.quick.is(":visible")){wa._preQuick=!1;break}}else if(409==e.code)a=L["server_"+a];else{if(416==e.code)return void(confirm(L["error_"+e.code])&&(Oe(),wa._spectate=!0,wa._gaming=!0,l("enter",{id:e.target,password:wa._pw,spectate:!0},!0)));if(413==e.code)ca.dialog.room.hide(),ca.menu.setRoom.trigger("click");else if(429==e.code)qe("lobby");else if(430==e.code){if(wa.setRoom(e.message,null),ca.dialog.quick.is(":visible")){wa._preQuick=!1;break}}else if(431==e.code||432==e.code||433==e.code)ca.dialog.room.show();else if(447===e.code){alert("자동화 봇 방지를 위한 캡챠 인증에 실패했습니다. 메인 화면에서 다시 시도해 주세요.");break}}402==e.code?(w("[게스트 접속 제한] "+L["error_"+e.code]+a),$("#intro-text").html("이 서버는 게스트 접속을 허용하지 않습니다."),$("#intro").attr("src","/img/kkutu/def.png"),$("#Bottom").empty()):444==e.code?e.reason?(alert(`차단되었습니다. 관리자에게 문의하세요.\n\n사유: ${e.reason}\n종료일: ${e.enddate}`),la.onclose=function(a){$("#intro").attr("src","/img/kkutu/def.png"),$("#Bottom").empty(),$("#intro-text").html(`차단되었습니다. 관리자에게 문의하세요.<p>사유: ${e.reason}<br>종료일: ${e.enddate}`)},la.close()):(alert("차단이 해제되었습니다. 재접속합니다."),la.onclose=function(e){$("#intro").attr("src","/img/kkutu/def.png"),$("#Bottom").empty(),$("#intro-text").html("차단이 해제되었습니다. 재접속 해주세요.")},location.reload()):alert("[#"+e.code+"] "+L["error_"+e.code]+a)}wa._record&&de(e)}function f(e){$.getJSON("https://ipinfo.io/",a=>{if(wa.admin)console.log(`접속 아이피: ${a.ip}`),console.log(`접속 지역: ${a.country}`);else if(-1==Ra.indexOf(a.country))return e(a)})}function v(){var e=prompt("불건전하거나 잘못된 닉네임을 사용하였으므로 닉네임이 강제로 변경되었습니다. 새로운 닉네임을 입력해 주세요.");return null==e?v():null==e?v():/[(ㄱ-ㅎ)]/gi.test(e)?(alert("닉네임을 자음만으로 지정하실 수 없습니다."),v()):/[(가-힣a-zA-Z)]/gi.test(e)?e.length>10?(alert("닉네임 길이 제한은 최대 10글자까지입니다."),v()):e.match("<")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),v()):e.match(">")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),v()):e.match("&lt")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),v()):e.match("　")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),v()):e.match("불건전닉네임")?(alert("이 닉네임은 닉네임으로 지정할 수 없습니다."),v()):e.match("잘못된닉네임")?(alert("이 닉네임은 닉네임으로 지정할 수 없습니다."),v()):($.post("/nickname",{data:Pe(e)}),alert("닉네임이 "+e+"(으)로 변경되었습니다. 재접속 해주세요.")):(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),v())}function k(){$("#Intro").empty(),$(".UserListBox").empty(),$(".RoomListBox").empty(),$(".MeBox").empty(),$(".ChatBox").empty(),$(".ADBox").empty(),$(".kkutu-menu").empty(),$("#Bottom").empty(),$("#prompt").css("text-align","center"),$("#promptbtn").attr("style","display: flex; align-items: center; justify-content: center;"),$("#promptText").html("BF끄투에서 사용할 닉네임을 입력하세요."),c(ca.dialog.promptKKuTu)}function _(e,a){var o=L.agree+" "+a.Y+", "+L.disagree+" "+a.N+L.kickCon;return a.Y>=a.N?o+=(e.title||e.name)+L.kicked:o+=(e.title||e.name)+L.kickDenied,o}function y(e){var a,o,r={"/ㄱ":L.cmd_r,"/청소":L.cmd_cls,"/ㄹ":L.cmd_f,"/ㄷ":L.cmd_e,"/ㄷㄷ":L.cmd_ee,"/무시":L.cmd_wb,"/차단":L.cmd_shut,"/id":L.cmd_id};switch(e[0].toLowerCase()){case"/ㄱ":case"/r":wa.room&&(wa.room.master==wa.id?ca.menu.start.trigger("click"):ca.menu.ready.trigger("click"));break;case"/청소":case"/cls":$("#Chat").empty();break;case"/ㄹ":case"/f":c(ca.dialog.chatLog),ca.chatLog.scrollTop(999999999);break;case"/귓":case"/ㄷ":case"/e":C(e[1],e.slice(2).join(" "));break;case"/답":case"/ㄷㄷ":case"/ee":wa._recentFrom?C(wa._recentFrom,e.slice(1).join(" ")):Ke(L.error_425);break;case"/무시":case"/wb":!function(e){wa._wblock.hasOwnProperty(e)?(wa.admin||delete wa._wblock[e],Ke(e+L.wnblocked)):(wa._wblock[e]=!0,Ke(e+L.wblocked))}(e[1]);break;case"/차단":case"/shut":A(e.slice(1).join(" "));break;case"/아이디":case"/id":if(e[1]){for(a in o=0,e[1]=e.slice(1).join(" "),wa.users)(wa.users[a].profile.title||wa.users[a].profile.name)==e[1]&&Ke("["+ ++o+"] "+a);o||Ke(L.error_405)}else Ke(L.myId+wa.id);break;default:for(a in r)Ke(r[a],a)}}function w(e){c(ca.dialog.alertKKuTu),$("#alert").css("text-align","center"),$("#alertbtn").attr("style","display: flex; align-items: center; justify-content: center;"),$("#alertText").html(e)}function C(e,a){a.length&&(wa._whisper=e,l("talk",{whisper:e,value:a},!0),Ie({title:"→"+e},a,!0))}function A(e){wa._shut.hasOwnProperty(e)?(wa.admin||delete wa._shut[e],Ke(e+L.userNShut)):(wa._shut[e]=!0,Ke(e+L.userShut))}function T(e,a){var o=(e=e.replace(/[^\sa-zA-Zㄱ-ㅎ0-9가-힣]/g,"")).match(/[ㄱ-ㅎ가-힣]/)?"ko":"en";if(e.length<1)return a({error:404});$.get("/dict/"+e+"?lang="+o,a)}function x(){return wa.place?wa.room.gaming||wa.resulting?"for-gaming":wa.master?"for-master":"for-normal":"for-lobby"}function D(e,a){var o,r=x();if(wa._replay){if(void 0!==e&&!e)return;le()}if(!wa._replay&&("for-gaming"!=r||e)){for(o in wa.practicing&&(r="for-gaming"),$(".kkutu-menu button").hide(),ca.box)ca.box[o].hide();ca.box.me.show(),ca.box.chat.show().width(790).height(190),ca.chat.height(120),"for-lobby"==r?(wa._ar_first=!0,ca.box.userList.show(),wa._shop?(ca.box.roomList.hide(),ca.box.shop.show()):(ca.box.roomList.show(),ca.box.shop.hide()),R(a||r!=wa._only),z(a||r!=wa._only),B(),wa._jamsu&&(clearTimeout(wa._jamsu),wa.admin||delete wa._jamsu)):"for-master"==r||"for-normal"==r?($(".team-chosen").removeClass("team-chosen"),wa.users[wa.id].game.ready||"S"==wa.users[wa.id].game.form?(ca.menu.ready.addClass("toggled"),$(".team-selector").addClass("team-unable")):(ca.menu.ready.removeClass("toggled"),$(".team-selector").removeClass("team-unable"),$("#team-"+wa.users[wa.id].game.team).addClass("team-chosen"),wa.opts.ar&&wa._ar_first&&(ca.menu.ready.addClass("toggled"),ca.menu.ready.trigger("click"),wa._ar_first=!1)),wa._shop=!1,ca.box.room.show().height(360),"for-master"==r&&ca.dialog.inviteList.is(":visible")&&R(),P(!1),B()):"for-gaming"==r&&(wa._gAnim&&(ca.box.room.show(),wa._gAnim=!1),wa._shop=!1,wa._ar_first=!0,ca.box.me.hide(),ca.box.game.show(),$(".ChatBox").width(1e3).height(140),ca.chat.height(70),P(!0)),wa._only=r,function(e){location.hash=e?"#"+e:""}(wa.place),$(".kkutu-menu ."+r).show()}}function S(e){$(e).addClass("room-head-modified"),p(function(){$(e).removeClass("room-head-modified")},3e3)}function B(){var e,a=wa.users[wa.id],o=0,r=xe(a.data.score),t=fa[r-2]||0,i=fa[r-1],n=Fe(a);for(e in a.data.record)o+=a.data.record[e][1];Xe(".my-image",a.equip,a.id),$(".my-stat-level").replaceWith(De(a.data.score).addClass("my-stat-level")),$(".my-stat-name").text(a.profile.title||a.profile.name),$(".my-stat-record").html(L.globalWin+" "+o+L.W),$(".my-stat-ping").html(ea(a.money)+L.ping),$(".my-rankPoint").html(a.data.rankPoint+L.LP),$(".my-rank").html(L[n]),$(".my-okg .graph-bar").width(wa._playTime%6e5/6e3+"%"),$(".my-okg-text").html(j(wa._playTime)),$(".my-level").html(L.LEVEL+" "+r),$(".my-gauge .graph-bar").width((a.data.score-t)/(i-t)*190),$(".my-gauge-text").html(ea(a.data.score)+" / "+ea(i))}function j(e){var a=Math.floor(e/6e4)%60,o=Math.floor(.001*e)%60,r=Math.floor(e/36e5),t=[];return r&&t.push(r+L.HOURS),a&&t.push(a+L.MINUTE),r||t.push(o+L.SECOND),t.join(" ")}function R(e){var a,o,r,t=0;if(wa.opts.su){for(a in r=[],wa.users)t++,r.push(wa.users[a]);r.sort(function(e,a){return a.data.score-e.data.score}),e=!0}else for(a in r=wa.users,wa.users)t++;if(ca.lobby.userListTitle.html("<i class='fa fa-users'></i>&lt;<b>"+L["server_"+wa.server]+"</b>&gt; "+L.UserList.replace("FA{users}","")+" ["+t+L.MN+"]"),e)for(a in ca.lobby.userList.empty(),ca.dialog.inviteList.empty(),r)(o=r[a]).robot||(ca.lobby.userList.append(q(o)),0==o.place&&ca.dialog.inviteList.append(q(o,!0)))}function q(e,a){var o;return O(o=a?$("<div>").attr("id","invite-item-"+e.id).addClass("invite-item users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(De(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name").html(e.profile.title||e.profile.name)).on("click",function(e){X($(e.currentTarget).attr("id").slice(12))}):$("<div>").attr("id","users-item-"+e.id).addClass("users-item").append($("<div>").addClass("jt-image users-image").css("background-image","url('"+e.profile.image+"')")).append(De(e.data.score).addClass("users-level")).append($("<div>").addClass("users-name ellipse").html(e.profile.title||e.profile.name)).on("click",function(e){Y($(e.currentTarget).attr("id").slice(11))}),e),o}function O(e,a){a.equip.NIK&&e.addClass("x-"+a.equip.NIK),"b9_bf"==a.equip.BDG&&e.addClass("x-bf"),"b5_yt"==a.equip.BDG&&e.addClass("x-yt"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"b6_word"==a.equip.BDG&&e.addClass("x-word"),"b6_design"==a.equip.BDG&&e.addClass("x-design"),"b5_bj"==a.equip.BDG&&e.addClass("x-bj"),"1yearbadge"==a.equip.BDG&&e.addClass("x-1yearbadge"),"b6_usermanage"==a.equip.BDG&&e.addClass("x-uman"),"b6_develop"==a.equip.BDG&&e.addClass("x-develop"),"b7_general_affairs"==a.equip.BDG&&e.addClass("x-money"),"b1_master"==a.equip.BDG&&e.addClass("x-master"),"b1_master2"==a.equip.BDG&&e.addClass("x-master"),"b8_assist_manager"==a.equip.BDG&&e.addClass("x-premanager"),"b6_music"==a.equip.BDG&&e.addClass("x-music"),"b1_challenger2"==a.equip.BDG&&e.addClass("x-challenger"),"b1_champion2"==a.equip.BDG&&e.addClass("x-champion"),"b9_honor"==a.equip.BDG&&e.addClass("x-honor")}function z(e){var a,o=0;if(e){for(a in ca.lobby.roomList.empty(),wa.rooms)ca.lobby.roomList.append(N(wa.rooms[a])),o++;$("#roomlist-loading").hide()}else for(a in $(".rooms-create").remove(),wa.rooms)o++;ca.lobby.roomListTitle.html(L.RoomList.replace("FA{bars}","<i class='fa fa-bars'></i>")+" ["+o+L.GAE+"]"),o?($(".rooms-gaming").css("display",wa.opts.ow?"none":""),$(".rooms-locked").css("display",wa.opts.ou?"none":"")):ca.lobby.roomList.append(ca.lobby.createBanner.clone().on("click",function(e){ca.menu.newRoom.trigger("click")}))}function N(e){var a,o,r=Be(e.mode,e.opts);return a=$("<div>").attr("id","room-"+e.id).addClass("rooms-item").append(o=$("<div>").addClass("rooms-channel channel-"+e.channel).on("click",function(a){!function(e){var a=wa.rooms[e],o=$("#ri-players").empty();wa._roominfo=e,$("#RoomInfoDiag .dialog-title").html(e+L.sRoomInfo),$("#ri-title").html((a.password?"<i class='fa fa-lock'></i>&nbsp;":"")+a.title),$("#ri-mode").html(L["mode"+ra[a.mode]]),$("#ri-round").html(a.round+", "+a.time+L.SECOND),$("#ri-limit").html(a.players.length+" / "+a.limit),a.players.forEach(function(e,r){var t,i,n=a.readies[e]||{};e=wa.users[e]||ga,a.players[r].robot?(e.profile={title:L.robot},e.equip={robot:!0}):n.t=n.t||0,o.append($("<div>").addClass("ri-player").append(i=$("<div>").addClass("moremi rip-moremi")).append(t=$("<div>").addClass("ellipse rip-title").html(e.profile.title||e.profile.name)).append($("<div>").addClass("rip-team team-"+n.t).html($("#team-"+n.t).html())).append($("<div>").addClass("rip-form").html(L["pform_"+n.f]))),e.id==a.master&&t.prepend($("<label>").addClass("rip-master").html("["+L.master+"]&nbsp;")),t.prepend(De(e.data.score).addClass("profile-level rip-level")),Xe(i,e.equip,e.id)}),c(ca.dialog.roomInfo),ca.dialog.roomInfo.show()}(e.id)})).append($("<div>").addClass("rooms-number").html(e.id)).append($("<div>").addClass("rooms-title ellipse").text(Ee(e.title))).append($("<div>").addClass("rooms-limit").html(e.players.length+" / "+e.limit)).append($("<div>").width(270).append($("<div>").addClass("rooms-mode").html(r.join(" / ").toString())).append($("<div>").addClass("rooms-round").html(L.rounds+" "+e.round)).append($("<div>").addClass("rooms-time").html(e.time+L.SECOND))).append($("<div>").addClass("rooms-lock").html(e.password?"<i class='fa fa-lock'></i>":"<i class='fa fa-unlock'></i>")).on("click",function(e){e.target!=o.get(0)&&Ze($(e.currentTarget).attr("id").slice(5))}),e.gaming&&a.addClass("rooms-gaming"),e.admin&&a.addClass("rooms-admin"+(e.gaming?"-gaming":"-waiting")),e.password&&a.addClass("rooms-locked"),a}function Z(e){var a,o,r,t=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append(a=$("<div>").addClass("moremi game-user-image")).append($("<div>").addClass("game-user-title").append(De(e.data.score).addClass("game-user-level")).append(r=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name)).append($("<div>").addClass("expl").html(L.LEVEL+" "+xe(e.data.score)))).append(o=$("<div>").addClass("game-user-score"));return Xe(a,e.equip,e.id),global.expl(t),O(r,e),e.game.team&&o.addClass("team-"+e.game.team),t}function M(e){var a,o,r=$("<div>").attr("id","game-user-"+e.id).addClass("game-user").append($("<div>").addClass("game-user-title").append(De(e.data.score).addClass("game-user-level")).append(o=$("<div>").addClass("game-user-name ellipse").html(e.profile.title||e.profile.name))).append(a=$("<div>").addClass("game-user-score"));return e.id==wa.id&&o.addClass("game-user-my-name"),O(o,e),e.game.team&&a.addClass("team-"+e.game.team),r}function E(e){return{title:L["aiLevel"+e]+" "+L.robot,image:"/img/kkutu/robot.png"}}function P(e){var a,o,r,t,i,n,s,l=na[ra[wa.room.mode]],d=ua||l.big?M:Z,c=!1,m=!0;if(je($(".RoomBox .product-title"),wa.room),je($(".GameBox .product-title"),wa.room),e){for(a in r=$(".GameBox .game-body").empty(),wa.room.game.seq)(o=wa._replay?ma.users[wa.room.game.seq[a]]||wa.room.game.seq[a]:wa.users[wa.room.game.seq[a]]||wa.robots[wa.room.game.seq[a].id]||wa.room.game.seq[a]).robot&&!o.profile&&(o.profile=E(o.level),wa.robots[o.id]=o),r.append(d(o)),G(o.id,o.game.score||0);clearTimeout(wa._jamsu),!wa.admin&&delete wa._jamsu}else{for(a in r=$(".room-users").empty(),g="S"==wa.users[wa.id].game.form,wa.room.players)if((o=wa.users[wa.room.players[a]]||wa.room.players[a]).game){var u=o.game.practice?"/"+L.stat_practice:"",g="S"==o.game.form&&"/"+L.stat_spectate;o.robot&&(o.profile=E(o.level),wa.robots[o.id]=o),r.append($("<div>").attr("id","room-user-"+o.id).addClass("room-user").append(n=$("<div>").addClass("moremi room-user-image")).append($("<div>").addClass("room-user-stat").append(t=$("<div>").addClass("room-user-ready")).append(i=$("<div>").addClass("room-user-team team-"+o.game.team).html($("#team-"+o.game.team).html()))).append($("<div>").addClass("room-user-title").append(De(o.data.score).addClass("room-user-level")).append(s=$("<div>").addClass("room-user-name").text(o.profile.title||o.profile.name))).on("click",function(e){Y($(e.currentTarget).attr("id").slice(10))})),Xe(n,o.equip,o.id),g&&i.hide(),o.id==wa.room.master?t.addClass("room-user-master").html(L.master+u+(g||"")):g?t.addClass("room-user-spectate").html(L.stat_spectate+u):o.game.ready||o.robot?(t.addClass("room-user-readied").html(L.stat_ready),o.robot||(c=!0)):o.game.practice?(t.addClass("room-user-practice").html(L.stat_practice),m=!1):(t.html(L.stat_noready),m=!1),O(s,o)}c&&wa.room.master==wa.id&&m?wa._jamsu||(wa._jamsu=p(F,5e3)):(clearTimeout(wa._jamsu),!wa.admin&&delete wa._jamsu)}ca.dialog.profile.is(":visible")&&Y(wa._profiled)}function F(){Ke(L.subJamsu),wa._jamsu=p(function(){l("leave"),alert(L.masterJamsu)},3e4)}function G(e,a){var o;return(o=wa["_s"+e])?(clearTimeout(o.timer),o.$obj=$("#game-user-"+e+" .game-user-score"),o.goal=a):o=wa["_s"+e]={$obj:$("#game-user-"+e+" .game-user-score"),goal:a,now:0},I(o),$("#game-user-"+e)}function I(e){var a=(e.goal-e.now)*Math.min(1,.01*ha);a<.1?a=e.goal-e.now:e.timer=p(I,ha,e),e.now+=a,function(e,a){var o,r=a>99999?s(Math.round(.001*a),4)+"k":s(a,5);for(e.empty(),o=0;o<r.length;o++)e.append($("<div>").addClass("game-user-score-char").html(r[o]))}(e.$obj,Math.round(e.now))}function K(e){var a=$("#dress-view"),o=wa.users[wa.id];Xe(a,o.equip,o.id),$(".dress-type.selected").removeClass("selected"),$("#dress-type-all").addClass("selected"),$("#dress-nickname").val(o.nickname),$("#dress-exordial").val(o.exordial),J(e||!0)}function U(e,a,o,r,t){var i,n,s,l,d,c,m=[],u=!0===o;for(c in e.empty(),r||(r={}),r)wa.box.hasOwnProperty(r[c])||(wa.box[r[c]]={value:0});for(c in wa.box)m.push({key:c,obj:Je(c),value:wa.box[c]});for(c in m.sort(function(e,a){return e.obj.name<a.obj.name?-1:1}),m)n=m[c].obj,s=m[c].value,"BDG"==(l=n.group).substr(0,3)&&(l="BDG"),d="Mhand"==l?r.Mlhand==m[c].key||r.Mrhand==m[c].key:r[l]==m[c].key,"number"==typeof s&&(s={value:s}),(s.hasOwnProperty("value")||d)&&(u||-1!=o.indexOf(n.group))&&(e.append(i=$("<div>").addClass("dress-item").append(Se(n.image).addClass("dress-item-image").html("x"+s.value)).append(be(n,d,s.expire))),i.attr("id",a+"-"+n._id).on("click",t),d&&i.addClass("dress-equipped"));global.expl(e)}function J(e){var a,o=wa.users[wa.id].equip||{},r=!0===e;wa._avGroup=e,a=!!r||(e||"").split(","),U($("#dress-goods"),"dress",a,o,function(e){var a,o=$(e.currentTarget),r=o.attr("id").slice(6),t=Je(r);if(e.ctrlKey){if(o.hasClass("dress-equipped"))return aa(426);if(!confirm(L.surePayback+ea(Math.round(.2*(t.cost||0)))+L.ping))return;$.post("/payback/"+r,function(e){if(e.error)return aa(e.error);alert(L.painback),wa.box=e.box,wa.users[wa.id].money=e.money,K(wa._avGroup),D(!1)})}else if(-1!=ia.indexOf(t.group))"Mhand"==t.group&&(a=confirm(L.dressWhichHand)),function(e,a){var o=wa.users[wa.id],r=wa.shop[e].group;"Mhand"==r&&(r=a?"Mlhand":"Mrhand"),"BDG"==r.substr(0,3)&&(r="BDG");var t=o.equip[r]==e;confirm(L[t?"sureUnequip":"sureEquip"]+": "+L[e][0])&&$.post("/equip/"+e,{isLeft:a},function(e){if(e.error)return aa(e.error);wa.box=e.box,o.equip=e.equip,K(wa._avGroup),l("refresh"),D(!1)})}(r,a);else if("CNS"==t.group){if(!confirm(L.sureConsume))return;$.post("/consume/"+r,function(e){e.exp&&Ke(L.obtainExp+": "+ea(e.exp)),e.money&&Ke(L.obtainMoney+": "+ea(e.money)),e.gain.forEach(function(e){Qe(e)}),wa.box=e.box,wa.users[wa.id].data=e.data,l("refresh"),K(wa._avGroup),B()})}})}function H(){function e(){r.html($("<h4>").css("padding-top","8px").width("100%").html(L.cfTray))}function a(){var a,n={WPC:1,WPB:2,WPA:3},l="",d=0;r.empty(),$(".cf-tray-selected").removeClass("cf-tray-selected"),wa._tray.forEach(function(e){a=Je(e),l+=e.slice(4),d+=n[e.slice(1,4)],r.append($("<div>").addClass("jt-image").css("background-image","url("+a.image+")").attr("id","cf-tray-"+e).on("click",o)),$("#cf-\\"+e).addClass("cf-tray-selected")}),t.html(L.searching),i.empty(),ca.dialog.cfCompose.removeClass("cf-composable"),s.html(""),T(l,function(e){var a=!1;if(e.error){if(3!=l.length)return t.html(L["wpFail_"+e.error]);a=!0,t.html(L.cfBlend)}(function(e,a,o){$.get("/cf/"+e+"?l="+a+"&b="+(o?"1":""),function(e){if(e.error)return aa(e.error);i.empty(),e.data.forEach(function(e){var a=Je(e.key),o=e.rate>=1?L.cfRewAlways:(100*e.rate).toFixed(1)+"%";i.append($("<div>").addClass("cf-rew-item").append($("<div>").addClass("jt-image cf-rew-image").css("background-image","url("+a.image+")")).append($("<div>").width(100).append($("<div>").width(100).html(a.name)).append($("<div>").addClass("cf-rew-value").html("x"+e.value))).append($("<div>").addClass("cf-rew-rate").html(o)))}),s.html(L.cfCost+": "+e.cost+L.ping)})})(l,d,a),ca.dialog.cfCompose.addClass("cf-composable"),e.error||t.html(Le(e.word,e.mean,e.theme,e.type.split(",")))}),""==l&&e()}function o(e){var o=$(e.currentTarget).attr("id").slice(8),r=wa._tray.indexOf(o);-1!=r&&(wa._tray.splice(r,1),a())}var r=$("#cf-tray"),t=$("#cf-dict"),i=$("#cf-reward"),n=$("#cf-goods"),s=$("#cf-cost");wa._tray=[],t.empty(),i.empty(),s.html(""),ca.dialog.cfCompose.removeClass("cf-composable"),U(n,"cf",["PIX","PIY","PIZ"],null,function(e){var o,r=$(e.currentTarget).attr("id").slice(3),t=wa.box[r],i=0;if(wa._tray.length>=100)return aa(435);for(o in wa._tray)wa._tray[o]==r&&i++;t-i>0?(wa._tray.push(r),a()):aa(434)}),e()}function W(e){var a=ca.dialog.lbTable.empty(),o=e.data[0]?e.data[0].rank:0,r=(e.page||Math.floor(o/20))+1;e.data.forEach(function(e,o){var r=wa.users[e.id];r=r?r.profile.title||r.profile.name:L.hidden,e.score=Number(e.score),a.append($("<tr>").attr("id","ranking-"+e.id).addClass("ranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(De(e.score).addClass("ranking-image")).append($("<label>").css("padding-top",2).html(xe(e.score)))).append($("<td>").html(r)).append($("<td>").html(ea(e.score))))}),$("#ranking-"+wa.id).addClass("ranking-me"),ca.dialog.lbPage.html(L.page+" "+r),ca.dialog.lbPrev.attr("disabled",r<=1),ca.dialog.lbNext.attr("disabled",e.data.length<15),ca.dialog.lbMe.attr("disabled",!!wa.guest),wa._lbpage=r-1}function V(e){var a=ca.dialog.rplbTable.empty(),o=e.data[0]?e.data[0].rank:0,r=(e.page||Math.floor(o/20))+1;e.data.forEach(function(e,o){var r=wa.users[e.id];r=r?r.profile.title||r.profile.name:L.hidden,a.append($("<tr>").attr("id","rpranking-"+e.id).addClass("rpranking-"+(e.rank+1)).append($("<td>").html(e.rank+1)).append($("<td>").append(function(e,a){var o=Ge(e,a);return $("<div>").css({float:"left","background-image":`url('/img/kkutu/rankicon/${o}.png')`,"background-position":"100% 100%","background-size":"100%"})}(e.score,e.id).addClass("rpranking-image")).append($("<label>").css("padding-top",2).html(L[`${Ge(e.score,e.id)}`]))).append($("<td>").html(r)).append($("<td>").html(ea(e.score))))}),$("#rpranking-"+wa.id).addClass("rpranking-me"),ca.dialog.rplbPage.html(L.page+" "+r),ca.dialog.rplbPrev.attr("disabled",r<=1),ca.dialog.rplbNext.attr("disabled",e.data.length<15),ca.dialog.rplbMe.attr("disabled",!!wa.guest),wa._rplbpage=r-1}function Q(){function e(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),o=wa.friends[a],r=prompt(L.friendEditMemo,o);r&&l("friendEdit",{id:a,memo:r},!0)}function a(e){var a=$(e.currentTarget).parent().parent().attr("id").slice(4),o=wa.friends[a];if(wa._friends[a].server)return aa(455);confirm(o+"(#"+a.substr(0,5)+")\n"+L.friendSureRemove)&&l("friendRemove",{id:a},!0)}var o,r,t,i,n=0;for(o in ca.dialog.commFriends.empty(),wa.friends)n++,i=wa.friends[o],r=wa._friends[o]||{},t=(wa.users[o]||{}).profile,ca.dialog.commFriends.append($("<div>").addClass("cf-item").attr("id","cfi-"+o).append($("<div>").addClass("cfi-status cfi-stat-"+(r.server?"on":"off"))).append($("<div>").addClass("cfi-server").html(r.server?L["server_"+r.server]:"-")).append($("<div>").addClass("cfi-name ellipse").html(t?t.title||t.name:L.hidden)).append($("<div>").addClass("cfi-memo ellipse").text(i)).append($("<div>").addClass("cfi-menu").append($("<i>").addClass("fa fa-pencil").on("click",e)).append($("<i>").addClass("fa fa-remove").on("click",a))));$("#CommunityDiag .dialog-title").html(L.communityText+" ("+n+" / 100)")}function Y(e){var a,o,r,t=wa.users[e]||wa.robots[e],i=$("#profile-record").empty(),n=wa.users[e];if(t){if(!t.robot){var s=Fe(n);$("#rankicon").attr("src","/img/kkutu/rankicon/"+s+".png")}if($("#ProfileDiag .dialog-title").text((t.profile.title||t.profile.name)+L.sProfile),$(".profile-head").empty().append(a=$("<div>").addClass("moremi profile-moremi")).append($("<div>").addClass("profile-head-item").append(Se(t.profile.image).addClass("profile-image")).append($("<div>").addClass("profile-title ellipse").text(t.profile.title||t.profile.name).append($("<label>").addClass("profile-tag").html(" #"+t.id.toString().substr(0,5))))).append($("<div>").addClass("profile-head-item").append(De(t.data.score).addClass("profile-level")).append($("<div>").addClass("profile-level-text").html(L.LEVEL+" "+(r=xe(t.data.score)))).append($("<div>").addClass("profile-score-text").html(ea(t.data.score)+" / "+ea(fa[r-1])+L.PTS))).append(o=$("<div>").addClass("profile-head-item profile-exordial ellipse").text(Ee(t.exordial||"")).append($("<div>").addClass("expl").css({"white-space":"normal",width:300,"font-size":"11px"}).text(t.exordial))),t.robot)ca.dialog.profileLevel.show(),ca.dialog.profileLevel.prop("disabled",wa.id!=wa.room.master),$("#rank").html(L.UNRANKED),$("#rankpoint").html(L["0LP"]),$("#profile-place").html(wa.room.id+L.roomNumber);else{for(r in $.get(`/clan?type=getclan&id=${t.id}`,function(e){var a=$(".profile-title.ellipse").html();e.name?$(".profile-title.ellipse").html(`[${e.name}] ${a}`):$(".profile-title.ellipse").html(`${a}`)}),ca.dialog.profileLevel.hide(),$("#rank").html(L[s]),$("#rankpoint").html(n.data.rankPoint+L.LP),$("#profile-place").html(t.place?t.place+L.roomNumber:L.lobby),t.data.record){var l=t.data.record[r];i.append($("<div>").addClass("profile-record-field").append($("<div>").addClass("profile-field-name").html(L["mode"+r])).append($("<div>").addClass("profile-field-record").html(l[0]+L.P+" "+l[1]+L.W)).append($("<div>").addClass("profile-field-score").html(ea(l[2])+L.PTS)))}Xe(a,t.equip,t.id)}$("#profile-friendadd").hide(),wa._profiled=e,ca.dialog.profileKick.hide(),ca.dialog.profileReport.hide(),ca.dialog.profileShut.hide(),ca.dialog.profileDress.hide(),ca.dialog.profileWhisper.hide(),ca.dialog.profileHandover.hide(),wa.id==e?ca.dialog.profileDress.show():t.robot||(ca.dialog.profileShut.show(),ca.dialog.profileReport.show(),ca.dialog.profileWhisper.show()),wa.room&&wa.id!=e&&wa.id==wa.room.master&&(ca.dialog.profileKick.show(),ca.dialog.profileHandover.show()),t.robot?$("#profile-warn").hide():$("#warnRecord").text(function(e){var a=$.ajax({url:`/getWarn?target=${e}`,method:"GET",async:!1}),o=JSON.parse(a.responseText);return o.message?o.message:alert("경고 누적 횟수를 조회하지 못했습니다."+o.error)}(e)+L.WARNCOUNT),c(ca.dialog.profile),ca.dialog.profile.show(),global.expl(o)}else Ke(L.error_405)}function X(e){var a;("AI"==e||(a=wa.users[e].profile.title||wa.users[e].profile.name,confirm(a+L.sureInvite)))&&l("invite",{target:e})}function ee(e){wa._replay||wa.lastFail!=wa.id||wa.id!=e?wa.failCombo=0:(wa.failCombo++,1==wa.failCombo&&Ke(L.trollWarning),wa.failCombo>1&&(l("leave"),aa(437))),wa.lastFail=e}function ae(){var e;for(e in wa.room.players)(wa._replay?ma.users[wa.room.players[e]]||wa.room.players[e]:wa.users[wa.room.players[e]]||wa.robots[wa.room.players[e].id]).game.score=0,!wa.admin&&delete wa["_s"+wa.room.players[e]];wa.admin||delete wa.lastFail,wa.failCombo=0,wa._spectate=-1==wa.room.game.seq.indexOf(wa.id),wa._gAnim=!0,ca.box.room.show().height(360).animate({height:1},500),ca.box.game.height(1).animate({height:410},500),Oe(),ca.dialog.resultSave.attr("disabled",!1),ce(),ca.game.display.html(L.soon),ze("game_start"),Me(),p(function(){ca.box.room.height(360).hide(),ca.chat.scrollTop(999999999)},500)}function oe(){var e;for(e in wa.room.game.seq)wa.room.game.seq[e].robot&&(wa.room.game.seq[e].game.score=0);for(e in ma.users={},ma.players){var a=ma.players[e].id,o=ma.readies[a]||{},r=wa.users[a]||wa.robots[a],t=a;ma.players[e].robot?(r=ma.users[a]={robot:!0},(t=ma.players[e]).game={}):r=ma.users[a]={},wa.room.players.push(t),r.id=t,r.profile=ma.players[e],r.data=r.profile.data,r.equip=r.profile.equip,r.game={score:0,team:o.t}}wa._rf=0}function re(e){var a,o,r=wa.room.events[--wa._rf];if(r){a=r.time;do{if(!(r=wa.room.events[--wa._rf]))break}while(a-r.time<1e3);for(o=wa._rf-1,oe(),a=wa.muteEff,wa.muteEff=!0,i=0;i<o;i++)se();$(".deltaScore").remove(),wa.muteEff=a,se()}}function te(e){var a=wa._rpause=!wa._rpause;$(e.target).html(a?L.replayResume:L.replayPause)}function ie(e){clearTimeout(wa._rt),se()}function ne(){wa.$gpt.html(wa._gpp+" ("+(.001*wa._eventTime).toFixed(1)+L.SECOND+" / "+(.001*wa._gtt).toFixed(1)+L.SECOND+")")}function se(e){var a,o=wa.room.events[wa._rf];return clearTimeout(wa._rt),e||wa._rf++,o?wa._rpause?(wa._rf--,wa._rt=p(se,100)):((a=o.data).hint&&(a.hint={_id:a.hint}),"chat"==a.type&&(a.timestamp=ma.time+o.time),h(a),wa._eventTime=o.time,ne(),void(wa.room.events.length>wa._rf?wa._rt=p(se,wa.room.events[wa._rf].time-o.time):le())):void le()}function le(){wa.admin||delete wa.room,wa._replay=!1,ca.box.room.height(360),clearTimeout(wa._rt),D(),qe("lobby")}function de(e){if(!wa._replay&&ma){var a,o=e;if(e.hasOwnProperty("type")&&"room"!=e.type&&"obtain"!=e.type){for(a in e={},o)e[a]=o[a];e.profile&&(e.profile={id:e.profile.id,title:"#"+e.profile.id}),e.user&&(e.user={id:e.user.profile.id,profile:{id:e.user.profile.id,title:"#"+e.user.profile.id},data:{score:0},equip:{}}),ma.events.push({data:e,time:(new Date).getTime()-ma.time})}}}function ce(){wa._relay=!1,d(),ca.game.here.hide(),ca.dialog.result.hide(),ca.dialog.dress.hide(),ca.dialog.charFactory.hide(),$(".jjoriping,.rounds,.game-body").removeClass("cw"),$(".jjoriping,.rounds").removeClass("dg"),$(".rounds").removeClass("painter"),ca.game.display.empty(),ca.game.chain.hide(),ca.game.hints.empty().hide(),ca.game.tools.hide(),ca.game.cwcmd.hide(),ca.game.bb.hide(),ca.game.round.empty(),ca.game.history.empty(),ca.game.items.show().css("opacity",0),$(".jjo-turn-time .graph-bar").width(0).css({float:"","text-align":"","background-color":""}),$(".jjo-round-time .graph-bar").width(0).css({float:"","text-align":""}).removeClass("round-extreme"),$(".game-user-bomb").removeClass("game-user-bomb")}function me(e){var a;for(ca.game.round.empty(),a=0;a<wa.room.round;a++)ca.game.round.append($l=$("<label>").html(wa.room.game.title[a])),a+1==e&&$l.addClass("rounds-current")}function ue(){g("turnGoing")}function pe(e){return wa._replay?ma.users[e].game.score:(wa.users[e]||wa.robots[e]).game.score}function ge(e,a){wa._replay?ma.users[e].game.score+=a:(wa.users[e]||wa.robots[e]).game.score+=a}function he(e,a){return e.append(a),p(function(){a.remove()},2e3),e}function fe(e){var a,t,n,s=$(".result-board").empty();if(wa._resultPage=2,!e)return ca.dialog.resultOK.trigger("click");for(i in e.list)r=e.list[i],o=wa.users[r.id]||{profile:{title:L.hidden}},n=r.id==wa.id,s.append(a=$("<div>").addClass("result-board-item").append($("<div>").addClass("result-board-rank").html(r.rank+1)).append(De(r.score).addClass("result-board-level")).append($("<div>").addClass("result-board-name").html(o.profile.title||o.profile.name)).append($("<div>").addClass("result-board-score").html(ea(r.score)+L.PTS)).append($("<div>").addClass("result-board-reward").html("")).append(t=$("<div>").addClass("result-board-lvup").css("display",n?"block":"none").append($("<i>").addClass("fa fa-arrow-up")).append($("<div>").html(e.prev-r.rank)))),n&&(e.prev-r.rank<=0&&t.hide(),a.addClass("result-board-me"))}function $e(){$(".kick-vote-time .graph-bar").width(wa.kickTime/wa._kickTime*300),--wa.kickTime>0?wa._kickTimer=p($e,1e3):ca.dialog.kickVoteY.trigger("click")}function be(e,a,o){var r,t,i=$("<div>").addClass("expl dress-expl").append($("<div>").addClass("dress-item-title").html(He(e._id)+(a?L.equipped:""))).append($("<div>").addClass("dress-item-group").html(L["GROUP_"+e.group])).append($("<div>").addClass("dress-item-expl").html(We(e._id))),n=$("<div>").addClass("dress-item-opts");for(r in e.term&&i.append($("<div>").addClass("dress-item-term").html(Math.floor(e.term/86400)+L.DATE+" "+L.ITEM_TERM)),o&&i.append($("<div>").addClass("dress-item-term").html(new Date(1e3*o).toLocaleString()+L.ITEM_TERMED)),e.options)if("gif"!=r){var s=r.charAt(0);t=e.options[r],"g"==s?t="+"+(100*t).toFixed(1)+"%p":"h"==s&&(t="+"+t),n.append($("<label>").addClass("item-opts-head").html(L["OPTS_"+r])).append($("<label>").addClass("item-opts-body").html(t)).append($("<br>"))}return t&&i.append(n),i}function ve(e){var a;$.get("/shop",function(o){for(a in wa.shop={},o.goods)wa.shop[o.goods[a]._id]=o.goods[a];e&&e(o)})}function ke(e){var a,o,r=$(e.currentTarget).attr("id").slice(6),t=wa.shop[r],i=wa.users[wa.id],n=i.money,s=n-t.cost,l=L.surePurchase,d={};for(o in wa.box&&wa.box[r]&&(l=L.alreadyGot+" "+l),c(ca.dialog.purchase,!0),$("#purchase-ping-before").html(ea(n)+L.ping),$("#purchase-ping-cost").html(ea(t.cost)+L.ping),$("#purchase-item-name").html(L[r][0]),a=$("#purchase-ping-after").html(ea(s)+L.ping),$("#purchase-item-desc").html(s<0?L.notEnoughMoney:l),i.equip)d[o]=i.equip[o];d["Mhand"==t.group?["Mlhand","Mrhand"][Math.floor(2*Math.random())]:t.group]=r,Xe("#moremi-after",d,"shop"),wa._sgood=r,ca.dialog.purchaseOK.attr("disabled",s<0),s<0?a.addClass("purchase-not-enough"):a.removeClass("purchase-not-enough")}function _e(e){e<1||($("#Middle").css("padding-top",e),p(function(){$("#Middle").css("padding-top",0),p(_e,50,.7*e)},50))}function ye(e,a,o,r){ra[wa.room.mode];var t,i,n,s,l,d=JSON.parse($("#RULE").html()),c="KKT"==ra[wa.room.mode],m="KAP"==ra[wa.room.mode],u=pa[t=e.length],g=0,h=wa.turnTime/96,f=wa.turnTime/12;if(ca.game.display.empty(),u?(i="As"+wa._speed,u=u.split("")):"en"==d[ra[wa.room.mode]].lang&&t<10?i="As"+wa._speed:(i="Al",_e(t)),n="K"+wa._speed,u){for(s in u)"0"!=u[s]&&(ca.game.display.append(l=$("<div>").addClass("display-text").css({float:m?"right":"left","margin-top":-6,"font-size":36}).hide().html(m?e.charAt(t-g-1):e.charAt(g))),g++,p(function(e,a){var o={"margin-top":0};ze(a),e.html()==wa.mission?(ze("mission"),e.css({color:"#66FF66"}),o["font-size"]=24):o["font-size"]=20,e.show().animate(o,100)},Number(s)*h,l,i));s=ca.game.display.children("div").get(0),$(s).css(m?"margin-right":"margin-left",.5*(ca.game.display.width()-20*t))}else if(g="",m)for(s=0;s<t;s++)p(function(e){ze(i),e==wa.mission?(ze("mission"),g="<label style='color: #66FF66;'>"+e+"</label>"+g):g=e+g,ca.game.display.html(g)},Number(s)*f/t,e[t-s-1]);else for(s=0;s<t;s++)p(function(e){ze(i),e==wa.mission?(ze("mission"),g+="<label style='color: #66FF66;'>"+e+"</label>"):g+=e,ca.game.display.html(g)},Number(s)*f/t,e[s]);p(function(){for(s=0;s<3;s++)p(function(e){if(c){if(1==e)return;ze("kung")}(u?ca.game.display.children(".display-text"):ca.game.display).css("font-size",21).animate({"font-size":20},h)},s*h*2,s);p(Ce,4*h,e,a,o,r),c||ze(n)},f)}function we(e){var a,o=Le("",e);ca.game.hints.append(a=$("<div>").addClass("hint-item").append($("<label>").html(o)).append($("<div>").addClass("expl").css({"white-space":"normal",width:200}).html(o.html()))),ua||a.width(0).animate({width:215}),global.expl(a)}function Ce(e,a,o,r){var t,i,n,s=r?r.split(","):[],l={};ca.game.history.prepend(t=$("<div>").addClass("ellipse history-item").width(0).animate({width:200}).html(e)),(i=ca.game.history.children()).length>6&&i.last().remove(),n=Le(e,a,o,s),s.forEach(function(e){l[e]||L["class_"+e]&&(l[e]=!0,t.append($("<label>").addClass("history-class").html(L["class_"+e])))}),t.append(i=$("<div>").addClass("history-mean ellipse").append(n)).append($("<div>").addClass("expl").css({width:200,"white-space":"normal"}).html("<h5 style='color: #BBBBBB;'>"+n.html()+"</h5>")),global.expl(t)}function Le(e,a,o,r){if(!a||-1==a.indexOf("＂"))return function(e,a){return $("<label>").addClass("word").html(a)}(0,a);var t=$("<label>").addClass("word"),i=a.split(/＂[0-9]+＂/).slice(1).map(function(e){return-1==e.indexOf("［")?[[e]]:e.split(/［[0-9]+］/).slice(1).map(function(e){return e.split(/（[0-9]+）/).slice(1)})}),n=(r&&r.map(function(e){return L["class_"+e]}),o?o.split(",").map(function(e){return L["theme_"+e]}):[]),s=i.length>1;return i.forEach(function(e,a){var o=$("<label>").addClass("word-m1"),r=e.length>1;s&&o.append($("<label>").addClass("word-head word-m1-head").html(a+1)),e.forEach(function(e,a){var t=$("<label>").addClass("word-m2"),i=e.length,s=i>1,l=n.splice(0,i);r&&t.append($("<label>").addClass("word-head word-m2-head").html(a+1)),e.forEach(function(e,a){var o=$("<label>").addClass("word-m3"),r=l.shift();s&&o.append($("<label>").addClass("word-head word-m3-head").html(a+1)),r&&o.append($("<label>").addClass("word-theme").html(r)),o.append($("<label>").addClass("word-m3-body").html(function(e){return e.replace(/\$\$[^\$]+\$\$/g,function(e){return"<equ>"+e.slice(2,e.length-2).replace(/\^\{([^\}]+)\}/g,"<sup>$1</sup>").replace(/_\{([^\}]+)\}/g,"<sub>$1</sub>").replace(/\\geq/g,"≥")+"</equ>"}).replace(/\*\*([^\*]+)\*\*/g,"<sup>$1</sup>").replace(/\*([^\*]+)\*/g,"<sub>$1</sub>")}(e))),t.append(o)}),o.append(t)}),t.append(o)}),t}function Ae(e,a,o){var r=e+(a?"("+a+")":"");return o&&(r+="<label class='jjo-display-word-length'>("+o+")</label>"),r}function Te(e){return Math.round((.3*!(e%5)+1)*(.4*!(e%15)+1)*(.5*!(e%45)+1)*(120+60*Math.floor(e/5)+120*Math.floor(e*e/225)+180*Math.floor(e*e/2025)))}function xe(e){var a,o=fa.length;for(a=0;a<o&&!(e<fa[a]);a++);return a+1}function De(e,a,o){if(e<="-1")var r="admin",t=100,i=100;else t=(r=xe(e)-1)%25*-100,i=-100*Math.floor(.04*r);return"admin"==r?$("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/lvGM.png')","background-position":t+"% "+i+"%","background-size":"100%"}):$("<div>").css({float:"left","background-image":"url('/img/kkutu/lv/newlv.png')","background-position":t+"% "+i+"%","background-size":"2560%"})}function Se(e){return $("<div>").addClass("jt-image").css("background-image","url('"+e+"')")}function Be(e,a,o){var r,t=[L["mode"+ra[e]]];for(r in sa)a[sa[r].name.toLowerCase()]&&t.push(L["opt"+sa[r].name]);return o&&t.push(a.injpick.join("|")),o?t.toString():t}function je(e,a){var o,r=Be(a.mode,a.opts),t=na[ra[a.mode]];e.empty().append($("<h5>").addClass("room-head-number").html("["+(a.practice?L.practice:a.id)+"]")).append($("<h5>").addClass("room-head-title").text(Ee(a.title))).append(o=$("<h5>").addClass("room-head-mode").html(r.join(" / "))).append($("<h5>").addClass("room-head-limit").html((ua?"":L.players+" ")+a.players.length+" / "+a.limit)).append($("<h5>").addClass("room-head-round").html(L.rounds+" "+a.round)).append($("<h5>").addClass("room-head-time").html(a.time+L.SECOND)),-1!=t.opts.indexOf("ijp")&&(o.append($("<div>").addClass("expl").html("<h5>"+a.opts.injpick.map(function(e){return L["theme_"+e]})+"</h5>")),global.expl(e))}function Re(e,a){wa._lsRemain=e.length,e.forEach(function(e){!function(e,a,o){function r(o){_a[e]=new i(a),t()}function t(){0==--wa._lsRemain?o&&o():d(L.loadRemain+wa._lsRemain)}function i(e){var a=this;this.audio=new Audio(e),this.audio.load(),this.start=function(){a.audio.play()},this.stop=function(){a.audio.currentTime=0,a.audio.pause()}}var n=new XMLHttpRequest;n.open("GET",a),n.responseType="arraybuffer",n.onload=function(a){La?La.decodeAudioData(a.target.response,function(a){_a[e]=a,t()},r):r()},n.send()}(e.key,e.value,a)})}function qe(e,a){"lobby"==e&&(e=$("#bgmselect").val().substr(0,1));return wa.bgm&&wa.bgm.stop(),wa.bgm=ze(e,!0)}function Oe(){wa.bgm&&(wa.bgm.stop(),!wa.admin&&delete wa.bgm)}function ze(e,a){var o,r,t=a&&wa.muteBGM||!a&&wa.muteEff;return r=_a[e]||_a.missing,window.hasOwnProperty("AudioBuffer")&&r instanceof AudioBuffer?((o=La.createBufferSource()).startedAt=La.currentTime,o.loop=a,o.buffer=t?La.createBuffer(2,r.length,La.sampleRate):r,o.connect(La.destination)):(r.readyState&&(r.audio.currentTime=0),r.audio.loop=a||!1,r.audio.volume=t?0:$("#bgmvol").val(),o=r),ya[e]&&ya[e].stop(),ya[e]=o,o.key=e,o.start(),o}function Ne(){var e;for(e in ya)ya[e].stop()}function Ze(e){var a;wa.rooms[e]&&(wa.rooms[e].password&&!(a=prompt(L.putPassword))||(wa._pw=a,l("enter",{id:e,password:a})))}function Me(){var e=$("#Chat,#chat-log-board"),a=e.children(".chat-item").last().get(0);a&&"HR"==a.tagName||(e.append($("<hr>").addClass("chat-item")),ca.chat.scrollTop(999999999))}function Ee(e){if(ka.test(e))return e.replace(ka,"[타서버 언급 금지]");if(va.test(e))return e.replace(va,"-");if(ba.test(e)){var a=$("#badwordfilter").val().substr(0,2);return"NO"==a?wa.admin?e.toString():e.replace(ba,"**"):"**"==a?e.replace(ba,a):"♥♥"==a?e.replace(ba,a):"★★"==a?e.replace(ba,a):(++Ba,e.replace(ba,"**"))}return e}function Pe(e){return ka.test(e)?e.replace(ka,""):va.test(e)?e.replace(va,""):ba.test(e)?e.replace(ba,""):e}function Fe(e){return Ge(e.data.rankPoint,e.id)}function Ge(e,a){var o,r=$.ajax({url:"/rpRanking",method:"GET",async:!1}),t=JSON.parse(r.responseText);return e>=5e3?(o="MASTER",t.data[0].id==a&&(o="CHAMPION"),t.data[1].id!=a&&t.data[2].id!=a||(o="CHALLENGER")):e<50?o="UNRANKED":e>=50&&e<1e3?o="BRONZE":e>=1e3&&e<2e3?o="SILVER":e>=2e3&&e<3e3?o="GOLD":e>=3e3&&e<4e3?o="PLATINUM":e>=4e3&&e<5e3&&(o="DIAMOND"),o}function Ie(e,a,o,r){var t,i,n,s,l,d,c=r?new Date(r):new Date,m=wa.users[e.id]?wa.users[e.id].equip:{},u="";if(wa.room&&((l=$(".room-users")[0].children[`room-user-${e.id}`])?d=l.innerText.includes(L.stat_spectate):(P(!1),d=(l=$(".room-users")[0].children[`room-user-${e.id}`]).innerText.includes(L.stat_spectate))),u=null==d?"":d?null==d?"":d?"x-spectator":"":"",!wa._shut[e.title||e.name]){if(o){if(wa.opts.dw)return;if(wa._wblock[o])return}a=Ee(a,wa.users[e.id]),ze("k"),Ue(),!ua&&wa.room&&(t=(wa.room.gaming?2:0)+($(".jjoriping").hasClass("cw")?1:0),function(e,a,o){$("#cb-"+a).remove();var r,t,i=(2&o?$("#game-user-"+a):$("#room-user-"+a)).offset(),n=2==o?"chat-balloon-bot":"chat-balloon-tip",s=$("<div>").addClass("chat-balloon").attr("id","cb-"+a).append($("<div>").addClass("jt-image "+n))[2==o?"prepend":"append"]($("<h4>").html(e));i&&(ca.balloons.append(s),1==o?(r=0,t=220):2==o?(r=35-s.height(),t=-2):3==o?(r=5,t=210):(r=40,t=110),s.css({top:i.top+r,left:i.left+t}),p(function(){s.animate({opacity:0},500,function(){s.remove()})},2500))}(a,e.id,t)),ca.chat.append(n=$("<div>").addClass("chat-item").append(t=$("<div>").addClass(`chat-head ellipse ${u}`).text(e.title||e.name)).append(i=$("<div>").addClass("chat-body").html(a)).append($("<div>").addClass("chat-stamp").text(c.toLocaleTimeString()))),r&&t.prepend($("<i>").addClass("fa fa-video-camera")),t.on("click",function(a){Y(e.id)}),ca.chatLog.append(n=n.clone()),n.append($("<div>").addClass("expl").css("font-weight","normal").html("#"+(e.id||"").substr(0,5))),(s=a.match(/https?:\/\/[\w\.\?\/&#%=-_\+]+/g))&&(a=i.html(),s.forEach(function(e){a=a.replace(e,"<a href='#' style='color: #2222FF;' onclick='if(confirm(\""+L.linkWarning+'")) window.open("'+e+"\");'>"+e+"</a>")}),i.html(a)),o&&(!0!==o&&(wa._recentFrom=o),i.html("<label style='color: #7777FF; font-weight: bold;'>&lt;"+L.whisper+"&gt;</label>"+i.html())),O(t,{equip:m}),ca.chat.scrollTop(999999999)}}function Ke(e,a){var o=new Date;ze("k"),Ue(),$("#Chat,#chat-log-board").append($("<div>").addClass("chat-item chat-notice").append($("<div>").addClass("chat-head").text(a||L.notice)).append($("<div>").addClass("chat-body").text(e)).append($("<div>").addClass("chat-stamp").text(o.toLocaleTimeString()))),ca.chat.scrollTop(999999999),"tail"==a&&console.warn(o.toLocaleString(),e)}function Ue(){var e=$("#Chat .chat-item"),a=$("#chat-log-board .chat-item");e.length>99&&e.first().remove(),a.length>199&&a.first().remove()}function Je(e){var a;return a="$"==e.charAt()?wa.shop[e.slice(0,4)]:wa.shop[e],{_id:e,group:a.group,term:a.term,name:He(e),cost:a.cost,image:Ve(e,a),desc:We(e),options:a.options}}function He(e){return"$"==e.charAt()?L[e.slice(0,4)][0]+" - "+e.slice(4):L[e][0]}function We(e){return"$"==e.charAt()?L[e.slice(0,4)][1]:L[e][1]}function Ve(e,a){var o,r;if(e){if("$"==e.charAt())return function(e,a){var o,r=document.createElement("canvas"),t=r.getContext("2d");switch(r.width=r.height=50,t.font="24px NBGothic",t.textAlign="center",t.textBaseline="middle",e){case"WPC":case"WPB":case"WPA":o=["WPC","WPB","WPA"].indexOf(e),t.beginPath(),t.arc(25,25,25,0,2*Math.PI),t.fillStyle=["#DDDDDD","#A6C5FF","#FFEF31"][o],t.fill(),t.fillStyle=["#000000","#4465C3","#E69D12"][o],t.fillText(a,25,25)}return r.toDataURL()}(e.slice(1,4),e.slice(4))}else"string"==typeof a&&(a={_id:"def",group:a,options:{}});return r=(o=wa.shop[e]||a).options.hasOwnProperty("gif")?".gif":".png","BDG"==o.group.slice(0,3)?"/img/kkutu/moremi/badge/"+o._id+r:"M"==o.group.charAt(0)?"/img/kkutu/moremi/"+o.group.slice(1)+"/"+o._id+r:"/img/kkutu/shop/"+o._id+".png"}function Qe(e){ca.dialog.obtain.is(":visible")?wa._obtain.push(e):(Ye(e),c(ca.dialog.obtain,!0))}function Ye(e){ze("success"),$("#obtain-image").css("background-image","url("+Ve(e.key)+")"),$("#obtain-name").html(He(e.key))}function Xe(e,a,o){var r,t,i=$(e).empty(),n={Mlhand:"Mhand",Mrhand:"Mhand"};if("hide_moremi"!=a.MSKIN){if("shop"!==o){var s=wa.users[o];if(void 0!==s)var l=Fe(s)}if(null==a.MSKIN)var d="def";else d=a.MSKIN;for(r in a||(a={}),ta)t="M"+ta[r],i.append($("<img>").addClass("moremies moremi-"+t.slice(1)).attr("src",Ve(a[t],n[t]||t)).css({width:"100%",height:"100%"}));(t=a.BDG)&&i.append($("<img>").addClass("moremies moremi-badge").attr("src",Ve(t)).css({width:"100%",height:"100%"})),i.children(".moremi-back").after($("<img>").addClass("moremies moremi-body").attr("src",a.robot?"/img/kkutu/moremi/robot.png":`/img/kkutu/moremi/skin/${d}.png`).css({width:"100%",height:"100%"})),i.children(".moremi-rhand").css("transform","scaleX(-1)"),"shop"!==o&&void 0!==s&&"UNRANKED"!==l&&i.append($("<img>").addClass("moremies moremi-tier").attr("src","/img/kkutu/rankedge/"+l+".png").css({width:"100%",height:"100%"}))}else for(r in ta)t="M"+ta[r],i.append($("<img>").addClass("moremies moremi-"+t.slice(1)).attr("src","/img/kkutu/def.png").css({width:"100%",height:"100%"}))}function ea(e){var a=/(^[+-]?\d+)(\d{3})/;if(null===e)return"?";for(e=e.toString();a.test(e);)e=e.replace(a,"$1,$2");return e}function aa(e){return alert(L["error_"+e])}function oa(e){ca.yell.show().css("opacity",1).html(e),p(function(){ca.yell.animate({opacity:0},3e3),p(function(){ca.yell.hide()},3e3)},1e3)}var ra,ta,ia,na,sa,la,da,ca,ma,ua,pa=[null,"10000000","10001000","10010010","10011010","11011010","11011110","11011111","11111111"],ga={profile:{title:L.null},data:{score:0}},ha=30,fa=[],$a="bwBuAGwAeQBiAGYAawBrAHUAdAB1AGMAYQBuAHIAZQBhAGQAdABoAGkAcwBmAGkAbABlAHQAaABhAHQAdgBlAHIAaQBmAGkAZQBkAGIAeQBiAGYAawBrAHUAdAB1AGMAbABpAGUAbgB0AA==",ba=new RegExp(["(시|싀|쉬|슈|씨|쒸|씌|쓔|쑤|시이{1,}|싀이{1,}|쉬이{1,}|씨이{1,}|쒸이{1,}|씌이{1,}|찌이{1,}|스|쓰|쯔|스으{1,}|쓰으{1,}|쯔으{1,}|수우{1,}|쑤우{1,}|십|싑|쉽|슙|씹|쓉|씝|쓥|씁|싶|싚|슆|슾|앂|씦|쓒|씊|쑾|ㅅ|ㅆ|ㅅㅣ{1,}|ㅅ이{1,}|ㅆ이{1,}|c|c이{1,}|C|C이{1,}|Ⓒ|Ⓒ이{1,}|^^ㅣ|^^I|^^l)[^가-힣]*(바|발|팔|빠|빨|불|벌|벨|밸|빠|ㅂ|ㅃ|ㅍ)","(뷩|병|뱡|뱅|뱡|빙|븅|븽|뷰웅|비잉|볭|뱽|뼝|뺑|쁑|삥|삉|뺭|뼈엉|쀼웅|ㅂ)[^가-힣]*(쉰|신|싄|슨|씬|씐|진|즨|ㅅ|딱|시인|시나)","(샛|섓|쌧|썠|쌨|샜|섔|쌨|썠|새|섀|세|셰|쌔|쎄|썌|쎼)[^가-힣]*(끼|끠|애끼|에끼)","(저새|저색|저샛|저쉑|저샛|저셋|저섀|저셰|저쌔|저쎄|저썌|저쎼)[^가-힣]*(기|애{1,}기|에{1,}기|)","(개|게|걔|깨|께|꼐|꺠)[^가-힣]*(같|새|샛|세|섀|셰)","(니|닝|느|노|늬|너|쟤|걔|ㄴ)[^가-힣]*(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄{1,}마|검{1,}마|검|금|미|앰|앱|애{1,}비|애{1,}미|에{1,}미|에{1,}비|애{1,}믜|애{1,}븨|아{1,}빠|엄{1,}빠|의미|의비|븨|믜)","(ㄱㅁ|ㄱㅃ|ㅇㅁ|ㅇㅂ|엄마|검마|앰|아빠|엄빠)[^가-힣]*(죽|뒤|사|돌|없)","(앰|엠|얨|옘|앱|엡|옙|얩)[^가-힣]*(창|챵|촹|생|섕|셍|솅|쉥)","(세|섹|색|쉑|쇡|세엑{1,}크|세액{1,}크|세크|새크|새에{1,}크|새애{1,}크|셍|셱|섁|세그|세엑|세액|세에{1,}엑|세애{1,}액|쎅|쎽|쎆|쎾|셲)[^가-힣]*(ㅅ|스|슥|슨|슫|슷|승|로스)","(ㅈ|젓|젔|젇|젖|좟|좠|좓|좢)[^가-힣]*(뒏|됟|됫|됬|됏|됐|됃|같|갇|까|가|까)","(자|쥬|주|자아{1,}|잠|좌|좌아{1,}|잗|잣|쟈|쟈아{1,}|보|뷰|부|보오{1,}|볻|봇|뵤)[^가-힣]*(지|짓|짇|징|즤|즫|즷|즹|빨)","(질|입|안|밖)[^가-힣]*(싸)","(후|훚|훗|훋)[^가-힣]*(장|쟝|좡)","(꼬|보|딸|똘|빡)[^가-힣]*(추)","(미친|잡|쓰레기|거지|그지|똥|ㅣ발)[^가-힣]*(녀석|놈|충|자식|냐|냔|세|네|것)","미친","(버|벅|뻐|뻑|퍼|퍽)[^가-힣]*(큐|뀨)","(호)[^가-힣]*(로|모|구)","(스|수|슈|쓰|쑤|쓔|스으{1,}|수우{1,}|슈우{1,}|쓰우{1,}|쑤으{1,}|쓔으{1,})[^가-힣]*(랙|렉|럑|롁|랚|렊|럒|롂)","(지|즤|디|G|ㅣ|치|찌|지이|지이{1,}|즤이{1,}|G이{1,}|즤|G이)[^가-힣]*(랄|라알)","(딸)[^가-힣]*(딸|치|쳐|쳤|침)","발[^가-힣]*기","풀[^가-힣]*발","딸[^가-힣]*딸","강[^가-힣]*간","자[^가-힣]*위","부[^가-힣]*랄","불[^가-힣]*알","오[^가-힣]*르[^가-힣]*가[^가-힣]*즘","처[^가-힣]*녀[^가-힣]*막","질[^가-힣]*내","질[^가-힣]*외","정[^가-힣]*액","자[^가-힣]*궁","생[^가-힣]*리","월[^가-힣]*경","페[^가-힣]*도","또[^가-힣]*라[^가-힣]*이","장[^가-힣]*애","종[^가-힣]*간","쓰[^가-힣]*레[^가-힣]*기","무[^가-힣]*뇌","학[^가-힣]*식[^가-힣]*충","급[^가-힣]*식[^가-힣]*충","버[^가-힣]*러[^가-힣]*지","찌[^가-힣]*꺼[^가-힣]*기","삐[^가-힣]*꾸","닥[^가-힣]*쳐","꺼[^가-힣]*져","애[^가-힣]*자","찌[^가-힣]*그[^가-힣]*레[^가-힣]*기","대[^가-힣]*가[^가-힣]*리","면[^가-힣]*상","와[^가-힣]*꾸","시[^가-힣]*빠[^가-힣]*빠","파[^가-힣]*오[^가-힣]*후","사[^가-힣]*까[^가-힣]*시","씹[^가-힣]*덕","애[^가-힣]*미","엿[^가-힣]*먹","애[^가-힣]*비","새[^가-힣]*끼","줬[^가-힣]*까","(뒤)[^가-힣]*(져|진|졌|질|짐)","살[^가-힣]*지[^가-힣]*마","자[^가-힣]*살[^가-힣]*(해|하|헤)","자[^가-힣]*살","살[^가-힣]*해","(좆|좃|좄|졷|줫|줮|줟|죶|죳|죴|죧|조오{1,}|조옷{1,}|조옺{1,})","(좆|좃|좄|졷|줫|줮|줟|죶|죳|죴|죧|존|조오{1,}|조옷{1,}|조옺{1,})[^가-힣]*나","씹|씹","봊|봊","잦|잦","(섹|섻)","썅|썅","ㅗ{1,}","ㅄ|ㅄ","ㄲㅈ|ㄲㅈ","(ㅈ)[^가-힣]*(ㅂㅅ|ㄲ|ㄹ|ㄴ)","(f|F)[^A-Za-z]*(u|U)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(d|D)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(m|M)","(m|M)[^A-Za-z]*(o|O)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)[^A-Za-z]*(h|H)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(d|D)[^A-Za-z]*(a|A)[^A-Za-z]*(m|M)[^A-Za-z]*(n|N)","(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(b|B)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(c|C)[^A-Za-z]*(h|H)","(d|D)[^A-Za-z]*(i|I)[^A-Za-z]*(c|C)[^A-Za-z]*(k|K)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*x","(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(c|C)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(t|T)","(p|P)[^A-Za-z]*(u|U)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(y|Y)","(f|F)[^A-Za-z]*(a|A)[^A-Za-z]*(g|G)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(e|E)[^A-Za-z]*(r|R)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(g|G)[^A-Za-z]*(a|A)","(n|N)[^A-Za-z]*(i|I)[^A-Za-z]*(g|G)[^A-Za-z]*(r|R)[^A-Za-z]*(o|O)","(j|J)[^A-Za-z]*(u|U)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(m|M)[^A-Za-z]*(u|U)[^A-Za-z]*(f|F)[^A-Za-z]*(f|F)","(p|P)[^A-Za-z]*(i|I)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)","(r|R)[^A-Za-z]*(e|E)[^A-Za-z]*(t|T)[^A-Za-z]*(a|A)[^A-Za-z]*(r|R)[^A-Za-z]*(d|D)","(s|S)[^A-Za-z]*(l|L)[^A-Za-z]*(u|U)[^A-Za-z]*(t|T)","(t|T)[^A-Za-z]*(i|I)[^A-Za-z]*(t|T)[^A-Za-z]*(s|S)","(t|T)[^A-Za-z]*(r|R)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)","(t|T)[^A-Za-z]*(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(t|T)","(w|W)[^A-Za-z]*(a|A)[^A-Za-z]*(n|N)[^A-Za-z]*(k|K)","(w|W)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(r|R)[^A-Za-z]*(e|E)","(s|S)[^A-Za-z]*(i|I)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)","(g|G)[^A-Za-z]*(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(a|A)[^A-Za-z]*(k|K)[^A-Za-z]*(i|I)","(a|A)[^A-Za-z]*(s|S)[^A-Za-z]*(s|S)[^A-Za-z]*(h|H)[^A-Za-z]*(o|O)[^A-Za-z]*(l|L)[^A-Za-z]*(e|E)","(t|T)[^A-Za-z]*(l|L)[^A-Za-z]*q[^A-Za-z]*(k|K)[^A-Za-z]*(f|F)","(t|T)[^A-Za-z]*(p|P)[^A-Za-z]*(r|R)[^A-Za-z]*(t|T)[^A-Za-z]*(m|M)","(s|S)[^A-Za-z]*(e|E)[^A-Za-z]*(e|E)[^A-Za-z]*(b|B)[^A-Za-z]*(a|A)[^A-Za-z]*(l|L)"].join("|")),va=new RegExp(["(&lt;|<)(i|I)(m|M)(g|G)","(&lt;|<)(s|S)(c|C)(r|R)(i|I)(p|P)(t|T)","(&lt;|<)(h|H)(1|2|3|4|5|6)","(&lt;|<)(a|A)"].join("|")),ka=new RegExp(["(끄투|끄)[^가-힣]*(코리아|코)","(끄투|끄)[^가-힣]*(닷)[^가-힣]*(컴)","(끄)[^가-힣]*(닷)","(끄투)[^가-힣]*(리오)","(끄투)[^가-힣]*(한국)","(끄)[^가-힣]*(리)","(끄)[^가-힣]*(한)","(태풍)[^가-힣]*(끄튬|끄툼|끄투)","(분홍|핑크|핑크빛)[^가-힣]*(끄투)","(투데이)[^가-힣]*(끄투)","(이름)[^가-힣]*(없는)[^가-힣]*(끄투)","(김)[^가-힣]*(대|머)[^가-힣]*(운)","(리)[^가-힣]*(오)","(행)[^가-힣]*(끄|끄투)","(끄투|끄)[^가-힣]*(플러스|플)","(뜨|뚜)[^가-힣]*(투|트)"].join("|")),_a={},ya={},wa={},Ca={Classic:{},DaneoClassic:{},Jaqwi:{},Crossword:{},Typing:{},Hunmin:{},Daneo:{},Sock:{},Drawing:{}},La=!!window.hasOwnProperty("AudioContext")&&new AudioContext,Aa=window.WebSocket,Ta=setInterval,xa=setTimeout;$(document).ready(function(){function e(e,a){var o,r;for(o in sa)r=sa[o].name.toLowerCase(),-1==e.indexOf(o)?$("#"+a+"-"+r+"-panel").hide():$("#"+a+"-"+r+"-panel").show()}function a(e){var a,o,r={};for(a in sa)o=sa[a].name.toLowerCase(),$("#"+e+"-"+o).is(":checked")&&(r[o]=!0);return r}function o(e,a,o,r,t){var i;if(!t){if(e.gaming)return!1;if(e.password)return!1;if(e.players.length>=e.limit)return!1}if(e.mode!=a)return!1;if(-1==r&&e.time!=r)return!1;for(i in o)if(!e.opts[i])return!1;return!0}function r(e){$(".team-selector").hasClass("team-unable")||l("team",{value:$(e.currentTarget).attr("id").slice(5)})}function t(){ca.dialog.replayView.attr("disabled",!0)}function i(){(la=new Aa(wa.URL)).onopen=function(e){d()},la.onmessage=_onMessage=function(e){h(JSON.parse(e.data))},la.onclose=function(e){var a=L.closed+" (#"+e.code+")";da&&da.close(),Ne(),alert(a),$.get("/kkutu_notice.html",function(e){d(e)})},la.onerror=function(e){console.warn(L.error,e)}}var n;for(wa.PUBLIC="true"==$("#PUBLIC").html(),wa.URL=$("#URL").html(),wa.version=$("#version").html(),wa.server=location.href.match(/\?.*server=(\d+)/)[1],wa.shop={},wa._okg=0,wa._playTime=0,wa._kd="",wa._timers=[],wa._obtain=[],wa._wblock={},wa._shut={},wa.usersR={},fa.push(Te(1)),n=2;n<366;n++)fa.push(fa[n-2]+Te(n));if(fa[365]=1/0,fa.push(1/0),ca={loading:$("#Loading"),lobby:{userListTitle:$(".UserListBox .product-title"),userList:$(".UserListBox .product-body"),roomListTitle:$(".RoomListBox .product-title"),roomList:$(".RoomListBox .product-body"),createBanner:$("<div>").addClass("rooms-item rooms-create").append($("<div>").html(L.newRoom))},chat:$("#Chat"),chatLog:$("#chat-log-board"),talk:$(".ChatBox input").last(),chatBtn:$(".ChatBox button").last(),menu:{help:$("#HelpBtn"),setting:$("#SettingBtn"),community:$("#CommunityBtn"),cursing:$("#CursingBtn"),newRoom:$("#NewRoomBtn"),setRoom:$("#SetRoomBtn"),quickRoom:$("#QuickRoomBtn"),spectate:$("#SpectateBtn"),shop:$("#ShopBtn"),dict:$("#DictionaryBtn"),wordPlus:$("#WordPlusBtn"),reloadRoom:$("#ReloadRoom"),Clan:$("#ClanBtn"),invite:$("#InviteBtn"),practice:$("#PracticeBtn"),ready:$("#ReadyBtn"),start:$("#StartBtn"),exit:$("#ExitBtn"),notice:$("#NoticeBtn"),replay:$("#ReplayBtn"),findUser:$("#FindUserBtn"),leaderboard:$("#LeaderboardBtn"),rankpointlb:$("#RPLeaderboardBtn")},dialog:{setting:$("#SettingDiag"),settingServer:$("#setting-server"),settingOK:$("#setting-ok"),community:$("#CommunityDiag"),cursing:$("#CursingDiag"),cursingValue:$("#CursingDiag #cursing-value").first(),commFriends:$("#comm-friends"),commFriendAdd:$("#comm-friend-add"),room:$("#RoomDiag"),roomOK:$("#room-ok"),quick:$("#QuickDiag"),quickOK:$("#quick-ok"),result:$("#ResultDiag"),resultOK:$("#result-ok"),resultSave:$("#result-save"),practice:$("#PracticeDiag"),practiceOK:$("#practice-ok"),dict:$("#DictionaryDiag"),dictInjeong:$("#dict-injeong"),dictSearch:$("#dict-search"),wordPlus:$("#WordPlusDiag"),wordPlusOK:$("#wp-ok"),clanDiag:$("#ClanDiag"),newClanDiag:$("#NewClanDiag"),viewClanDiag:$("#ViewClanDiag"),newClan:$("#newClan"),makeClan:$("#makeClan"),kickUser:$("#kickUser"),extendMax:$("#extendMax"),viewClan:$("#viewClan"),leaveClan:$("#leaveClan"),joinClan:$("#joinClan"),deleteClan:$("#deleteClan"),invite:$("#InviteDiag"),inviteList:$(".invite-board"),inviteRobot:$("#invite-robot"),roomInfo:$("#RoomInfoDiag"),roomInfoJoin:$("#room-info-join"),profile:$("#ProfileDiag"),findUser:$("#FindUserDiag"),rank:$("#rank"),lp:$("#rankpoint"),profileShut:$("#profile-shut"),profileHandover:$("#profile-handover"),profileKick:$("#profile-kick"),profileLevel:$("#profile-level"),profileDress:$("#profile-dress"),profileWhisper:$("#profile-whisper"),profileReport:$("#profile-report"),profileFriendAdd:$("#profile-friendadd"),findIDOK:$("#find-id-ok"),findNickOK:$("#find-nick-ok"),reportDiag:$("#ReportDiag"),reportSubmit:$("#report-submit"),kickVote:$("#KickVoteDiag"),kickVoteY:$("#kick-vote-yes"),kickVoteN:$("#kick-vote-no"),purchase:$("#PurchaseDiag"),purchaseOK:$("#purchase-ok"),purchaseNO:$("#purchase-no"),replay:$("#ReplayDiag"),replayView:$("#replay-view"),leaderboard:$("#LeaderboardDiag"),rankpointlb:$("#RPLeaderboardDiag"),lbTable:$("#ranking tbody"),lbPage:$("#lb-page"),lbNext:$("#lb-next"),lbMe:$("#lb-me"),lbPrev:$("#lb-prev"),rplbTable:$("#rpranking tbody"),rplbPage:$("#rplb-page"),rplbNext:$("#rplb-next"),rplbMe:$("#rplb-me"),rplbPrev:$("#rplb-prev"),dress:$("#DressDiag"),dressOK:$("#dress-ok"),charFactory:$("#CharFactoryDiag"),cfCompose:$("#cf-compose"),injPick:$("#InjPickDiag"),injPickAll:$("#injpick-all"),injPickNo:$("#injpick-no"),injPickOK:$("#injpick-ok"),chatLog:$("#ChatLogDiag"),alertKKuTu:$("#AlertDiag"),alertKKuTuOK:$("#alert-ok"),promptKKuTu:$("#PromptDiag"),promptKKuTuOK:$("#prompt-ok"),obtain:$("#ObtainDiag"),obtainOK:$("#obtain-ok"),help:$("#HelpDiag")},box:{chat:$(".ChatBox"),userList:$(".UserListBox"),roomList:$(".RoomListBox"),shop:$(".ShopBox"),room:$(".RoomBox"),game:$(".GameBox"),me:$(".MeBox")},game:{display:$(".jjo-display"),hints:$(".GameBox .hints"),tools:$(".GameBox .tools"),drawingTitle:$("#drawing-title"),themeisTitle:$("#themeis-title"),cwcmd:$(".GameBox .cwcmd"),bb:$(".GameBox .bb"),items:$(".GameBox .items"),chain:$(".GameBox .chain"),round:$(".rounds"),here:$(".game-input").hide(),hereText:$("#game-input"),history:$(".history"),roundBar:$(".jjo-round-time .graph-bar"),turnBar:$(".jjo-turn-time .graph-bar")},yell:$("#Yell").hide(),balloons:$("#Balloons")},null==Aa)return d(L.websocketUnsupport),void alert(L.websocketUnsupport);for(wa._soundList=[{key:"k",value:"/media/kkutu/k.mp3"},{key:"lobby",value:"/media/kkutu/LobbyBGM_newbfkkutu.mp3"},{key:"1",value:"/media/kkutu/LobbyBGM_newbfkkutu.mp3"},{key:"2",value:"/media/kkutu/LobbyBGM_allgro.mp3"},{key:"3",value:"/media/kkutu/LobbyBGM_newstart.mp3"},{key:"4",value:"/media/kkutu/LobbyBGM_original.mp3"},{key:"jaqwi",value:"/media/kkutu/JaqwiBGM.mp3"},{key:"jaqwiF",value:"/media/kkutu/JaqwiFastBGM.mp3"},{key:"game_start",value:"/media/kkutu/game_start.mp3"},{key:"round_start",value:"/media/kkutu/round_start.mp3"},{key:"fail",value:"/media/kkutu/fail.mp3"},{key:"timeout",value:"/media/kkutu/timeout.mp3"},{key:"lvup",value:"/media/kkutu/lvup.mp3"},{key:"Al",value:"/media/kkutu/Al.mp3"},{key:"success",value:"/media/kkutu/success.mp3"},{key:"missing",value:"/media/kkutu/missing.mp3"},{key:"mission",value:"/media/kkutu/mission.mp3"},{key:"kung",value:"/media/kkutu/kung.mp3"},{key:"horr",value:"/media/kkutu/horr.mp3"}],n=0;n<=10;n++)wa._soundList.push({key:"T"+n,value:"/media/kkutu/T"+n+".mp3"},{key:"K"+n,value:"/media/kkutu/K"+n+".mp3"},{key:"As"+n,value:"/media/kkutu/As"+n+".mp3"});for(n in Re(wa._soundList,function(){ve(i)}),wa.admin||delete wa._soundList,ta=$("#MOREMI_PART").html().split(","),ia=$("#AVAIL_EQUIP").html().split(","),na=JSON.parse($("#RULE").html()),sa=JSON.parse($("#OPTIONS").html()),ra=Object.keys(na),(ua="true"==$("#mobile").html())&&(ha=200),wa._timePercent=function(){return 100-(wa._turnSound.audio?wa._turnSound.audio.currentTime:La.currentTime-wa._turnSound.startedAt)/wa.turnTime*1e5+"%"},wa.setRoom=function(e,a){var o="for-lobby"==x();null==a?(wa.admin||delete wa.rooms[e],o&&$("#room-"+e).remove()):(o&&!wa.rooms[e]&&ca.lobby.roomList.append($("<div>").attr("id","room-"+e)),wa.rooms[e]=a,o&&$("#room-"+e).replaceWith(N(a)))},wa.setUser=function(e,a){var o,r=x(),t="for-lobby"==r||"for-master"==r;wa._replay?ma.users[e]=a:null==a?(wa.admin||delete wa.users[e],t&&$("#users-item-"+e+",#invite-item-"+e).remove()):(t&&!wa.users[e]&&(o=q(a,"for-master"==r),"for-master"==r?ca.dialog.inviteList.append(o):ca.lobby.userList.append(o)),wa.users[e]=a,t&&(o?$("#"+o.attr("id")).replaceWith(o):$("#"+("for-lobby"==r?"users-item-":"invite-item")+e).replaceWith(q(a,"for-master"==r))))},$(document).on("paste",function(e){if(wa.room&&wa.room.gaming)return e.preventDefault(),!1}),ca.talk.on("drop",function(e){if(wa.room&&wa.room.gaming)return e.preventDefault(),!1}),wa.opts=$.cookie("kks"),wa.opts&&m(JSON.parse(wa.opts)),$(".dialog-head .dialog-title").on("mousedown",function(e){var a=$(e.currentTarget).parents(".dialog");$(".dialog-front").removeClass("dialog-front"),a.addClass("dialog-front"),function(e,a,o){var r=e.position();$(window).on("mousemove",function(t){var i=t.pageX-a,n=t.pageY-o;e.css("left",r.left+i),e.css("top",r.top+n)})}(a,e.pageX,e.pageY)}).on("mouseup",function(e){$(window).off("mousemove")}),ca.chatBtn.on("click",function(e){var a=ua&&ca.game.here.is(":visible")?ca.game.hereText.val():ca.talk.val(),o={value:a.trim()};a&&("/"==o.value[0]?(o.cmd=o.value.split(" "),y(o.cmd)):((ca.game.here.is(":visible")||wa._relay)&&(o.relay=!0),l("talk",o)),wa._whisper?(ca.talk.val("/e "+wa._whisper+" "),wa.admin||delete wa._whisper):ca.talk.val(""),ca.game.hereText.val(""))}).hotkey(ca.talk,13).hotkey(ca.game.hereText,13),$("#cw-q-input").on("keydown",function(e){if(13==e.keyCode){if(!o.trim())return;var a=$(e.currentTarget),o=a.val();l("talk",{relay:!0,data:wa._sel,value:o.trim()}),a.val("")}}).on("focusout",function(e){$(".cw-q-body").empty(),ca.game.cwcmd.css("opacity",0)}),$("#room-limit").on("change",function(e){var a=$(e.currentTarget),o=a.val();o<2||o>8?a.css("color","#FF4444"):a.css("color","")}),$("#room-round").on("change",function(e){var a=$(e.currentTarget),o=a.val();o<1||o>10?a.css("color","#FF4444"):a.css("color","")}),$("#room-wordLimit").on("change",function(e){var a=$(e.currentTarget),o=a.val();o<2||o>9?a.css("color","#FF4444"):a.css("color","")}),ca.game.here.on("click",function(e){ua||ca.talk.focus()}),ca.talk.on("keyup",function(e){ca.game.hereText.val(ca.talk.val())}),$(window).on("beforeunload",function(e){if(wa.room)return L.sureExit}),$(".result-me-gauge .graph-bar").addClass("result-me-before-bar"),$(".result-me-gauge").append($("<div>").addClass("graph-bar result-me-current-bar")).append($("<div>").addClass("graph-bar result-me-bonus-bar")),ca.dialog)ca.dialog[n].children(".dialog-head").hasClass("no-close")||ca.dialog[n].children(".dialog-head").append($("<div>").addClass("closeBtn").on("click",function(e){$(e.currentTarget).parent().parent().hide()}).hotkey(!1,27));for(ca.menu.help.on("click",function(e){$("#help-board").attr("src","/help"),c(ca.dialog.help)}),ca.menu.setting.on("click",function(e){c(ca.dialog.setting)}),ca.menu.community.on("click",function(e){if(wa.guest)return aa(451);c(ca.dialog.community)}),ca.dialog.commFriendAdd.on("click",function(e){var a=prompt(L.friendAddNotice);if(a)return wa.users[a]?void l("friendAdd",{target:a},!0):aa(450)}),ca.menu.newRoom.on("click",function(e){var a,o=$("#room-selecttheme").is(":checked"),r=$("#room-bantheme").is(":checked");o||r?($("#room-selecttheme-panel").hide(),$("#room-bantheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-bantheme-panel").show(),$("#room-injeong-pick").hide()),ca.dialog.quick.hide(),wa.typeRoom="enter",c(a=ca.dialog.room),a.find(".dialog-title").html(L.newRoom)}),ca.menu.setRoom.on("click",function(e){var a,o,r,t=na[ra[wa.room.mode]],i=$("#room-selecttheme").is(":checked"),n=$("#room-bantheme").is(":checked"),s=$("#room-mode").val();for(o in wa.typeRoom="setRoom",$("#room-title").val(wa.room.title),$("#room-limit").val(wa.room.limit),$("#room-mode").val(wa.room.mode).trigger("change"),$("#room-round").val(wa.room.round),$("#room-wordLimit").val(wa.room.wordLimit),$("#room-time").val(wa.room.time/t.time),sa)r=sa[o].name.toLowerCase(),$("#room-"+r).attr("checked",wa.room.opts[r]);wa._injpick=wa.room.opts.injpick,i||n?($("#room-selecttheme-panel").hide(),$("#room-bantheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-bantheme-panel").show(),$("#room-injeong-pick").hide()),10!=s&&11!=s||($("#room-selecttheme-panel").hide(),$("#room-bantheme-panel").hide(),$("#room-injeong-pick").show()),c(a=ca.dialog.room),a.find(".dialog-title").html(L.setRoom)}),$("#quick-mode, #QuickDiag .game-option").on("change",function(r){var t,i,n=$("#quick-mode").val(),s=$("#quick-time").val(),l=0;for(t in"quick-mode"==r.currentTarget.id&&$("#QuickDiag .game-option").prop("checked",!1),i=a("quick"),e(na[ra[n]].opts,"quick"),e(na[ra[n]].time,"quick"),wa.rooms)o(wa.rooms[t],n,i,s,!0)&&l++;$("#quick-status").html(L.quickStatus+" "+l)}),ca.menu.quickRoom.on("click",function(e){ca.dialog.room.hide(),c(ca.dialog.quick),ca.dialog.quick.is(":visible")&&($("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-mode").trigger("change"),$("#quick-time").trigger("change"),$("#quick-queue").html(""),ca.dialog.quickOK.removeClass("searching").html(L.OK))}),ca.dialog.quickOK.on("click",function(e){function r(){var e,a=[];if(ca.dialog.quick.is(":visible")){for(e in $("#quick-queue").html(L.quickQueue+" "+j(1e3*wa._quickn++)),wa.rooms)o(wa.rooms[e],t,n,i)&&a.push(e);a.length&&(e=a[Math.floor(Math.random()*a.length)],wa._preQuick=!0,$("#room-"+e).trigger("click"))}else clearTimeout(wa._quickT)}var t=$("#quick-mode").val(),i=$("#quick-time").val(),n=a("quick");if("for-lobby"==x()){if(ca.dialog.quickOK.hasClass("searching"))return r(),clearTimeout(wa._quickT),$("#QuickDiag>.dialog-body").find("*").prop("disabled",!1),$("#quick-queue").html(""),ca.dialog.quickOK.removeClass("searching").html(L.OK);$("#QuickDiag>.dialog-body").find("*").prop("disabled",!0),ca.dialog.quickOK.addClass("searching").html("<i class='fa fa-spinner fa-spin'></i> "+L.NO).prop("disabled",!1),wa._quickn=0,wa._quickT=u(r,1e3)}}),ca.dialog.injPickOK.on("click",function(e){var a=$(wa._ijkey+"list"),o=[],r=$(".dialog-opt#ko-pick-list").find("input").is(":checked"),t=$("#room-mode").val();(!r&&3==t||2==t)&&($("#room-selecttheme")[0].checked=!1,$("#room-bantheme")[0].checked=!1,$("#room-selecttheme-panel").show(),$("#room-bantheme-panel").show(),$("#room-injeong-pick").hide()),wa._injpick=a.find("input").each(function(e,a){var r=$(a),t=r.attr("id").slice(8);r.is(":checked")&&o.push(t)}),wa._injpick=o,ca.dialog.injPick.hide()}),$("#room-mode").on("change",function(a){var o=$("#room-mode").val(),r=na[ra[o]];$("#room-selecttheme").change(function(){$("#room-selecttheme")[0].checked||$("#room-bantheme")[0].checked?($("#room-selecttheme-panel").hide(),$("#room-bantheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-bantheme-panel").show(),$("#room-injeong-pick").hide())}),$("#room-bantheme").change(function(){$("#room-selecttheme")[0].checked||$("#room-bantheme")[0].checked?($("#room-selecttheme-panel").hide(),$("#room-bantheme-panel").hide(),$("#room-injeong-pick").show()):($("#room-selecttheme-panel").show(),$("#room-bantheme-panel").show(),$("#room-injeong-pick").hide())}),17==o?$("#room-wordLimit-panel").show():$("#room-wordLimit-panel").hide(),$("#game-mode-expl").html(L["modex"+o]),e(r.opts,"room"),wa._injpick=[],"Typing"==r.rule&&$("#room-round").val(3),$("#room-time").children("option").each(function(e,a){$(a).html(Number($(a).val())*r.time+L.SECOND)}),$("#quick-time").children("option").each(function(e,a){-1==$(a).val()?$(a).html("상관 없음"):$(a).html(Number($(a).val())*r.time+L.SECOND)}),ca.dialog.quick.is(":visible")||-1==r.opts.indexOf("ijp")||$("#room-injeong-pick").show(),3==o&&$("#room-injeong-pick").hide()}).trigger("change"),ca.menu.spectate.on("click",function(e){ca.menu.spectate.hasClass("toggled")?(l("form",{mode:"J"}),ca.menu.spectate.removeClass("toggled")):(l("form",{mode:"S"}),ca.menu.spectate.addClass("toggled"))}),ca.menu.shop.on("click",function(e){(wa._shop=!wa._shop)?(function(){var e=$("#shop-shelf");e.html(L.LOADING),ve(function(a){if(e.empty(),wa.guest&&(a.error=423),a.error)return ca.menu.shop.trigger("click"),aa(a.error);a.goods.sort(function(e,a){return a.updatedAt-e.updatedAt}).forEach(function(a,o,r){if(!(a.cost<0)){var t=Ve(!1,a);e.append($("<div>").attr("id","goods_"+a._id).addClass("goods").append($("<div>").addClass("jt-image goods-image").css("background-image","url("+t+")")).append($("<div>").addClass("goods-title").html(He(a._id))).append($("<div>").addClass("goods-cost").html(ea(a.cost)+L.ping)).append(be(a,!1)).on("click",ke))}}),global.expl(e)}),$(".shop-type.selected").removeClass("selected"),$("#shop-type-all").addClass("selected")}(),ca.menu.shop.addClass("toggled")):ca.menu.shop.removeClass("toggled"),D()}),$(".shop-type").on("click",function(e){var a=$(e.currentTarget),o=a.attr("id").slice(10);$(".shop-type.selected").removeClass("selected"),a.addClass("selected"),function(e){var a,o,r,t=!0===e;for(r in t||(e=e.split(",")),wa.shop)(o=wa.shop[r]).cost<0||(a=$("#goods_"+r).show(),t||-1==e.indexOf(o.group)&&a.hide())}("all"==o||a.attr("value"))}),ca.menu.dict.on("click",function(e){c(ca.dialog.dict)}),ca.menu.wordPlus.on("click",function(e){c(ca.dialog.wordPlus)}),ca.menu.reloadRoom.on("click",function(e){$("#roomlist-loading").show(),z(!0),R(!0)}),ca.menu.Clan.on("click",function(e){c(ca.dialog.clanDiag),$.get("/clan?type=clanlist",function(e){var a,o=JSON.parse(e.list);for(a in $("#clanList tbody").empty(),o)$("#clanList").append($("<tr>").attr("id","clan-"+o[a].clanname).addClass("clan-"+o[a].clanname).append($("<td>").html(o[a].clanname)).append($("<td>").html(o[a].clanid)))})}),ca.menu.invite.on("click",function(e){c(ca.dialog.invite),R(!0)}),ca.menu.practice.on("click",function(e){na[ra[wa.room.mode]].ai?($("#PracticeDiag .dialog-title").html(L.practice),$("#ai-team").val(0).prop("disabled",!0),c(ca.dialog.practice)):l("practice",{level:-1})}),ca.menu.ready.on("click",function(e){l("ready")}),ca.menu.start.on("click",function(e){l("start")}),ca.menu.exit.on("click",function(e){if(wa.room.gaming){if(!confirm(L.sureExit))return;wa._spaced&&Ca.Typing.spaceOff(),clearInterval(wa._tTime),wa._relay=!1}l("leave")}),ca.menu.replay.on("click",function(e){wa._replay&&le(),c(ca.dialog.replay),t(),ca.dialog.replay.is(":visible")&&$("#replay-file").trigger("change")}),ca.menu.findUser.on("click",function(e){c(ca.dialog.findUser)}),ca.dialog.findIDOK.on("click",function(e){Y($("#find-id-target").val()),$("#find-target").val()!=wa.id&&$("#profile-friendadd").show()}),ca.dialog.findNickOK.on("click",function(e){var a=$("#find-nick-target").val(),o=$.ajax({url:`/getid?target=${a}`,method:"GET",async:!1}),r=JSON.parse(o.responseText);Y(r.id),r.id!=wa.id&&$("#profile-friendadd").show()}),ca.menu.leaderboard.on("click",function(e){wa._lbpage=0,ca.dialog.leaderboard.is(":visible")?ca.dialog.leaderboard.hide():$.get("/ranking",function(e){W(e),c(ca.dialog.leaderboard)})}),ca.dialog.lbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(wa._lbpage-1),function(e){W(e)})}),ca.dialog.lbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?id="+wa.id,function(e){W(e)})}),ca.dialog.lbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/ranking?p="+(wa._lbpage+1),function(e){W(e)})}),ca.menu.rankpointlb.on("click",function(e){wa._rplbpage=0,ca.dialog.rankpointlb.is(":visible")?ca.dialog.rankpointlb.hide():$.get("/rpRanking",function(e){V(e),c(ca.dialog.rankpointlb)})}),ca.dialog.rplbPrev.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/rpRanking?p="+(wa._rplbpage-1),function(e){V(e)})}),ca.dialog.rplbMe.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/rpRanking?id="+wa.id,function(e){V(e)})}),ca.dialog.rplbNext.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.get("/rpRanking?p="+(wa._rplbpage+1),function(e){V(e)})}),ca.dialog.settingServer.on("click",function(e){$("#setting-server").prop("disabled",!0),alert("이동할 서버가 없습니다.")}),ca.dialog.settingOK.on("click",function(e){m({mb:$("#mute-bgm").is(":checked"),me:$("#mute-effect").is(":checked"),di:$("#deny-invite").is(":checked"),dw:$("#deny-whisper").is(":checked"),df:$("#deny-friend").is(":checked"),ar:$("#auto-ready").is(":checked"),su:$("#sort-user").is(":checked"),ow:$("#only-waiting").is(":checked"),ou:$("#only-unlock").is(":checked")}),ca.dialog.setting.hide(),$.cookie("kks",JSON.stringify(wa.opts))}),ca.dialog.profileLevel.on("click",function(e){$("#PracticeDiag .dialog-title").html(L.robot),$("#ai-team").prop("disabled",!1),c(ca.dialog.practice)}),ca.dialog.practiceOK.on("click",function(e){var a=$("#practice-level").val(),o=$("#ai-team").val();ca.dialog.practice.hide(),$("#PracticeDiag .dialog-title").html()==L.robot?l("setAI",{target:wa._profiled,level:a,team:o}):l("practice",{level:a})}),ca.dialog.roomOK.on("click",function(e){var a,o,r={injpick:wa._injpick};for(a in sa)r[o=sa[a].name.toLowerCase()]=$("#room-"+o).is(":checked");l(wa.typeRoom,{title:$("#room-title").val().trim()||$("#room-title").attr("placeholder").trim(),password:$("#room-pw").val(),limit:$("#room-limit").val(),mode:$("#room-mode").val(),round:$("#room-round").val(),wordLimit:$("#room-wordLimit").val(),time:$("#room-time").val(),opts:r}),ca.dialog.room.hide()}),ca.dialog.resultOK.on("click",function(e){1==wa._resultPage&&wa._resultRank?fe(wa._resultRank[wa.id]):(wa.practicing&&(wa.room.gaming=!0,l("leave")),wa.resulting=!1,ca.dialog.result.hide(),wa.admin||delete wa._replay,wa.admin||delete wa._resultRank,ca.box.room.height(360),qe("lobby"),Me(),D())}),ca.dialog.resultSave.on("click",function(e){var i=new Date(ma.time),n=JSON.stringify(ma)+$a;t=new Blob([n],{type:"text/plain"}),a=URL.createObjectURL(t),o="KKuTu"+i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()+" "+i.getHours()+"-"+i.getMinutes()+"-"+i.getSeconds()+".bkr",r=$("<a>").attr({download:o,href:a}).on("click",function(e){r.remove()}),$("#Jungle").append(r),r[0].click()}),ca.dialog.dictInjeong.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||$("#dict-theme").val()&&(a.prop("disabled",!0),$("#dict-output").html(L.searching),$.get("/injeong/"+$("#dict-input").val()+"?theme="+$("#dict-theme").val(),function(e){if(p(function(){a.prop("disabled",!1)},2e3),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(L.wpSuccess+"("+e.message+")")}))}),ca.dialog.dictSearch.on("click",function(e){var a=$(e.currentTarget);a.is(":disabled")||(a.prop("disabled",!0),$("#dict-output").html(L.searching),T($("#dict-input").val(),function(e){if(p(function(){a.prop("disabled",!1)},500),e.error)return $("#dict-output").html(e.error+": "+L["wpFail_"+e.error]);$("#dict-output").html(Le(e.word,e.mean,e.theme,e.type.split(",")))}))}).hotkey($("#dict-input"),13),ca.dialog.wordPlusOK.on("click",function(e){var a;ca.dialog.wordPlusOK.hasClass("searching")||(a=$("#wp-input").val())&&((a=a.replace(/[^a-z가-힣]/g,"")).length<2||($("#wp-input").val(""),$(e.currentTarget).addClass("searching").html("<i class='fa fa-spin fa-spinner'></i>"),l("wp",{value:a})))}).hotkey($("#wp-input"),13),ca.dialog.inviteRobot.on("click",function(e){X("AI")}),ca.box.me.on("click",function(e){Y(wa.id)}),ca.dialog.roomInfoJoin.on("click",function(e){ca.dialog.roomInfo.hide(),Ze(wa._roominfo)}),ca.dialog.profileHandover.on("click",function(e){confirm(L.sureHandover)&&l("handover",{target:wa._profiled})}),ca.dialog.profileFriendAdd.on("click",function(e){wa.users[$("#find-target").val()]?l("friendAdd",{target:$("#find-target").val()},!0):aa(450)}),ca.dialog.profileKick.on("click",function(e){l("kick",{robot:wa.robots.hasOwnProperty(wa._profiled),target:wa._profiled})}),ca.dialog.profileShut.on("click",function(e){var a=wa.users[wa._profiled];a&&A(a.profile.title||a.profile.name)}),ca.dialog.profileWhisper.on("click",function(e){var a=wa.users[wa._profiled];ca.talk.val("/e "+(a.profile.title||a.profile.name).replace(/\s/g,"")+" ").focus()}),ca.dialog.profileReport.on("click",function(e){var a=wa.users[wa._profiled];c(ca.dialog.reportDiag),$("#report-target").text(a.id),$("#submitter").text(wa.id)}),ca.dialog.profileDress.on("click",function(e){return wa.guest?aa(421):wa._gaming?aa(438):void(c(ca.dialog.dress)&&$.get("/box",function(e){if(e.error)return aa(e.error);wa.box=e,K()}))}),ca.dialog.dressOK.on("click",function(e){$(e.currentTarget).attr("disabled",!0),$.post("/exordial",{data:$("#dress-exordial").val()},function(e){if(ca.dialog.dressOK.attr("disabled",!1),e.error)return aa(e.error);ca.dialog.dress.hide()})}),ca.dialog.dressOK.on("click",function(e){if($("#dress-nickname").val()!=wa.nickname)return $("#dress-nickname").val()?/[(ㄱ-ㅎ)]/gi.test($("#dress-nickname").val())?w("닉네임을 자음만으로 지정하실 수 없습니다."):/[(가-힣a-zA-Z)]/gi.test($("#dress-nickname").val())?$("#dress-nickname").val().match("<")?w("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match(">")?w("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match("&lt")?w("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match("　")?w("닉네임에 잘못된 문자가 포함되어 있습니다."):$("#dress-nickname").val().match("불건전닉네임")?w("이 닉네임은 닉네임으로 지정할 수 없습니다."):$("#dress-nickname").val().match("잘못된닉네임")?w("이 닉네임은 닉네임으로 지정할 수 없습니다."):($(e.currentTarget).attr("disabled",!0),alert(`닉네임이 ${Pe($("#dress-nickname").val())}(으)로 변경되었습니다.`),void $.post("/nickname",{data:Pe($("#dress-nickname").val())},function(e){if(ca.dialog.dressOK.attr("disabled",!1),e.error)return aa(e.error);ca.dialog.dress.hide()})):w("닉네임에 잘못된 문자가 포함되어 있습니다."):w("닉네임을 입력해 주세요.")}),$("#DressDiag .dress-type").on("click",function(e){var a=$(e.currentTarget),o=a.attr("id").slice(11);$(".dress-type.selected").removeClass("selected"),a.addClass("selected"),J("all"==o||a.attr("value"))}),$("#dress-cf").on("click",function(e){if(wa._gaming)return aa(438);c(ca.dialog.charFactory)&&H()}),ca.dialog.cfCompose.on("click",function(e){if(!ca.dialog.cfCompose.hasClass("cf-composable"))return aa(436);confirm(L.cfSureCompose)&&$.post("/cf",{tray:wa._tray.join("|")},function(e){var a;if(e.error)return aa(e.error);for(a in l("refresh"),alert(L.cfComposed),wa.users[wa.id].money=e.money,wa.box=e.box,e.gain)Qe(e.gain[a]);K(wa._avGroup),B(),H()})}),$("#room-injeong-pick").on("click",function(e){var a,o=na[ra[$("#room-mode").val()]];for(a in $("#injpick-list>div").hide(),"ko"==o.lang?(wa._ijkey="#ko-pick-",$("#ko-pick-list").show()):"en"==o.lang&&(wa._ijkey="#en-pick-",$("#en-pick-list").show()),ca.dialog.injPickNo.trigger("click"),wa._injpick)$(wa._ijkey+wa._injpick[a]).prop("checked",!0);c(ca.dialog.injPick)}),ca.dialog.injPickAll.on("click",function(e){$("#injpick-list input").prop("checked",!0)}),ca.dialog.injPickNo.on("click",function(e){$("#injpick-list input").prop("checked",!1)}),ca.dialog.kickVoteY.on("click",function(e){l("kickVote",{agree:!0}),clearTimeout(wa._kickTimer),ca.dialog.kickVote.hide()}),ca.dialog.kickVoteN.on("click",function(e){l("kickVote",{agree:!1}),clearTimeout(wa._kickTimer),ca.dialog.kickVote.hide()}),ca.dialog.reportSubmit.on("click",function(e){$.post("/report",{target:$("#report-target").text(),submitter:wa.id,reason:$("#report-reason").val()}),alert(`신고가 완료되었습니다.\n\n대상: ${$("#report-target").text()}\n신고자: ${wa.id}\n사유: ${$("#report-reason").val()}`)}),ca.dialog.purchaseOK.on("click",function(e){$.post("/buy/"+wa._sgood,function(e){var a=wa.users[wa.id];if(e.error)return aa(e.error);alert(L.purchased),a.money=e.money,a.box=e.box,B()}),ca.dialog.purchase.hide()}),ca.dialog.purchaseNO.on("click",function(e){ca.dialog.purchase.hide()}),ca.menu.cursing.click(function(){var e;ca.dialog.cursing.toggle(),"block"==ca.dialog.cursing.css("display")&&(e=ca.dialog.cursingValue,"NONE"==ja&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">확인된 욕설이 없습니다.(횟수: ${Ba.toString()})</div>`),"LIT"==ja&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 낮음(사용횟수: ${Ba.toString()})</div>`),"LOW"==ja&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">낮음(사용횟수: ${Ba.toString()})</div>`),"MID"==ja&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">조금 높음(사용횟수: ${Ba.toString()})</div>`),"HIGH"==ja&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">높음(사용횟수: ${Ba.toString()})</div>`),"WARN"==ja&&e.html(`<h4>욕설 사용량:</h4><div id="cursing-count">매우 높음(사용횟수: ${Ba.toString()})</div>`))}),ca.dialog.obtainOK.on("click",function(e){var a=wa._obtain.shift();a?Ye(a):ca.dialog.obtain.hide()}),ca.dialog.alertKKuTuOK.on("click",function(e){ca.dialog.alertKKuTu.hide()}),ca.dialog.newClan.on("click",function(e){c(ca.dialog.newClanDiag)}),ca.dialog.viewClan.on("click",function(e){c(ca.dialog.viewClanDiag),$.get(`/clan?type=getclan&id=${wa.id}`,function(e){if(e.name){var a,o=xe(e.score);for(a in $("#deleteClan").hide(),$("#kickTarget").hide(),$("#kickUser").hide(),$("#leaveClan").show(),$("#extendMax").hide(),0==e.perm?($("#deleteClan").show(),$("#kickTarget").show(),$("#kickUser").show(),$("#leaveClan").hide(),$("#extendMax").show()):1==e.perm&&($("#kickTarget").show(),$("#kickUser").show(),$("#extendMax").show()),$("#myClanName").html(`클랜 이름: ${e.name}`),$("#myClanID").html(`클랜 ID: ${e.id}`),$("#myClanMax").html(`클랜원 수: ${Object.keys(e.users).length}/${e.max}명`),$("#myClanActivate").html(`클랜 활동량: ${e.score}`),$("#clanUserList tbody").empty(),$("#myClanLevel").attr("src",`/img/kkutu/clanlv/lv${o}.png`),Object.keys(e.users))$("#clanUserList").append($("<tr>").attr("id","clanuser-bf").html(Object.keys(e.users)[a]))}else alert("클랜에 가입하지 않았습니다."),ca.dialog.viewClanDiag.hide()})}),ca.dialog.deleteClan.on("click",function(e){$.get(`/clan?type=getclan&id=${wa.id}`,function(e){confirm(`정말 ${e.name} 클랜을 삭제하시겠습니까?`)&&(0==e.users[wa.id]?($.get(`/clan?type=delete&id=${e.id}`),alert(`${e.name} 클랜이 삭제되었습니다.`),ca.dialog.viewClanDiag.hide()):alert("클랜 마스터만 클랜을 삭제할 수 있습니다."))})}),ca.dialog.makeClan.on("click",function(e){var a=$("#clanName").val();$.get(`/clan?type=getclan&id=${wa.id}`,function(e){e.name?null==e.name?(alert("이미 클랜에 가입되어 있습니다!"),ca.dialog.newClanDiag.hide()):alert("이미 클랜에 가입되어 있습니다!"):null==a?alert("클랜 이름을 자음만으로 지정하실 수 없습니다."):null==a?alert("클랜 이름을 자음만으로 지정하실 수 없습니다."):/[(ㄱ-ㅎ)]/gi.test(a)?alert("클랜 이름을 자음만으로 지정하실 수 없습니다."):/[(가-힣a-zA-Z)]/gi.test(a)?a.length>8?alert("클랜 이름 길이 제한은 최대 8글자까지입니다."):a.match("<")?alert("클랜 이름에 잘못된 문자가 포함되어 있습니다."):a.match(">")?alert("클랜 이름에 잘못된 문자가 포함되어 있습니다."):a.match("&lt")?alert("클랜 이름에 잘못된 문자가 포함되어 있습니다."):a.match("　")?alert("클랜 이름에 잘못된 문자가 포함되어 있습니다."):(a=Pe(a),$.get(`/clan?type=create&id=${wa.id}&clanname=${a}`,function(e){"MONEYFAIL"==e.message?(alert("핑이 부족합니다! (10000핑 필요)"),ca.dialog.newClanDiag.hide()):(alert(`10000핑을 소비하여 ${a} 클랜을 만들었습니다!`),ca.dialog.newClanDiag.hide())})):alert("클랜 이름에 잘못된 문자가 포함되어 있습니다.")})}),ca.dialog.kickUser.on("click",function(e){$.get(`/clan?type=getclan&id=${wa.id}`,function(e){var a=$("#kickTarget").val(),o=confirm(`정말 ${a}님을 추방하시겠습니까?`);o&&a===wa.id?alert("자기 자신은 추방할 수 없습니다!"):o&&2==e.users[wa.id]?alert("클랜 마스터와 클랜 관리자만 추방할 수 있습니다."):o&&$.get(`/clan?type=removeuser&userid=${a}&clanid=${e.id}`,function(e){"FAIL"==e.message?alert("추방 실패! 추방 대상 유저 ID가 잘못되었을 수 있습니다."):alert(`${a}님을 추방했습니다!`)})})}),ca.dialog.extendMax.on("click",function(e){$.get(`/clan?type=getclan&id=${wa.id}`,function(e){var a=confirm(`5000핑을 소비하여 클랜원 제한을 ${Number(e.max)+10}명으로 늘리시겠습니까?`);a&&0!=e.users[wa.id]?alert("클랜 마스터만 확장할 수 있습니다."):a&&$.get(`/clan?type=extend&clanid=${e.id}&masterid=${wa.id}`,function(a){"FAIL"==a.message?alert("알 수 없는 문제로 인해 실패했습니다."):"LOWPERM"==a.message?alert("권한이 부족합니다."):"MAX"==a.message?alert("클랜 확장 한도에 도달했습니다. (50명)"):(alert(`클랜원 제한을 ${Number(e.max)+10}명으로 늘렸습니다.`),ca.dialog.viewClanDiag.hide(),ca.dialog.viewClan.trigger("click"))})})}),ca.dialog.joinClan.on("click",function(e){$.get(`/clan?type=getclan&id=${wa.id}`,function(e){if(e.name)alert("이미 클랜에 가입되어 있습니다.");else{var a=$("#joinTarget").val();$.get(`/clan?type=adduser&userid=${wa.id}&clanid=${a}&userp=2`,function(e){"FAIL"==e.message?alert("가입 실패! 가입 대상 클랜 ID가 잘못되었을 수 있습니다."):"USERLIMITFAIL"==e.message?alert("가입 실패! 클랜원 한도에 도달한 클랜입니다."):alert(`${a} 클랜에 가입했습니다!`)})}})}),ca.dialog.leaveClan.on("click",function(e){$.get(`/clan?type=getclan&id=${wa.id}`,function(e){e.name?confirm(`정말 ${e.name} 클랜을 떠나시겠습니까?`)&&$.get(`/clan?type=removeuser&userid=${wa.id}&clanid=${e.id}`,function(a){"FAIL"==a.message?(alert("알 수 없는 오류로 인해 클랜 탈퇴에 실패했습니다."),ca.dialog.viewClanDiag.hide()):(alert(`${e.name} 클랜을 떠났습니다!`),ca.dialog.viewClanDiag.hide())}):alert("클랜에 가입되어 있지 않습니다!")})}),ca.dialog.promptKKuTuOK.on("click",function(e){var a=$("#prompt-input").val();return ca.dialog.promptKKuTu.hide(),null==a?k():null==a?k():/[(ㄱ-ㅎ)]/gi.test(a)?(alert("닉네임을 자음만으로 지정하실 수 없습니다."),k()):/[(가-힣a-zA-Z)]/gi.test(a)?a.length>10?(alert("닉네임 길이 제한은 최대 10글자까지입니다."),k()):a.match("<")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):a.match(">")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):a.match("&lt")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):a.match("　")?(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k()):a.match("불건전닉네임")?(alert("이 닉네임은 닉네임으로 지정할 수 없습니다."),k()):a.match("잘못된닉네임")?(alert("이 닉네임은 닉네임으로 지정할 수 없습니다."),k()):(alert("닉네임 설정이 완료되었습니다. 새로고침 해주세요."),$.post("/nickname",{data:Pe(a)}),void $.get(`/newUser?id=${wa.id}&cp=${wa.id}cp`)):(alert("닉네임에 잘못된 문자가 포함되어 있습니다."),k())}),n=0;n<5;n++)$("#team-"+n).on("click",r),$("#room-unknownword.game-option").click(()=>$("#room-unknownword.game-option").is(":checked")?$(".game-option").not("#room-unknownword.game-option").not("#room-mission.game-option").not("#room-abcmission.game-option").not("#room-moremission.game-option").not("#room-returns.game-option").not("#room-randomturn.game-option").not("#room-ignoreinitial.game-option").prop("checked",!1).prop("disabled",!0):$(".game-option").prop("disabled",!1));$("#replay-file").on("change",function(e){var a=e.target.files[0],o=new FileReader,r=$("#replay-date").html("-"),t=$("#replay-version").html("-"),i=$("#replay-players").html("-");ma=!1,ca.dialog.replayView.attr("disabled",!0),a&&(o.readAsText(a),o.onload=function(e){var a,o;try{if(-1==e.target.result.indexOf($a))alert("BF끄투의 리플레이 파일이 아닌 것 같습니다."),ca.dialog.replayView.attr("disabled",!0);else{for(a in security=e.target.result.replace($a,""),o=JSON.parse(security),r.html(new Date(o.time).toLocaleString()),t.html(o.version),i.empty(),o.players){var n,s=o.players[a];i.append(n=$("<div>").addClass("replay-player-bar ellipse").html(s.title).prepend(De(s.data.score).addClass("users-level"))),s.id==o.me&&n.css("font-weight","bold")}ma=o,ca.dialog.replayView.attr("disabled",!1)}}catch(e){return console.warn(e),alert(L.replayError)}})}),ca.dialog.replayView.on("click",function(e){!function(){var e;for(e in le(),wa._replay=!0,wa.room={title:ma.title,players:[],events:[],time:ma.roundTime,round:ma.round,mode:ma.mode,limit:ma.limit,game:ma.game,opts:ma.opts,readies:ma.readies},oe(),ma.events)wa.room.events.push(ma.events[e]);ca.box.userList.hide(),ca.box.roomList.hide(),ca.box.game.show(),ca.dialog.replay.hide(),ae(),P(!0),wa.$gp=$(".GameBox .product-title").empty().append(wa.$gpt=$("<div>").addClass("game-replay-title")).append(wa.$gpc=$("<div>").addClass("game-replay-controller").append($("<button>").html(L.replayNext).on("click",ie)).append($("<button>").html(L.replayPause).on("click",te)).append($("<button>").html(L.replayPrev).on("click",re))),wa._gpp=L.replay+" - "+new Date(ma.time).toLocaleString(),wa._gtt=wa.room.events[wa.room.events.length-1].time,wa._eventTime=0,wa._rt=p(se,2e3),wa._rprev=0,wa._rpause=!1,ne()}()}),u(function(){Sa>0?Sa=0:Da>0&&(Da-=.03)},1e3)}),Ca.Classic.roundReady=function(e){wa.room.game.title.length,ce(),wa._roundTime=1e3*wa.room.time,ca.game.display.html(Ae(e.char,e.subChar)),ca.game.chain.show().html(wa.chain=0),wa.room.opts.mission&&ca.game.items.show().css("opacity",1).html(wa.mission=e.mission),"KAP"==ra[wa.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),me(e.round),ze("round_start"),de("roundReady")},Ca.Classic.turnStart=function(e){wa.room.game.turn=e.turn,e.seq&&(wa.room.game.seq=e.seq),(wa._tid=wa.room.game.seq[e.turn])&&(wa._tid.robot&&(wa._tid=wa._tid.id),e.id=wa._tid,ca.game.display.html(wa._char=Ae(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),wa._replay||(ca.game.here.css("display",e.id==wa.id?"block":"none"),e.id==wa.id&&(ua?ca.game.hereText.val("").focus():ca.talk.focus())),ca.game.items.html(wa.mission=e.mission),la.onmessage=_onMessage,clearInterval(wa._tTime),wa._chars=[e.char,e.subChar],wa._speed=e.speed,wa._tTime=u(ue,ha),wa.turnTime=e.turnTime,wa._turnTime=e.turnTime,wa._roundTime=e.roundTime,wa._turnSound=ze("T"+e.speed),de("turnStart"))},Ca.Classic.turnGoing=function(){wa.room||clearInterval(wa._tTime),wa._turnTime-=ha,wa._roundTime-=ha,ca.game.turnBar.width(wa._timePercent()).html((.001*wa._turnTime).toFixed(1)+L.SECOND),ca.game.roundBar.width(wa._roundTime/wa.room.time*.1+"%").html((.001*wa._roundTime).toFixed(1)+L.SECOND),ca.game.roundBar.hasClass("round-extreme")||wa._roundTime<=5e3&&ca.game.roundBar.addClass("round-extreme")},Ca.Classic.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");wa._turnSound&&wa._turnSound.stop(),ge(e,a.score),clearInterval(wa._tTime),a.ok?(ee(),clearTimeout(wa._fail),ca.game.here.hide(),ca.game.chain.html(++wa.chain),ye(a.value,a.mean,a.theme,a.wc)):(ee(e),r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),ca.game.here.hide(),ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(wa._chars[0]))&&(o=a.hint.indexOf(wa._chars[1])),"KAP"==ra[wa.room.mode]?ca.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,o))).append($("<label>").html(a.hint.slice(o))):ca.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ua?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);he(t,e)},500)),he(t,r).removeClass("game-user-current"),G(e,pe(e))},Ca.DaneoClassic.roundReady=function(e){wa.room.game.title.length,ce(),wa._roundTime=1e3*wa.room.time,ca.game.display.html(wa._char="&lt;"+L["theme_"+e.theme]+"&gt;"),ca.game.chain.show().html(wa.chain=0),wa.room.opts.mission&&ca.game.items.show().css("opacity",1).html(wa.mission=e.mission),"KAP"==ra[wa.room.mode]&&$(".jjoDisplayBar .graph-bar").css({float:"right","text-align":"left"}),me(e.round),ze("round_start"),de("roundReady")},Ca.DaneoClassic.turnStart=function(e){wa.room.game.turn=e.turn,e.seq&&(wa.room.game.seq=e.seq),(wa._tid=wa.room.game.seq[e.turn])&&(wa._tid.robot&&(wa._tid=wa._tid.id),e.id=wa._tid,ca.game.display.html(wa._char=Ae(e.char,e.subChar,e.wordLength)),$("#game-user-"+e.id).addClass("game-user-current"),wa._replay||(ca.game.here.css("display",e.id==wa.id?"block":"none"),e.id==wa.id&&(ua?ca.game.hereText.val("").focus():ca.talk.focus())),ca.game.items.html(wa.mission=e.mission),la.onmessage=_onMessage,clearInterval(wa._tTime),wa._chars=[e.char,e.subChar],wa._speed=e.speed,wa._tTime=u(ue,ha),wa.turnTime=e.turnTime,wa._turnTime=e.turnTime,wa._roundTime=e.roundTime,wa._turnSound=ze("T"+e.speed),de("turnStart"))},Ca.DaneoClassic.turnGoing=Ca.Classic.turnGoing,Ca.DaneoClassic.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");wa._turnSound&&wa._turnSound.stop(),ge(e,a.score),clearInterval(wa._tTime),a.ok?(ee(),clearTimeout(wa._fail),ca.game.here.hide(),ca.game.chain.html(++wa.chain),ye(a.value,a.mean,a.theme,a.wc)):(ee(e),r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),ca.game.here.hide(),ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(wa._chars[0]))&&(o=a.hint.indexOf(wa._chars[1])),"KAP"==ra[wa.room.mode]?ca.game.display.empty().append($("<label>").css("color","#AAAAAA").html(a.hint.slice(0,o))).append($("<label>").html(a.hint.slice(o))):ca.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ua?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);he(t,e)},500)),he(t,r).removeClass("game-user-current"),G(e,pe(e))},Ca.Jaqwi.roundReady=function(e){var a=L.jqTheme+": "+L["theme_"+e.theme];ce(),wa._roundTime=1e3*wa.room.time,wa._fastTime=1e4,ca.game.display.html(a),ca.game.items.hide(),ca.game.hints.show(),$(".jjo-turn-time .graph-bar").width("100%").html(a).css("text-align","center"),me(e.round),ze("round_start"),clearInterval(wa._tTime)},Ca.Jaqwi.turnStart=function(e){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),wa.room.game.seq.indexOf(wa.id)>=0&&ca.game.here.show(),ca.game.display.html(wa._char=e.char),clearInterval(wa._tTime),wa._tTime=u(ue,ha),qe("jaqwi")},Ca.Jaqwi.turnGoing=function(){var e,a,o=ca.game.roundBar;wa.room||clearInterval(wa._tTime),wa._roundTime-=ha,a=wa._spectate?L.stat_spectate:(.001*wa._roundTime).toFixed(1)+L.SECOND,o.width(wa._roundTime/wa.room.time*.1+"%").html(a),o.hasClass("round-extreme")||wa._roundTime<=wa._fastTime&&(e=wa.bgm.currentTime/wa.bgm.duration,wa.bgm.paused?Oe():qe("jaqwiF"),wa.bgm.currentTime=wa.bgm.duration*e,o.addClass("round-extreme"))},Ca.Jaqwi.turnHint=function(e){ze("mission"),we(e.hint)},Ca.Jaqwi.turnEnd=function(e,a){var o=$("<div>").addClass("deltaScore").html("+"+a.score),r=$("#game-user-"+e);a.giveup?r.addClass("game-user-bomb"):a.answer?(ca.game.here.hide(),ca.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),Oe(),ze("horr")):(e==wa.id&&ca.game.here.hide(),ge(e,a.score),wa._roundTime>1e4&&(wa._roundTime=1e4),he(r,o),G(e,pe(e)).addClass("game-user-current"),ze("success"))},Ca.Crossword.roundReady=function(e,a){var o=e.seq?e.seq.indexOf(wa.id):-1;ce(),$(".jjoriping,.rounds,.game-body").addClass("cw"),wa._roundTime=1e3*wa.room.time,wa._fastTime=3e4,wa.selectedRound=-1==o?1:o%wa.room.round+1,ca.game.items.hide(),ca.game.cwcmd.show().css("opacity",0),me(wa.selectedRound),a||ze("round_start"),clearInterval(wa._tTime)},Ca.Crossword.turnEnd=function(e,a){var o,r,t=$("<div>").addClass("deltaScore").html("+"+a.score),i=$("#game-user-"+e);a.score?(r=a.pos.join(","),e==wa.id?(ca.game.cwcmd.css("opacity",0),ze("success")):(wa._sel&&a.pos.join(",")==wa._sel.join(",")&&ca.game.cwcmd.css("opacity",0),ze("mission")),wa._bdb[r][4]=a.value,wa._bdb[r][5]=e,a.pos[0]==wa.selectedRound-1?Ca.Crossword.drawDisplay():(o=$(ca.game.round.children("label").get(a.pos[0])).addClass("round-effect"),p(function(){o.removeClass("round-effect")},800)),ge(e,a.score),G(e,pe(e)),he(i,t)):(Oe(),ca.game.round.empty(),ze("horr"))},Ca.Crossword.drawDisplay=function(){var e,a,o,r,t,i,n,s,l,d=wa._boards[wa.selectedRound-1],c=ca.game.display.empty(),m={};for(a in d)for(r=Number(d[a][0]),t=Number(d[a][1]),i="1"==d[a][2],n=Number(d[a][3]),s=d[a][4],c.append(e=$("<div>").addClass("cw-bar").attr("id","cw-"+r+"-"+t+"-"+d[a][2]).css({top:12.5*t+"%",left:12.5*r+"%",width:12.5*(i?1:n)+"%",height:12.5*(i?n:1)+"%"})),s&&e.addClass("cw-open"),d[a][5]==wa.id?e.addClass("cw-my-open"):e.on("click",Ca.Crossword.onBar).on("mouseleave",Ca.Crossword.onSwap),o=0;o<n;o++)l=r+"-"+t,s&&(m[l]=s.charAt(o)),e.append($("<div>").addClass("cw-cell").attr("id","cwc-"+l).html(m[l]||"")),i?t++:r++},Ca.Crossword.onSwap=function(e){ca.game.display.prepend($(e.currentTarget))},Ca.Crossword.onRound=function(e){var a=$(e.currentTarget).html().charCodeAt(0)-9311;me(wa.selectedRound=a),$(".rounds label").on("click",Ca.Crossword.onRound),Ca.Crossword.drawDisplay()},Ca.Crossword.onBar=function(e){var a=$(e.currentTarget).attr("id").slice(3).split("-"),o=wa._means[wa.selectedRound-1][a.join(",")],r="1"==o.dir;ca.game.cwcmd.css("opacity",1),wa._sel=[wa.selectedRound-1,a[0],a[1],a[2]],$(".cw-q-head").html(L[r?"cwVert":"cwHorz"]+o.len+L.cwL),$("#cw-q-input").val("").focus(),$(".cw-q-body").html(Le(0,o.mean,o.theme,o.type.split(",")))},Ca.Crossword.turnStart=function(e,a){var o,r;for(o in wa._bdb={},wa._boards=e.boards,wa._means=e.means,e.boards)for(r in e.boards[o])wa._bdb[[o,e.boards[o][r][0],e.boards[o][r][1],e.boards[o][r][2]].join(",")]=e.boards[o][r];$(".rounds label").on("click",Ca.Crossword.onRound),Ca.Crossword.drawDisplay(),clearInterval(wa._tTime),wa._tTime=u(ue,ha),qe("jaqwi")},Ca.Crossword.turnGoing=Ca.Jaqwi.turnGoing,Ca.Crossword.turnHint=function(e){ze("fail")},Ca.Typing.roundReady=function(e){wa.room.game.title.length,wa._chatter=ua?ca.game.hereText:ca.talk,ce(),wa._round=e.round,wa._roundTime=1e3*wa.room.time,wa._fastTime=1e4,wa._list=e.list.concat(e.list),wa.chain=0,a(),me(e.round),ze("round_start"),de("roundReady")},Ca.Typing.spaceOn=function(){wa.room.opts.proverb||(wa._spaced=!0,$("body").on("keydown","#"+wa._chatter.attr("id"),e))},Ca.Typing.spaceOff=function(){wa.admin||delete wa._spaced,$("body").off("keydown","#"+wa._chatter.attr("id"),e)},Ca.Typing.turnStart=function(e){wa._spectate||(ca.game.here.show(),ua?ca.game.hereText.val("").focus():ca.talk.val("").focus(),Ca.Typing.spaceOn()),la.onmessage=_onMessage,clearInterval(wa._tTime),wa._tTime=u(ue,ha),wa._roundTime=e.roundTime,qe("jaqwi"),de("turnStart")},Ca.Typing.turnGoing=Ca.Jaqwi.turnGoing,Ca.Typing.turnEnd=function(e,o){var r=$("<div>").addClass("deltaScore").html("+"+o.score),i=$("#game-user-"+e);o.error?(wa.chain++,a(),ze("fail")):o.ok?(wa.id==e?(wa.chain++,a(),ze("mission"),Ce(o.value,"")):wa._spectate&&ze("mission"),ge(e,o.score),he(i,r),G(e,pe(e))):(clearInterval(wa._tTime),Ca.Typing.spaceOff(),ca.game.here.hide(),Oe(),ze("horr"),p(n,1e3,o.speed),wa._round<wa.room.round&&t(10))},Ca.Hunmin.roundReady=function(e){wa.room.game.title.length,ce(),wa._roundTime=1e3*wa.room.time,ca.game.display.html(wa._char="&lt;"+e.theme+"&gt;"),ca.game.chain.show().html(wa.chain=0),wa.room.opts.mission&&ca.game.items.show().css("opacity",1).html(wa.mission=e.mission),me(e.round),ze("round_start"),de("roundReady")},Ca.Hunmin.turnStart=function(e){wa.room.game.turn=e.turn,e.seq&&(wa.room.game.seq=e.seq),wa._tid=wa.room.game.seq[e.turn],wa._tid.robot&&(wa._tid=wa._tid.id),e.id=wa._tid,ca.game.display.html(wa._char),$("#game-user-"+e.id).addClass("game-user-current"),wa._replay||(ca.game.here.css("display",e.id==wa.id?"block":"none"),e.id==wa.id&&(ua?ca.game.hereText.val("").focus():ca.talk.focus())),ca.game.items.html(wa.mission=e.mission),la.onmessage=_onMessage,clearInterval(wa._tTime),wa._chars=[e.char,e.subChar],wa._speed=e.speed,wa._tTime=u(ue,ha),wa.turnTime=e.turnTime,wa._turnTime=e.turnTime,wa._roundTime=e.roundTime,wa._turnSound=ze("T"+e.speed),de("turnStart")},Ca.Hunmin.turnGoing=Ca.Classic.turnGoing,Ca.Hunmin.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");wa._turnSound.stop(),ge(e,a.score),clearInterval(wa._tTime),a.ok?(clearTimeout(wa._fail),ca.game.here.hide(),ca.game.chain.html(++wa.chain),ye(a.value,a.mean,a.theme,a.wc)):(r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),ca.game.here.hide(),ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(wa._chars[0]))&&(o=a.hint.indexOf(wa._chars[1])),ca.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ua?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);he(t,e)},500)),he(t,r).removeClass("game-user-current"),G(e,pe(e))},Ca.Daneo.roundReady=function(e){wa.room.game.title.length,ce(),wa._roundTime=1e3*wa.room.time,ca.game.display.html(wa._char="&lt;"+L["theme_"+e.theme]+"&gt;"),ca.game.chain.show().html(wa.chain=0),wa.room.opts.mission&&ca.game.items.show().css("opacity",1).html(wa.mission=e.mission),me(e.round),ze("round_start"),de("roundReady")},Ca.Daneo.turnStart=function(e){wa.room.game.turn=e.turn,e.seq&&(wa.room.game.seq=e.seq),wa._tid=wa.room.game.seq[e.turn],wa._tid.robot&&(wa._tid=wa._tid.id),e.id=wa._tid,ca.game.display.html(wa._char),$("#game-user-"+e.id).addClass("game-user-current"),wa._replay||(ca.game.here.css("display",e.id==wa.id?"block":"none"),e.id==wa.id&&(ua?ca.game.hereText.val("").focus():ca.talk.focus())),ca.game.items.html(wa.mission=e.mission),la.onmessage=_onMessage,clearInterval(wa._tTime),wa._chars=[e.char,e.subChar],wa._speed=e.speed,wa._tTime=u(ue,ha),wa.turnTime=e.turnTime,wa._turnTime=e.turnTime,wa._roundTime=e.roundTime,wa._turnSound=ze("T"+e.speed),de("turnStart")},Ca.Daneo.turnGoing=Ca.Classic.turnGoing,Ca.Daneo.turnEnd=function(e,a){var o,r=$("<div>").addClass("deltaScore").html(a.score>0?"+"+(a.score-a.bonus):a.score),t=$(".game-user-current");wa._turnSound.stop(),ge(e,a.score),clearInterval(wa._tTime),a.ok?(clearTimeout(wa._fail),ca.game.here.hide(),ca.game.chain.html(++wa.chain),ye(a.value,a.mean,a.theme,a.wc)):(r.addClass("lost"),$(".game-user-current").addClass("game-user-bomb"),ca.game.here.hide(),ze("timeout")),a.hint&&(a.hint=a.hint._id,-1==(o=a.hint.indexOf(wa._chars[0]))&&(o=a.hint.indexOf(wa._chars[1])),ca.game.display.empty().append($("<label>").html(a.hint.slice(0,o+1))).append($("<label>").css("color","#AAAAAA").html(a.hint.slice(o+1)))),a.bonus&&(ua?r.html("+"+(b.score-b.bonus)+"+"+b.bonus):p(function(){var e=$("<div>").addClass("deltaScore bonus").html("+"+a.bonus);he(t,e)},500)),he(t,r).removeClass("game-user-current"),G(e,pe(e))},Ca.Drawing.roundReady=function(e,a){L.jqTheme,L["theme_"+e.theme],ce(),$(".jjoriping,.rounds,.game-body").addClass("cw"),$(".jjoriping,.rounds").addClass("dg"),$(".game-user-drawing").removeClass("game-user-drawing"),ca.game.tools.hide(),wa._relay=!1,wa._roundTime=1e3*wa.room.time,wa._fastTime=1e4,ca.game.items.hide(),ca.game.hints.show(),ca.game.cwcmd.show().css("opacity",0),wa.id===e.painter?(console.log("i'm painter!"),wa._isPainter=!0):wa._isPainter=!1,$("#game-user-"+e.painter).addClass("game-user-drawing"),me(e.round),ze("round_start"),clearInterval(wa._tTime)},Ca.Drawing.turnStart=function(e,a){$(".game-user-current").removeClass("game-user-current"),$(".game-user-bomb").removeClass("game-user-bomb"),wa.room.game.seq.indexOf(wa.id)>=0&&(wa._isPainter?($("#drawing-line-width").change(function(){console.log(this.value),ca.game.canvas.freeDrawingBrush.width=this.value,l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$("#drawing-color").change(function(){console.log(this.value),ca.game.canvas.freeDrawingBrush.color=this.value,l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$("#drawing-clear").click(function(){console.log("clear"),ca.game.canvas.clear(),l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-red").click(function(){console.log("change red"),ca.game.canvas.freeDrawingBrush.color="#FF0000",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-orange").click(function(){console.log("change orange"),ca.game.canvas.freeDrawingBrush.color="#FFA500",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-yellow").click(function(){console.log("change yellow"),ca.game.canvas.freeDrawingBrush.color="#FFFF00",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-green").click(function(){console.log("change green"),ca.game.canvas.freeDrawingBrush.color="#008000",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-blue").click(function(){console.log("change blue"),ca.game.canvas.freeDrawingBrush.color="#0000FF",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-indigo").click(function(){console.log("change indigo"),ca.game.canvas.freeDrawingBrush.color="#4B0082",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-violet").click(function(){console.log("change red"),ca.game.canvas.freeDrawingBrush.color="#9400D3",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-black").click(function(){console.log("change black"),ca.game.canvas.freeDrawingBrush.color="#000000",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),$(".button-color#color-white").click(function(){console.log("change white"),ca.game.canvas.freeDrawingBrush.color="#FFFFFF",l("drawingCanvas",{data:JSON.stringify(ca.game.canvas)},!1)}),ca.game.drawingTitle.text(e.word),ca.game.themeisTitle.text(L["theme_"+e.theme]),ca.game.hints.hide(),ca.game.tools.show(),$(".rounds").removeClass("dg"),$(".rounds").addClass("painter")):(ca.game.hints.show(),ca.game.tools.hide(),wa._relay=!0)),Ca.Drawing.drawDisplay(),clearInterval(wa._tTime),wa._tTime=u(ue,ha),qe("jaqwi")},Ca.Drawing.turnHint=function(e){var a;a=Array.isArray(e.hint)?L["theme_"+e.hint[0]]:e.hint,ze("mission"),we(a)},Ca.Drawing.turnEnd=function(e,a){var o=$("<div>").addClass("deltaScore").html("+"+a.score),r=$("#game-user-"+e);a.giveup?(r.addClass("game-user-bomb"),wa._relay=!1):a.answer?(ca.game.here.hide(),ca.game.display.html($("<label>").css("color","#FFFF44").html(a.answer)),Oe(),ze("horr"),wa._relay=!1):(e==wa.id&&ca.game.here.hide(),ge(e,a.score),wa._roundTime>1e4&&(wa._roundTime=1e4),he(r,o),G(e,pe(e)).addClass("game-user-current"),ze("success"))},Ca.Drawing.drawDisplay=function(){ca.game.display.empty().append($("<canvas>").attr("id","canvas").css({width:"300",height:"300",left:0,top:0}).addClass("canvas"));var e=window._canvas=new fabric.Canvas("canvas");e.backgroundColor="#ffffff",e.isDrawingMode=wa._isPainter,e.setHeight(300),e.setWidth(300),e.selection=!1,$("#drawing-line-width").val(20),$("#drawing-color").val("#000000"),wa._isPainter&&e.on("mouse:up",function(a){l("drawingCanvas",{data:JSON.stringify(e)},!1)}),e.renderAll(),ca.game.canvas=e},Ca.Drawing.turnGoing=function(){var e,a,o=ca.game.roundBar;wa.room||clearInterval(wa._tTime),wa._roundTime-=ha,a=wa._spectate?L.stat_spectate:(.001*wa._roundTime).toFixed(1)+L.SECOND,o.width(wa._roundTime/wa.room.time*.1+"%").html(a),o.hasClass("round-extreme")||wa._roundTime<=wa._fastTime&&(e=wa.bgm.currentTime/wa.bgm.duration,wa.bgm.paused?Oe():qe("jaqwiF"),wa.bgm.currentTime=wa.bgm.duration*e,o.addClass("round-extreme"))},Ca.Drawing.drawCanvas=function(e){wa._isPainter||(ca.game.canvas.clear(),ca.game.canvas.loadFromJSON(e.data,ca.game.canvas.renderAll.bind(ca.game.canvas)))},Ca.Sock.roundReady=function(e,a){e.seq&&e.seq.indexOf(wa.id),ce(),wa._relay=!0,$(".jjoriping,.rounds,.game-body").addClass("cw"),wa._va=[],wa._lang=na[ra[wa.room.mode]].lang,wa._board=e.board,wa._maps=[],wa._roundTime=1e3*wa.room.time,wa._fastTime=1e4,ca.game.items.hide(),ca.game.bb.show(),Ca.Sock.drawDisplay(),me(e.round),a||ze("round_start"),clearInterval(wa._tTime)},Ca.Sock.turnEnd=function(e,a){var o,r,t,i=$("<div>").addClass("deltaScore").html("+"+a.score),n=$("#game-user-"+e);if(a.score){for(t=(o=a.value).length,wa._maps.push(o),r=0;r<t;r++)wa._board=wa._board.replace(o.charAt(r),"　");ze(e==wa.id?"success":"mission"),Ca.Sock.drawDisplay(),ge(e,a.score),G(e,pe(e)),he(n,i)}else Oe(),wa._relay=!1,ze("horr")},Ca.Sock.drawMaps=function(){ca.game.bb.empty(),wa._maps.sort(function(e,a){return a.length-e.length}).forEach(function(e){ca.game.bb.append(function(e){var a,o=$("<div>").addClass("bb-word"),r=e.length;for(a=0;a<r;a++)o.append($("<div>").addClass("bb-char").html(e.charAt(a)));return o}(e))})},Ca.Sock.drawDisplay=function(){var e,a=$("<div>").css("height","100%"),o=wa._board.split(""),r="ko"==wa._lang?"12.5%":"10%";o.forEach(function(o,t){a.append(e=$("<div>").addClass("sock-char sock-"+o).css({width:r,height:r}).html(o)),wa._va[t]&&wa._va[t]!=o&&e.html(wa._va[t]).addClass("sock-picked").animate({opacity:0},500)}),wa._va=o,ca.game.display.empty().append(a),Ca.Sock.drawMaps()},Ca.Sock.turnStart=function(e,a){clearInterval(wa._tTime),wa._tTime=u(ue,ha),qe("jaqwi")},Ca.Sock.turnGoing=Ca.Jaqwi.turnGoing,Ca.Sock.turnHint=function(e){ze("fail")};var Da=0,Sa=0,Ba=0,ja="NONE";const Ra=["KR"]}(),document.onload=function(){"Microsoft Internet Explorer"==navigator.appName&&(alert("지원하지 않는 브라우저입니다.\n다른 브라우저를 사용해 주세요."),$("#Middle").html("<center><h1><br/><font color='black'>잘못된 접근입니다.</font></h1></center>"),$("#Bottom").remove())};